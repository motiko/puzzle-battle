{"version":3,"sources":["src/types.ts","src/util.ts","src/premove.ts","src/board.ts","src/fen.ts","src/config.ts","src/anim.ts","src/draw.ts","src/drag.ts","src/explosion.ts","src/api.ts","src/state.ts","src/svg.ts","src/wrap.ts","src/drop.ts","src/events.ts","src/render.ts","src/chessground.ts","index.js","node_modules/parcel-bundler/src/builtins/hmr-runtime.js"],"names":["config","fen","board","document","getElementById","ground","OVERLAY_ID","OldModule","module","bundle","Module","moduleName","call","hot","data","hotData","_acceptCallbacks","_disposeCallbacks","accept","fn","push","dispose","checkedAssets","assetsToAccept","parent","isParcelRequire","WebSocket","hostname","location","protocol","ws","onmessage","event","JSON","parse","type","handled","assets","forEach","asset","isNew","didAccept","hmrAcceptCheck","global","parcelRequire","id","every","generated","js","console","clear","hmrApply","v","hmrAcceptRun","reload","close","onclose","log","removeErrorOverlay","error","message","stack","overlay","createErrorOverlay","body","appendChild","remove","createElement","stackTrace","innerText","innerHTML","getParents","modules","parents","k","d","dep","Array","isArray","length","concat","Function","deps","cached","cache","some","cb"],"mappings":"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","file":"puzzle-battle.e31bb0bc.js","sourceRoot":"..","sourcesContent":["export type Color = 'white' | 'black';\nexport type Role = 'king' | 'queen' | 'rook' | 'bishop' | 'knight' | 'pawn';\nexport type Key = 'a0' | 'a1' | 'b1' | 'c1' | 'd1' | 'e1' | 'f1' | 'g1' | 'h1' | 'a2' | 'b2' | 'c2' | 'd2' | 'e2' | 'f2' | 'g2' | 'h2' | 'a3' | 'b3' | 'c3' | 'd3' | 'e3' | 'f3' | 'g3' | 'h3' | 'a4' | 'b4' | 'c4' | 'd4' | 'e4' | 'f4' | 'g4' | 'h4' | 'a5' | 'b5' | 'c5' | 'd5' | 'e5' | 'f5' | 'g5' | 'h5' | 'a6' | 'b6' | 'c6' | 'd6' | 'e6' | 'f6' | 'g6' | 'h6' | 'a7' | 'b7' | 'c7' | 'd7' | 'e7' | 'f7' | 'g7' | 'h7' | 'a8' | 'b8' | 'c8' | 'd8' | 'e8' | 'f8' | 'g8' | 'h8';\nexport type File = 'a' | 'b' | 'c' | 'd' | 'e' | 'f' | 'g' | 'h';\nexport type Rank = '1' | '2' | '3' | '4' | '5' | '6' | '7' | '8';\nexport type FEN = string;\nexport type Pos = [number, number];\nexport interface Piece {\n  role: Role;\n  color: Color;\n  promoted?: boolean;\n}\nexport interface Drop {\n  role: Role;\n  key: Key;\n}\nexport type Pieces = Map<Key, Piece>\nexport type PiecesDiff = Map<Key, Piece | undefined>\n\nexport type KeyPair = [Key, Key];\n\nexport type NumberPair = [number, number];\n\nexport type NumberQuad = [number, number, number, number];\n\nexport interface Rect {\n  left: number;\n  top: number;\n  width: number;\n  height: number;\n}\n\nexport type Dests = Map<Key, Key[]>;\n\nexport interface Elements {\n  board: HTMLElement;\n  container: HTMLElement;\n  ghost?: HTMLElement;\n  svg?: SVGElement;\n}\nexport interface Dom {\n  elements: Elements;\n  bounds: Memo<ClientRect>;\n  redraw: () => void;\n  redrawNow: (skipSvg?: boolean) => void;\n  unbind?: Unbind;\n  destroyed?: boolean;\n  relative?: boolean; // don't compute bounds, use relative % to place pieces\n}\nexport interface Exploding {\n  stage: number;\n  keys: readonly Key[];\n}\n\nexport interface MoveMetadata {\n  premove: boolean;\n  ctrlKey?: boolean;\n  holdTime?: number;\n  captured?: Piece;\n  predrop?: boolean;\n}\nexport interface SetPremoveMetadata {\n  ctrlKey?: boolean;\n}\n\nexport type MouchEvent = MouseEvent & TouchEvent;\n\nexport interface KeyedNode extends HTMLElement {\n  cgKey: Key;\n}\nexport interface PieceNode extends KeyedNode {\n  tagName: 'PIECE';\n  cgPiece: string;\n  cgAnimating?: boolean;\n  cgFading?: boolean;\n  cgDragging?: boolean;\n}\nexport interface SquareNode extends KeyedNode {\n  tagName: 'SQUARE';\n}\n\nexport interface Memo<A> {\n  (): A;\n  clear: () => void;\n}\n\nexport interface Timer {\n  start: () => void;\n  cancel: () => void;\n  stop: () => number;\n}\n\nexport type Redraw = () => void;\nexport type Unbind = () => void;\nexport type Milliseconds = number;\nexport type KHz = number;\n\nexport const colors: readonly Color[] = ['white', 'black'];\nexport const files: readonly File[] = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'];\nexport const ranks: readonly Rank[] = ['1', '2', '3', '4', '5', '6', '7', '8'];\n","import * as cg from './types';\n\nexport const invRanks: readonly cg.Rank[] = ['8', '7', '6', '5', '4', '3', '2', '1'];\n\nexport const allKeys: readonly cg.Key[] = Array.prototype.concat(...cg.files.map(c => cg.ranks.map(r => c + r)));\n\nexport const pos2key = (pos: cg.Pos): cg.Key => allKeys[8 * pos[0] + pos[1]];\n\nexport const key2pos = (k: cg.Key): cg.Pos => [k.charCodeAt(0) - 97, k.charCodeAt(1) - 49];\n\nexport function memo<A>(f: () => A): cg.Memo<A> {\n  let v: A | undefined;\n  const ret = (): A => {\n    if (v === undefined) v = f();\n    return v;\n  };\n  ret.clear = () => { v = undefined };\n  return ret;\n}\n\nexport const timer = (): cg.Timer => {\n  let startAt: number | undefined;\n  return {\n    start() { startAt = performance.now() },\n    cancel() { startAt = undefined },\n    stop() {\n      if (!startAt) return 0;\n      const time = performance.now() - startAt;\n      startAt = undefined;\n      return time;\n    }\n  };\n}\n\nexport const opposite = (c: cg.Color): cg.Color => c === 'white' ? 'black' : 'white';\n\nexport const distanceSq = (pos1: cg.Pos, pos2: cg.Pos): number => {\n  const dx = pos1[0] - pos2[0],\n  dy = pos1[1] - pos2[1];\n  return dx * dx + dy * dy;\n}\n\nexport const samePiece = (p1: cg.Piece, p2: cg.Piece): boolean =>\n  p1.role === p2.role && p1.color === p2.color;\n\nconst posToTranslateBase = (pos: cg.Pos, asWhite: boolean, xFactor: number, yFactor: number): cg.NumberPair => [\n  (asWhite ? pos[0] : 7 - pos[0]) * xFactor,\n  (asWhite ? 7 - pos[1] : pos[1]) * yFactor\n];\n\nexport const posToTranslateAbs = (bounds: ClientRect): (pos: cg.Pos, asWhite: boolean) => cg.NumberPair => {\n  const xFactor = bounds.width / 8,\n  yFactor = bounds.height / 8;\n  return (pos, asWhite) => posToTranslateBase(pos, asWhite, xFactor, yFactor);\n}\n\nexport const posToTranslateRel = (pos: cg.Pos, asWhite: boolean): cg.NumberPair =>\n  posToTranslateBase(pos, asWhite, 100, 100);\n\nexport const translateAbs = (el: HTMLElement, pos: cg.NumberPair): void => {\n  el.style.transform = `translate(${pos[0]}px,${pos[1]}px)`;\n}\n\nexport const translateRel = (el: HTMLElement, percents: cg.NumberPair): void => {\n  el.style.transform = `translate(${percents[0]}%,${percents[1]}%)`;\n}\n\nexport const setVisible = (el: HTMLElement, v: boolean): void => {\n  el.style.visibility = v ? 'visible' : 'hidden';\n}\n\nexport const eventPosition = (e: cg.MouchEvent): cg.NumberPair | undefined => {\n  if (e.clientX || e.clientX === 0) return [e.clientX, e.clientY];\n  if (e.touches && e.targetTouches[0]) return [e.targetTouches[0].clientX, e.targetTouches[0].clientY]; /* eslint-disable-line */\n  return; // touchend has no position!\n}\n\nexport const isRightButton = (e: MouseEvent): boolean => e.buttons === 2 || e.button === 2;\n\nexport const createEl = (tagName: string, className?: string): HTMLElement => {\n  const el = document.createElement(tagName);\n  if (className) el.className = className;\n  return el;\n}\n","import * as util from './util'\nimport * as cg from './types'\n\ntype Mobility = (x1: number, y1: number, x2: number, y2: number) => boolean;\n\nfunction diff(a: number, b: number): number {\n  return Math.abs(a - b);\n}\n\nfunction pawn(color: cg.Color): Mobility {\n  return (x1, y1, x2, y2) => diff(x1, x2) < 2 && (\n    color === 'white' ? (\n      // allow 2 squares from first two ranks, for horde\n      y2 === y1 + 1 || (y1 <= 1 && y2 === (y1 + 2) && x1 === x2)\n    ) : (\n      y2 === y1 - 1 || (y1 >= 6 && y2 === (y1 - 2) && x1 === x2)\n    )\n  );\n}\n\nconst knight: Mobility = (x1, y1, x2, y2) => {\n  const xd = diff(x1, x2);\n  const yd = diff(y1, y2);\n  return (xd === 1 && yd === 2) || (xd === 2 && yd === 1);\n}\n\nconst bishop: Mobility = (x1, y1, x2, y2) => {\n  return diff(x1, x2) === diff(y1, y2);\n}\n\nconst rook: Mobility = (x1, y1, x2, y2) => {\n  return x1 === x2 || y1 === y2;\n}\n\nconst queen: Mobility = (x1, y1, x2, y2) => {\n  return bishop(x1, y1, x2, y2) || rook(x1, y1, x2, y2);\n}\n\nfunction king(color: cg.Color, rookFiles: number[], canCastle: boolean): Mobility {\n  return (x1, y1, x2, y2)  => (\n    diff(x1, x2) < 2 && diff(y1, y2) < 2\n  ) || (\n    canCastle && y1 === y2 && y1 === (color === 'white' ? 0 : 7) && (\n      (x1 === 4 && ((x2 === 2 && rookFiles.includes(0)) || (x2 === 6 && rookFiles.includes(7)))) ||\n      rookFiles.includes(x2)\n    )\n  );\n}\n\nfunction rookFilesOf(pieces: cg.Pieces, color: cg.Color) {\n  const backrank = color === 'white' ? '1' : '8';\n  const files = [];\n  for (const [key, piece] of pieces) {\n    if (key[1] === backrank && piece.color === color && piece.role === 'rook') {\n      files.push(util.key2pos(key)[0]);\n    }\n  }\n  return files;\n}\n\nconst allPos = util.allKeys.map(util.key2pos);\n\nexport function premove(pieces: cg.Pieces, key: cg.Key, canCastle: boolean): cg.Key[] {\n  const piece = pieces.get(key);\n  if (!piece) return [];\n  const pos = util.key2pos(key),\n    r = piece.role,\n    mobility: Mobility = r === 'pawn' ? pawn(piece.color) : (\n      r === 'knight' ? knight : (\n        r === 'bishop' ? bishop : (\n          r === 'rook' ? rook : (\n            r === 'queen' ? queen : king(piece.color, rookFilesOf(pieces, piece.color), canCastle)\n          ))));\n  return allPos.filter(pos2 =>\n    (pos[0] !== pos2[0] || pos[1] !== pos2[1]) && mobility(pos[0], pos[1], pos2[0], pos2[1])\n  ).map(util.pos2key);\n}\n","import { State } from './state'\nimport { pos2key, key2pos, opposite } from './util'\nimport { premove } from './premove'\nimport * as cg from './types'\n\nexport type Callback = (...args: any[]) => void;\n\nexport function callUserFunction(f: Callback | undefined, ...args: any[]): void {\n  if (f) setTimeout(() => f(...args), 1);\n}\n\nexport function toggleOrientation(state: State): void {\n  state.orientation = opposite(state.orientation);\n  state.animation.current =\n  state.draggable.current =\n  state.selected = undefined;\n}\n\nexport function reset(state: State): void {\n  state.lastMove = undefined;\n  unselect(state);\n  unsetPremove(state);\n  unsetPredrop(state);\n}\n\nexport function setPieces(state: State, pieces: cg.PiecesDiff): void {\n  for (const [key, piece] of pieces) {\n    if (piece) state.pieces.set(key, piece);\n    else state.pieces.delete(key);\n  }\n}\n\nexport function setCheck(state: State, color: cg.Color | boolean): void {\n  state.check = undefined;\n  if (color === true) color = state.turnColor;\n  if (color) for (const [k, p] of state.pieces) {\n    if (p.role === 'king' && p.color === color) {\n      state.check = k;\n    }\n  }\n}\n\nfunction setPremove(state: State, orig: cg.Key, dest: cg.Key, meta: cg.SetPremoveMetadata): void {\n  unsetPredrop(state);\n  state.premovable.current = [orig, dest];\n  callUserFunction(state.premovable.events.set, orig, dest, meta);\n}\n\nexport function unsetPremove(state: State): void {\n  if (state.premovable.current) {\n    state.premovable.current = undefined;\n    callUserFunction(state.premovable.events.unset);\n  }\n}\n\nfunction setPredrop(state: State, role: cg.Role, key: cg.Key): void {\n  unsetPremove(state);\n  state.predroppable.current = { role, key };\n  callUserFunction(state.predroppable.events.set, role, key);\n}\n\nexport function unsetPredrop(state: State): void {\n  const pd = state.predroppable;\n  if (pd.current) {\n    pd.current = undefined;\n    callUserFunction(pd.events.unset);\n  }\n}\n\nfunction tryAutoCastle(state: State, orig: cg.Key, dest: cg.Key): boolean {\n  if (!state.autoCastle) return false;\n\n  const king = state.pieces.get(orig);\n  if (!king || king.role !== 'king') return false;\n\n  const origPos = key2pos(orig);\n  const destPos = key2pos(dest);\n  if ((origPos[1] !== 0 && origPos[1] !== 7) || origPos[1] !== destPos[1]) return false;\n  if (origPos[0] === 4 && !state.pieces.has(dest)) {\n    if (destPos[0] === 6) dest = pos2key([7, destPos[1]]);\n    else if (destPos[0] === 2) dest = pos2key([0, destPos[1]]);\n  }\n  const rook = state.pieces.get(dest);\n  if (!rook || rook.color !== king.color || rook.role !== 'rook') return false;\n\n  state.pieces.delete(orig);\n  state.pieces.delete(dest);\n\n  if (origPos[0] < destPos[0]) {\n    state.pieces.set(pos2key([6, destPos[1]]), king);\n    state.pieces.set(pos2key([5, destPos[1]]), rook);\n  } else {\n    state.pieces.set(pos2key([2, destPos[1]]), king);\n    state.pieces.set(pos2key([3, destPos[1]]), rook);\n  }\n  return true;\n}\n\nexport function baseMove(state: State, orig: cg.Key, dest: cg.Key): cg.Piece | boolean {\n  const origPiece = state.pieces.get(orig), destPiece = state.pieces.get(dest);\n  if (orig === dest || !origPiece) return false;\n  const captured = (destPiece && destPiece.color !== origPiece.color) ? destPiece : undefined;\n  if (dest === state.selected) unselect(state);\n  callUserFunction(state.events.move, orig, dest, captured);\n  if (!tryAutoCastle(state, orig, dest)) {\n    state.pieces.set(dest, origPiece);\n    state.pieces.delete(orig);\n  }\n  state.lastMove = [orig, dest];\n  state.check = undefined;\n  callUserFunction(state.events.change);\n  return captured || true;\n}\n\nexport function baseNewPiece(state: State, piece: cg.Piece, key: cg.Key, force?: boolean): boolean {\n  if (state.pieces.has(key)) {\n    if (force) state.pieces.delete(key);\n    else return false;\n  }\n  callUserFunction(state.events.dropNewPiece, piece, key);\n  state.pieces.set(key, piece);\n  state.lastMove = [key];\n  state.check = undefined;\n  callUserFunction(state.events.change);\n  state.movable.dests = undefined;\n  state.turnColor = opposite(state.turnColor);\n  return true;\n}\n\nfunction baseUserMove(state: State, orig: cg.Key, dest: cg.Key): cg.Piece | boolean {\n  const result = baseMove(state, orig, dest);\n  if (result) {\n    state.movable.dests = undefined;\n    state.turnColor = opposite(state.turnColor);\n    state.animation.current = undefined;\n  }\n  return result;\n}\n\nexport function userMove(state: State, orig: cg.Key, dest: cg.Key): boolean {\n  if (canMove(state, orig, dest)) {\n    const result = baseUserMove(state, orig, dest);\n    if (result) {\n      const holdTime = state.hold.stop();\n      unselect(state);\n      const metadata: cg.MoveMetadata = {\n        premove: false,\n        ctrlKey: state.stats.ctrlKey,\n        holdTime\n      };\n      if (result !== true) metadata.captured = result;\n      callUserFunction(state.movable.events.after, orig, dest, metadata);\n      return true;\n    }\n  } else if (canPremove(state, orig, dest)) {\n    setPremove(state, orig, dest, {\n      ctrlKey: state.stats.ctrlKey\n    });\n    unselect(state);\n    return true;\n  }\n  unselect(state);\n  return false;\n}\n\nexport function dropNewPiece(state: State, orig: cg.Key, dest: cg.Key, force?: boolean): void {\n  const piece = state.pieces.get(orig);\n  if (piece && (canDrop(state, orig, dest) || force)) {\n    state.pieces.delete(orig);\n    baseNewPiece(state, piece, dest, force);\n    callUserFunction(state.movable.events.afterNewPiece, piece.role, dest, {\n      predrop: false\n    });\n  } else if (piece && canPredrop(state, orig, dest)) {\n    setPredrop(state, piece.role, dest);\n  } else {\n    unsetPremove(state);\n    unsetPredrop(state);\n  }\n  state.pieces.delete(orig);\n  unselect(state);\n}\n\nexport function selectSquare(state: State, key: cg.Key, force?: boolean): void {\n  callUserFunction(state.events.select, key);\n  if (state.selected) {\n    if (state.selected === key && !state.draggable.enabled) {\n      unselect(state);\n      state.hold.cancel();\n      return;\n    } else if ((state.selectable.enabled || force) && state.selected !== key) {\n      if (userMove(state, state.selected, key)) {\n        state.stats.dragged = false;\n        return;\n      }\n    }\n  }\n  if (isMovable(state, key) || isPremovable(state, key)) {\n    setSelected(state, key);\n    state.hold.start();\n  }\n}\n\nexport function setSelected(state: State, key: cg.Key): void {\n  state.selected = key;\n  if (isPremovable(state, key)) {\n    state.premovable.dests = premove(state.pieces, key, state.premovable.castle);\n  }\n  else state.premovable.dests = undefined;\n}\n\nexport function unselect(state: State): void {\n  state.selected = undefined;\n  state.premovable.dests = undefined;\n  state.hold.cancel();\n}\n\nfunction isMovable(state: State, orig: cg.Key): boolean {\n  const piece = state.pieces.get(orig);\n  return !!piece && (\n    state.movable.color === 'both' || (\n      state.movable.color === piece.color &&\n        state.turnColor === piece.color\n    ));\n}\n\nexport function canMove(state: State, orig: cg.Key, dest: cg.Key): boolean {\n  return orig !== dest && isMovable(state, orig) && (\n    state.movable.free || !!state.movable.dests?.get(orig)?.includes(dest)\n  );\n}\n\nfunction canDrop(state: State, orig: cg.Key, dest: cg.Key): boolean {\n  const piece = state.pieces.get(orig);\n  return !!piece && (orig === dest || !state.pieces.has(dest)) && (\n    state.movable.color === 'both' || (\n      state.movable.color === piece.color &&\n        state.turnColor === piece.color\n    ));\n}\n\n\nfunction isPremovable(state: State, orig: cg.Key): boolean {\n  const piece = state.pieces.get(orig);\n  return !!piece && state.premovable.enabled &&\n  state.movable.color === piece.color &&\n    state.turnColor !== piece.color;\n}\n\nfunction canPremove(state: State, orig: cg.Key, dest: cg.Key): boolean {\n  return orig !== dest &&\n  isPremovable(state, orig) &&\n  premove(state.pieces, orig, state.premovable.castle).includes(dest);\n}\n\nfunction canPredrop(state: State, orig: cg.Key, dest: cg.Key): boolean {\n  const piece = state.pieces.get(orig);\n  const destPiece = state.pieces.get(dest);\n  return !!piece &&\n  (!destPiece || destPiece.color !== state.movable.color) &&\n  state.predroppable.enabled &&\n  (piece.role !== 'pawn' || (dest[1] !== '1' && dest[1] !== '8')) &&\n  state.movable.color === piece.color &&\n    state.turnColor !== piece.color;\n}\n\nexport function isDraggable(state: State, orig: cg.Key): boolean {\n  const piece = state.pieces.get(orig);\n  return !!piece && state.draggable.enabled && (\n    state.movable.color === 'both' || (\n      state.movable.color === piece.color && (\n        state.turnColor === piece.color || state.premovable.enabled\n      )\n    )\n  );\n}\n\nexport function playPremove(state: State): boolean {\n  const move = state.premovable.current;\n  if (!move) return false;\n  const orig = move[0], dest = move[1];\n  let success = false;\n  if (canMove(state, orig, dest)) {\n    const result = baseUserMove(state, orig, dest);\n    if (result) {\n      const metadata: cg.MoveMetadata = { premove: true };\n      if (result !== true) metadata.captured = result;\n      callUserFunction(state.movable.events.after, orig, dest, metadata);\n      success = true;\n    }\n  }\n  unsetPremove(state);\n  return success;\n}\n\nexport function playPredrop(state: State, validate: (drop: cg.Drop) => boolean): boolean {\n  const drop = state.predroppable.current;\n  let success = false;\n  if (!drop) return false;\n  if (validate(drop)) {\n    const piece = {\n      role: drop.role,\n      color: state.movable.color\n    } as cg.Piece;\n    if (baseNewPiece(state, piece, drop.key)) {\n      callUserFunction(state.movable.events.afterNewPiece, drop.role, drop.key, {\n        predrop: true\n      });\n      success = true;\n    }\n  }\n  unsetPredrop(state);\n  return success;\n}\n\nexport function cancelMove(state: State): void {\n  unsetPremove(state);\n  unsetPredrop(state);\n  unselect(state);\n}\n\nexport function stop(state: State): void {\n  state.movable.color =\n  state.movable.dests =\n  state.animation.current = undefined;\n  cancelMove(state);\n}\n\nexport function getKeyAtDomPos(pos: cg.NumberPair, asWhite: boolean, bounds: ClientRect): cg.Key | undefined {\n  let file = Math.floor(8 * (pos[0] - bounds.left) / bounds.width);\n  if (!asWhite) file = 7 - file;\n  let rank = 7 - Math.floor(8 * (pos[1] - bounds.top) / bounds.height);\n  if (!asWhite) rank = 7 - rank;\n  return (file >= 0 && file < 8 && rank >= 0 && rank < 8) ? pos2key([file, rank]) : undefined;\n}\n\nexport function whitePov(s: State): boolean {\n  return s.orientation === 'white';\n}\n","import { pos2key, invRanks } from './util'\nimport * as cg from './types'\n\nexport const initial: cg.FEN = 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR';\n\nconst roles: { [letter: string]: cg.Role } = { p: 'pawn', r: 'rook', n: 'knight', b: 'bishop', q: 'queen', k: 'king' };\n\nconst letters = { pawn: 'p', rook: 'r', knight: 'n', bishop: 'b', queen: 'q', king: 'k' };\n\nexport function read(fen: cg.FEN): cg.Pieces {\n  if (fen === 'start') fen = initial;\n  const pieces: cg.Pieces = new Map();\n  let row = 7, col = 0;\n  for (const c of fen) {\n    switch (c) {\n      case ' ': return pieces;\n      case '/':\n        --row;\n        if (row < 0) return pieces;\n        col = 0;\n        break;\n      case '~':\n        const piece = pieces.get(pos2key([col, row]));\n        if (piece) piece.promoted = true;\n        break;\n      default:\n        const nb = c.charCodeAt(0);\n        if (nb < 57) col += nb - 48;\n        else {\n          const role = c.toLowerCase();\n          pieces.set(pos2key([col, row]), {\n            role: roles[role],\n            color: c === role ? 'black' : 'white',\n          });\n          ++col;\n        }\n    }\n  }\n  return pieces;\n}\n\nexport function write(pieces: cg.Pieces): cg.FEN {\n  return invRanks.map(y => cg.files.map(x => {\n      const piece = pieces.get(x + y as cg.Key);\n      if (piece) {\n        const letter = letters[piece.role];\n        return piece.color === 'white' ? letter.toUpperCase() : letter;\n      } else return '1';\n    }).join('')\n  ).join('/').replace(/1{2,}/g, s => s.length.toString());\n}\n","import { State } from './state'\nimport { setCheck, setSelected } from './board'\nimport { read as fenRead } from './fen'\nimport { DrawShape, DrawBrush } from './draw'\nimport * as cg from './types'\n\nexport interface Config {\n  fen?: cg.FEN; // chess position in Forsyth notation\n  orientation?: cg.Color; // board orientation. white | black\n  turnColor?: cg.Color; // turn to play. white | black\n  check?: cg.Color | boolean; // true for current color, false to unset\n  lastMove?: cg.Key[]; // squares part of the last move [\"c3\", \"c4\"]\n  selected?: cg.Key; // square currently selected \"a1\"\n  coordinates?: boolean; // include coords attributes\n  autoCastle?: boolean; // immediately complete the castle by moving the rook after king move\n  viewOnly?: boolean; // don't bind events: the user will never be able to move pieces around\n  disableContextMenu?: boolean; // because who needs a context menu on a chessboard\n  resizable?: boolean; // listens to chessground.resize on document.body to clear bounds cache\n  addPieceZIndex?: boolean; // adds z-index values to pieces (for 3D)\n  // pieceKey: boolean; // add a data-key attribute to piece elements\n  highlight?: {\n    lastMove?: boolean; // add last-move class to squares\n    check?: boolean; // add check class to squares\n  };\n  animation?: {\n    enabled?: boolean;\n    duration?: number;\n  };\n  movable?: {\n    free?: boolean; // all moves are valid - board editor\n    color?: cg.Color | 'both'; // color that can move. white | black | both | undefined\n    dests?: cg.Dests; // valid moves. {\"a2\" [\"a3\" \"a4\"] \"b1\" [\"a3\" \"c3\"]}\n    showDests?: boolean; // whether to add the move-dest class on squares\n    events?: {\n      after?: (orig: cg.Key, dest: cg.Key, metadata: cg.MoveMetadata) => void; // called after the move has been played\n      afterNewPiece?: (role: cg.Role, key: cg.Key, metadata: cg.MoveMetadata) => void; // called after a new piece is dropped on the board\n    };\n    rookCastle?: boolean; // castle by moving the king to the rook\n  };\n  premovable?: {\n    enabled?: boolean; // allow premoves for color that can not move\n    showDests?: boolean; // whether to add the premove-dest class on squares\n    castle?: boolean; // whether to allow king castle premoves\n    dests?: cg.Key[]; // premove destinations for the current selection\n    events?: {\n      set?: (orig: cg.Key, dest: cg.Key, metadata?: cg.SetPremoveMetadata) => void; // called after the premove has been set\n      unset?: () => void;  // called after the premove has been unset\n    };\n  };\n  predroppable?: {\n    enabled?: boolean; // allow predrops for color that can not move\n    events?: {\n      set?: (role: cg.Role, key: cg.Key) => void; // called after the predrop has been set\n      unset?: () => void; // called after the predrop has been unset\n    };\n  };\n  draggable?: {\n    enabled?: boolean; // allow moves & premoves to use drag'n drop\n    distance?: number; // minimum distance to initiate a drag; in pixels\n    autoDistance?: boolean; // lets chessground set distance to zero when user drags pieces\n    showGhost?: boolean; // show ghost of piece being dragged\n    deleteOnDropOff?: boolean; // delete a piece when it is dropped off the board\n  };\n  selectable?: {\n    // disable to enforce dragging over click-click move\n    enabled?: boolean;\n  };\n  events?: {\n    change?: () => void; // called after the situation changes on the board\n    // called after a piece has been moved.\n    // capturedPiece is undefined or like {color: 'white'; 'role': 'queen'}\n    move?: (orig: cg.Key, dest: cg.Key, capturedPiece?: cg.Piece) => void;\n    dropNewPiece?: (piece: cg.Piece, key: cg.Key) => void;\n    select?: (key: cg.Key) => void; // called when a square is selected\n    insert?: (elements: cg.Elements) => void; // when the board DOM has been (re)inserted\n  };\n  drawable?: {\n    enabled?: boolean; // can draw\n    visible?: boolean; // can view\n    eraseOnClick?: boolean;\n    shapes?: DrawShape[];\n    autoShapes?: DrawShape[];\n    brushes?: DrawBrush[];\n    pieces?: {\n      baseUrl?: string;\n    };\n    onChange?: (shapes: DrawShape[]) => void; // called after drawable shapes change\n  };\n}\n\nexport function configure(state: State, config: Config): void {\n\n  // don't merge destinations. Just override.\n  if (config.movable?.dests) state.movable.dests = undefined;\n\n  merge(state, config);\n\n  // if a fen was provided, replace the pieces\n  if (config.fen) {\n    state.pieces = fenRead(config.fen);\n    state.drawable.shapes = [];\n  }\n\n  // apply config values that could be undefined yet meaningful\n  if (config.hasOwnProperty('check')) setCheck(state, config.check || false);\n  if (config.hasOwnProperty('lastMove') && !config.lastMove) state.lastMove = undefined;\n  // in case of ZH drop last move, there's a single square.\n  // if the previous last move had two squares,\n  // the merge algorithm will incorrectly keep the second square.\n  else if (config.lastMove) state.lastMove = config.lastMove;\n\n  // fix move/premove dests\n  if (state.selected) setSelected(state, state.selected);\n\n  // no need for such short animations\n  if (!state.animation.duration || state.animation.duration < 100) state.animation.enabled = false;\n\n  if (!state.movable.rookCastle && state.movable.dests) {\n    const rank = state.movable.color === 'white' ? '1' : '8',\n    kingStartPos = 'e' + rank as cg.Key,\n    dests = state.movable.dests.get(kingStartPos),\n    king = state.pieces.get(kingStartPos);\n    if (!dests || !king || king.role !== 'king') return;\n    state.movable.dests.set(kingStartPos, dests.filter(d =>\n      !((d === 'a' + rank) && dests.includes('c' + rank as cg.Key)) &&\n        !((d === 'h' + rank) && dests.includes('g' + rank as cg.Key))\n    ));\n  }\n}\n\nfunction merge(base: any, extend: any): void {\n  for (const key in extend) {\n    if (isObject(base[key]) && isObject(extend[key])) merge(base[key], extend[key]);\n    else base[key] = extend[key];\n  }\n}\n\nfunction isObject(o: unknown): boolean {\n  return typeof o === 'object';\n}\n","import { State } from './state'\nimport * as util from './util'\nimport * as cg from './types'\n\nexport type Mutation<A> = (state: State) => A;\n\n// 0,1 animation goal\n// 2,3 animation current status\nexport type AnimVector = cg.NumberQuad;\n\nexport type AnimVectors = Map<cg.Key, AnimVector>;\n\nexport type AnimFadings = Map<cg.Key, cg.Piece>;\n\nexport interface AnimPlan {\n  anims: AnimVectors;\n  fadings: AnimFadings;\n}\n\nexport interface AnimCurrent {\n  start: DOMHighResTimeStamp;\n  frequency: cg.KHz;\n  plan: AnimPlan;\n}\n\nexport function anim<A>(mutation: Mutation<A>, state: State): A {\n  return state.animation.enabled ? animate(mutation, state) : render(mutation, state);\n}\n\nexport function render<A>(mutation: Mutation<A>, state: State): A {\n  const result = mutation(state);\n  state.dom.redraw();\n  return result;\n}\n\ninterface AnimPiece {\n  key: cg.Key;\n  pos: cg.Pos;\n  piece: cg.Piece;\n}\ntype AnimPieces = Map<cg.Key, AnimPiece>;\n\nfunction makePiece(key: cg.Key, piece: cg.Piece): AnimPiece {\n  return {\n    key: key,\n    pos: util.key2pos(key),\n    piece: piece\n  };\n}\n\nfunction closer(piece: AnimPiece, pieces: AnimPiece[]): AnimPiece | undefined {\n  return pieces.sort((p1, p2) => {\n    return util.distanceSq(piece.pos, p1.pos) - util.distanceSq(piece.pos, p2.pos);\n  })[0];\n}\n\nfunction computePlan(prevPieces: cg.Pieces, current: State): AnimPlan {\n  const anims: AnimVectors = new Map(),\n  animedOrigs: cg.Key[] = [],\n  fadings: AnimFadings = new Map(),\n  missings: AnimPiece[] = [],\n  news: AnimPiece[] = [],\n  prePieces: AnimPieces = new Map();\n  let curP: cg.Piece | undefined, preP: AnimPiece | undefined, vector: cg.NumberPair;\n  for (const [k, p] of prevPieces) {\n    prePieces.set(k, makePiece(k, p));\n  }\n  for (const key of util.allKeys) {\n    curP = current.pieces.get(key);\n    preP = prePieces.get(key);\n    if (curP) {\n      if (preP) {\n        if (!util.samePiece(curP, preP.piece)) {\n          missings.push(preP);\n          news.push(makePiece(key, curP));\n        }\n      } else news.push(makePiece(key, curP));\n    } else if (preP) missings.push(preP);\n  }\n  for (const newP of news) {\n    preP = closer(newP, missings.filter(p => util.samePiece(newP.piece, p.piece)));\n    if (preP) {\n      vector = [preP.pos[0] - newP.pos[0], preP.pos[1] - newP.pos[1]];\n      anims.set(newP.key, vector.concat(vector) as AnimVector);\n      animedOrigs.push(preP.key);\n    }\n  }\n  for (const p of missings) {\n    if (!animedOrigs.includes(p.key)) fadings.set(p.key, p.piece);\n  }\n\n  return {\n    anims: anims,\n    fadings: fadings\n  };\n}\n\nfunction step(state: State, now: DOMHighResTimeStamp): void {\n  const cur = state.animation.current;\n  if (cur === undefined) { // animation was canceled :(\n    if (!state.dom.destroyed) state.dom.redrawNow();\n    return;\n  }\n  const rest = 1 - (now - cur.start) * cur.frequency;\n  if (rest <= 0) {\n    state.animation.current = undefined;\n    state.dom.redrawNow();\n  } else {\n    const ease = easing(rest);\n    for (const cfg of cur.plan.anims.values()) {\n      cfg[2] = cfg[0] * ease;\n      cfg[3] = cfg[1] * ease;\n    }\n    state.dom.redrawNow(true); // optimisation: don't render SVG changes during animations\n    requestAnimationFrame((now = performance.now()) => step(state, now));\n  }\n}\n\nfunction animate<A>(mutation: Mutation<A>, state: State): A {\n  // clone state before mutating it\n  const prevPieces: cg.Pieces = new Map(state.pieces);\n\n  const result = mutation(state);\n  const plan = computePlan(prevPieces, state);\n  if (plan.anims.size || plan.fadings.size) {\n    const alreadyRunning = state.animation.current && state.animation.current.start;\n    state.animation.current = {\n      start: performance.now(),\n      frequency: 1 / state.animation.duration,\n      plan: plan\n    };\n    if (!alreadyRunning) step(state, performance.now());\n  } else {\n    // don't animate, just render right away\n    state.dom.redraw();\n  }\n  return result;\n}\n\n// https://gist.github.com/gre/1650294\nfunction easing(t: number): number {\n  return t < 0.5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;\n}\n","import { State } from './state'\nimport { unselect, cancelMove, getKeyAtDomPos, whitePov } from './board'\nimport { eventPosition, isRightButton } from './util'\nimport * as cg from './types'\n\nexport interface DrawShape {\n  orig: cg.Key;\n  dest?: cg.Key;\n  brush: string;\n  modifiers?: DrawModifiers;\n  piece?: DrawShapePiece;\n}\n\nexport interface DrawShapePiece {\n  role: cg.Role;\n  color: cg.Color;\n  scale?: number;\n}\n\nexport interface DrawBrush {\n  key: string;\n  color: string;\n  opacity: number;\n  lineWidth: number;\n}\n\nexport interface DrawBrushes {\n  [name: string]: DrawBrush;\n}\n\nexport interface DrawModifiers {\n  lineWidth?: number;\n}\n\nexport interface Drawable {\n  enabled: boolean; // can draw\n  visible: boolean; // can view\n  eraseOnClick: boolean;\n  onChange?: (shapes: DrawShape[]) => void;\n  shapes: DrawShape[]; // user shapes\n  autoShapes: DrawShape[]; // computer shapes\n  current?: DrawCurrent;\n  brushes: DrawBrushes;\n  // drawable SVG pieces; used for crazyhouse drop\n  pieces: {\n    baseUrl: string;\n  };\n  prevSvgHash: string;\n}\n\nexport interface DrawCurrent {\n  orig: cg.Key; // orig key of drawing\n  dest?: cg.Key; // shape dest, or undefined for circle\n  mouseSq?: cg.Key; // square being moused over\n  pos: cg.NumberPair; // relative current position\n  brush: string; // brush name for shape\n}\n\nconst brushes = ['green', 'red', 'blue', 'yellow'];\n\nexport function start(state: State, e: cg.MouchEvent): void {\n  // support one finger touch only\n  if (e.touches && e.touches.length > 1) return; /* eslint-disable-line */\n  e.stopPropagation();\n  e.preventDefault();\n  e.ctrlKey ? unselect(state) : cancelMove(state);\n  const pos = eventPosition(e)!,\n  orig = getKeyAtDomPos(pos, whitePov(state), state.dom.bounds());\n  if (!orig) return;\n  state.drawable.current = {\n    orig,\n    pos,\n    brush: eventBrush(e)\n  };\n  processDraw(state);\n}\n\nexport function processDraw(state: State): void {\n  requestAnimationFrame(() => {\n    const cur = state.drawable.current;\n    if (cur) {\n      const mouseSq = getKeyAtDomPos(cur.pos, whitePov(state), state.dom.bounds());\n      if (mouseSq !== cur.mouseSq) {\n        cur.mouseSq = mouseSq;\n        cur.dest = mouseSq !== cur.orig ? mouseSq : undefined;\n        state.dom.redrawNow();\n      }\n      processDraw(state);\n    }\n  });\n}\n\nexport function move(state: State, e: cg.MouchEvent): void {\n  if (state.drawable.current) state.drawable.current.pos = eventPosition(e)!;\n}\n\nexport function end(state: State): void {\n  const cur = state.drawable.current;\n  if (cur) {\n    if (cur.mouseSq) addShape(state.drawable, cur);\n    cancel(state);\n  }\n}\n\nexport function cancel(state: State): void {\n  if (state.drawable.current) {\n    state.drawable.current = undefined;\n    state.dom.redraw();\n  }\n}\n\nexport function clear(state: State): void {\n  if (state.drawable.shapes.length) {\n    state.drawable.shapes = [];\n    state.dom.redraw();\n    onChange(state.drawable);\n  }\n}\n\nfunction eventBrush(e: cg.MouchEvent): string {\n  const modA = (e.shiftKey || e.ctrlKey) && isRightButton(e);\n  const modB = e.altKey || e.metaKey || e.getModifierState('AltGraph');\n  return brushes[(modA ? 1 : 0) + (modB ? 2 : 0)];\n}\n\nfunction addShape(drawable: Drawable, cur: DrawCurrent): void {\n  const sameShape = (s: DrawShape) => s.orig === cur.orig && s.dest === cur.dest;\n  const similar = drawable.shapes.find(sameShape);\n  if (similar) drawable.shapes = drawable.shapes.filter(s => !sameShape(s));\n  if (!similar || similar.brush !== cur.brush) drawable.shapes.push(cur);\n  onChange(drawable);\n}\n\nfunction onChange(drawable: Drawable): void {\n  if (drawable.onChange) drawable.onChange(drawable.shapes);\n}\n","import { State } from './state'\nimport * as board from './board'\nimport * as util from './util'\nimport { clear as drawClear } from './draw'\nimport * as cg from './types'\nimport { anim } from './anim'\n\nexport interface DragCurrent {\n  orig: cg.Key; // orig key of dragging piece\n  piece: cg.Piece;\n  origPos: cg.NumberPair; // first event position\n  pos: cg.NumberPair; // latest event position\n  started: boolean; // whether the drag has started; as per the distance setting\n  element: cg.PieceNode | (() => cg.PieceNode | undefined);\n  newPiece?: boolean; // it it a new piece from outside the board\n  force?: boolean; // can the new piece replace an existing one (editor)\n  previouslySelected?: cg.Key;\n  originTarget: EventTarget | null;\n}\n\nexport function start(s: State, e: cg.MouchEvent): void {\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n  if (e.button !== undefined && e.button !== 0) return; // only touch or left click\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n  if (e.touches && e.touches.length > 1) return; // support one finger touch only\n  const bounds = s.dom.bounds(),\n  position = util.eventPosition(e)!,\n  orig = board.getKeyAtDomPos(position, board.whitePov(s), bounds);\n  if (!orig) return;\n  const piece = s.pieces.get(orig);\n  const previouslySelected = s.selected;\n  if (!previouslySelected && s.drawable.enabled && (\n    s.drawable.eraseOnClick || (!piece || piece.color !== s.turnColor)\n  )) drawClear(s);\n  // Prevent touch scroll and create no corresponding mouse event, if there\n  // is an intent to interact with the board. If no color is movable\n  // (and the board is not for viewing only), touches are likely intended to\n  // select squares.\n  if (e.cancelable !== false &&\n      (!e.touches || !s.movable.color || piece || previouslySelected || pieceCloseTo(s, position))) /* eslint-disable-line */\n        e.preventDefault();\n  const hadPremove = !!s.premovable.current;\n  const hadPredrop = !!s.predroppable.current;\n  s.stats.ctrlKey = e.ctrlKey;\n  if (s.selected && board.canMove(s, s.selected, orig)) {\n    anim(state => board.selectSquare(state, orig), s);\n  } else {\n    board.selectSquare(s, orig);\n  }\n  const stillSelected = s.selected === orig;\n  const element = pieceElementByKey(s, orig);\n  if (piece && element && stillSelected && board.isDraggable(s, orig)) {\n    s.draggable.current = {\n      orig,\n      piece,\n      origPos: position,\n      pos: position,\n      started: s.draggable.autoDistance && s.stats.dragged,\n      element,\n      previouslySelected,\n      originTarget: e.target\n    };\n    element.cgDragging = true;\n    element.classList.add('dragging');\n    // place ghost\n    const ghost = s.dom.elements.ghost;\n    if (ghost) {\n      ghost.className = `ghost ${piece.color} ${piece.role}`;\n      util.translateAbs(ghost, util.posToTranslateAbs(bounds)(util.key2pos(orig), board.whitePov(s)));\n      util.setVisible(ghost, true);\n    }\n    processDrag(s);\n  } else {\n    if (hadPremove) board.unsetPremove(s);\n    if (hadPredrop) board.unsetPredrop(s);\n  }\n  s.dom.redraw();\n}\n\nfunction pieceCloseTo(s: State, pos: cg.NumberPair): boolean {\n  const asWhite = board.whitePov(s),\n  bounds = s.dom.bounds(),\n  radiusSq = Math.pow(bounds.width / 8, 2);\n  for (const key in s.pieces) {\n    const center = computeSquareCenter(key as cg.Key, asWhite, bounds);\n    if (util.distanceSq(center, pos) <= radiusSq) return true;\n  }\n  return false;\n}\n\nexport function dragNewPiece(s: State, piece: cg.Piece, e: cg.MouchEvent, force?: boolean): void {\n\n  const key: cg.Key = 'a0';\n  s.pieces.set(key, piece);\n  s.dom.redraw();\n\n  const position = util.eventPosition(e)!;\n\n  s.draggable.current = {\n    orig: key,\n    piece,\n    origPos: position,\n    pos: position,\n    started: true,\n    element: () => pieceElementByKey(s, key),\n    originTarget: e.target,\n    newPiece: true,\n    force: !!force\n  };\n  processDrag(s);\n}\n\nfunction processDrag(s: State): void {\n  requestAnimationFrame(() => {\n    const cur = s.draggable.current;\n    if (!cur) return;\n    // cancel animations while dragging\n    if (s.animation.current?.plan.anims.has(cur.orig)) s.animation.current = undefined;\n    // if moving piece is gone, cancel\n    const origPiece = s.pieces.get(cur.orig);\n    if (!origPiece || !util.samePiece(origPiece, cur.piece)) cancel(s);\n    else {\n      if (!cur.started && util.distanceSq(cur.pos, cur.origPos) >= Math.pow(s.draggable.distance, 2)) cur.started = true;\n      if (cur.started) {\n\n        // support lazy elements\n        if (typeof cur.element === 'function') {\n          const found = cur.element();\n          if (!found) return;\n          found.cgDragging = true;\n          found.classList.add('dragging');\n          cur.element = found;\n        }\n\n        const bounds = s.dom.bounds();\n        util.translateAbs(cur.element, [\n          cur.pos[0] - bounds.left - bounds.width / 16,\n          cur.pos[1] - bounds.top - bounds.height / 16\n        ]);\n      }\n    }\n    processDrag(s);\n  });\n}\n\nexport function move(s: State, e: cg.MouchEvent): void {\n  // support one finger touch only\n  if (s.draggable.current && (!e.touches || e.touches.length < 2)) { /* eslint-disable-line */\n    s.draggable.current.pos = util.eventPosition(e)!;\n  }\n}\n\nexport function end(s: State, e: cg.MouchEvent): void {\n  const cur = s.draggable.current;\n  if (!cur) return;\n  // create no corresponding mouse event\n  if (e.type === 'touchend' && e.cancelable !== false) e.preventDefault();\n  // comparing with the origin target is an easy way to test that the end event\n  // has the same touch origin\n  if (e.type === 'touchend' && cur.originTarget !== e.target && !cur.newPiece) {\n    s.draggable.current = undefined;\n    return;\n  }\n  board.unsetPremove(s);\n  board.unsetPredrop(s);\n  // touchend has no position; so use the last touchmove position instead\n  const eventPos = util.eventPosition(e) || cur.pos;\n  const dest = board.getKeyAtDomPos(eventPos, board.whitePov(s), s.dom.bounds());\n  if (dest && cur.started && cur.orig !== dest) {\n    if (cur.newPiece) board.dropNewPiece(s, cur.orig, dest, cur.force);\n    else {\n      s.stats.ctrlKey = e.ctrlKey;\n      if (board.userMove(s, cur.orig, dest)) s.stats.dragged = true;\n    }\n  } else if (cur.newPiece) {\n    s.pieces.delete(cur.orig);\n  } else if (s.draggable.deleteOnDropOff && !dest) {\n    s.pieces.delete(cur.orig);\n    board.callUserFunction(s.events.change);\n  }\n  if (cur.orig === cur.previouslySelected && (cur.orig === dest || !dest))\n    board.unselect(s);\n  else if (!s.selectable.enabled) board.unselect(s);\n\n  removeDragElements(s);\n\n  s.draggable.current = undefined;\n  s.dom.redraw();\n}\n\nexport function cancel(s: State): void {\n  const cur = s.draggable.current;\n  if (cur) {\n    if (cur.newPiece) s.pieces.delete(cur.orig);\n    s.draggable.current = undefined;\n    board.unselect(s);\n    removeDragElements(s);\n    s.dom.redraw();\n  }\n}\n\nfunction removeDragElements(s: State): void {\n  const e = s.dom.elements;\n  if (e.ghost) util.setVisible(e.ghost, false);\n}\n\nfunction computeSquareCenter(key: cg.Key, asWhite: boolean, bounds: ClientRect): cg.NumberPair {\n  const pos = util.key2pos(key);\n  if (!asWhite) {\n    pos[0] = 7 - pos[0];\n    pos[1] = 7 - pos[1];\n  }\n  return [\n    bounds.left + bounds.width * pos[0] / 8 + bounds.width / 16,\n    bounds.top + bounds.height * (7 - pos[1]) / 8 + bounds.height / 16\n  ];\n}\n\nfunction pieceElementByKey(s: State, key: cg.Key): cg.PieceNode | undefined {\n  let el = s.dom.elements.board.firstChild;\n  while (el) {\n    if ((el as cg.KeyedNode).cgKey === key && (el as cg.KeyedNode).tagName === 'PIECE') return el as cg.PieceNode;\n    el = el.nextSibling;\n  }\n  return;\n}\n","import { State } from './state'\nimport { Key } from './types'\n\nexport function explosion(state: State, keys: Key[]): void {\n  state.exploding = { stage: 1, keys };\n  state.dom.redraw();\n  setTimeout(() => {\n    setStage(state, 2);\n    setTimeout(() => setStage(state, undefined), 120);\n  }, 120);\n}\n\nfunction setStage(state: State, stage: number | undefined): void {\n  if (state.exploding) {\n    if (stage) state.exploding.stage = stage;\n    else state.exploding = undefined;\n    state.dom.redraw();\n  }\n}\n","import { State } from './state'\nimport * as board from './board'\nimport { write as fenWrite } from './fen'\nimport { Config, configure } from './config'\nimport { anim, render } from './anim'\nimport { cancel as dragCancel, dragNewPiece } from './drag'\nimport { DrawShape } from './draw'\nimport { explosion } from './explosion'\nimport * as cg from './types'\n\nexport interface Api {\n\n  // reconfigure the instance. Accepts all config options, except for viewOnly & drawable.visible.\n  // board will be animated accordingly, if animations are enabled.\n  set(config: Config): void;\n\n  // read chessground state; write at your own risks.\n  state: State;\n\n  // get the position as a FEN string (only contains pieces, no flags)\n  // e.g. rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR\n  getFen(): cg.FEN;\n\n  // change the view angle\n  toggleOrientation(): void;\n\n  // perform a move programmatically\n  move(orig: cg.Key, dest: cg.Key): void;\n\n  // add and/or remove arbitrary pieces on the board\n  setPieces(pieces: cg.PiecesDiff): void;\n\n  // click a square programmatically\n  selectSquare(key: cg.Key | null, force?: boolean): void;\n\n  // put a new piece on the board\n  newPiece(piece: cg.Piece, key: cg.Key): void;\n\n  // play the current premove, if any; returns true if premove was played\n  playPremove(): boolean;\n\n  // cancel the current premove, if any\n  cancelPremove(): void;\n\n  // play the current predrop, if any; returns true if premove was played\n  playPredrop(validate: (drop: cg.Drop) => boolean): boolean;\n\n  // cancel the current predrop, if any\n  cancelPredrop(): void;\n\n  // cancel the current move being made\n  cancelMove(): void;\n\n  // cancel current move and prevent further ones\n  stop(): void;\n\n  // make squares explode (atomic chess)\n  explode(keys: cg.Key[]): void;\n\n  // programmatically draw user shapes\n  setShapes(shapes: DrawShape[]): void;\n\n  // programmatically draw auto shapes\n  setAutoShapes(shapes: DrawShape[]): void;\n\n  // square name at this DOM position (like \"e4\")\n  getKeyAtDomPos(pos: cg.NumberPair): cg.Key | undefined;\n\n  // only useful when CSS changes the board width/height ratio (for 3D)\n  redrawAll: cg.Redraw;\n\n  // for crazyhouse and board editors\n  dragNewPiece(piece: cg.Piece, event: cg.MouchEvent, force?: boolean): void;\n\n  // unbinds all events\n  // (important for document-wide events like scroll and mousemove)\n  destroy: cg.Unbind;\n}\n\n// see API types and documentations in dts/api.d.ts\nexport function start(state: State, redrawAll: cg.Redraw): Api {\n\n  function toggleOrientation(): void {\n    board.toggleOrientation(state);\n    redrawAll();\n  }\n\n  return {\n\n    set(config): void {\n      if (config.orientation && config.orientation !== state.orientation) toggleOrientation();\n      (config.fen ? anim : render)(state => configure(state, config), state);\n    },\n\n    state,\n\n    getFen: () => fenWrite(state.pieces),\n\n    toggleOrientation,\n\n    setPieces(pieces): void {\n      anim(state => board.setPieces(state, pieces), state);\n    },\n\n    selectSquare(key, force): void {\n      if (key) anim(state => board.selectSquare(state, key, force), state);\n      else if (state.selected) {\n        board.unselect(state);\n        state.dom.redraw();\n      }\n    },\n\n    move(orig, dest): void {\n      anim(state => board.baseMove(state, orig, dest), state);\n    },\n\n    newPiece(piece, key): void {\n      anim(state => board.baseNewPiece(state, piece, key), state);\n    },\n\n    playPremove(): boolean {\n      if (state.premovable.current) {\n        if (anim(board.playPremove, state)) return true;\n        // if the premove couldn't be played, redraw to clear it up\n        state.dom.redraw();\n      }\n      return false;\n    },\n\n    playPredrop(validate): boolean {\n      if (state.predroppable.current) {\n        const result = board.playPredrop(state, validate);\n        state.dom.redraw();\n        return result;\n      }\n      return false;\n    },\n\n    cancelPremove(): void {\n      render(board.unsetPremove, state);\n    },\n\n    cancelPredrop(): void {\n      render(board.unsetPredrop, state);\n    },\n\n    cancelMove(): void {\n      render(state => { board.cancelMove(state); dragCancel(state); }, state);\n    },\n\n    stop(): void {\n      render(state => { board.stop(state); dragCancel(state); }, state);\n    },\n\n    explode(keys: cg.Key[]): void {\n      explosion(state, keys);\n    },\n\n    setAutoShapes(shapes: DrawShape[]): void {\n      render(state => state.drawable.autoShapes = shapes, state);\n    },\n\n    setShapes(shapes: DrawShape[]): void {\n      render(state => state.drawable.shapes = shapes, state);\n    },\n\n    getKeyAtDomPos(pos): cg.Key | undefined {\n      return board.getKeyAtDomPos(pos, board.whitePov(state), state.dom.bounds());\n    },\n\n    redrawAll,\n\n    dragNewPiece(piece, event, force): void {\n      dragNewPiece(state, piece, event, force)\n    },\n\n    destroy(): void {\n      board.stop(state);\n      state.dom.unbind && state.dom.unbind();\n      state.dom.destroyed = true;\n    }\n  };\n}\n","import * as fen from './fen'\nimport { AnimCurrent } from './anim'\nimport { DragCurrent } from './drag'\nimport { Drawable } from './draw'\nimport { timer } from './util'\nimport * as cg from './types';\n\nexport interface State {\n  pieces: cg.Pieces;\n  orientation: cg.Color; // board orientation. white | black\n  turnColor: cg.Color; // turn to play. white | black\n  check?: cg.Key; // square currently in check \"a2\"\n  lastMove?: cg.Key[]; // squares part of the last move [\"c3\"; \"c4\"]\n  selected?: cg.Key; // square currently selected \"a1\"\n  coordinates: boolean; // include coords attributes\n  autoCastle: boolean; // immediately complete the castle by moving the rook after king move\n  viewOnly: boolean; // don't bind events: the user will never be able to move pieces around\n  disableContextMenu: boolean; // because who needs a context menu on a chessboard\n  resizable: boolean; // listens to chessground.resize on document.body to clear bounds cache\n  addPieceZIndex: boolean; // adds z-index values to pieces (for 3D)\n  pieceKey: boolean; // add a data-key attribute to piece elements\n  highlight: {\n    lastMove: boolean; // add last-move class to squares\n    check: boolean; // add check class to squares\n  };\n  animation: {\n    enabled: boolean;\n    duration: number;\n    current?: AnimCurrent;\n  };\n  movable: {\n    free: boolean; // all moves are valid - board editor\n    color?: cg.Color | 'both'; // color that can move. white | black | both\n    dests?: cg.Dests; // valid moves. {\"a2\" [\"a3\" \"a4\"] \"b1\" [\"a3\" \"c3\"]}\n    showDests: boolean; // whether to add the move-dest class on squares\n    events: {\n      after?: (orig: cg.Key, dest: cg.Key, metadata: cg.MoveMetadata) => void; // called after the move has been played\n      afterNewPiece?: (role: cg.Role, key: cg.Key, metadata: cg.MoveMetadata) => void; // called after a new piece is dropped on the board\n    };\n    rookCastle: boolean; // castle by moving the king to the rook\n  };\n  premovable: {\n    enabled: boolean; // allow premoves for color that can not move\n    showDests: boolean; // whether to add the premove-dest class on squares\n    castle: boolean; // whether to allow king castle premoves\n    dests?: cg.Key[]; // premove destinations for the current selection\n    current?: cg.KeyPair; // keys of the current saved premove [\"e2\" \"e4\"]\n    events: {\n      set?: (orig: cg.Key, dest: cg.Key, metadata?: cg.SetPremoveMetadata) => void; // called after the premove has been set\n      unset?: () => void;  // called after the premove has been unset\n    };\n  };\n  predroppable: {\n    enabled: boolean; // allow predrops for color that can not move\n    current?: { // current saved predrop {role: 'knight'; key: 'e4'}\n      role: cg.Role;\n      key: cg.Key;\n    };\n    events: {\n      set?: (role: cg.Role, key: cg.Key) => void; // called after the predrop has been set\n      unset?: () => void; // called after the predrop has been unset\n    };\n  };\n  draggable: {\n    enabled: boolean; // allow moves & premoves to use drag'n drop\n    distance: number; // minimum distance to initiate a drag; in pixels\n    autoDistance: boolean; // lets chessground set distance to zero when user drags pieces\n    showGhost: boolean; // show ghost of piece being dragged\n    deleteOnDropOff: boolean; // delete a piece when it is dropped off the board\n    current?: DragCurrent;\n  };\n  dropmode: {\n    active: boolean;\n    piece?: cg.Piece;\n  };\n  selectable: {\n    // disable to enforce dragging over click-click move\n    enabled: boolean;\n  };\n  stats: {\n    // was last piece dragged or clicked?\n    // needs default to false for touch\n    dragged: boolean;\n    ctrlKey?: boolean;\n  };\n  events: {\n    change?: () => void; // called after the situation changes on the board\n    // called after a piece has been moved.\n    // capturedPiece is undefined or like {color: 'white'; 'role': 'queen'}\n    move?: (orig: cg.Key, dest: cg.Key, capturedPiece?: cg.Piece) => void;\n    dropNewPiece?: (piece: cg.Piece, key: cg.Key) => void;\n    select?: (key: cg.Key) => void; // called when a square is selected\n    insert?: (elements: cg.Elements) => void; // when the board DOM has been (re)inserted\n  };\n  drawable: Drawable;\n  exploding?: cg.Exploding;\n  dom: cg.Dom;\n  hold: cg.Timer;\n}\n\nexport function defaults(): Partial<State> {\n  return {\n    pieces: fen.read(fen.initial),\n    orientation: 'white',\n    turnColor: 'white',\n    coordinates: true,\n    autoCastle: true,\n    viewOnly: false,\n    disableContextMenu: false,\n    resizable: true,\n    addPieceZIndex: false,\n    pieceKey: false,\n    highlight: {\n      lastMove: true,\n      check: true\n    },\n    animation: {\n      enabled: true,\n      duration: 200\n    },\n    movable: {\n      free: true,\n      color: 'both',\n      showDests: true,\n      events: {},\n      rookCastle: true\n    },\n    premovable: {\n      enabled: true,\n      showDests: true,\n      castle: true,\n      events: {}\n    },\n    predroppable: {\n      enabled: false,\n      events: {}\n    },\n    draggable: {\n      enabled: true,\n      distance: 3,\n      autoDistance: true,\n      showGhost: true,\n      deleteOnDropOff: false\n    },\n    dropmode: {\n      active: false\n    },\n    selectable: {\n      enabled: true\n    },\n    stats: {\n      // on touchscreen, default to \"tap-tap\" moves\n      // instead of drag\n      dragged: !('ontouchstart' in window)\n    },\n    events: {},\n    drawable: {\n      enabled: true, // can draw\n      visible: true, // can view\n      eraseOnClick: true,\n      shapes: [],\n      autoShapes: [],\n      brushes: {\n        green: { key: 'g', color: '#15781B', opacity: 1, lineWidth: 10 },\n        red: { key: 'r', color: '#882020', opacity: 1, lineWidth: 10 },\n        blue: { key: 'b', color: '#003088', opacity: 1, lineWidth: 10 },\n        yellow: { key: 'y', color: '#e68f00', opacity: 1, lineWidth: 10 },\n        paleBlue: { key: 'pb', color: '#003088', opacity: 0.4, lineWidth: 15 },\n        paleGreen: { key: 'pg', color: '#15781B', opacity: 0.4, lineWidth: 15 },\n        paleRed: { key: 'pr', color: '#882020', opacity: 0.4, lineWidth: 15 },\n        paleGrey: { key: 'pgr', color: '#4a4a4a', opacity: 0.35, lineWidth: 15 }\n      },\n      pieces: {\n        baseUrl: 'https://lichess1.org/assets/piece/cburnett/'\n      },\n      prevSvgHash: ''\n    },\n    hold: timer()\n  };\n}\n","import { State } from './state'\nimport { key2pos } from './util'\nimport { Drawable, DrawShape, DrawShapePiece, DrawBrush, DrawBrushes, DrawModifiers } from './draw'\nimport * as cg from './types'\n\nexport function createElement(tagName: string): SVGElement {\n  return document.createElementNS('http://www.w3.org/2000/svg', tagName);\n}\n\ninterface Shape {\n  shape: DrawShape;\n  current: boolean;\n  hash: Hash;\n}\n\ntype CustomBrushes = Map<string, DrawBrush>; // by hash\n\ntype ArrowDests = Map<cg.Key, number>; // how many arrows land on a square\n\ntype Hash = string;\n\nexport function renderSvg(state: State, root: SVGElement): void {\n\n  const d = state.drawable,\n  curD = d.current,\n  cur = curD && curD.mouseSq ? curD as DrawShape : undefined,\n  arrowDests: ArrowDests = new Map(),\n  bounds = state.dom.bounds();\n\n  for (const s of d.shapes.concat(d.autoShapes).concat(cur ? [cur] : [])) {\n    if (s.dest) arrowDests.set(s.dest, (arrowDests.get(s.dest) || 0) + 1);\n  }\n\n  const shapes: Shape[] = d.shapes.concat(d.autoShapes).map((s: DrawShape) => {\n    return {\n      shape: s,\n      current: false,\n      hash: shapeHash(s, arrowDests, false, bounds)\n    };\n  });\n  if (cur) shapes.push({\n    shape: cur,\n    current: true,\n    hash: shapeHash(cur, arrowDests, true, bounds)\n  });\n\n  const fullHash = shapes.map(sc => sc.hash).join(';');\n  if (fullHash === state.drawable.prevSvgHash) return;\n  state.drawable.prevSvgHash = fullHash;\n\n  const defsEl = root.firstChild as SVGElement;\n\n  syncDefs(d, shapes, defsEl);\n  syncShapes(state, shapes, d.brushes, arrowDests, root, defsEl);\n}\n\n// append only. Don't try to update/remove.\nfunction syncDefs(d: Drawable, shapes: Shape[], defsEl: SVGElement) {\n  const brushes: CustomBrushes = new Map();\n  let brush: DrawBrush;\n  for (const s of shapes) {\n    if (s.shape.dest) {\n      brush = d.brushes[s.shape.brush];\n      if (s.shape.modifiers) brush = makeCustomBrush(brush, s.shape.modifiers);\n      brushes.set(brush.key, brush);\n    }\n  }\n  const keysInDom = new Set();\n  let el: SVGElement | undefined = defsEl.firstChild as SVGElement;\n  while (el) {\n    keysInDom.add(el.getAttribute('cgKey'));\n    el = el.nextSibling as SVGElement | undefined;\n  }\n  for (const [key, brush] of brushes.entries()) {\n    if (!keysInDom.has(key)) defsEl.appendChild(renderMarker(brush));\n  }\n}\n\n// append and remove only. No updates.\nfunction syncShapes(state: State, shapes: Shape[], brushes: DrawBrushes, arrowDests: ArrowDests, root: SVGElement, defsEl: SVGElement): void {\n  const bounds = state.dom.bounds(),\n  hashesInDom = new Map(), // by hash\n  toRemove: SVGElement[] = [];\n  for (const sc of shapes) hashesInDom.set(sc.hash, false);\n  let el: SVGElement | undefined = defsEl.nextSibling as SVGElement, elHash: Hash;\n  while (el) {\n    elHash = el.getAttribute('cgHash') as Hash;\n    // found a shape element that's here to stay\n    if (hashesInDom.has(elHash)) hashesInDom.set(elHash, true);\n    // or remove it\n    else toRemove.push(el);\n    el = el.nextSibling as SVGElement | undefined;\n  }\n  // remove old shapes\n  for (const el of toRemove) root.removeChild(el);\n  // insert shapes that are not yet in dom\n  for (const sc of shapes) {\n    if (!hashesInDom.get(sc.hash)) root.appendChild(renderShape(state, sc, brushes, arrowDests, bounds));\n  }\n}\n\nfunction shapeHash({orig, dest, brush, piece, modifiers}: DrawShape, arrowDests: ArrowDests, current: boolean, bounds: ClientRect): Hash {\n  return [bounds.width, bounds.height, current, orig, dest, brush, dest && (arrowDests.get(dest) || 0) > 1,\n    piece && pieceHash(piece),\n    modifiers && modifiersHash(modifiers)\n  ].filter(x => x).join(',');\n}\n\nfunction pieceHash(piece: DrawShapePiece): Hash {\n  return [piece.color, piece.role, piece.scale].filter(x => x).join(',');\n}\n\nfunction modifiersHash(m: DrawModifiers): Hash {\n  return '' + (m.lineWidth || '');\n}\n\nfunction renderShape(state: State, {shape, current, hash}: Shape, brushes: DrawBrushes, arrowDests: ArrowDests, bounds: ClientRect): SVGElement {\n  let el: SVGElement;\n  if (shape.piece) el = renderPiece(\n    state.drawable.pieces.baseUrl,\n    orient(key2pos(shape.orig), state.orientation),\n    shape.piece,\n    bounds);\n  else {\n    const orig = orient(key2pos(shape.orig), state.orientation);\n    if (shape.dest) {\n      let brush: DrawBrush = brushes[shape.brush];\n      if (shape.modifiers) brush = makeCustomBrush(brush, shape.modifiers);\n      el = renderArrow(\n        brush,\n        orig,\n        orient(key2pos(shape.dest), state.orientation),\n        current,\n        (arrowDests.get(shape.dest) || 0) > 1,\n        bounds);\n    }\n    else el = renderCircle(brushes[shape.brush], orig, current, bounds);\n  }\n  el.setAttribute('cgHash', hash);\n  return el;\n}\n\nfunction renderCircle(brush: DrawBrush, pos: cg.Pos, current: boolean, bounds: ClientRect): SVGElement {\n  const o = pos2px(pos, bounds),\n  widths = circleWidth(bounds),\n  radius = (bounds.width + bounds.height) / 32;\n  return setAttributes(createElement('circle'), {\n    stroke: brush.color,\n    'stroke-width': widths[current ? 0 : 1],\n    fill: 'none',\n    opacity: opacity(brush, current),\n    cx: o[0],\n    cy: o[1],\n    r: radius - widths[1] / 2\n  });\n}\n\nfunction renderArrow(brush: DrawBrush, orig: cg.Pos, dest: cg.Pos, current: boolean, shorten: boolean, bounds: ClientRect): SVGElement {\n  const m = arrowMargin(bounds, shorten && !current),\n  a = pos2px(orig, bounds),\n  b = pos2px(dest, bounds),\n  dx = b[0] - a[0],\n  dy = b[1] - a[1],\n  angle = Math.atan2(dy, dx),\n  xo = Math.cos(angle) * m,\n  yo = Math.sin(angle) * m;\n  return setAttributes(createElement('line'), {\n    stroke: brush.color,\n    'stroke-width': lineWidth(brush, current, bounds),\n    'stroke-linecap': 'round',\n    'marker-end': 'url(#arrowhead-' + brush.key + ')',\n    opacity: opacity(brush, current),\n    x1: a[0],\n    y1: a[1],\n    x2: b[0] - xo,\n    y2: b[1] - yo\n  });\n}\n\nfunction renderPiece(baseUrl: string, pos: cg.Pos, piece: DrawShapePiece, bounds: ClientRect): SVGElement {\n  const o = pos2px(pos, bounds),\n  size = bounds.width / 8 * (piece.scale || 1),\n  name = piece.color[0] + (piece.role === 'knight' ? 'n' : piece.role[0]).toUpperCase();\n  return setAttributes(createElement('image'), {\n    className: `${piece.role} ${piece.color}`,\n    x: o[0] - size / 2,\n    y: o[1] - size / 2,\n    width: size,\n    height: size,\n    href: baseUrl + name + '.svg'\n  });\n}\n\nfunction renderMarker(brush: DrawBrush): SVGElement {\n  const marker = setAttributes(createElement('marker'), {\n    id: 'arrowhead-' + brush.key,\n    orient: 'auto',\n    markerWidth: 4,\n    markerHeight: 8,\n    refX: 2.05,\n    refY: 2.01\n  });\n  marker.appendChild(setAttributes(createElement('path'), {\n    d: 'M0,0 V4 L3,2 Z',\n    fill: brush.color\n  }));\n  marker.setAttribute('cgKey', brush.key);\n  return marker;\n}\n\nfunction setAttributes(el: SVGElement, attrs: { [key: string]: any }): SVGElement {\n  for (const key in attrs) el.setAttribute(key, attrs[key]);\n  return el;\n}\n\nfunction orient(pos: cg.Pos, color: cg.Color): cg.Pos {\n  return color === 'white' ? pos : [7 - pos[0], 7 - pos[1]];\n}\n\nfunction makeCustomBrush(base: DrawBrush, modifiers: DrawModifiers): DrawBrush {\n  return {\n    color: base.color,\n    opacity: Math.round(base.opacity * 10) / 10,\n    lineWidth: Math.round(modifiers.lineWidth || base.lineWidth),\n    key: [base.key, modifiers.lineWidth].filter(x => x).join(''),\n  };\n}\n\nfunction circleWidth(bounds: ClientRect): [number, number] {\n  const base = bounds.width / 512;\n  return [3 * base, 4 * base];\n}\n\nfunction lineWidth(brush: DrawBrush, current: boolean, bounds: ClientRect): number {\n  return (brush.lineWidth || 10) * (current ? 0.85 : 1) / 512 * bounds.width;\n}\n\nfunction opacity(brush: DrawBrush, current: boolean): number {\n  return (brush.opacity || 1) * (current ? 0.9 : 1);\n}\n\nfunction arrowMargin(bounds: ClientRect, shorten: boolean): number {\n  return (shorten ? 20 : 10) / 512 * bounds.width;\n}\n\nfunction pos2px(pos: cg.Pos, bounds: ClientRect): cg.NumberPair {\n  return [(pos[0] + 0.5) * bounds.width / 8, (7.5 - pos[1]) * bounds.height / 8];\n}\n","import { State } from './state'\nimport { setVisible, createEl } from './util'\nimport { colors, files, ranks } from './types'\nimport { createElement as createSVG } from './svg'\nimport { Elements } from './types'\n\nexport function renderWrap(element: HTMLElement, s: State, relative: boolean): Elements {\n\n  // .cg-wrap (element passed to Chessground)\n  //   cg-helper (12.5%)\n  //     cg-container (800%)\n  //       cg-board\n  //       svg\n  //       coords.ranks\n  //       coords.files\n  //       piece.ghost\n\n  element.innerHTML = '';\n\n  // ensure the cg-wrap class is set\n  // so bounds calculation can use the CSS width/height values\n  // add that class yourself to the element before calling chessground\n  // for a slight performance improvement! (avoids recomputing style)\n  element.classList.add('cg-wrap');\n\n  for (const c of colors) element.classList.toggle('orientation-' + c, s.orientation === c);\n  element.classList.toggle('manipulable', !s.viewOnly);\n\n  const helper = createEl('cg-helper');\n  element.appendChild(helper);\n  const container = createEl('cg-container');\n  helper.appendChild(container);\n\n  const board = createEl('cg-board');\n  container.appendChild(board);\n\n  let svg: SVGElement | undefined;\n  if (s.drawable.visible && !relative) {\n    svg = createSVG('svg');\n    svg.appendChild(createSVG('defs'));\n    container.appendChild(svg);\n  }\n\n  if (s.coordinates) {\n    const orientClass = s.orientation === 'black' ? ' black' : '';\n    container.appendChild(renderCoords(ranks, 'ranks' + orientClass));\n    container.appendChild(renderCoords(files, 'files' + orientClass));\n  }\n\n  let ghost: HTMLElement | undefined;\n  if (s.draggable.showGhost && !relative) {\n    ghost = createEl('piece', 'ghost');\n    setVisible(ghost, false);\n    container.appendChild(ghost);\n  }\n\n  return {\n    board,\n    container,\n    ghost,\n    svg\n  };\n}\n\nfunction renderCoords(elems: readonly string[], className: string): HTMLElement {\n  const el = createEl('coords', className);\n  let f: HTMLElement;\n  for (const elem of elems) {\n    f = createEl('coord');\n    f.textContent = elem;\n    el.appendChild(f);\n  }\n  return el;\n}\n","import { State } from './state'\nimport * as cg from './types'\nimport * as board from './board'\nimport * as util from './util'\nimport { cancel as dragCancel } from './drag'\n\nexport function setDropMode(s: State, piece?: cg.Piece): void {\n  s.dropmode = {\n    active: true,\n    piece\n  };\n  dragCancel(s);\n}\n\nexport function cancelDropMode(s: State): void {\n  s.dropmode = {\n    active: false\n  };\n}\n\nexport function drop(s: State, e: cg.MouchEvent): void {\n  if (!s.dropmode.active) return;\n\n  board.unsetPremove(s);\n  board.unsetPredrop(s);\n\n  const piece = s.dropmode.piece;\n\n  if (piece) {\n    s.pieces.set('a0', piece);\n    const position = util.eventPosition(e);\n    const dest = position && board.getKeyAtDomPos(\n      position, board.whitePov(s), s.dom.bounds());\n    if (dest) board.dropNewPiece(s, 'a0', dest);\n  }\n  s.dom.redraw();\n}\n","import { State } from './state'\nimport * as drag from './drag'\nimport * as draw from './draw'\nimport { drop } from './drop'\nimport { isRightButton } from './util'\nimport * as cg from './types'\n\ntype MouchBind = (e: cg.MouchEvent) => void;\ntype StateMouchBind = (d: State, e: cg.MouchEvent) => void;\n\nexport function bindBoard(s: State, boundsUpdated: () => void): void {\n\n  const boardEl = s.dom.elements.board;\n\n  if (!s.dom.relative && s.resizable && 'ResizeObserver' in window) {\n    const observer = new (window as any)['ResizeObserver'](boundsUpdated);\n    observer.observe(boardEl);\n  }\n\n  if (s.viewOnly) return;\n\n  // Cannot be passive, because we prevent touch scrolling and dragging of\n  // selected elements.\n  const onStart = startDragOrDraw(s);\n  boardEl.addEventListener('touchstart', onStart as EventListener, { passive: false });\n  boardEl.addEventListener('mousedown', onStart as EventListener, { passive: false });\n\n  if (s.disableContextMenu || s.drawable.enabled) {\n    boardEl.addEventListener('contextmenu', e => e.preventDefault());\n  }\n}\n\n// returns the unbind function\nexport function bindDocument(s: State, boundsUpdated: () => void): cg.Unbind {\n\n  const unbinds: cg.Unbind[] = [];\n\n  // Old versions of Edge and Safari do not support ResizeObserver. Send\n  // chessground.resize if a user action has changed the bounds of the board.\n  if (!s.dom.relative && s.resizable && !('ResizeObserver' in window)) {\n    unbinds.push(unbindable(document.body, 'chessground.resize', boundsUpdated));\n  }\n\n  if (!s.viewOnly) {\n\n    const onmove: MouchBind = dragOrDraw(s, drag.move, draw.move);\n    const onend: MouchBind = dragOrDraw(s, drag.end, draw.end);\n\n    for (const ev of ['touchmove', 'mousemove']) unbinds.push(unbindable(document, ev, onmove));\n    for (const ev of ['touchend', 'mouseup']) unbinds.push(unbindable(document, ev, onend));\n\n    const onScroll = () => s.dom.bounds.clear();\n    unbinds.push(unbindable(document, 'scroll', onScroll, { capture: true, passive: true }));\n    unbinds.push(unbindable(window, 'resize', onScroll, { passive: true }));\n  }\n\n  return () => unbinds.forEach(f => f());\n}\n\nfunction unbindable(el: EventTarget, eventName: string, callback: MouchBind, options?: any): cg.Unbind {\n  el.addEventListener(eventName, callback as EventListener, options);\n  return () => el.removeEventListener(eventName, callback as EventListener, options);\n}\n\nfunction startDragOrDraw(s: State): MouchBind {\n  return e => {\n    if (s.draggable.current) drag.cancel(s);\n    else if (s.drawable.current) draw.cancel(s);\n    else if (e.shiftKey || isRightButton(e)) { if (s.drawable.enabled) draw.start(s, e); }\n    else if (!s.viewOnly) {\n      if (s.dropmode.active) drop(s, e);\n      else drag.start(s, e);\n    }\n  };\n}\n\nfunction dragOrDraw(s: State, withDrag: StateMouchBind, withDraw: StateMouchBind): MouchBind {\n  return e => {\n    if (s.drawable.current) { if (s.drawable.enabled) withDraw(s, e); }\n    else if (!s.viewOnly) withDrag(s, e);\n  };\n}\n","import { State } from './state'\nimport { key2pos, createEl } from './util'\nimport { whitePov } from './board'\nimport * as util from './util'\nimport { AnimCurrent, AnimVectors, AnimVector, AnimFadings } from './anim'\nimport { DragCurrent } from './drag'\nimport * as cg from './types'\n\ntype PieceName = string; // `$color $role`\n\ntype SquareClasses = Map<cg.Key, string>;\n\n// ported from https://github.com/veloce/lichobile/blob/master/src/js/chessground/view.js\n// in case of bugs, blame @veloce\nexport function render(s: State): void {\n  const asWhite: boolean = whitePov(s),\n  posToTranslate = s.dom.relative ? util.posToTranslateRel : util.posToTranslateAbs(s.dom.bounds()),\n  translate = s.dom.relative ? util.translateRel : util.translateAbs,\n  boardEl: HTMLElement = s.dom.elements.board,\n  pieces: cg.Pieces = s.pieces,\n  curAnim: AnimCurrent | undefined = s.animation.current,\n  anims: AnimVectors = curAnim ? curAnim.plan.anims : new Map(),\n  fadings: AnimFadings = curAnim ? curAnim.plan.fadings : new Map(),\n  curDrag: DragCurrent | undefined = s.draggable.current,\n  squares: SquareClasses = computeSquareClasses(s),\n  samePieces: Set<cg.Key> = new Set(),\n  sameSquares: Set<cg.Key> = new Set(),\n  movedPieces: Map<PieceName, cg.PieceNode[]> = new Map(),\n  movedSquares: Map<string, cg.SquareNode[]> = new Map(); // by class name\n  let k: cg.Key,\n  el: cg.PieceNode | cg.SquareNode | undefined,\n  pieceAtKey: cg.Piece | undefined,\n  elPieceName: PieceName,\n  anim: AnimVector | undefined,\n  fading: cg.Piece | undefined,\n  pMvdset: cg.PieceNode[] | undefined,\n  pMvd: cg.PieceNode | undefined,\n  sMvdset: cg.SquareNode[] | undefined,\n  sMvd: cg.SquareNode | undefined;\n\n  // walk over all board dom elements, apply animations and flag moved pieces\n  el = boardEl.firstChild as cg.PieceNode | cg.SquareNode | undefined;\n  while (el) {\n    k = el.cgKey;\n    if (isPieceNode(el)) {\n      pieceAtKey = pieces.get(k);\n      anim = anims.get(k);\n      fading = fadings.get(k);\n      elPieceName = el.cgPiece;\n      // if piece not being dragged anymore, remove dragging style\n      if (el.cgDragging && (!curDrag || curDrag.orig !== k)) {\n        el.classList.remove('dragging');\n        translate(el, posToTranslate(key2pos(k), asWhite));\n        el.cgDragging = false;\n      }\n      // remove fading class if it still remains\n      if (!fading && el.cgFading) {\n        el.cgFading = false;\n        el.classList.remove('fading');\n      }\n      // there is now a piece at this dom key\n      if (pieceAtKey) {\n        // continue animation if already animating and same piece\n        // (otherwise it could animate a captured piece)\n        if (anim && el.cgAnimating && elPieceName === pieceNameOf(pieceAtKey)) {\n          const pos = key2pos(k);\n          pos[0] += anim[2];\n          pos[1] += anim[3];\n          el.classList.add('anim');\n          translate(el, posToTranslate(pos, asWhite));\n        } else if (el.cgAnimating) {\n          el.cgAnimating = false;\n          el.classList.remove('anim');\n          translate(el, posToTranslate(key2pos(k), asWhite));\n          if (s.addPieceZIndex) el.style.zIndex = posZIndex(key2pos(k), asWhite);\n        }\n        // same piece: flag as same\n        if (elPieceName === pieceNameOf(pieceAtKey) && (!fading || !el.cgFading)) {\n          samePieces.add(k);\n        }\n        // different piece: flag as moved unless it is a fading piece\n        else {\n          if (fading && elPieceName === pieceNameOf(fading)) {\n            el.classList.add('fading');\n            el.cgFading = true;\n          } else {\n            appendValue(movedPieces, elPieceName, el);\n          }\n        }\n      }\n      // no piece: flag as moved\n      else {\n        appendValue(movedPieces, elPieceName, el);\n      }\n    }\n    else if (isSquareNode(el)) {\n      const cn = el.className;\n      if (squares.get(k) === cn) sameSquares.add(k);\n      else appendValue(movedSquares, cn, el);\n    }\n    el = el.nextSibling as cg.PieceNode | cg.SquareNode | undefined;\n  }\n\n  // walk over all squares in current set, apply dom changes to moved squares\n  // or append new squares\n  for (const [sk, className] of squares) {\n    if (!sameSquares.has(sk)) {\n      sMvdset = movedSquares.get(className);\n      sMvd = sMvdset && sMvdset.pop();\n      const translation = posToTranslate(key2pos(sk), asWhite);\n      if (sMvd) {\n        sMvd.cgKey = sk;\n        translate(sMvd, translation);\n      }\n      else {\n        const squareNode = createEl('square', className) as cg.SquareNode;\n        squareNode.cgKey = sk;\n        translate(squareNode, translation);\n        boardEl.insertBefore(squareNode, boardEl.firstChild);\n      }\n    }\n  }\n\n  // walk over all pieces in current set, apply dom changes to moved pieces\n  // or append new pieces\n  for (const [k, p] of pieces) {\n    anim = anims.get(k);\n    if (!samePieces.has(k)) {\n      pMvdset = movedPieces.get(pieceNameOf(p));\n      pMvd = pMvdset && pMvdset.pop();\n      // a same piece was moved\n      if (pMvd) {\n        // apply dom changes\n        pMvd.cgKey = k;\n        if (pMvd.cgFading) {\n          pMvd.classList.remove('fading');\n          pMvd.cgFading = false;\n        }\n        const pos = key2pos(k);\n        if (s.addPieceZIndex) pMvd.style.zIndex = posZIndex(pos, asWhite);\n        if (anim) {\n          pMvd.cgAnimating = true;\n          pMvd.classList.add('anim');\n          pos[0] += anim[2];\n          pos[1] += anim[3];\n        }\n        translate(pMvd, posToTranslate(pos, asWhite));\n      }\n      // no piece in moved obj: insert the new piece\n      // assumes the new piece is not being dragged\n      else {\n\n        const pieceName = pieceNameOf(p),\n        pieceNode = createEl('piece', pieceName) as cg.PieceNode,\n        pos = key2pos(k);\n\n        pieceNode.cgPiece = pieceName;\n        pieceNode.cgKey = k;\n        if (anim) {\n          pieceNode.cgAnimating = true;\n          pos[0] += anim[2];\n          pos[1] += anim[3];\n        }\n        translate(pieceNode, posToTranslate(pos, asWhite));\n\n        if (s.addPieceZIndex) pieceNode.style.zIndex = posZIndex(pos, asWhite);\n\n        boardEl.appendChild(pieceNode);\n      }\n    }\n  }\n\n  // remove any element that remains in the moved sets\n  for (const nodes of movedPieces.values()) removeNodes(s, nodes);\n  for (const nodes of movedSquares.values()) removeNodes(s, nodes);\n}\n\nexport function updateBounds(s: State): void {\n  if (s.dom.relative) return;\n  const asWhite: boolean = whitePov(s),\n  posToTranslate = util.posToTranslateAbs(s.dom.bounds());\n  let el = s.dom.elements.board.firstChild as cg.PieceNode | cg.SquareNode | undefined;\n  while (el) {\n    if ((isPieceNode(el) && !el.cgAnimating) || isSquareNode(el)) {\n      util.translateAbs(el, posToTranslate(key2pos(el.cgKey), asWhite));\n    }\n    el = el.nextSibling as cg.PieceNode | cg.SquareNode | undefined;\n  }\n}\n\nfunction isPieceNode(el: cg.PieceNode | cg.SquareNode): el is cg.PieceNode {\n  return el.tagName === 'PIECE';\n}\nfunction isSquareNode(el: cg.PieceNode | cg.SquareNode): el is cg.SquareNode {\n  return el.tagName === 'SQUARE';\n}\n\nfunction removeNodes(s: State, nodes: HTMLElement[]): void {\n  for (const node of nodes) s.dom.elements.board.removeChild(node);\n}\n\nfunction posZIndex(pos: cg.Pos, asWhite: boolean): string {\n  let z = 2 + pos[1] * 8 + (7 - pos[0]);\n  if (asWhite) z = 67 - z;\n  return z + '';\n}\n\nfunction pieceNameOf(piece: cg.Piece): string {\n  return `${piece.color} ${piece.role}`;\n}\n\nfunction computeSquareClasses(s: State): SquareClasses {\n  const squares: SquareClasses = new Map();\n  if (s.lastMove && s.highlight.lastMove) for (const k of s.lastMove) {\n    addSquare(squares, k, 'last-move');\n  }\n  if (s.check && s.highlight.check) addSquare(squares, s.check, 'check');\n  if (s.selected) {\n    addSquare(squares, s.selected, 'selected');\n    if (s.movable.showDests) {\n      const dests = s.movable.dests?.get(s.selected);\n      if (dests) for (const k of dests) {\n        addSquare(squares, k, 'move-dest' + (s.pieces.has(k) ? ' oc' : ''));\n      }\n      const pDests = s.premovable.dests;\n      if (pDests) for (const k of pDests) {\n        addSquare(squares, k, 'premove-dest' + (s.pieces.has(k) ? ' oc' : ''));\n      }\n    }\n  }\n  const premove = s.premovable.current;\n  if (premove) for (const k of premove) addSquare(squares, k, 'current-premove');\n  else if (s.predroppable.current) addSquare(squares, s.predroppable.current.key, 'current-premove');\n\n  const o = s.exploding;\n  if (o) for (const k of o.keys) addSquare(squares, k, 'exploding' + o.stage);\n\n  return squares;\n}\n\nfunction addSquare(squares: SquareClasses, key: cg.Key, klass: string): void {\n  const classes = squares.get(key);\n  if (classes) squares.set(key, `${classes} ${klass}`);\n  else squares.set(key, klass)\n}\n\nfunction appendValue<K, V>(map: Map<K, V[]>, key: K, value: V): void {\n  const arr = map.get(key);\n  if (arr) arr.push(value);\n  else map.set(key, [value]);\n}\n","import { Api, start } from './api'\nimport { Config, configure } from './config'\nimport { State, defaults } from './state'\n\nimport { renderWrap } from './wrap';\nimport * as events from './events'\nimport { render, updateBounds } from './render';\nimport * as svg from './svg';\nimport * as util from './util';\n\nexport function Chessground(element: HTMLElement, config?: Config): Api {\n\n  const state = defaults() as State;\n\n  configure(state, config || {});\n\n  function redrawAll(): void {\n    const prevUnbind = state.dom && state.dom.unbind; /* eslint-disable-line */\n    // compute bounds from existing board element if possible\n    // this allows non-square boards from CSS to be handled (for 3D)\n    const relative = state.viewOnly && !state.drawable.visible,\n    elements = renderWrap(element, state, relative),\n    bounds = util.memo(() => elements.board.getBoundingClientRect()),\n    redrawNow = (skipSvg?: boolean): void => {\n      render(state);\n      if (!skipSvg && elements.svg) svg.renderSvg(state, elements.svg);\n    },\n    boundsUpdated = (): void => {\n      bounds.clear();\n      updateBounds(state);\n      if (elements.svg) svg.renderSvg(state, elements.svg);\n    };\n    state.dom = {\n      elements,\n      bounds,\n      redraw: debounceRedraw(redrawNow),\n      redrawNow,\n      unbind: prevUnbind,\n      relative\n    };\n    state.drawable.prevSvgHash = '';\n    redrawNow(false);\n    events.bindBoard(state, boundsUpdated);\n    if (!prevUnbind) state.dom.unbind = events.bindDocument(state, boundsUpdated);\n    state.events.insert && state.events.insert(elements);\n  }\n  redrawAll();\n\n  return start(state, redrawAll);\n}\n\nfunction debounceRedraw(redrawNow: (skipSvg?: boolean) => void): () => void {\n  let redrawing = false;\n  return () => {\n    if (redrawing) return;\n    redrawing = true;\n    requestAnimationFrame(() => {\n      redrawNow();\n      redrawing = false;\n    });\n  };\n}\n","import { Chessground } from \"chessground\";\n\nconst config = { fen: \"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR\" };\nconst board= document.getElementById(\"board\");\nconst ground = Chessground(board, config);\n","var OVERLAY_ID = '__parcel__error__overlay__';\n\nvar OldModule = module.bundle.Module;\n\nfunction Module(moduleName) {\n  OldModule.call(this, moduleName);\n  this.hot = {\n    data: module.bundle.hotData,\n    _acceptCallbacks: [],\n    _disposeCallbacks: [],\n    accept: function (fn) {\n      this._acceptCallbacks.push(fn || function () {});\n    },\n    dispose: function (fn) {\n      this._disposeCallbacks.push(fn);\n    }\n  };\n\n  module.bundle.hotData = null;\n}\n\nmodule.bundle.Module = Module;\nvar checkedAssets, assetsToAccept;\n\nvar parent = module.bundle.parent;\nif ((!parent || !parent.isParcelRequire) && typeof WebSocket !== 'undefined') {\n  var hostname = process.env.HMR_HOSTNAME || location.hostname;\n  var protocol = location.protocol === 'https:' ? 'wss' : 'ws';\n  var ws = new WebSocket(protocol + '://' + hostname + ':' + process.env.HMR_PORT + '/');\n  ws.onmessage = function(event) {\n    checkedAssets = {};\n    assetsToAccept = [];\n\n    var data = JSON.parse(event.data);\n\n    if (data.type === 'update') {\n      var handled = false;\n      data.assets.forEach(function(asset) {\n        if (!asset.isNew) {\n          var didAccept = hmrAcceptCheck(global.parcelRequire, asset.id);\n          if (didAccept) {\n            handled = true;\n          }\n        }\n      });\n\n      // Enable HMR for CSS by default.\n      handled = handled || data.assets.every(function(asset) {\n        return asset.type === 'css' && asset.generated.js;\n      });\n\n      if (handled) {\n        console.clear();\n\n        data.assets.forEach(function (asset) {\n          hmrApply(global.parcelRequire, asset);\n        });\n\n        assetsToAccept.forEach(function (v) {\n          hmrAcceptRun(v[0], v[1]);\n        });\n      } else if (location.reload) { // `location` global exists in a web worker context but lacks `.reload()` function.\n        location.reload();\n      }\n    }\n\n    if (data.type === 'reload') {\n      ws.close();\n      ws.onclose = function () {\n        location.reload();\n      }\n    }\n\n    if (data.type === 'error-resolved') {\n      console.log('[parcel] ✨ Error resolved');\n\n      removeErrorOverlay();\n    }\n\n    if (data.type === 'error') {\n      console.error('[parcel] 🚨  ' + data.error.message + '\\n' + data.error.stack);\n\n      removeErrorOverlay();\n\n      var overlay = createErrorOverlay(data);\n      document.body.appendChild(overlay);\n    }\n  };\n}\n\nfunction removeErrorOverlay() {\n  var overlay = document.getElementById(OVERLAY_ID);\n  if (overlay) {\n    overlay.remove();\n  }\n}\n\nfunction createErrorOverlay(data) {\n  var overlay = document.createElement('div');\n  overlay.id = OVERLAY_ID;\n\n  // html encode message and stack trace\n  var message = document.createElement('div');\n  var stackTrace = document.createElement('pre');\n  message.innerText = data.error.message;\n  stackTrace.innerText = data.error.stack;\n\n  overlay.innerHTML = (\n    '<div style=\"background: black; font-size: 16px; color: white; position: fixed; height: 100%; width: 100%; top: 0px; left: 0px; padding: 30px; opacity: 0.85; font-family: Menlo, Consolas, monospace; z-index: 9999;\">' +\n      '<span style=\"background: red; padding: 2px 4px; border-radius: 2px;\">ERROR</span>' +\n      '<span style=\"top: 2px; margin-left: 5px; position: relative;\">🚨</span>' +\n      '<div style=\"font-size: 18px; font-weight: bold; margin-top: 20px;\">' + message.innerHTML + '</div>' +\n      '<pre>' + stackTrace.innerHTML + '</pre>' +\n    '</div>'\n  );\n\n  return overlay;\n\n}\n\nfunction getParents(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return [];\n  }\n\n  var parents = [];\n  var k, d, dep;\n\n  for (k in modules) {\n    for (d in modules[k][1]) {\n      dep = modules[k][1][d];\n      if (dep === id || (Array.isArray(dep) && dep[dep.length - 1] === id)) {\n        parents.push(k);\n      }\n    }\n  }\n\n  if (bundle.parent) {\n    parents = parents.concat(getParents(bundle.parent, id));\n  }\n\n  return parents;\n}\n\nfunction hmrApply(bundle, asset) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (modules[asset.id] || !bundle.parent) {\n    var fn = new Function('require', 'module', 'exports', asset.generated.js);\n    asset.isNew = !modules[asset.id];\n    modules[asset.id] = [fn, asset.deps];\n  } else if (bundle.parent) {\n    hmrApply(bundle.parent, asset);\n  }\n}\n\nfunction hmrAcceptCheck(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (!modules[id] && bundle.parent) {\n    return hmrAcceptCheck(bundle.parent, id);\n  }\n\n  if (checkedAssets[id]) {\n    return;\n  }\n  checkedAssets[id] = true;\n\n  var cached = bundle.cache[id];\n\n  assetsToAccept.push([bundle, id]);\n\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    return true;\n  }\n\n  return getParents(global.parcelRequire, id).some(function (id) {\n    return hmrAcceptCheck(global.parcelRequire, id)\n  });\n}\n\nfunction hmrAcceptRun(bundle, id) {\n  var cached = bundle.cache[id];\n  bundle.hotData = {};\n  if (cached) {\n    cached.hot.data = bundle.hotData;\n  }\n\n  if (cached && cached.hot && cached.hot._disposeCallbacks.length) {\n    cached.hot._disposeCallbacks.forEach(function (cb) {\n      cb(bundle.hotData);\n    });\n  }\n\n  delete bundle.cache[id];\n  bundle(id);\n\n  cached = bundle.cache[id];\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    cached.hot._acceptCallbacks.forEach(function (cb) {\n      cb();\n    });\n    return true;\n  }\n}\n"]}