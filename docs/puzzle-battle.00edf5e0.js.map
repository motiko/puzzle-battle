{"version":3,"sources":["src/types.ts","src/util.ts","src/premove.ts","src/board.ts","src/fen.ts","src/config.ts","src/anim.ts","src/draw.ts","src/drag.ts","src/explosion.ts","src/api.ts","src/state.ts","src/svg.ts","src/wrap.ts","src/drop.ts","src/events.ts","src/render.ts","src/chessground.ts","exports.ts","../node_modules/peerjs-js-binarypack/lib/bufferbuilder.js","../node_modules/peerjs-js-binarypack/lib/binarypack.js","../node_modules/webrtc-adapter/src/js/utils.js","../node_modules/webrtc-adapter/src/js/chrome/getusermedia.js","../node_modules/webrtc-adapter/src/js/chrome/getdisplaymedia.js","../node_modules/webrtc-adapter/src/js/chrome/chrome_shim.js","../node_modules/webrtc-adapter/src/js/edge/filtericeservers.js","../node_modules/sdp/sdp.js","../node_modules/rtcpeerconnection-shim/rtcpeerconnection.js","../node_modules/webrtc-adapter/src/js/edge/getusermedia.js","../node_modules/webrtc-adapter/src/js/edge/getdisplaymedia.js","../node_modules/webrtc-adapter/src/js/edge/edge_shim.js","../node_modules/webrtc-adapter/src/js/firefox/getusermedia.js","../node_modules/webrtc-adapter/src/js/firefox/getdisplaymedia.js","../node_modules/webrtc-adapter/src/js/firefox/firefox_shim.js","../node_modules/webrtc-adapter/src/js/safari/safari_shim.js","../node_modules/webrtc-adapter/src/js/common_shim.js","../node_modules/webrtc-adapter/src/js/adapter_factory.js","../node_modules/webrtc-adapter/src/js/adapter_core.js","adapter.ts","supports.ts","util.ts","../node_modules/eventemitter3/index.js","logger.ts","enums.ts","socket.ts","negotiator.ts","baseconnection.ts","mediaconnection.ts","encodingQueue.ts","dataconnection.ts","api.ts","peer.ts","index.js"],"names":["window","eventNameToWrap","wrapper","RTCPeerConnection","proto","prototype","nativeAddEventListener","addEventListener","nativeEventName","cb","apply","arguments","wrappedCallback","e","modifiedEvent","_eventMap","nativeRemoveEventListener","removeEventListener","unwrappedCb","Object","defineProperty","get","set","enumerable","configurable","bool","Error","logDisabled_","deprecationWarnings_","console","log","oldMethod","newMethod","warn","navigator","result","browser","version","mozGetUserMedia","extractVersion","userAgent","webkitGetUserMedia","isSecureContext","webkitRTCPeerConnection","RTCIceGatherer","mediaDevices","match","supportsUnifiedPlan","RTCRtpTransceiver","compactObject","data","isObject","keys","reduce","accumulator","key","isObj","value","isEmptyObject","length","undefined","assign","track","outbound","streamStatsType","filteredResult","Map","trackStats","forEach","type","trackIdentifier","id","push","trackStat","stats","trackId","walkStats","uastring","expr","pos","parseInt","val","toString","call","base","resultSet","has","name","endsWith","browserDetails","utils","detectBrowser","constraintsToChrome_","c","mandatory","optional","cc","r","ideal","exact","min","max","oldname_","prefix","charAt","toUpperCase","slice","oc","mix","advanced","concat","shimConstraints_","constraints","func","JSON","parse","stringify","audio","remap","obj","a","b","video","face","facingMode","getSupportedFacingModeLies","matches","getSupportedConstraints","enumerateDevices","then","devices","dev","filter","d","kind","find","some","label","toLowerCase","includes","deviceId","logging","shimError_","PermissionDeniedError","PermissionDismissedError","InvalidStateError","DevicesNotFoundError","ConstraintNotSatisfiedError","TrackStartError","MediaDeviceFailedDueToShutdown","MediaDeviceKillSwitchOn","TabCaptureError","ScreenCaptureError","DeviceCaptureError","message","constraint","constraintName","getUserMedia","onSuccess","onError","bind","origGetUserMedia","cs","stream","getAudioTracks","getVideoTracks","getTracks","stop","DOMException","Promise","reject","getSourceId","getDisplayMedia","sourceId","widthSpecified","width","heightSpecified","height","frameRateSpecified","frameRate","chromeMediaSource","chromeMediaSourceId","maxFrameRate","maxWidth","maxHeight","error","MediaStream","webkitMediaStream","wrapPeerConnectionEvent","transceiver","receiver","_ontrack","f","origSetRemoteDescription","setRemoteDescription","_ontrackpoly","te","getReceivers","event","Event","streams","dispatchEvent","shimSenderWithDtmf","pc","dtmf","_dtmf","createDTMFSender","_pc","getSenders","_senders","origAddTrack","addTrack","sender","origRemoveTrack","removeTrack","idx","indexOf","splice","origAddStream","addStream","origRemoveStream","removeStream","s","RTCRtpSender","origGetSenders","senders","origGetStats","getStats","selector","onSucc","onErr","fixChromeStats_","response","standardReport","report","standardStats","timestamp","localcandidate","remotecandidate","names","stat","makeMapStats","map","resolve","RTCRtpReceiver","filterStats","origGetReceivers","receivers","srcElement","MediaStreamTrack","err","shimAddTrackRemoveTrackWithNative","origGetLocalStreams","getLocalStreams","nativeStreams","_reverseStreams","_streams","alreadyExists","newStream","signalingState","t","oldStream","method","nativeMethod","methodObj","args","isLegacyCall","description","desc","replaceInternalStreamId","origSetLocalDescription","setLocalDescription","sdp","internalId","externalStream","internalStream","replace","RegExp","RTCSessionDescription","replaceExternalStreamId","origLocalDescription","getOwnPropertyDescriptor","streamid","RTCIceCandidate","nativeAddIceCandidate","addIceCandidate","candidate","target","_shimmedLocalStreams","streamId","existingSenders","newSenders","newSender","iceServers","edgeVersion","hasTurn","server","urls","url","deprecated","isString","validTurn","startsWith","SDPUtils","require","writeMediaSection","caps","dtlsRole","writeRtpDescription","writeIceParameters","iceGatherer","getLocalParameters","writeDtlsParameters","dtlsTransport","mid","rtpSender","rtpReceiver","_initialTrackId","msid","sendEncodingParameters","ssrc","rtx","localCName","getCommonCapabilities","localCapabilities","remoteCapabilities","commonCapabilities","codecs","headerExtensions","fecMechanisms","findCodecByPayloadType","pt","i","payloadType","preferredPayloadType","rtxCapabilityMatches","lRtx","rRtx","lCodecs","rCodecs","lCodec","parameters","apt","rCodec","clockRate","numChannels","Math","rtcpFeedback","fb","j","parameter","lHeaderExtension","rHeaderExtension","uri","isActionAllowedInSignalingState","action","offer","answer","maybeAddCandidate","iceTransport","alreadyAdded","getRemoteCandidates","remoteCandidate","foundation","ip","port","priority","protocol","addRemoteCandidate","makeError","code","NotSupportedError","InvalidAccessError","TypeError","OperationError","module","exports","addTrackToStreamAndFireEvent","MediaStreamTrackEvent","fireAddTrack","trackEvent","setTimeout","_dispatchEvent","config","_eventTarget","document","createDocumentFragment","canTrickleIceCandidates","needNegotiation","localStreams","remoteStreams","_localDescription","_remoteDescription","iceConnectionState","connectionState","iceGatheringState","usingBundle","bundlePolicy","rtcpMuxPolicy","iceTransportPolicy","filterIceServers","_iceGatherers","iceCandidatePoolSize","gatherPolicy","_config","transceivers","_sdpSessionId","generateSessionId","_sdpSessionVersion","_dtlsRole","_isClosed","onicecandidate","onaddstream","ontrack","onremovestream","onsignalingstatechange","oniceconnectionstatechange","onconnectionstatechange","onicegatheringstatechange","onnegotiationneeded","ondatachannel","_emitGatheringStateChange","getConfiguration","getRemoteStreams","_createTransceiver","doNotAdd","hasBundleTransport","recvEncodingParameters","associatedRemoteMediaStreams","wantReceive","transports","_createIceAndDtlsTransports","_maybeFireNegotiationNeeded","clonedStream","clone","clonedTrack","enabled","_createIceGatherer","sdpMLineIndex","shift","writable","bufferedCandidateEvents","bufferCandidates","end","state","_gather","onlocalcandidate","evt","sdpMid","cand","component","ufrag","usernameFragment","serializedCandidate","writeCandidate","parseCandidate","toJSON","sections","getMediaSections","getDescription","join","complete","every","RTCIceTransport","onicestatechange","_updateIceConnectionState","_updateConnectionState","RTCDtlsTransport","ondtlsstatechange","onerror","_disposeIceAndDtlsTransports","_transceive","send","recv","params","encodings","rtcp","cname","compound","rtcpParameters","p","receive","sessionpart","splitSections","mediaSection","parseRtpParameters","isIceLite","matchPrefix","isRejected","rejected","remoteIceParameters","getIceParameters","remoteDtlsParameters","getDtlsParameters","role","start","_updateSignalingState","receiverList","iceOptions","substr","split","lines","splitLines","getKind","direction","getDirection","remoteMsid","parseMsid","getMid","generateIdentifier","parseRtpEncodingParameters","parseRtcpParameters","isComplete","cands","setTransport","setRemoteCandidates","default","getCapabilities","codec","isNewTrack","nativeTrack","sid","item","close","newState","states","closed","checking","connected","completed","disconnected","failed","new","connecting","createOffer","numAudioTracks","numVideoTracks","offerOptions","offerToReceiveAudio","offerToReceiveVideo","writeSessionBoilerplate","remoteCodec","hdrExt","rHdrExt","getLocalCandidates","createAnswer","mediaSectionsInOffer","localTrack","reducedSize","candidateString","trim","senderOrReceiver","promises","all","allStats","results","ortcObjectName","nativeGetstats","nativeStats","mapStats","inboundrtp","outboundrtp","candidatepair","fixStatsType","methods","catch","origMSTEnabled","ev","RTCDtmfSender","RTCDTMFSender","RTCPeerConnectionShim","replaceTrack","setTrack","nativeGetUserMedia","getSettings","nativeGetSettings","applyConstraints","nativeApplyConstraints","preferredMediaSource","mediaSource","RTCTrackEvent","mozRTCPeerConnection","modernStatsTypes","nativeGetStats","DataChannel","RTCDataChannel","origAddTransceiver","addTransceiver","setParametersPromises","initParameters","shouldPerformCheck","sendEncodings","encodingParam","test","rid","parseFloat","scaleResolutionDownBy","RangeError","maxFramerate","getParameters","setParameters","origCreateOffer","finally","origCreateAnswer","_localStreams","_addTrack","index","tracks","_remoteStreams","_onaddstream","_onaddstreampoly","successCallback","failureCallback","options","promise","withCallback","_getUserMedia","shimConstraints","errcb","OrigPeerConnection","pcConfig","pcConstraints","newIceServers","hasOwnProperty","generateCertificate","audioTransceiver","getTransceivers","setDirection","videoTransceiver","NativeRTCIceCandidate","nativeCandidate","parsedCandidate","augmentedCandidate","_sctp","sctpInDescription","sdpSemantics","mLine","parseMLine","isFirefox","maxMessageSize","canSendMMS","remoteIsFirefox","canSendMaxMessageSize","remoteMMS","Number","POSITIVE_INFINITY","sctp","origCreateDataChannel","createDataChannel","dataChannel","wrapDcSend","channel","dc","origDataChannelSend","size","byteLength","readyState","_onconnectionstatechange","origMethod","_connectionstatechangepoly","_lastConnectionState","newEvent","nativeSRD","line","shimChrome","shimFirefox","shimEdge","shimSafari","adapter","commonShim","disableLog","disableWarnings","chromeShim","shimPeerConnection","browserShim","shimGetUserMedia","shimMediaStream","shimOnTrack","shimAddTrackRemoveTrack","shimGetSendersWithDtmf","shimGetStats","shimSenderReceiverGetStats","fixNegotiationNeeded","shimRTCIceCandidate","shimConnectionState","shimMaxMessageSize","shimSendThrowTypeError","removeAllowExtmapMixed","firefoxShim","shimRemoveStream","shimSenderGetStats","shimReceiverGetStats","shimRTCDataChannel","shimAddTransceiver","shimCreateOffer","shimCreateAnswer","edgeShim","shimGetDisplayMedia","shimReplaceTrack","safariShim","shimRTCIceServerUrls","shimCreateOfferLegacy","shimCallbacksAPI","shimLocalStreamsAPI","shimRemoteStreamsAPI","shimTrackEventTransceiver","path","location","pathname","peer","Peer","debug","conn","connect","on","fen","board","getElementById","ground"],"mappings":"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","file":"puzzle-battle.00edf5e0.js","sourceRoot":"..","sourcesContent":["export type Color = 'white' | 'black';\nexport type Role = 'king' | 'queen' | 'rook' | 'bishop' | 'knight' | 'pawn';\nexport type Key = 'a0' | 'a1' | 'b1' | 'c1' | 'd1' | 'e1' | 'f1' | 'g1' | 'h1' | 'a2' | 'b2' | 'c2' | 'd2' | 'e2' | 'f2' | 'g2' | 'h2' | 'a3' | 'b3' | 'c3' | 'd3' | 'e3' | 'f3' | 'g3' | 'h3' | 'a4' | 'b4' | 'c4' | 'd4' | 'e4' | 'f4' | 'g4' | 'h4' | 'a5' | 'b5' | 'c5' | 'd5' | 'e5' | 'f5' | 'g5' | 'h5' | 'a6' | 'b6' | 'c6' | 'd6' | 'e6' | 'f6' | 'g6' | 'h6' | 'a7' | 'b7' | 'c7' | 'd7' | 'e7' | 'f7' | 'g7' | 'h7' | 'a8' | 'b8' | 'c8' | 'd8' | 'e8' | 'f8' | 'g8' | 'h8';\nexport type File = 'a' | 'b' | 'c' | 'd' | 'e' | 'f' | 'g' | 'h';\nexport type Rank = '1' | '2' | '3' | '4' | '5' | '6' | '7' | '8';\nexport type FEN = string;\nexport type Pos = [number, number];\nexport interface Piece {\n  role: Role;\n  color: Color;\n  promoted?: boolean;\n}\nexport interface Drop {\n  role: Role;\n  key: Key;\n}\nexport type Pieces = Map<Key, Piece>\nexport type PiecesDiff = Map<Key, Piece | undefined>\n\nexport type KeyPair = [Key, Key];\n\nexport type NumberPair = [number, number];\n\nexport type NumberQuad = [number, number, number, number];\n\nexport interface Rect {\n  left: number;\n  top: number;\n  width: number;\n  height: number;\n}\n\nexport type Dests = Map<Key, Key[]>;\n\nexport interface Elements {\n  board: HTMLElement;\n  container: HTMLElement;\n  ghost?: HTMLElement;\n  svg?: SVGElement;\n}\nexport interface Dom {\n  elements: Elements;\n  bounds: Memo<ClientRect>;\n  redraw: () => void;\n  redrawNow: (skipSvg?: boolean) => void;\n  unbind?: Unbind;\n  destroyed?: boolean;\n  relative?: boolean; // don't compute bounds, use relative % to place pieces\n}\nexport interface Exploding {\n  stage: number;\n  keys: readonly Key[];\n}\n\nexport interface MoveMetadata {\n  premove: boolean;\n  ctrlKey?: boolean;\n  holdTime?: number;\n  captured?: Piece;\n  predrop?: boolean;\n}\nexport interface SetPremoveMetadata {\n  ctrlKey?: boolean;\n}\n\nexport type MouchEvent = MouseEvent & TouchEvent;\n\nexport interface KeyedNode extends HTMLElement {\n  cgKey: Key;\n}\nexport interface PieceNode extends KeyedNode {\n  tagName: 'PIECE';\n  cgPiece: string;\n  cgAnimating?: boolean;\n  cgFading?: boolean;\n  cgDragging?: boolean;\n}\nexport interface SquareNode extends KeyedNode {\n  tagName: 'SQUARE';\n}\n\nexport interface Memo<A> {\n  (): A;\n  clear: () => void;\n}\n\nexport interface Timer {\n  start: () => void;\n  cancel: () => void;\n  stop: () => number;\n}\n\nexport type Redraw = () => void;\nexport type Unbind = () => void;\nexport type Milliseconds = number;\nexport type KHz = number;\n\nexport const colors: readonly Color[] = ['white', 'black'];\nexport const files: readonly File[] = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'];\nexport const ranks: readonly Rank[] = ['1', '2', '3', '4', '5', '6', '7', '8'];\n","import * as cg from './types';\n\nexport const invRanks: readonly cg.Rank[] = ['8', '7', '6', '5', '4', '3', '2', '1'];\n\nexport const allKeys: readonly cg.Key[] = Array.prototype.concat(...cg.files.map(c => cg.ranks.map(r => c + r)));\n\nexport const pos2key = (pos: cg.Pos): cg.Key => allKeys[8 * pos[0] + pos[1]];\n\nexport const key2pos = (k: cg.Key): cg.Pos => [k.charCodeAt(0) - 97, k.charCodeAt(1) - 49];\n\nexport function memo<A>(f: () => A): cg.Memo<A> {\n  let v: A | undefined;\n  const ret = (): A => {\n    if (v === undefined) v = f();\n    return v;\n  };\n  ret.clear = () => { v = undefined };\n  return ret;\n}\n\nexport const timer = (): cg.Timer => {\n  let startAt: number | undefined;\n  return {\n    start() { startAt = performance.now() },\n    cancel() { startAt = undefined },\n    stop() {\n      if (!startAt) return 0;\n      const time = performance.now() - startAt;\n      startAt = undefined;\n      return time;\n    }\n  };\n}\n\nexport const opposite = (c: cg.Color): cg.Color => c === 'white' ? 'black' : 'white';\n\nexport const distanceSq = (pos1: cg.Pos, pos2: cg.Pos): number => {\n  const dx = pos1[0] - pos2[0],\n  dy = pos1[1] - pos2[1];\n  return dx * dx + dy * dy;\n}\n\nexport const samePiece = (p1: cg.Piece, p2: cg.Piece): boolean =>\n  p1.role === p2.role && p1.color === p2.color;\n\nconst posToTranslateBase = (pos: cg.Pos, asWhite: boolean, xFactor: number, yFactor: number): cg.NumberPair => [\n  (asWhite ? pos[0] : 7 - pos[0]) * xFactor,\n  (asWhite ? 7 - pos[1] : pos[1]) * yFactor\n];\n\nexport const posToTranslateAbs = (bounds: ClientRect): (pos: cg.Pos, asWhite: boolean) => cg.NumberPair => {\n  const xFactor = bounds.width / 8,\n  yFactor = bounds.height / 8;\n  return (pos, asWhite) => posToTranslateBase(pos, asWhite, xFactor, yFactor);\n}\n\nexport const posToTranslateRel = (pos: cg.Pos, asWhite: boolean): cg.NumberPair =>\n  posToTranslateBase(pos, asWhite, 100, 100);\n\nexport const translateAbs = (el: HTMLElement, pos: cg.NumberPair): void => {\n  el.style.transform = `translate(${pos[0]}px,${pos[1]}px)`;\n}\n\nexport const translateRel = (el: HTMLElement, percents: cg.NumberPair): void => {\n  el.style.transform = `translate(${percents[0]}%,${percents[1]}%)`;\n}\n\nexport const setVisible = (el: HTMLElement, v: boolean): void => {\n  el.style.visibility = v ? 'visible' : 'hidden';\n}\n\nexport const eventPosition = (e: cg.MouchEvent): cg.NumberPair | undefined => {\n  if (e.clientX || e.clientX === 0) return [e.clientX, e.clientY];\n  if (e.touches && e.targetTouches[0]) return [e.targetTouches[0].clientX, e.targetTouches[0].clientY]; /* eslint-disable-line */\n  return; // touchend has no position!\n}\n\nexport const isRightButton = (e: MouseEvent): boolean => e.buttons === 2 || e.button === 2;\n\nexport const createEl = (tagName: string, className?: string): HTMLElement => {\n  const el = document.createElement(tagName);\n  if (className) el.className = className;\n  return el;\n}\n","import * as util from './util'\nimport * as cg from './types'\n\ntype Mobility = (x1: number, y1: number, x2: number, y2: number) => boolean;\n\nfunction diff(a: number, b: number): number {\n  return Math.abs(a - b);\n}\n\nfunction pawn(color: cg.Color): Mobility {\n  return (x1, y1, x2, y2) => diff(x1, x2) < 2 && (\n    color === 'white' ? (\n      // allow 2 squares from first two ranks, for horde\n      y2 === y1 + 1 || (y1 <= 1 && y2 === (y1 + 2) && x1 === x2)\n    ) : (\n      y2 === y1 - 1 || (y1 >= 6 && y2 === (y1 - 2) && x1 === x2)\n    )\n  );\n}\n\nconst knight: Mobility = (x1, y1, x2, y2) => {\n  const xd = diff(x1, x2);\n  const yd = diff(y1, y2);\n  return (xd === 1 && yd === 2) || (xd === 2 && yd === 1);\n}\n\nconst bishop: Mobility = (x1, y1, x2, y2) => {\n  return diff(x1, x2) === diff(y1, y2);\n}\n\nconst rook: Mobility = (x1, y1, x2, y2) => {\n  return x1 === x2 || y1 === y2;\n}\n\nconst queen: Mobility = (x1, y1, x2, y2) => {\n  return bishop(x1, y1, x2, y2) || rook(x1, y1, x2, y2);\n}\n\nfunction king(color: cg.Color, rookFiles: number[], canCastle: boolean): Mobility {\n  return (x1, y1, x2, y2)  => (\n    diff(x1, x2) < 2 && diff(y1, y2) < 2\n  ) || (\n    canCastle && y1 === y2 && y1 === (color === 'white' ? 0 : 7) && (\n      (x1 === 4 && ((x2 === 2 && rookFiles.includes(0)) || (x2 === 6 && rookFiles.includes(7)))) ||\n      rookFiles.includes(x2)\n    )\n  );\n}\n\nfunction rookFilesOf(pieces: cg.Pieces, color: cg.Color) {\n  const backrank = color === 'white' ? '1' : '8';\n  const files = [];\n  for (const [key, piece] of pieces) {\n    if (key[1] === backrank && piece.color === color && piece.role === 'rook') {\n      files.push(util.key2pos(key)[0]);\n    }\n  }\n  return files;\n}\n\nconst allPos = util.allKeys.map(util.key2pos);\n\nexport function premove(pieces: cg.Pieces, key: cg.Key, canCastle: boolean): cg.Key[] {\n  const piece = pieces.get(key);\n  if (!piece) return [];\n  const pos = util.key2pos(key),\n    r = piece.role,\n    mobility: Mobility = r === 'pawn' ? pawn(piece.color) : (\n      r === 'knight' ? knight : (\n        r === 'bishop' ? bishop : (\n          r === 'rook' ? rook : (\n            r === 'queen' ? queen : king(piece.color, rookFilesOf(pieces, piece.color), canCastle)\n          ))));\n  return allPos.filter(pos2 =>\n    (pos[0] !== pos2[0] || pos[1] !== pos2[1]) && mobility(pos[0], pos[1], pos2[0], pos2[1])\n  ).map(util.pos2key);\n}\n","import { State } from './state'\nimport { pos2key, key2pos, opposite } from './util'\nimport { premove } from './premove'\nimport * as cg from './types'\n\nexport type Callback = (...args: any[]) => void;\n\nexport function callUserFunction(f: Callback | undefined, ...args: any[]): void {\n  if (f) setTimeout(() => f(...args), 1);\n}\n\nexport function toggleOrientation(state: State): void {\n  state.orientation = opposite(state.orientation);\n  state.animation.current =\n  state.draggable.current =\n  state.selected = undefined;\n}\n\nexport function reset(state: State): void {\n  state.lastMove = undefined;\n  unselect(state);\n  unsetPremove(state);\n  unsetPredrop(state);\n}\n\nexport function setPieces(state: State, pieces: cg.PiecesDiff): void {\n  for (const [key, piece] of pieces) {\n    if (piece) state.pieces.set(key, piece);\n    else state.pieces.delete(key);\n  }\n}\n\nexport function setCheck(state: State, color: cg.Color | boolean): void {\n  state.check = undefined;\n  if (color === true) color = state.turnColor;\n  if (color) for (const [k, p] of state.pieces) {\n    if (p.role === 'king' && p.color === color) {\n      state.check = k;\n    }\n  }\n}\n\nfunction setPremove(state: State, orig: cg.Key, dest: cg.Key, meta: cg.SetPremoveMetadata): void {\n  unsetPredrop(state);\n  state.premovable.current = [orig, dest];\n  callUserFunction(state.premovable.events.set, orig, dest, meta);\n}\n\nexport function unsetPremove(state: State): void {\n  if (state.premovable.current) {\n    state.premovable.current = undefined;\n    callUserFunction(state.premovable.events.unset);\n  }\n}\n\nfunction setPredrop(state: State, role: cg.Role, key: cg.Key): void {\n  unsetPremove(state);\n  state.predroppable.current = { role, key };\n  callUserFunction(state.predroppable.events.set, role, key);\n}\n\nexport function unsetPredrop(state: State): void {\n  const pd = state.predroppable;\n  if (pd.current) {\n    pd.current = undefined;\n    callUserFunction(pd.events.unset);\n  }\n}\n\nfunction tryAutoCastle(state: State, orig: cg.Key, dest: cg.Key): boolean {\n  if (!state.autoCastle) return false;\n\n  const king = state.pieces.get(orig);\n  if (!king || king.role !== 'king') return false;\n\n  const origPos = key2pos(orig);\n  const destPos = key2pos(dest);\n  if ((origPos[1] !== 0 && origPos[1] !== 7) || origPos[1] !== destPos[1]) return false;\n  if (origPos[0] === 4 && !state.pieces.has(dest)) {\n    if (destPos[0] === 6) dest = pos2key([7, destPos[1]]);\n    else if (destPos[0] === 2) dest = pos2key([0, destPos[1]]);\n  }\n  const rook = state.pieces.get(dest);\n  if (!rook || rook.color !== king.color || rook.role !== 'rook') return false;\n\n  state.pieces.delete(orig);\n  state.pieces.delete(dest);\n\n  if (origPos[0] < destPos[0]) {\n    state.pieces.set(pos2key([6, destPos[1]]), king);\n    state.pieces.set(pos2key([5, destPos[1]]), rook);\n  } else {\n    state.pieces.set(pos2key([2, destPos[1]]), king);\n    state.pieces.set(pos2key([3, destPos[1]]), rook);\n  }\n  return true;\n}\n\nexport function baseMove(state: State, orig: cg.Key, dest: cg.Key): cg.Piece | boolean {\n  const origPiece = state.pieces.get(orig), destPiece = state.pieces.get(dest);\n  if (orig === dest || !origPiece) return false;\n  const captured = (destPiece && destPiece.color !== origPiece.color) ? destPiece : undefined;\n  if (dest === state.selected) unselect(state);\n  callUserFunction(state.events.move, orig, dest, captured);\n  if (!tryAutoCastle(state, orig, dest)) {\n    state.pieces.set(dest, origPiece);\n    state.pieces.delete(orig);\n  }\n  state.lastMove = [orig, dest];\n  state.check = undefined;\n  callUserFunction(state.events.change);\n  return captured || true;\n}\n\nexport function baseNewPiece(state: State, piece: cg.Piece, key: cg.Key, force?: boolean): boolean {\n  if (state.pieces.has(key)) {\n    if (force) state.pieces.delete(key);\n    else return false;\n  }\n  callUserFunction(state.events.dropNewPiece, piece, key);\n  state.pieces.set(key, piece);\n  state.lastMove = [key];\n  state.check = undefined;\n  callUserFunction(state.events.change);\n  state.movable.dests = undefined;\n  state.turnColor = opposite(state.turnColor);\n  return true;\n}\n\nfunction baseUserMove(state: State, orig: cg.Key, dest: cg.Key): cg.Piece | boolean {\n  const result = baseMove(state, orig, dest);\n  if (result) {\n    state.movable.dests = undefined;\n    state.turnColor = opposite(state.turnColor);\n    state.animation.current = undefined;\n  }\n  return result;\n}\n\nexport function userMove(state: State, orig: cg.Key, dest: cg.Key): boolean {\n  if (canMove(state, orig, dest)) {\n    const result = baseUserMove(state, orig, dest);\n    if (result) {\n      const holdTime = state.hold.stop();\n      unselect(state);\n      const metadata: cg.MoveMetadata = {\n        premove: false,\n        ctrlKey: state.stats.ctrlKey,\n        holdTime\n      };\n      if (result !== true) metadata.captured = result;\n      callUserFunction(state.movable.events.after, orig, dest, metadata);\n      return true;\n    }\n  } else if (canPremove(state, orig, dest)) {\n    setPremove(state, orig, dest, {\n      ctrlKey: state.stats.ctrlKey\n    });\n    unselect(state);\n    return true;\n  }\n  unselect(state);\n  return false;\n}\n\nexport function dropNewPiece(state: State, orig: cg.Key, dest: cg.Key, force?: boolean): void {\n  const piece = state.pieces.get(orig);\n  if (piece && (canDrop(state, orig, dest) || force)) {\n    state.pieces.delete(orig);\n    baseNewPiece(state, piece, dest, force);\n    callUserFunction(state.movable.events.afterNewPiece, piece.role, dest, {\n      predrop: false\n    });\n  } else if (piece && canPredrop(state, orig, dest)) {\n    setPredrop(state, piece.role, dest);\n  } else {\n    unsetPremove(state);\n    unsetPredrop(state);\n  }\n  state.pieces.delete(orig);\n  unselect(state);\n}\n\nexport function selectSquare(state: State, key: cg.Key, force?: boolean): void {\n  callUserFunction(state.events.select, key);\n  if (state.selected) {\n    if (state.selected === key && !state.draggable.enabled) {\n      unselect(state);\n      state.hold.cancel();\n      return;\n    } else if ((state.selectable.enabled || force) && state.selected !== key) {\n      if (userMove(state, state.selected, key)) {\n        state.stats.dragged = false;\n        return;\n      }\n    }\n  }\n  if (isMovable(state, key) || isPremovable(state, key)) {\n    setSelected(state, key);\n    state.hold.start();\n  }\n}\n\nexport function setSelected(state: State, key: cg.Key): void {\n  state.selected = key;\n  if (isPremovable(state, key)) {\n    state.premovable.dests = premove(state.pieces, key, state.premovable.castle);\n  }\n  else state.premovable.dests = undefined;\n}\n\nexport function unselect(state: State): void {\n  state.selected = undefined;\n  state.premovable.dests = undefined;\n  state.hold.cancel();\n}\n\nfunction isMovable(state: State, orig: cg.Key): boolean {\n  const piece = state.pieces.get(orig);\n  return !!piece && (\n    state.movable.color === 'both' || (\n      state.movable.color === piece.color &&\n        state.turnColor === piece.color\n    ));\n}\n\nexport function canMove(state: State, orig: cg.Key, dest: cg.Key): boolean {\n  return orig !== dest && isMovable(state, orig) && (\n    state.movable.free || !!state.movable.dests?.get(orig)?.includes(dest)\n  );\n}\n\nfunction canDrop(state: State, orig: cg.Key, dest: cg.Key): boolean {\n  const piece = state.pieces.get(orig);\n  return !!piece && (orig === dest || !state.pieces.has(dest)) && (\n    state.movable.color === 'both' || (\n      state.movable.color === piece.color &&\n        state.turnColor === piece.color\n    ));\n}\n\n\nfunction isPremovable(state: State, orig: cg.Key): boolean {\n  const piece = state.pieces.get(orig);\n  return !!piece && state.premovable.enabled &&\n  state.movable.color === piece.color &&\n    state.turnColor !== piece.color;\n}\n\nfunction canPremove(state: State, orig: cg.Key, dest: cg.Key): boolean {\n  return orig !== dest &&\n  isPremovable(state, orig) &&\n  premove(state.pieces, orig, state.premovable.castle).includes(dest);\n}\n\nfunction canPredrop(state: State, orig: cg.Key, dest: cg.Key): boolean {\n  const piece = state.pieces.get(orig);\n  const destPiece = state.pieces.get(dest);\n  return !!piece &&\n  (!destPiece || destPiece.color !== state.movable.color) &&\n  state.predroppable.enabled &&\n  (piece.role !== 'pawn' || (dest[1] !== '1' && dest[1] !== '8')) &&\n  state.movable.color === piece.color &&\n    state.turnColor !== piece.color;\n}\n\nexport function isDraggable(state: State, orig: cg.Key): boolean {\n  const piece = state.pieces.get(orig);\n  return !!piece && state.draggable.enabled && (\n    state.movable.color === 'both' || (\n      state.movable.color === piece.color && (\n        state.turnColor === piece.color || state.premovable.enabled\n      )\n    )\n  );\n}\n\nexport function playPremove(state: State): boolean {\n  const move = state.premovable.current;\n  if (!move) return false;\n  const orig = move[0], dest = move[1];\n  let success = false;\n  if (canMove(state, orig, dest)) {\n    const result = baseUserMove(state, orig, dest);\n    if (result) {\n      const metadata: cg.MoveMetadata = { premove: true };\n      if (result !== true) metadata.captured = result;\n      callUserFunction(state.movable.events.after, orig, dest, metadata);\n      success = true;\n    }\n  }\n  unsetPremove(state);\n  return success;\n}\n\nexport function playPredrop(state: State, validate: (drop: cg.Drop) => boolean): boolean {\n  const drop = state.predroppable.current;\n  let success = false;\n  if (!drop) return false;\n  if (validate(drop)) {\n    const piece = {\n      role: drop.role,\n      color: state.movable.color\n    } as cg.Piece;\n    if (baseNewPiece(state, piece, drop.key)) {\n      callUserFunction(state.movable.events.afterNewPiece, drop.role, drop.key, {\n        predrop: true\n      });\n      success = true;\n    }\n  }\n  unsetPredrop(state);\n  return success;\n}\n\nexport function cancelMove(state: State): void {\n  unsetPremove(state);\n  unsetPredrop(state);\n  unselect(state);\n}\n\nexport function stop(state: State): void {\n  state.movable.color =\n  state.movable.dests =\n  state.animation.current = undefined;\n  cancelMove(state);\n}\n\nexport function getKeyAtDomPos(pos: cg.NumberPair, asWhite: boolean, bounds: ClientRect): cg.Key | undefined {\n  let file = Math.floor(8 * (pos[0] - bounds.left) / bounds.width);\n  if (!asWhite) file = 7 - file;\n  let rank = 7 - Math.floor(8 * (pos[1] - bounds.top) / bounds.height);\n  if (!asWhite) rank = 7 - rank;\n  return (file >= 0 && file < 8 && rank >= 0 && rank < 8) ? pos2key([file, rank]) : undefined;\n}\n\nexport function whitePov(s: State): boolean {\n  return s.orientation === 'white';\n}\n","import { pos2key, invRanks } from './util'\nimport * as cg from './types'\n\nexport const initial: cg.FEN = 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR';\n\nconst roles: { [letter: string]: cg.Role } = { p: 'pawn', r: 'rook', n: 'knight', b: 'bishop', q: 'queen', k: 'king' };\n\nconst letters = { pawn: 'p', rook: 'r', knight: 'n', bishop: 'b', queen: 'q', king: 'k' };\n\nexport function read(fen: cg.FEN): cg.Pieces {\n  if (fen === 'start') fen = initial;\n  const pieces: cg.Pieces = new Map();\n  let row = 7, col = 0;\n  for (const c of fen) {\n    switch (c) {\n      case ' ': return pieces;\n      case '/':\n        --row;\n        if (row < 0) return pieces;\n        col = 0;\n        break;\n      case '~':\n        const piece = pieces.get(pos2key([col, row]));\n        if (piece) piece.promoted = true;\n        break;\n      default:\n        const nb = c.charCodeAt(0);\n        if (nb < 57) col += nb - 48;\n        else {\n          const role = c.toLowerCase();\n          pieces.set(pos2key([col, row]), {\n            role: roles[role],\n            color: c === role ? 'black' : 'white',\n          });\n          ++col;\n        }\n    }\n  }\n  return pieces;\n}\n\nexport function write(pieces: cg.Pieces): cg.FEN {\n  return invRanks.map(y => cg.files.map(x => {\n      const piece = pieces.get(x + y as cg.Key);\n      if (piece) {\n        const letter = letters[piece.role];\n        return piece.color === 'white' ? letter.toUpperCase() : letter;\n      } else return '1';\n    }).join('')\n  ).join('/').replace(/1{2,}/g, s => s.length.toString());\n}\n","import { State } from './state'\nimport { setCheck, setSelected } from './board'\nimport { read as fenRead } from './fen'\nimport { DrawShape, DrawBrush } from './draw'\nimport * as cg from './types'\n\nexport interface Config {\n  fen?: cg.FEN; // chess position in Forsyth notation\n  orientation?: cg.Color; // board orientation. white | black\n  turnColor?: cg.Color; // turn to play. white | black\n  check?: cg.Color | boolean; // true for current color, false to unset\n  lastMove?: cg.Key[]; // squares part of the last move [\"c3\", \"c4\"]\n  selected?: cg.Key; // square currently selected \"a1\"\n  coordinates?: boolean; // include coords attributes\n  autoCastle?: boolean; // immediately complete the castle by moving the rook after king move\n  viewOnly?: boolean; // don't bind events: the user will never be able to move pieces around\n  disableContextMenu?: boolean; // because who needs a context menu on a chessboard\n  resizable?: boolean; // listens to chessground.resize on document.body to clear bounds cache\n  addPieceZIndex?: boolean; // adds z-index values to pieces (for 3D)\n  // pieceKey: boolean; // add a data-key attribute to piece elements\n  highlight?: {\n    lastMove?: boolean; // add last-move class to squares\n    check?: boolean; // add check class to squares\n  };\n  animation?: {\n    enabled?: boolean;\n    duration?: number;\n  };\n  movable?: {\n    free?: boolean; // all moves are valid - board editor\n    color?: cg.Color | 'both'; // color that can move. white | black | both | undefined\n    dests?: cg.Dests; // valid moves. {\"a2\" [\"a3\" \"a4\"] \"b1\" [\"a3\" \"c3\"]}\n    showDests?: boolean; // whether to add the move-dest class on squares\n    events?: {\n      after?: (orig: cg.Key, dest: cg.Key, metadata: cg.MoveMetadata) => void; // called after the move has been played\n      afterNewPiece?: (role: cg.Role, key: cg.Key, metadata: cg.MoveMetadata) => void; // called after a new piece is dropped on the board\n    };\n    rookCastle?: boolean; // castle by moving the king to the rook\n  };\n  premovable?: {\n    enabled?: boolean; // allow premoves for color that can not move\n    showDests?: boolean; // whether to add the premove-dest class on squares\n    castle?: boolean; // whether to allow king castle premoves\n    dests?: cg.Key[]; // premove destinations for the current selection\n    events?: {\n      set?: (orig: cg.Key, dest: cg.Key, metadata?: cg.SetPremoveMetadata) => void; // called after the premove has been set\n      unset?: () => void;  // called after the premove has been unset\n    };\n  };\n  predroppable?: {\n    enabled?: boolean; // allow predrops for color that can not move\n    events?: {\n      set?: (role: cg.Role, key: cg.Key) => void; // called after the predrop has been set\n      unset?: () => void; // called after the predrop has been unset\n    };\n  };\n  draggable?: {\n    enabled?: boolean; // allow moves & premoves to use drag'n drop\n    distance?: number; // minimum distance to initiate a drag; in pixels\n    autoDistance?: boolean; // lets chessground set distance to zero when user drags pieces\n    showGhost?: boolean; // show ghost of piece being dragged\n    deleteOnDropOff?: boolean; // delete a piece when it is dropped off the board\n  };\n  selectable?: {\n    // disable to enforce dragging over click-click move\n    enabled?: boolean;\n  };\n  events?: {\n    change?: () => void; // called after the situation changes on the board\n    // called after a piece has been moved.\n    // capturedPiece is undefined or like {color: 'white'; 'role': 'queen'}\n    move?: (orig: cg.Key, dest: cg.Key, capturedPiece?: cg.Piece) => void;\n    dropNewPiece?: (piece: cg.Piece, key: cg.Key) => void;\n    select?: (key: cg.Key) => void; // called when a square is selected\n    insert?: (elements: cg.Elements) => void; // when the board DOM has been (re)inserted\n  };\n  drawable?: {\n    enabled?: boolean; // can draw\n    visible?: boolean; // can view\n    eraseOnClick?: boolean;\n    shapes?: DrawShape[];\n    autoShapes?: DrawShape[];\n    brushes?: DrawBrush[];\n    pieces?: {\n      baseUrl?: string;\n    };\n    onChange?: (shapes: DrawShape[]) => void; // called after drawable shapes change\n  };\n}\n\nexport function configure(state: State, config: Config): void {\n\n  // don't merge destinations. Just override.\n  if (config.movable?.dests) state.movable.dests = undefined;\n\n  merge(state, config);\n\n  // if a fen was provided, replace the pieces\n  if (config.fen) {\n    state.pieces = fenRead(config.fen);\n    state.drawable.shapes = [];\n  }\n\n  // apply config values that could be undefined yet meaningful\n  if (config.hasOwnProperty('check')) setCheck(state, config.check || false);\n  if (config.hasOwnProperty('lastMove') && !config.lastMove) state.lastMove = undefined;\n  // in case of ZH drop last move, there's a single square.\n  // if the previous last move had two squares,\n  // the merge algorithm will incorrectly keep the second square.\n  else if (config.lastMove) state.lastMove = config.lastMove;\n\n  // fix move/premove dests\n  if (state.selected) setSelected(state, state.selected);\n\n  // no need for such short animations\n  if (!state.animation.duration || state.animation.duration < 100) state.animation.enabled = false;\n\n  if (!state.movable.rookCastle && state.movable.dests) {\n    const rank = state.movable.color === 'white' ? '1' : '8',\n    kingStartPos = 'e' + rank as cg.Key,\n    dests = state.movable.dests.get(kingStartPos),\n    king = state.pieces.get(kingStartPos);\n    if (!dests || !king || king.role !== 'king') return;\n    state.movable.dests.set(kingStartPos, dests.filter(d =>\n      !((d === 'a' + rank) && dests.includes('c' + rank as cg.Key)) &&\n        !((d === 'h' + rank) && dests.includes('g' + rank as cg.Key))\n    ));\n  }\n}\n\nfunction merge(base: any, extend: any): void {\n  for (const key in extend) {\n    if (isObject(base[key]) && isObject(extend[key])) merge(base[key], extend[key]);\n    else base[key] = extend[key];\n  }\n}\n\nfunction isObject(o: unknown): boolean {\n  return typeof o === 'object';\n}\n","import { State } from './state'\nimport * as util from './util'\nimport * as cg from './types'\n\nexport type Mutation<A> = (state: State) => A;\n\n// 0,1 animation goal\n// 2,3 animation current status\nexport type AnimVector = cg.NumberQuad;\n\nexport type AnimVectors = Map<cg.Key, AnimVector>;\n\nexport type AnimFadings = Map<cg.Key, cg.Piece>;\n\nexport interface AnimPlan {\n  anims: AnimVectors;\n  fadings: AnimFadings;\n}\n\nexport interface AnimCurrent {\n  start: DOMHighResTimeStamp;\n  frequency: cg.KHz;\n  plan: AnimPlan;\n}\n\nexport function anim<A>(mutation: Mutation<A>, state: State): A {\n  return state.animation.enabled ? animate(mutation, state) : render(mutation, state);\n}\n\nexport function render<A>(mutation: Mutation<A>, state: State): A {\n  const result = mutation(state);\n  state.dom.redraw();\n  return result;\n}\n\ninterface AnimPiece {\n  key: cg.Key;\n  pos: cg.Pos;\n  piece: cg.Piece;\n}\ntype AnimPieces = Map<cg.Key, AnimPiece>;\n\nfunction makePiece(key: cg.Key, piece: cg.Piece): AnimPiece {\n  return {\n    key: key,\n    pos: util.key2pos(key),\n    piece: piece\n  };\n}\n\nfunction closer(piece: AnimPiece, pieces: AnimPiece[]): AnimPiece | undefined {\n  return pieces.sort((p1, p2) => {\n    return util.distanceSq(piece.pos, p1.pos) - util.distanceSq(piece.pos, p2.pos);\n  })[0];\n}\n\nfunction computePlan(prevPieces: cg.Pieces, current: State): AnimPlan {\n  const anims: AnimVectors = new Map(),\n  animedOrigs: cg.Key[] = [],\n  fadings: AnimFadings = new Map(),\n  missings: AnimPiece[] = [],\n  news: AnimPiece[] = [],\n  prePieces: AnimPieces = new Map();\n  let curP: cg.Piece | undefined, preP: AnimPiece | undefined, vector: cg.NumberPair;\n  for (const [k, p] of prevPieces) {\n    prePieces.set(k, makePiece(k, p));\n  }\n  for (const key of util.allKeys) {\n    curP = current.pieces.get(key);\n    preP = prePieces.get(key);\n    if (curP) {\n      if (preP) {\n        if (!util.samePiece(curP, preP.piece)) {\n          missings.push(preP);\n          news.push(makePiece(key, curP));\n        }\n      } else news.push(makePiece(key, curP));\n    } else if (preP) missings.push(preP);\n  }\n  for (const newP of news) {\n    preP = closer(newP, missings.filter(p => util.samePiece(newP.piece, p.piece)));\n    if (preP) {\n      vector = [preP.pos[0] - newP.pos[0], preP.pos[1] - newP.pos[1]];\n      anims.set(newP.key, vector.concat(vector) as AnimVector);\n      animedOrigs.push(preP.key);\n    }\n  }\n  for (const p of missings) {\n    if (!animedOrigs.includes(p.key)) fadings.set(p.key, p.piece);\n  }\n\n  return {\n    anims: anims,\n    fadings: fadings\n  };\n}\n\nfunction step(state: State, now: DOMHighResTimeStamp): void {\n  const cur = state.animation.current;\n  if (cur === undefined) { // animation was canceled :(\n    if (!state.dom.destroyed) state.dom.redrawNow();\n    return;\n  }\n  const rest = 1 - (now - cur.start) * cur.frequency;\n  if (rest <= 0) {\n    state.animation.current = undefined;\n    state.dom.redrawNow();\n  } else {\n    const ease = easing(rest);\n    for (const cfg of cur.plan.anims.values()) {\n      cfg[2] = cfg[0] * ease;\n      cfg[3] = cfg[1] * ease;\n    }\n    state.dom.redrawNow(true); // optimisation: don't render SVG changes during animations\n    requestAnimationFrame((now = performance.now()) => step(state, now));\n  }\n}\n\nfunction animate<A>(mutation: Mutation<A>, state: State): A {\n  // clone state before mutating it\n  const prevPieces: cg.Pieces = new Map(state.pieces);\n\n  const result = mutation(state);\n  const plan = computePlan(prevPieces, state);\n  if (plan.anims.size || plan.fadings.size) {\n    const alreadyRunning = state.animation.current && state.animation.current.start;\n    state.animation.current = {\n      start: performance.now(),\n      frequency: 1 / state.animation.duration,\n      plan: plan\n    };\n    if (!alreadyRunning) step(state, performance.now());\n  } else {\n    // don't animate, just render right away\n    state.dom.redraw();\n  }\n  return result;\n}\n\n// https://gist.github.com/gre/1650294\nfunction easing(t: number): number {\n  return t < 0.5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1;\n}\n","import { State } from './state'\nimport { unselect, cancelMove, getKeyAtDomPos, whitePov } from './board'\nimport { eventPosition, isRightButton } from './util'\nimport * as cg from './types'\n\nexport interface DrawShape {\n  orig: cg.Key;\n  dest?: cg.Key;\n  brush: string;\n  modifiers?: DrawModifiers;\n  piece?: DrawShapePiece;\n}\n\nexport interface DrawShapePiece {\n  role: cg.Role;\n  color: cg.Color;\n  scale?: number;\n}\n\nexport interface DrawBrush {\n  key: string;\n  color: string;\n  opacity: number;\n  lineWidth: number;\n}\n\nexport interface DrawBrushes {\n  [name: string]: DrawBrush;\n}\n\nexport interface DrawModifiers {\n  lineWidth?: number;\n}\n\nexport interface Drawable {\n  enabled: boolean; // can draw\n  visible: boolean; // can view\n  eraseOnClick: boolean;\n  onChange?: (shapes: DrawShape[]) => void;\n  shapes: DrawShape[]; // user shapes\n  autoShapes: DrawShape[]; // computer shapes\n  current?: DrawCurrent;\n  brushes: DrawBrushes;\n  // drawable SVG pieces; used for crazyhouse drop\n  pieces: {\n    baseUrl: string;\n  };\n  prevSvgHash: string;\n}\n\nexport interface DrawCurrent {\n  orig: cg.Key; // orig key of drawing\n  dest?: cg.Key; // shape dest, or undefined for circle\n  mouseSq?: cg.Key; // square being moused over\n  pos: cg.NumberPair; // relative current position\n  brush: string; // brush name for shape\n}\n\nconst brushes = ['green', 'red', 'blue', 'yellow'];\n\nexport function start(state: State, e: cg.MouchEvent): void {\n  // support one finger touch only\n  if (e.touches && e.touches.length > 1) return; /* eslint-disable-line */\n  e.stopPropagation();\n  e.preventDefault();\n  e.ctrlKey ? unselect(state) : cancelMove(state);\n  const pos = eventPosition(e)!,\n  orig = getKeyAtDomPos(pos, whitePov(state), state.dom.bounds());\n  if (!orig) return;\n  state.drawable.current = {\n    orig,\n    pos,\n    brush: eventBrush(e)\n  };\n  processDraw(state);\n}\n\nexport function processDraw(state: State): void {\n  requestAnimationFrame(() => {\n    const cur = state.drawable.current;\n    if (cur) {\n      const mouseSq = getKeyAtDomPos(cur.pos, whitePov(state), state.dom.bounds());\n      if (mouseSq !== cur.mouseSq) {\n        cur.mouseSq = mouseSq;\n        cur.dest = mouseSq !== cur.orig ? mouseSq : undefined;\n        state.dom.redrawNow();\n      }\n      processDraw(state);\n    }\n  });\n}\n\nexport function move(state: State, e: cg.MouchEvent): void {\n  if (state.drawable.current) state.drawable.current.pos = eventPosition(e)!;\n}\n\nexport function end(state: State): void {\n  const cur = state.drawable.current;\n  if (cur) {\n    if (cur.mouseSq) addShape(state.drawable, cur);\n    cancel(state);\n  }\n}\n\nexport function cancel(state: State): void {\n  if (state.drawable.current) {\n    state.drawable.current = undefined;\n    state.dom.redraw();\n  }\n}\n\nexport function clear(state: State): void {\n  if (state.drawable.shapes.length) {\n    state.drawable.shapes = [];\n    state.dom.redraw();\n    onChange(state.drawable);\n  }\n}\n\nfunction eventBrush(e: cg.MouchEvent): string {\n  const modA = (e.shiftKey || e.ctrlKey) && isRightButton(e);\n  const modB = e.altKey || e.metaKey || e.getModifierState('AltGraph');\n  return brushes[(modA ? 1 : 0) + (modB ? 2 : 0)];\n}\n\nfunction addShape(drawable: Drawable, cur: DrawCurrent): void {\n  const sameShape = (s: DrawShape) => s.orig === cur.orig && s.dest === cur.dest;\n  const similar = drawable.shapes.find(sameShape);\n  if (similar) drawable.shapes = drawable.shapes.filter(s => !sameShape(s));\n  if (!similar || similar.brush !== cur.brush) drawable.shapes.push(cur);\n  onChange(drawable);\n}\n\nfunction onChange(drawable: Drawable): void {\n  if (drawable.onChange) drawable.onChange(drawable.shapes);\n}\n","import { State } from './state'\nimport * as board from './board'\nimport * as util from './util'\nimport { clear as drawClear } from './draw'\nimport * as cg from './types'\nimport { anim } from './anim'\n\nexport interface DragCurrent {\n  orig: cg.Key; // orig key of dragging piece\n  piece: cg.Piece;\n  origPos: cg.NumberPair; // first event position\n  pos: cg.NumberPair; // latest event position\n  started: boolean; // whether the drag has started; as per the distance setting\n  element: cg.PieceNode | (() => cg.PieceNode | undefined);\n  newPiece?: boolean; // it it a new piece from outside the board\n  force?: boolean; // can the new piece replace an existing one (editor)\n  previouslySelected?: cg.Key;\n  originTarget: EventTarget | null;\n}\n\nexport function start(s: State, e: cg.MouchEvent): void {\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n  if (e.button !== undefined && e.button !== 0) return; // only touch or left click\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n  if (e.touches && e.touches.length > 1) return; // support one finger touch only\n  const bounds = s.dom.bounds(),\n  position = util.eventPosition(e)!,\n  orig = board.getKeyAtDomPos(position, board.whitePov(s), bounds);\n  if (!orig) return;\n  const piece = s.pieces.get(orig);\n  const previouslySelected = s.selected;\n  if (!previouslySelected && s.drawable.enabled && (\n    s.drawable.eraseOnClick || (!piece || piece.color !== s.turnColor)\n  )) drawClear(s);\n  // Prevent touch scroll and create no corresponding mouse event, if there\n  // is an intent to interact with the board. If no color is movable\n  // (and the board is not for viewing only), touches are likely intended to\n  // select squares.\n  if (e.cancelable !== false &&\n      (!e.touches || !s.movable.color || piece || previouslySelected || pieceCloseTo(s, position))) /* eslint-disable-line */\n        e.preventDefault();\n  const hadPremove = !!s.premovable.current;\n  const hadPredrop = !!s.predroppable.current;\n  s.stats.ctrlKey = e.ctrlKey;\n  if (s.selected && board.canMove(s, s.selected, orig)) {\n    anim(state => board.selectSquare(state, orig), s);\n  } else {\n    board.selectSquare(s, orig);\n  }\n  const stillSelected = s.selected === orig;\n  const element = pieceElementByKey(s, orig);\n  if (piece && element && stillSelected && board.isDraggable(s, orig)) {\n    s.draggable.current = {\n      orig,\n      piece,\n      origPos: position,\n      pos: position,\n      started: s.draggable.autoDistance && s.stats.dragged,\n      element,\n      previouslySelected,\n      originTarget: e.target\n    };\n    element.cgDragging = true;\n    element.classList.add('dragging');\n    // place ghost\n    const ghost = s.dom.elements.ghost;\n    if (ghost) {\n      ghost.className = `ghost ${piece.color} ${piece.role}`;\n      util.translateAbs(ghost, util.posToTranslateAbs(bounds)(util.key2pos(orig), board.whitePov(s)));\n      util.setVisible(ghost, true);\n    }\n    processDrag(s);\n  } else {\n    if (hadPremove) board.unsetPremove(s);\n    if (hadPredrop) board.unsetPredrop(s);\n  }\n  s.dom.redraw();\n}\n\nfunction pieceCloseTo(s: State, pos: cg.NumberPair): boolean {\n  const asWhite = board.whitePov(s),\n  bounds = s.dom.bounds(),\n  radiusSq = Math.pow(bounds.width / 8, 2);\n  for (const key in s.pieces) {\n    const center = computeSquareCenter(key as cg.Key, asWhite, bounds);\n    if (util.distanceSq(center, pos) <= radiusSq) return true;\n  }\n  return false;\n}\n\nexport function dragNewPiece(s: State, piece: cg.Piece, e: cg.MouchEvent, force?: boolean): void {\n\n  const key: cg.Key = 'a0';\n  s.pieces.set(key, piece);\n  s.dom.redraw();\n\n  const position = util.eventPosition(e)!;\n\n  s.draggable.current = {\n    orig: key,\n    piece,\n    origPos: position,\n    pos: position,\n    started: true,\n    element: () => pieceElementByKey(s, key),\n    originTarget: e.target,\n    newPiece: true,\n    force: !!force\n  };\n  processDrag(s);\n}\n\nfunction processDrag(s: State): void {\n  requestAnimationFrame(() => {\n    const cur = s.draggable.current;\n    if (!cur) return;\n    // cancel animations while dragging\n    if (s.animation.current?.plan.anims.has(cur.orig)) s.animation.current = undefined;\n    // if moving piece is gone, cancel\n    const origPiece = s.pieces.get(cur.orig);\n    if (!origPiece || !util.samePiece(origPiece, cur.piece)) cancel(s);\n    else {\n      if (!cur.started && util.distanceSq(cur.pos, cur.origPos) >= Math.pow(s.draggable.distance, 2)) cur.started = true;\n      if (cur.started) {\n\n        // support lazy elements\n        if (typeof cur.element === 'function') {\n          const found = cur.element();\n          if (!found) return;\n          found.cgDragging = true;\n          found.classList.add('dragging');\n          cur.element = found;\n        }\n\n        const bounds = s.dom.bounds();\n        util.translateAbs(cur.element, [\n          cur.pos[0] - bounds.left - bounds.width / 16,\n          cur.pos[1] - bounds.top - bounds.height / 16\n        ]);\n      }\n    }\n    processDrag(s);\n  });\n}\n\nexport function move(s: State, e: cg.MouchEvent): void {\n  // support one finger touch only\n  if (s.draggable.current && (!e.touches || e.touches.length < 2)) { /* eslint-disable-line */\n    s.draggable.current.pos = util.eventPosition(e)!;\n  }\n}\n\nexport function end(s: State, e: cg.MouchEvent): void {\n  const cur = s.draggable.current;\n  if (!cur) return;\n  // create no corresponding mouse event\n  if (e.type === 'touchend' && e.cancelable !== false) e.preventDefault();\n  // comparing with the origin target is an easy way to test that the end event\n  // has the same touch origin\n  if (e.type === 'touchend' && cur.originTarget !== e.target && !cur.newPiece) {\n    s.draggable.current = undefined;\n    return;\n  }\n  board.unsetPremove(s);\n  board.unsetPredrop(s);\n  // touchend has no position; so use the last touchmove position instead\n  const eventPos = util.eventPosition(e) || cur.pos;\n  const dest = board.getKeyAtDomPos(eventPos, board.whitePov(s), s.dom.bounds());\n  if (dest && cur.started && cur.orig !== dest) {\n    if (cur.newPiece) board.dropNewPiece(s, cur.orig, dest, cur.force);\n    else {\n      s.stats.ctrlKey = e.ctrlKey;\n      if (board.userMove(s, cur.orig, dest)) s.stats.dragged = true;\n    }\n  } else if (cur.newPiece) {\n    s.pieces.delete(cur.orig);\n  } else if (s.draggable.deleteOnDropOff && !dest) {\n    s.pieces.delete(cur.orig);\n    board.callUserFunction(s.events.change);\n  }\n  if (cur.orig === cur.previouslySelected && (cur.orig === dest || !dest))\n    board.unselect(s);\n  else if (!s.selectable.enabled) board.unselect(s);\n\n  removeDragElements(s);\n\n  s.draggable.current = undefined;\n  s.dom.redraw();\n}\n\nexport function cancel(s: State): void {\n  const cur = s.draggable.current;\n  if (cur) {\n    if (cur.newPiece) s.pieces.delete(cur.orig);\n    s.draggable.current = undefined;\n    board.unselect(s);\n    removeDragElements(s);\n    s.dom.redraw();\n  }\n}\n\nfunction removeDragElements(s: State): void {\n  const e = s.dom.elements;\n  if (e.ghost) util.setVisible(e.ghost, false);\n}\n\nfunction computeSquareCenter(key: cg.Key, asWhite: boolean, bounds: ClientRect): cg.NumberPair {\n  const pos = util.key2pos(key);\n  if (!asWhite) {\n    pos[0] = 7 - pos[0];\n    pos[1] = 7 - pos[1];\n  }\n  return [\n    bounds.left + bounds.width * pos[0] / 8 + bounds.width / 16,\n    bounds.top + bounds.height * (7 - pos[1]) / 8 + bounds.height / 16\n  ];\n}\n\nfunction pieceElementByKey(s: State, key: cg.Key): cg.PieceNode | undefined {\n  let el = s.dom.elements.board.firstChild;\n  while (el) {\n    if ((el as cg.KeyedNode).cgKey === key && (el as cg.KeyedNode).tagName === 'PIECE') return el as cg.PieceNode;\n    el = el.nextSibling;\n  }\n  return;\n}\n","import { State } from './state'\nimport { Key } from './types'\n\nexport function explosion(state: State, keys: Key[]): void {\n  state.exploding = { stage: 1, keys };\n  state.dom.redraw();\n  setTimeout(() => {\n    setStage(state, 2);\n    setTimeout(() => setStage(state, undefined), 120);\n  }, 120);\n}\n\nfunction setStage(state: State, stage: number | undefined): void {\n  if (state.exploding) {\n    if (stage) state.exploding.stage = stage;\n    else state.exploding = undefined;\n    state.dom.redraw();\n  }\n}\n","import { State } from './state'\nimport * as board from './board'\nimport { write as fenWrite } from './fen'\nimport { Config, configure } from './config'\nimport { anim, render } from './anim'\nimport { cancel as dragCancel, dragNewPiece } from './drag'\nimport { DrawShape } from './draw'\nimport { explosion } from './explosion'\nimport * as cg from './types'\n\nexport interface Api {\n\n  // reconfigure the instance. Accepts all config options, except for viewOnly & drawable.visible.\n  // board will be animated accordingly, if animations are enabled.\n  set(config: Config): void;\n\n  // read chessground state; write at your own risks.\n  state: State;\n\n  // get the position as a FEN string (only contains pieces, no flags)\n  // e.g. rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR\n  getFen(): cg.FEN;\n\n  // change the view angle\n  toggleOrientation(): void;\n\n  // perform a move programmatically\n  move(orig: cg.Key, dest: cg.Key): void;\n\n  // add and/or remove arbitrary pieces on the board\n  setPieces(pieces: cg.PiecesDiff): void;\n\n  // click a square programmatically\n  selectSquare(key: cg.Key | null, force?: boolean): void;\n\n  // put a new piece on the board\n  newPiece(piece: cg.Piece, key: cg.Key): void;\n\n  // play the current premove, if any; returns true if premove was played\n  playPremove(): boolean;\n\n  // cancel the current premove, if any\n  cancelPremove(): void;\n\n  // play the current predrop, if any; returns true if premove was played\n  playPredrop(validate: (drop: cg.Drop) => boolean): boolean;\n\n  // cancel the current predrop, if any\n  cancelPredrop(): void;\n\n  // cancel the current move being made\n  cancelMove(): void;\n\n  // cancel current move and prevent further ones\n  stop(): void;\n\n  // make squares explode (atomic chess)\n  explode(keys: cg.Key[]): void;\n\n  // programmatically draw user shapes\n  setShapes(shapes: DrawShape[]): void;\n\n  // programmatically draw auto shapes\n  setAutoShapes(shapes: DrawShape[]): void;\n\n  // square name at this DOM position (like \"e4\")\n  getKeyAtDomPos(pos: cg.NumberPair): cg.Key | undefined;\n\n  // only useful when CSS changes the board width/height ratio (for 3D)\n  redrawAll: cg.Redraw;\n\n  // for crazyhouse and board editors\n  dragNewPiece(piece: cg.Piece, event: cg.MouchEvent, force?: boolean): void;\n\n  // unbinds all events\n  // (important for document-wide events like scroll and mousemove)\n  destroy: cg.Unbind;\n}\n\n// see API types and documentations in dts/api.d.ts\nexport function start(state: State, redrawAll: cg.Redraw): Api {\n\n  function toggleOrientation(): void {\n    board.toggleOrientation(state);\n    redrawAll();\n  }\n\n  return {\n\n    set(config): void {\n      if (config.orientation && config.orientation !== state.orientation) toggleOrientation();\n      (config.fen ? anim : render)(state => configure(state, config), state);\n    },\n\n    state,\n\n    getFen: () => fenWrite(state.pieces),\n\n    toggleOrientation,\n\n    setPieces(pieces): void {\n      anim(state => board.setPieces(state, pieces), state);\n    },\n\n    selectSquare(key, force): void {\n      if (key) anim(state => board.selectSquare(state, key, force), state);\n      else if (state.selected) {\n        board.unselect(state);\n        state.dom.redraw();\n      }\n    },\n\n    move(orig, dest): void {\n      anim(state => board.baseMove(state, orig, dest), state);\n    },\n\n    newPiece(piece, key): void {\n      anim(state => board.baseNewPiece(state, piece, key), state);\n    },\n\n    playPremove(): boolean {\n      if (state.premovable.current) {\n        if (anim(board.playPremove, state)) return true;\n        // if the premove couldn't be played, redraw to clear it up\n        state.dom.redraw();\n      }\n      return false;\n    },\n\n    playPredrop(validate): boolean {\n      if (state.predroppable.current) {\n        const result = board.playPredrop(state, validate);\n        state.dom.redraw();\n        return result;\n      }\n      return false;\n    },\n\n    cancelPremove(): void {\n      render(board.unsetPremove, state);\n    },\n\n    cancelPredrop(): void {\n      render(board.unsetPredrop, state);\n    },\n\n    cancelMove(): void {\n      render(state => { board.cancelMove(state); dragCancel(state); }, state);\n    },\n\n    stop(): void {\n      render(state => { board.stop(state); dragCancel(state); }, state);\n    },\n\n    explode(keys: cg.Key[]): void {\n      explosion(state, keys);\n    },\n\n    setAutoShapes(shapes: DrawShape[]): void {\n      render(state => state.drawable.autoShapes = shapes, state);\n    },\n\n    setShapes(shapes: DrawShape[]): void {\n      render(state => state.drawable.shapes = shapes, state);\n    },\n\n    getKeyAtDomPos(pos): cg.Key | undefined {\n      return board.getKeyAtDomPos(pos, board.whitePov(state), state.dom.bounds());\n    },\n\n    redrawAll,\n\n    dragNewPiece(piece, event, force): void {\n      dragNewPiece(state, piece, event, force)\n    },\n\n    destroy(): void {\n      board.stop(state);\n      state.dom.unbind && state.dom.unbind();\n      state.dom.destroyed = true;\n    }\n  };\n}\n","import * as fen from './fen'\nimport { AnimCurrent } from './anim'\nimport { DragCurrent } from './drag'\nimport { Drawable } from './draw'\nimport { timer } from './util'\nimport * as cg from './types';\n\nexport interface State {\n  pieces: cg.Pieces;\n  orientation: cg.Color; // board orientation. white | black\n  turnColor: cg.Color; // turn to play. white | black\n  check?: cg.Key; // square currently in check \"a2\"\n  lastMove?: cg.Key[]; // squares part of the last move [\"c3\"; \"c4\"]\n  selected?: cg.Key; // square currently selected \"a1\"\n  coordinates: boolean; // include coords attributes\n  autoCastle: boolean; // immediately complete the castle by moving the rook after king move\n  viewOnly: boolean; // don't bind events: the user will never be able to move pieces around\n  disableContextMenu: boolean; // because who needs a context menu on a chessboard\n  resizable: boolean; // listens to chessground.resize on document.body to clear bounds cache\n  addPieceZIndex: boolean; // adds z-index values to pieces (for 3D)\n  pieceKey: boolean; // add a data-key attribute to piece elements\n  highlight: {\n    lastMove: boolean; // add last-move class to squares\n    check: boolean; // add check class to squares\n  };\n  animation: {\n    enabled: boolean;\n    duration: number;\n    current?: AnimCurrent;\n  };\n  movable: {\n    free: boolean; // all moves are valid - board editor\n    color?: cg.Color | 'both'; // color that can move. white | black | both\n    dests?: cg.Dests; // valid moves. {\"a2\" [\"a3\" \"a4\"] \"b1\" [\"a3\" \"c3\"]}\n    showDests: boolean; // whether to add the move-dest class on squares\n    events: {\n      after?: (orig: cg.Key, dest: cg.Key, metadata: cg.MoveMetadata) => void; // called after the move has been played\n      afterNewPiece?: (role: cg.Role, key: cg.Key, metadata: cg.MoveMetadata) => void; // called after a new piece is dropped on the board\n    };\n    rookCastle: boolean; // castle by moving the king to the rook\n  };\n  premovable: {\n    enabled: boolean; // allow premoves for color that can not move\n    showDests: boolean; // whether to add the premove-dest class on squares\n    castle: boolean; // whether to allow king castle premoves\n    dests?: cg.Key[]; // premove destinations for the current selection\n    current?: cg.KeyPair; // keys of the current saved premove [\"e2\" \"e4\"]\n    events: {\n      set?: (orig: cg.Key, dest: cg.Key, metadata?: cg.SetPremoveMetadata) => void; // called after the premove has been set\n      unset?: () => void;  // called after the premove has been unset\n    };\n  };\n  predroppable: {\n    enabled: boolean; // allow predrops for color that can not move\n    current?: { // current saved predrop {role: 'knight'; key: 'e4'}\n      role: cg.Role;\n      key: cg.Key;\n    };\n    events: {\n      set?: (role: cg.Role, key: cg.Key) => void; // called after the predrop has been set\n      unset?: () => void; // called after the predrop has been unset\n    };\n  };\n  draggable: {\n    enabled: boolean; // allow moves & premoves to use drag'n drop\n    distance: number; // minimum distance to initiate a drag; in pixels\n    autoDistance: boolean; // lets chessground set distance to zero when user drags pieces\n    showGhost: boolean; // show ghost of piece being dragged\n    deleteOnDropOff: boolean; // delete a piece when it is dropped off the board\n    current?: DragCurrent;\n  };\n  dropmode: {\n    active: boolean;\n    piece?: cg.Piece;\n  };\n  selectable: {\n    // disable to enforce dragging over click-click move\n    enabled: boolean;\n  };\n  stats: {\n    // was last piece dragged or clicked?\n    // needs default to false for touch\n    dragged: boolean;\n    ctrlKey?: boolean;\n  };\n  events: {\n    change?: () => void; // called after the situation changes on the board\n    // called after a piece has been moved.\n    // capturedPiece is undefined or like {color: 'white'; 'role': 'queen'}\n    move?: (orig: cg.Key, dest: cg.Key, capturedPiece?: cg.Piece) => void;\n    dropNewPiece?: (piece: cg.Piece, key: cg.Key) => void;\n    select?: (key: cg.Key) => void; // called when a square is selected\n    insert?: (elements: cg.Elements) => void; // when the board DOM has been (re)inserted\n  };\n  drawable: Drawable;\n  exploding?: cg.Exploding;\n  dom: cg.Dom;\n  hold: cg.Timer;\n}\n\nexport function defaults(): Partial<State> {\n  return {\n    pieces: fen.read(fen.initial),\n    orientation: 'white',\n    turnColor: 'white',\n    coordinates: true,\n    autoCastle: true,\n    viewOnly: false,\n    disableContextMenu: false,\n    resizable: true,\n    addPieceZIndex: false,\n    pieceKey: false,\n    highlight: {\n      lastMove: true,\n      check: true\n    },\n    animation: {\n      enabled: true,\n      duration: 200\n    },\n    movable: {\n      free: true,\n      color: 'both',\n      showDests: true,\n      events: {},\n      rookCastle: true\n    },\n    premovable: {\n      enabled: true,\n      showDests: true,\n      castle: true,\n      events: {}\n    },\n    predroppable: {\n      enabled: false,\n      events: {}\n    },\n    draggable: {\n      enabled: true,\n      distance: 3,\n      autoDistance: true,\n      showGhost: true,\n      deleteOnDropOff: false\n    },\n    dropmode: {\n      active: false\n    },\n    selectable: {\n      enabled: true\n    },\n    stats: {\n      // on touchscreen, default to \"tap-tap\" moves\n      // instead of drag\n      dragged: !('ontouchstart' in window)\n    },\n    events: {},\n    drawable: {\n      enabled: true, // can draw\n      visible: true, // can view\n      eraseOnClick: true,\n      shapes: [],\n      autoShapes: [],\n      brushes: {\n        green: { key: 'g', color: '#15781B', opacity: 1, lineWidth: 10 },\n        red: { key: 'r', color: '#882020', opacity: 1, lineWidth: 10 },\n        blue: { key: 'b', color: '#003088', opacity: 1, lineWidth: 10 },\n        yellow: { key: 'y', color: '#e68f00', opacity: 1, lineWidth: 10 },\n        paleBlue: { key: 'pb', color: '#003088', opacity: 0.4, lineWidth: 15 },\n        paleGreen: { key: 'pg', color: '#15781B', opacity: 0.4, lineWidth: 15 },\n        paleRed: { key: 'pr', color: '#882020', opacity: 0.4, lineWidth: 15 },\n        paleGrey: { key: 'pgr', color: '#4a4a4a', opacity: 0.35, lineWidth: 15 }\n      },\n      pieces: {\n        baseUrl: 'https://lichess1.org/assets/piece/cburnett/'\n      },\n      prevSvgHash: ''\n    },\n    hold: timer()\n  };\n}\n","import { State } from './state'\nimport { key2pos } from './util'\nimport { Drawable, DrawShape, DrawShapePiece, DrawBrush, DrawBrushes, DrawModifiers } from './draw'\nimport * as cg from './types'\n\nexport function createElement(tagName: string): SVGElement {\n  return document.createElementNS('http://www.w3.org/2000/svg', tagName);\n}\n\ninterface Shape {\n  shape: DrawShape;\n  current: boolean;\n  hash: Hash;\n}\n\ntype CustomBrushes = Map<string, DrawBrush>; // by hash\n\ntype ArrowDests = Map<cg.Key, number>; // how many arrows land on a square\n\ntype Hash = string;\n\nexport function renderSvg(state: State, root: SVGElement): void {\n\n  const d = state.drawable,\n  curD = d.current,\n  cur = curD && curD.mouseSq ? curD as DrawShape : undefined,\n  arrowDests: ArrowDests = new Map(),\n  bounds = state.dom.bounds();\n\n  for (const s of d.shapes.concat(d.autoShapes).concat(cur ? [cur] : [])) {\n    if (s.dest) arrowDests.set(s.dest, (arrowDests.get(s.dest) || 0) + 1);\n  }\n\n  const shapes: Shape[] = d.shapes.concat(d.autoShapes).map((s: DrawShape) => {\n    return {\n      shape: s,\n      current: false,\n      hash: shapeHash(s, arrowDests, false, bounds)\n    };\n  });\n  if (cur) shapes.push({\n    shape: cur,\n    current: true,\n    hash: shapeHash(cur, arrowDests, true, bounds)\n  });\n\n  const fullHash = shapes.map(sc => sc.hash).join(';');\n  if (fullHash === state.drawable.prevSvgHash) return;\n  state.drawable.prevSvgHash = fullHash;\n\n  const defsEl = root.firstChild as SVGElement;\n\n  syncDefs(d, shapes, defsEl);\n  syncShapes(state, shapes, d.brushes, arrowDests, root, defsEl);\n}\n\n// append only. Don't try to update/remove.\nfunction syncDefs(d: Drawable, shapes: Shape[], defsEl: SVGElement) {\n  const brushes: CustomBrushes = new Map();\n  let brush: DrawBrush;\n  for (const s of shapes) {\n    if (s.shape.dest) {\n      brush = d.brushes[s.shape.brush];\n      if (s.shape.modifiers) brush = makeCustomBrush(brush, s.shape.modifiers);\n      brushes.set(brush.key, brush);\n    }\n  }\n  const keysInDom = new Set();\n  let el: SVGElement | undefined = defsEl.firstChild as SVGElement;\n  while (el) {\n    keysInDom.add(el.getAttribute('cgKey'));\n    el = el.nextSibling as SVGElement | undefined;\n  }\n  for (const [key, brush] of brushes.entries()) {\n    if (!keysInDom.has(key)) defsEl.appendChild(renderMarker(brush));\n  }\n}\n\n// append and remove only. No updates.\nfunction syncShapes(state: State, shapes: Shape[], brushes: DrawBrushes, arrowDests: ArrowDests, root: SVGElement, defsEl: SVGElement): void {\n  const bounds = state.dom.bounds(),\n  hashesInDom = new Map(), // by hash\n  toRemove: SVGElement[] = [];\n  for (const sc of shapes) hashesInDom.set(sc.hash, false);\n  let el: SVGElement | undefined = defsEl.nextSibling as SVGElement, elHash: Hash;\n  while (el) {\n    elHash = el.getAttribute('cgHash') as Hash;\n    // found a shape element that's here to stay\n    if (hashesInDom.has(elHash)) hashesInDom.set(elHash, true);\n    // or remove it\n    else toRemove.push(el);\n    el = el.nextSibling as SVGElement | undefined;\n  }\n  // remove old shapes\n  for (const el of toRemove) root.removeChild(el);\n  // insert shapes that are not yet in dom\n  for (const sc of shapes) {\n    if (!hashesInDom.get(sc.hash)) root.appendChild(renderShape(state, sc, brushes, arrowDests, bounds));\n  }\n}\n\nfunction shapeHash({orig, dest, brush, piece, modifiers}: DrawShape, arrowDests: ArrowDests, current: boolean, bounds: ClientRect): Hash {\n  return [bounds.width, bounds.height, current, orig, dest, brush, dest && (arrowDests.get(dest) || 0) > 1,\n    piece && pieceHash(piece),\n    modifiers && modifiersHash(modifiers)\n  ].filter(x => x).join(',');\n}\n\nfunction pieceHash(piece: DrawShapePiece): Hash {\n  return [piece.color, piece.role, piece.scale].filter(x => x).join(',');\n}\n\nfunction modifiersHash(m: DrawModifiers): Hash {\n  return '' + (m.lineWidth || '');\n}\n\nfunction renderShape(state: State, {shape, current, hash}: Shape, brushes: DrawBrushes, arrowDests: ArrowDests, bounds: ClientRect): SVGElement {\n  let el: SVGElement;\n  if (shape.piece) el = renderPiece(\n    state.drawable.pieces.baseUrl,\n    orient(key2pos(shape.orig), state.orientation),\n    shape.piece,\n    bounds);\n  else {\n    const orig = orient(key2pos(shape.orig), state.orientation);\n    if (shape.dest) {\n      let brush: DrawBrush = brushes[shape.brush];\n      if (shape.modifiers) brush = makeCustomBrush(brush, shape.modifiers);\n      el = renderArrow(\n        brush,\n        orig,\n        orient(key2pos(shape.dest), state.orientation),\n        current,\n        (arrowDests.get(shape.dest) || 0) > 1,\n        bounds);\n    }\n    else el = renderCircle(brushes[shape.brush], orig, current, bounds);\n  }\n  el.setAttribute('cgHash', hash);\n  return el;\n}\n\nfunction renderCircle(brush: DrawBrush, pos: cg.Pos, current: boolean, bounds: ClientRect): SVGElement {\n  const o = pos2px(pos, bounds),\n  widths = circleWidth(bounds),\n  radius = (bounds.width + bounds.height) / 32;\n  return setAttributes(createElement('circle'), {\n    stroke: brush.color,\n    'stroke-width': widths[current ? 0 : 1],\n    fill: 'none',\n    opacity: opacity(brush, current),\n    cx: o[0],\n    cy: o[1],\n    r: radius - widths[1] / 2\n  });\n}\n\nfunction renderArrow(brush: DrawBrush, orig: cg.Pos, dest: cg.Pos, current: boolean, shorten: boolean, bounds: ClientRect): SVGElement {\n  const m = arrowMargin(bounds, shorten && !current),\n  a = pos2px(orig, bounds),\n  b = pos2px(dest, bounds),\n  dx = b[0] - a[0],\n  dy = b[1] - a[1],\n  angle = Math.atan2(dy, dx),\n  xo = Math.cos(angle) * m,\n  yo = Math.sin(angle) * m;\n  return setAttributes(createElement('line'), {\n    stroke: brush.color,\n    'stroke-width': lineWidth(brush, current, bounds),\n    'stroke-linecap': 'round',\n    'marker-end': 'url(#arrowhead-' + brush.key + ')',\n    opacity: opacity(brush, current),\n    x1: a[0],\n    y1: a[1],\n    x2: b[0] - xo,\n    y2: b[1] - yo\n  });\n}\n\nfunction renderPiece(baseUrl: string, pos: cg.Pos, piece: DrawShapePiece, bounds: ClientRect): SVGElement {\n  const o = pos2px(pos, bounds),\n  size = bounds.width / 8 * (piece.scale || 1),\n  name = piece.color[0] + (piece.role === 'knight' ? 'n' : piece.role[0]).toUpperCase();\n  return setAttributes(createElement('image'), {\n    className: `${piece.role} ${piece.color}`,\n    x: o[0] - size / 2,\n    y: o[1] - size / 2,\n    width: size,\n    height: size,\n    href: baseUrl + name + '.svg'\n  });\n}\n\nfunction renderMarker(brush: DrawBrush): SVGElement {\n  const marker = setAttributes(createElement('marker'), {\n    id: 'arrowhead-' + brush.key,\n    orient: 'auto',\n    markerWidth: 4,\n    markerHeight: 8,\n    refX: 2.05,\n    refY: 2.01\n  });\n  marker.appendChild(setAttributes(createElement('path'), {\n    d: 'M0,0 V4 L3,2 Z',\n    fill: brush.color\n  }));\n  marker.setAttribute('cgKey', brush.key);\n  return marker;\n}\n\nfunction setAttributes(el: SVGElement, attrs: { [key: string]: any }): SVGElement {\n  for (const key in attrs) el.setAttribute(key, attrs[key]);\n  return el;\n}\n\nfunction orient(pos: cg.Pos, color: cg.Color): cg.Pos {\n  return color === 'white' ? pos : [7 - pos[0], 7 - pos[1]];\n}\n\nfunction makeCustomBrush(base: DrawBrush, modifiers: DrawModifiers): DrawBrush {\n  return {\n    color: base.color,\n    opacity: Math.round(base.opacity * 10) / 10,\n    lineWidth: Math.round(modifiers.lineWidth || base.lineWidth),\n    key: [base.key, modifiers.lineWidth].filter(x => x).join(''),\n  };\n}\n\nfunction circleWidth(bounds: ClientRect): [number, number] {\n  const base = bounds.width / 512;\n  return [3 * base, 4 * base];\n}\n\nfunction lineWidth(brush: DrawBrush, current: boolean, bounds: ClientRect): number {\n  return (brush.lineWidth || 10) * (current ? 0.85 : 1) / 512 * bounds.width;\n}\n\nfunction opacity(brush: DrawBrush, current: boolean): number {\n  return (brush.opacity || 1) * (current ? 0.9 : 1);\n}\n\nfunction arrowMargin(bounds: ClientRect, shorten: boolean): number {\n  return (shorten ? 20 : 10) / 512 * bounds.width;\n}\n\nfunction pos2px(pos: cg.Pos, bounds: ClientRect): cg.NumberPair {\n  return [(pos[0] + 0.5) * bounds.width / 8, (7.5 - pos[1]) * bounds.height / 8];\n}\n","import { State } from './state'\nimport { setVisible, createEl } from './util'\nimport { colors, files, ranks } from './types'\nimport { createElement as createSVG } from './svg'\nimport { Elements } from './types'\n\nexport function renderWrap(element: HTMLElement, s: State, relative: boolean): Elements {\n\n  // .cg-wrap (element passed to Chessground)\n  //   cg-helper (12.5%)\n  //     cg-container (800%)\n  //       cg-board\n  //       svg\n  //       coords.ranks\n  //       coords.files\n  //       piece.ghost\n\n  element.innerHTML = '';\n\n  // ensure the cg-wrap class is set\n  // so bounds calculation can use the CSS width/height values\n  // add that class yourself to the element before calling chessground\n  // for a slight performance improvement! (avoids recomputing style)\n  element.classList.add('cg-wrap');\n\n  for (const c of colors) element.classList.toggle('orientation-' + c, s.orientation === c);\n  element.classList.toggle('manipulable', !s.viewOnly);\n\n  const helper = createEl('cg-helper');\n  element.appendChild(helper);\n  const container = createEl('cg-container');\n  helper.appendChild(container);\n\n  const board = createEl('cg-board');\n  container.appendChild(board);\n\n  let svg: SVGElement | undefined;\n  if (s.drawable.visible && !relative) {\n    svg = createSVG('svg');\n    svg.appendChild(createSVG('defs'));\n    container.appendChild(svg);\n  }\n\n  if (s.coordinates) {\n    const orientClass = s.orientation === 'black' ? ' black' : '';\n    container.appendChild(renderCoords(ranks, 'ranks' + orientClass));\n    container.appendChild(renderCoords(files, 'files' + orientClass));\n  }\n\n  let ghost: HTMLElement | undefined;\n  if (s.draggable.showGhost && !relative) {\n    ghost = createEl('piece', 'ghost');\n    setVisible(ghost, false);\n    container.appendChild(ghost);\n  }\n\n  return {\n    board,\n    container,\n    ghost,\n    svg\n  };\n}\n\nfunction renderCoords(elems: readonly string[], className: string): HTMLElement {\n  const el = createEl('coords', className);\n  let f: HTMLElement;\n  for (const elem of elems) {\n    f = createEl('coord');\n    f.textContent = elem;\n    el.appendChild(f);\n  }\n  return el;\n}\n","import { State } from './state'\nimport * as cg from './types'\nimport * as board from './board'\nimport * as util from './util'\nimport { cancel as dragCancel } from './drag'\n\nexport function setDropMode(s: State, piece?: cg.Piece): void {\n  s.dropmode = {\n    active: true,\n    piece\n  };\n  dragCancel(s);\n}\n\nexport function cancelDropMode(s: State): void {\n  s.dropmode = {\n    active: false\n  };\n}\n\nexport function drop(s: State, e: cg.MouchEvent): void {\n  if (!s.dropmode.active) return;\n\n  board.unsetPremove(s);\n  board.unsetPredrop(s);\n\n  const piece = s.dropmode.piece;\n\n  if (piece) {\n    s.pieces.set('a0', piece);\n    const position = util.eventPosition(e);\n    const dest = position && board.getKeyAtDomPos(\n      position, board.whitePov(s), s.dom.bounds());\n    if (dest) board.dropNewPiece(s, 'a0', dest);\n  }\n  s.dom.redraw();\n}\n","import { State } from './state'\nimport * as drag from './drag'\nimport * as draw from './draw'\nimport { drop } from './drop'\nimport { isRightButton } from './util'\nimport * as cg from './types'\n\ntype MouchBind = (e: cg.MouchEvent) => void;\ntype StateMouchBind = (d: State, e: cg.MouchEvent) => void;\n\nexport function bindBoard(s: State, boundsUpdated: () => void): void {\n\n  const boardEl = s.dom.elements.board;\n\n  if (!s.dom.relative && s.resizable && 'ResizeObserver' in window) {\n    const observer = new (window as any)['ResizeObserver'](boundsUpdated);\n    observer.observe(boardEl);\n  }\n\n  if (s.viewOnly) return;\n\n  // Cannot be passive, because we prevent touch scrolling and dragging of\n  // selected elements.\n  const onStart = startDragOrDraw(s);\n  boardEl.addEventListener('touchstart', onStart as EventListener, { passive: false });\n  boardEl.addEventListener('mousedown', onStart as EventListener, { passive: false });\n\n  if (s.disableContextMenu || s.drawable.enabled) {\n    boardEl.addEventListener('contextmenu', e => e.preventDefault());\n  }\n}\n\n// returns the unbind function\nexport function bindDocument(s: State, boundsUpdated: () => void): cg.Unbind {\n\n  const unbinds: cg.Unbind[] = [];\n\n  // Old versions of Edge and Safari do not support ResizeObserver. Send\n  // chessground.resize if a user action has changed the bounds of the board.\n  if (!s.dom.relative && s.resizable && !('ResizeObserver' in window)) {\n    unbinds.push(unbindable(document.body, 'chessground.resize', boundsUpdated));\n  }\n\n  if (!s.viewOnly) {\n\n    const onmove: MouchBind = dragOrDraw(s, drag.move, draw.move);\n    const onend: MouchBind = dragOrDraw(s, drag.end, draw.end);\n\n    for (const ev of ['touchmove', 'mousemove']) unbinds.push(unbindable(document, ev, onmove));\n    for (const ev of ['touchend', 'mouseup']) unbinds.push(unbindable(document, ev, onend));\n\n    const onScroll = () => s.dom.bounds.clear();\n    unbinds.push(unbindable(document, 'scroll', onScroll, { capture: true, passive: true }));\n    unbinds.push(unbindable(window, 'resize', onScroll, { passive: true }));\n  }\n\n  return () => unbinds.forEach(f => f());\n}\n\nfunction unbindable(el: EventTarget, eventName: string, callback: MouchBind, options?: any): cg.Unbind {\n  el.addEventListener(eventName, callback as EventListener, options);\n  return () => el.removeEventListener(eventName, callback as EventListener, options);\n}\n\nfunction startDragOrDraw(s: State): MouchBind {\n  return e => {\n    if (s.draggable.current) drag.cancel(s);\n    else if (s.drawable.current) draw.cancel(s);\n    else if (e.shiftKey || isRightButton(e)) { if (s.drawable.enabled) draw.start(s, e); }\n    else if (!s.viewOnly) {\n      if (s.dropmode.active) drop(s, e);\n      else drag.start(s, e);\n    }\n  };\n}\n\nfunction dragOrDraw(s: State, withDrag: StateMouchBind, withDraw: StateMouchBind): MouchBind {\n  return e => {\n    if (s.drawable.current) { if (s.drawable.enabled) withDraw(s, e); }\n    else if (!s.viewOnly) withDrag(s, e);\n  };\n}\n","import { State } from './state'\nimport { key2pos, createEl } from './util'\nimport { whitePov } from './board'\nimport * as util from './util'\nimport { AnimCurrent, AnimVectors, AnimVector, AnimFadings } from './anim'\nimport { DragCurrent } from './drag'\nimport * as cg from './types'\n\ntype PieceName = string; // `$color $role`\n\ntype SquareClasses = Map<cg.Key, string>;\n\n// ported from https://github.com/veloce/lichobile/blob/master/src/js/chessground/view.js\n// in case of bugs, blame @veloce\nexport function render(s: State): void {\n  const asWhite: boolean = whitePov(s),\n  posToTranslate = s.dom.relative ? util.posToTranslateRel : util.posToTranslateAbs(s.dom.bounds()),\n  translate = s.dom.relative ? util.translateRel : util.translateAbs,\n  boardEl: HTMLElement = s.dom.elements.board,\n  pieces: cg.Pieces = s.pieces,\n  curAnim: AnimCurrent | undefined = s.animation.current,\n  anims: AnimVectors = curAnim ? curAnim.plan.anims : new Map(),\n  fadings: AnimFadings = curAnim ? curAnim.plan.fadings : new Map(),\n  curDrag: DragCurrent | undefined = s.draggable.current,\n  squares: SquareClasses = computeSquareClasses(s),\n  samePieces: Set<cg.Key> = new Set(),\n  sameSquares: Set<cg.Key> = new Set(),\n  movedPieces: Map<PieceName, cg.PieceNode[]> = new Map(),\n  movedSquares: Map<string, cg.SquareNode[]> = new Map(); // by class name\n  let k: cg.Key,\n  el: cg.PieceNode | cg.SquareNode | undefined,\n  pieceAtKey: cg.Piece | undefined,\n  elPieceName: PieceName,\n  anim: AnimVector | undefined,\n  fading: cg.Piece | undefined,\n  pMvdset: cg.PieceNode[] | undefined,\n  pMvd: cg.PieceNode | undefined,\n  sMvdset: cg.SquareNode[] | undefined,\n  sMvd: cg.SquareNode | undefined;\n\n  // walk over all board dom elements, apply animations and flag moved pieces\n  el = boardEl.firstChild as cg.PieceNode | cg.SquareNode | undefined;\n  while (el) {\n    k = el.cgKey;\n    if (isPieceNode(el)) {\n      pieceAtKey = pieces.get(k);\n      anim = anims.get(k);\n      fading = fadings.get(k);\n      elPieceName = el.cgPiece;\n      // if piece not being dragged anymore, remove dragging style\n      if (el.cgDragging && (!curDrag || curDrag.orig !== k)) {\n        el.classList.remove('dragging');\n        translate(el, posToTranslate(key2pos(k), asWhite));\n        el.cgDragging = false;\n      }\n      // remove fading class if it still remains\n      if (!fading && el.cgFading) {\n        el.cgFading = false;\n        el.classList.remove('fading');\n      }\n      // there is now a piece at this dom key\n      if (pieceAtKey) {\n        // continue animation if already animating and same piece\n        // (otherwise it could animate a captured piece)\n        if (anim && el.cgAnimating && elPieceName === pieceNameOf(pieceAtKey)) {\n          const pos = key2pos(k);\n          pos[0] += anim[2];\n          pos[1] += anim[3];\n          el.classList.add('anim');\n          translate(el, posToTranslate(pos, asWhite));\n        } else if (el.cgAnimating) {\n          el.cgAnimating = false;\n          el.classList.remove('anim');\n          translate(el, posToTranslate(key2pos(k), asWhite));\n          if (s.addPieceZIndex) el.style.zIndex = posZIndex(key2pos(k), asWhite);\n        }\n        // same piece: flag as same\n        if (elPieceName === pieceNameOf(pieceAtKey) && (!fading || !el.cgFading)) {\n          samePieces.add(k);\n        }\n        // different piece: flag as moved unless it is a fading piece\n        else {\n          if (fading && elPieceName === pieceNameOf(fading)) {\n            el.classList.add('fading');\n            el.cgFading = true;\n          } else {\n            appendValue(movedPieces, elPieceName, el);\n          }\n        }\n      }\n      // no piece: flag as moved\n      else {\n        appendValue(movedPieces, elPieceName, el);\n      }\n    }\n    else if (isSquareNode(el)) {\n      const cn = el.className;\n      if (squares.get(k) === cn) sameSquares.add(k);\n      else appendValue(movedSquares, cn, el);\n    }\n    el = el.nextSibling as cg.PieceNode | cg.SquareNode | undefined;\n  }\n\n  // walk over all squares in current set, apply dom changes to moved squares\n  // or append new squares\n  for (const [sk, className] of squares) {\n    if (!sameSquares.has(sk)) {\n      sMvdset = movedSquares.get(className);\n      sMvd = sMvdset && sMvdset.pop();\n      const translation = posToTranslate(key2pos(sk), asWhite);\n      if (sMvd) {\n        sMvd.cgKey = sk;\n        translate(sMvd, translation);\n      }\n      else {\n        const squareNode = createEl('square', className) as cg.SquareNode;\n        squareNode.cgKey = sk;\n        translate(squareNode, translation);\n        boardEl.insertBefore(squareNode, boardEl.firstChild);\n      }\n    }\n  }\n\n  // walk over all pieces in current set, apply dom changes to moved pieces\n  // or append new pieces\n  for (const [k, p] of pieces) {\n    anim = anims.get(k);\n    if (!samePieces.has(k)) {\n      pMvdset = movedPieces.get(pieceNameOf(p));\n      pMvd = pMvdset && pMvdset.pop();\n      // a same piece was moved\n      if (pMvd) {\n        // apply dom changes\n        pMvd.cgKey = k;\n        if (pMvd.cgFading) {\n          pMvd.classList.remove('fading');\n          pMvd.cgFading = false;\n        }\n        const pos = key2pos(k);\n        if (s.addPieceZIndex) pMvd.style.zIndex = posZIndex(pos, asWhite);\n        if (anim) {\n          pMvd.cgAnimating = true;\n          pMvd.classList.add('anim');\n          pos[0] += anim[2];\n          pos[1] += anim[3];\n        }\n        translate(pMvd, posToTranslate(pos, asWhite));\n      }\n      // no piece in moved obj: insert the new piece\n      // assumes the new piece is not being dragged\n      else {\n\n        const pieceName = pieceNameOf(p),\n        pieceNode = createEl('piece', pieceName) as cg.PieceNode,\n        pos = key2pos(k);\n\n        pieceNode.cgPiece = pieceName;\n        pieceNode.cgKey = k;\n        if (anim) {\n          pieceNode.cgAnimating = true;\n          pos[0] += anim[2];\n          pos[1] += anim[3];\n        }\n        translate(pieceNode, posToTranslate(pos, asWhite));\n\n        if (s.addPieceZIndex) pieceNode.style.zIndex = posZIndex(pos, asWhite);\n\n        boardEl.appendChild(pieceNode);\n      }\n    }\n  }\n\n  // remove any element that remains in the moved sets\n  for (const nodes of movedPieces.values()) removeNodes(s, nodes);\n  for (const nodes of movedSquares.values()) removeNodes(s, nodes);\n}\n\nexport function updateBounds(s: State): void {\n  if (s.dom.relative) return;\n  const asWhite: boolean = whitePov(s),\n  posToTranslate = util.posToTranslateAbs(s.dom.bounds());\n  let el = s.dom.elements.board.firstChild as cg.PieceNode | cg.SquareNode | undefined;\n  while (el) {\n    if ((isPieceNode(el) && !el.cgAnimating) || isSquareNode(el)) {\n      util.translateAbs(el, posToTranslate(key2pos(el.cgKey), asWhite));\n    }\n    el = el.nextSibling as cg.PieceNode | cg.SquareNode | undefined;\n  }\n}\n\nfunction isPieceNode(el: cg.PieceNode | cg.SquareNode): el is cg.PieceNode {\n  return el.tagName === 'PIECE';\n}\nfunction isSquareNode(el: cg.PieceNode | cg.SquareNode): el is cg.SquareNode {\n  return el.tagName === 'SQUARE';\n}\n\nfunction removeNodes(s: State, nodes: HTMLElement[]): void {\n  for (const node of nodes) s.dom.elements.board.removeChild(node);\n}\n\nfunction posZIndex(pos: cg.Pos, asWhite: boolean): string {\n  let z = 2 + pos[1] * 8 + (7 - pos[0]);\n  if (asWhite) z = 67 - z;\n  return z + '';\n}\n\nfunction pieceNameOf(piece: cg.Piece): string {\n  return `${piece.color} ${piece.role}`;\n}\n\nfunction computeSquareClasses(s: State): SquareClasses {\n  const squares: SquareClasses = new Map();\n  if (s.lastMove && s.highlight.lastMove) for (const k of s.lastMove) {\n    addSquare(squares, k, 'last-move');\n  }\n  if (s.check && s.highlight.check) addSquare(squares, s.check, 'check');\n  if (s.selected) {\n    addSquare(squares, s.selected, 'selected');\n    if (s.movable.showDests) {\n      const dests = s.movable.dests?.get(s.selected);\n      if (dests) for (const k of dests) {\n        addSquare(squares, k, 'move-dest' + (s.pieces.has(k) ? ' oc' : ''));\n      }\n      const pDests = s.premovable.dests;\n      if (pDests) for (const k of pDests) {\n        addSquare(squares, k, 'premove-dest' + (s.pieces.has(k) ? ' oc' : ''));\n      }\n    }\n  }\n  const premove = s.premovable.current;\n  if (premove) for (const k of premove) addSquare(squares, k, 'current-premove');\n  else if (s.predroppable.current) addSquare(squares, s.predroppable.current.key, 'current-premove');\n\n  const o = s.exploding;\n  if (o) for (const k of o.keys) addSquare(squares, k, 'exploding' + o.stage);\n\n  return squares;\n}\n\nfunction addSquare(squares: SquareClasses, key: cg.Key, klass: string): void {\n  const classes = squares.get(key);\n  if (classes) squares.set(key, `${classes} ${klass}`);\n  else squares.set(key, klass)\n}\n\nfunction appendValue<K, V>(map: Map<K, V[]>, key: K, value: V): void {\n  const arr = map.get(key);\n  if (arr) arr.push(value);\n  else map.set(key, [value]);\n}\n","import { Api, start } from './api'\nimport { Config, configure } from './config'\nimport { State, defaults } from './state'\n\nimport { renderWrap } from './wrap';\nimport * as events from './events'\nimport { render, updateBounds } from './render';\nimport * as svg from './svg';\nimport * as util from './util';\n\nexport function Chessground(element: HTMLElement, config?: Config): Api {\n\n  const state = defaults() as State;\n\n  configure(state, config || {});\n\n  function redrawAll(): void {\n    const prevUnbind = state.dom && state.dom.unbind; /* eslint-disable-line */\n    // compute bounds from existing board element if possible\n    // this allows non-square boards from CSS to be handled (for 3D)\n    const relative = state.viewOnly && !state.drawable.visible,\n    elements = renderWrap(element, state, relative),\n    bounds = util.memo(() => elements.board.getBoundingClientRect()),\n    redrawNow = (skipSvg?: boolean): void => {\n      render(state);\n      if (!skipSvg && elements.svg) svg.renderSvg(state, elements.svg);\n    },\n    boundsUpdated = (): void => {\n      bounds.clear();\n      updateBounds(state);\n      if (elements.svg) svg.renderSvg(state, elements.svg);\n    };\n    state.dom = {\n      elements,\n      bounds,\n      redraw: debounceRedraw(redrawNow),\n      redrawNow,\n      unbind: prevUnbind,\n      relative\n    };\n    state.drawable.prevSvgHash = '';\n    redrawNow(false);\n    events.bindBoard(state, boundsUpdated);\n    if (!prevUnbind) state.dom.unbind = events.bindDocument(state, boundsUpdated);\n    state.events.insert && state.events.insert(elements);\n  }\n  redrawAll();\n\n  return start(state, redrawAll);\n}\n\nfunction debounceRedraw(redrawNow: (skipSvg?: boolean) => void): () => void {\n  let redrawing = false;\n  return () => {\n    if (redrawing) return;\n    redrawing = true;\n    requestAnimationFrame(() => {\n      redrawNow();\n      redrawing = false;\n    });\n  };\n}\n","import { util } from \"./util\";\nimport { Peer } from \"./peer\";\n\nexport const peerjs = {\n  Peer,\n  util\n};\n\nexport default Peer;\n\n(<any>window).peerjs = peerjs;\n/** @deprecated Should use peerjs namespace */\n(<any>window).Peer = Peer;\n","var binaryFeatures = {};\r\nbinaryFeatures.useBlobBuilder = (function () {\r\n  try {\r\n    new Blob([]);\r\n    return false;\r\n  } catch (e) {\r\n    return true;\r\n  }\r\n})();\r\n\r\nbinaryFeatures.useArrayBufferView = !binaryFeatures.useBlobBuilder && (function () {\r\n  try {\r\n    return (new Blob([new Uint8Array([])])).size === 0;\r\n  } catch (e) {\r\n    return true;\r\n  }\r\n})();\r\n\r\nmodule.exports.binaryFeatures = binaryFeatures;\r\nvar BlobBuilder = module.exports.BlobBuilder;\r\nif (typeof window !== 'undefined') {\r\n  BlobBuilder = module.exports.BlobBuilder = window.WebKitBlobBuilder ||\r\n    window.MozBlobBuilder || window.MSBlobBuilder || window.BlobBuilder;\r\n}\r\n\r\nfunction BufferBuilder () {\r\n  this._pieces = [];\r\n  this._parts = [];\r\n}\r\n\r\nBufferBuilder.prototype.append = function (data) {\r\n  if (typeof data === 'number') {\r\n    this._pieces.push(data);\r\n  } else {\r\n    this.flush();\r\n    this._parts.push(data);\r\n  }\r\n};\r\n\r\nBufferBuilder.prototype.flush = function () {\r\n  if (this._pieces.length > 0) {\r\n    var buf = new Uint8Array(this._pieces);\r\n    if (!binaryFeatures.useArrayBufferView) {\r\n      buf = buf.buffer;\r\n    }\r\n    this._parts.push(buf);\r\n    this._pieces = [];\r\n  }\r\n};\r\n\r\nBufferBuilder.prototype.getBuffer = function () {\r\n  this.flush();\r\n  if (binaryFeatures.useBlobBuilder) {\r\n    var builder = new BlobBuilder();\r\n    for (var i = 0, ii = this._parts.length; i < ii; i++) {\r\n      builder.append(this._parts[i]);\r\n    }\r\n    return builder.getBlob();\r\n  } else {\r\n    return new Blob(this._parts);\r\n  }\r\n};\r\n\r\nmodule.exports.BufferBuilder = BufferBuilder;\r\n","var BufferBuilder = require('./bufferbuilder').BufferBuilder;\r\nvar binaryFeatures = require('./bufferbuilder').binaryFeatures;\r\n\r\nvar BinaryPack = {\r\n  unpack: function (data) {\r\n    var unpacker = new Unpacker(data);\r\n    return unpacker.unpack();\r\n  },\r\n  pack: function (data) {\r\n    var packer = new Packer();\r\n    packer.pack(data);\r\n    var buffer = packer.getBuffer();\r\n    return buffer;\r\n  }\r\n};\r\n\r\nmodule.exports = BinaryPack;\r\n\r\nfunction Unpacker (data) {\r\n  // Data is ArrayBuffer\r\n  this.index = 0;\r\n  this.dataBuffer = data;\r\n  this.dataView = new Uint8Array(this.dataBuffer);\r\n  this.length = this.dataBuffer.byteLength;\r\n}\r\n\r\nUnpacker.prototype.unpack = function () {\r\n  var type = this.unpack_uint8();\r\n  if (type < 0x80) {\r\n    return type;\r\n  } else if ((type ^ 0xe0) < 0x20) {\r\n    return (type ^ 0xe0) - 0x20;\r\n  }\r\n\r\n  var size;\r\n  if ((size = type ^ 0xa0) <= 0x0f) {\r\n    return this.unpack_raw(size);\r\n  } else if ((size = type ^ 0xb0) <= 0x0f) {\r\n    return this.unpack_string(size);\r\n  } else if ((size = type ^ 0x90) <= 0x0f) {\r\n    return this.unpack_array(size);\r\n  } else if ((size = type ^ 0x80) <= 0x0f) {\r\n    return this.unpack_map(size);\r\n  }\r\n\r\n  switch (type) {\r\n    case 0xc0:\r\n      return null;\r\n    case 0xc1:\r\n      return undefined;\r\n    case 0xc2:\r\n      return false;\r\n    case 0xc3:\r\n      return true;\r\n    case 0xca:\r\n      return this.unpack_float();\r\n    case 0xcb:\r\n      return this.unpack_double();\r\n    case 0xcc:\r\n      return this.unpack_uint8();\r\n    case 0xcd:\r\n      return this.unpack_uint16();\r\n    case 0xce:\r\n      return this.unpack_uint32();\r\n    case 0xcf:\r\n      return this.unpack_uint64();\r\n    case 0xd0:\r\n      return this.unpack_int8();\r\n    case 0xd1:\r\n      return this.unpack_int16();\r\n    case 0xd2:\r\n      return this.unpack_int32();\r\n    case 0xd3:\r\n      return this.unpack_int64();\r\n    case 0xd4:\r\n      return undefined;\r\n    case 0xd5:\r\n      return undefined;\r\n    case 0xd6:\r\n      return undefined;\r\n    case 0xd7:\r\n      return undefined;\r\n    case 0xd8:\r\n      size = this.unpack_uint16();\r\n      return this.unpack_string(size);\r\n    case 0xd9:\r\n      size = this.unpack_uint32();\r\n      return this.unpack_string(size);\r\n    case 0xda:\r\n      size = this.unpack_uint16();\r\n      return this.unpack_raw(size);\r\n    case 0xdb:\r\n      size = this.unpack_uint32();\r\n      return this.unpack_raw(size);\r\n    case 0xdc:\r\n      size = this.unpack_uint16();\r\n      return this.unpack_array(size);\r\n    case 0xdd:\r\n      size = this.unpack_uint32();\r\n      return this.unpack_array(size);\r\n    case 0xde:\r\n      size = this.unpack_uint16();\r\n      return this.unpack_map(size);\r\n    case 0xdf:\r\n      size = this.unpack_uint32();\r\n      return this.unpack_map(size);\r\n  }\r\n};\r\n\r\nUnpacker.prototype.unpack_uint8 = function () {\r\n  var byte = this.dataView[this.index] & 0xff;\r\n  this.index++;\r\n  return byte;\r\n};\r\n\r\nUnpacker.prototype.unpack_uint16 = function () {\r\n  var bytes = this.read(2);\r\n  var uint16 =\r\n    ((bytes[0] & 0xff) * 256) + (bytes[1] & 0xff);\r\n  this.index += 2;\r\n  return uint16;\r\n};\r\n\r\nUnpacker.prototype.unpack_uint32 = function () {\r\n  var bytes = this.read(4);\r\n  var uint32 =\r\n    ((bytes[0] * 256 +\r\n      bytes[1]) * 256 +\r\n      bytes[2]) * 256 +\r\n    bytes[3];\r\n  this.index += 4;\r\n  return uint32;\r\n};\r\n\r\nUnpacker.prototype.unpack_uint64 = function () {\r\n  var bytes = this.read(8);\r\n  var uint64 =\r\n    ((((((bytes[0] * 256 +\r\n      bytes[1]) * 256 +\r\n      bytes[2]) * 256 +\r\n      bytes[3]) * 256 +\r\n      bytes[4]) * 256 +\r\n      bytes[5]) * 256 +\r\n      bytes[6]) * 256 +\r\n    bytes[7];\r\n  this.index += 8;\r\n  return uint64;\r\n};\r\n\r\nUnpacker.prototype.unpack_int8 = function () {\r\n  var uint8 = this.unpack_uint8();\r\n  return (uint8 < 0x80) ? uint8 : uint8 - (1 << 8);\r\n};\r\n\r\nUnpacker.prototype.unpack_int16 = function () {\r\n  var uint16 = this.unpack_uint16();\r\n  return (uint16 < 0x8000) ? uint16 : uint16 - (1 << 16);\r\n};\r\n\r\nUnpacker.prototype.unpack_int32 = function () {\r\n  var uint32 = this.unpack_uint32();\r\n  return (uint32 < Math.pow(2, 31)) ? uint32\r\n    : uint32 - Math.pow(2, 32);\r\n};\r\n\r\nUnpacker.prototype.unpack_int64 = function () {\r\n  var uint64 = this.unpack_uint64();\r\n  return (uint64 < Math.pow(2, 63)) ? uint64\r\n    : uint64 - Math.pow(2, 64);\r\n};\r\n\r\nUnpacker.prototype.unpack_raw = function (size) {\r\n  if (this.length < this.index + size) {\r\n    throw new Error('BinaryPackFailure: index is out of range' +\r\n      ' ' + this.index + ' ' + size + ' ' + this.length);\r\n  }\r\n  var buf = this.dataBuffer.slice(this.index, this.index + size);\r\n  this.index += size;\r\n\r\n  // buf = util.bufferToString(buf);\r\n\r\n  return buf;\r\n};\r\n\r\nUnpacker.prototype.unpack_string = function (size) {\r\n  var bytes = this.read(size);\r\n  var i = 0;\r\n  var str = '';\r\n  var c;\r\n  var code;\r\n\r\n  while (i < size) {\r\n    c = bytes[i];\r\n    if (c < 128) {\r\n      str += String.fromCharCode(c);\r\n      i++;\r\n    } else if ((c ^ 0xc0) < 32) {\r\n      code = ((c ^ 0xc0) << 6) | (bytes[i + 1] & 63);\r\n      str += String.fromCharCode(code);\r\n      i += 2;\r\n    } else {\r\n      code = ((c & 15) << 12) | ((bytes[i + 1] & 63) << 6) |\r\n        (bytes[i + 2] & 63);\r\n      str += String.fromCharCode(code);\r\n      i += 3;\r\n    }\r\n  }\r\n\r\n  this.index += size;\r\n  return str;\r\n};\r\n\r\nUnpacker.prototype.unpack_array = function (size) {\r\n  var objects = new Array(size);\r\n  for (var i = 0; i < size; i++) {\r\n    objects[i] = this.unpack();\r\n  }\r\n  return objects;\r\n};\r\n\r\nUnpacker.prototype.unpack_map = function (size) {\r\n  var map = {};\r\n  for (var i = 0; i < size; i++) {\r\n    var key = this.unpack();\r\n    var value = this.unpack();\r\n    map[key] = value;\r\n  }\r\n  return map;\r\n};\r\n\r\nUnpacker.prototype.unpack_float = function () {\r\n  var uint32 = this.unpack_uint32();\r\n  var sign = uint32 >> 31;\r\n  var exp = ((uint32 >> 23) & 0xff) - 127;\r\n  var fraction = (uint32 & 0x7fffff) | 0x800000;\r\n  return (sign === 0 ? 1 : -1) *\r\n    fraction * Math.pow(2, exp - 23);\r\n};\r\n\r\nUnpacker.prototype.unpack_double = function () {\r\n  var h32 = this.unpack_uint32();\r\n  var l32 = this.unpack_uint32();\r\n  var sign = h32 >> 31;\r\n  var exp = ((h32 >> 20) & 0x7ff) - 1023;\r\n  var hfrac = (h32 & 0xfffff) | 0x100000;\r\n  var frac = hfrac * Math.pow(2, exp - 20) +\r\n    l32 * Math.pow(2, exp - 52);\r\n  return (sign === 0 ? 1 : -1) * frac;\r\n};\r\n\r\nUnpacker.prototype.read = function (length) {\r\n  var j = this.index;\r\n  if (j + length <= this.length) {\r\n    return this.dataView.subarray(j, j + length);\r\n  } else {\r\n    throw new Error('BinaryPackFailure: read index out of range');\r\n  }\r\n};\r\n\r\nfunction Packer () {\r\n  this.bufferBuilder = new BufferBuilder();\r\n}\r\n\r\nPacker.prototype.getBuffer = function () {\r\n  return this.bufferBuilder.getBuffer();\r\n};\r\n\r\nPacker.prototype.pack = function (value) {\r\n  var type = typeof (value);\r\n  if (type === 'string') {\r\n    this.pack_string(value);\r\n  } else if (type === 'number') {\r\n    if (Math.floor(value) === value) {\r\n      this.pack_integer(value);\r\n    } else {\r\n      this.pack_double(value);\r\n    }\r\n  } else if (type === 'boolean') {\r\n    if (value === true) {\r\n      this.bufferBuilder.append(0xc3);\r\n    } else if (value === false) {\r\n      this.bufferBuilder.append(0xc2);\r\n    }\r\n  } else if (type === 'undefined') {\r\n    this.bufferBuilder.append(0xc0);\r\n  } else if (type === 'object') {\r\n    if (value === null) {\r\n      this.bufferBuilder.append(0xc0);\r\n    } else {\r\n      var constructor = value.constructor;\r\n      if (constructor == Array) {\r\n        this.pack_array(value);\r\n      } else if (constructor == Blob || constructor == File || value instanceof Blob || value instanceof File) {\r\n        this.pack_bin(value);\r\n      } else if (constructor == ArrayBuffer) {\r\n        if (binaryFeatures.useArrayBufferView) {\r\n          this.pack_bin(new Uint8Array(value));\r\n        } else {\r\n          this.pack_bin(value);\r\n        }\r\n      } else if ('BYTES_PER_ELEMENT' in value) {\r\n        if (binaryFeatures.useArrayBufferView) {\r\n          this.pack_bin(new Uint8Array(value.buffer));\r\n        } else {\r\n          this.pack_bin(value.buffer);\r\n        }\r\n      } else if ((constructor == Object) || (constructor.toString().startsWith('class'))) {\r\n        this.pack_object(value);\r\n      } else if (constructor == Date) {\r\n        this.pack_string(value.toString());\r\n      } else if (typeof value.toBinaryPack === 'function') {\r\n        this.bufferBuilder.append(value.toBinaryPack());\r\n      } else {\r\n        throw new Error('Type \"' + constructor.toString() + '\" not yet supported');\r\n      }\r\n    }\r\n  } else {\r\n    throw new Error('Type \"' + type + '\" not yet supported');\r\n  }\r\n  this.bufferBuilder.flush();\r\n};\r\n\r\nPacker.prototype.pack_bin = function (blob) {\r\n  var length = blob.length || blob.byteLength || blob.size;\r\n  if (length <= 0x0f) {\r\n    this.pack_uint8(0xa0 + length);\r\n  } else if (length <= 0xffff) {\r\n    this.bufferBuilder.append(0xda);\r\n    this.pack_uint16(length);\r\n  } else if (length <= 0xffffffff) {\r\n    this.bufferBuilder.append(0xdb);\r\n    this.pack_uint32(length);\r\n  } else {\r\n    throw new Error('Invalid length');\r\n  }\r\n  this.bufferBuilder.append(blob);\r\n};\r\n\r\nPacker.prototype.pack_string = function (str) {\r\n  var length = utf8Length(str);\r\n\r\n  if (length <= 0x0f) {\r\n    this.pack_uint8(0xb0 + length);\r\n  } else if (length <= 0xffff) {\r\n    this.bufferBuilder.append(0xd8);\r\n    this.pack_uint16(length);\r\n  } else if (length <= 0xffffffff) {\r\n    this.bufferBuilder.append(0xd9);\r\n    this.pack_uint32(length);\r\n  } else {\r\n    throw new Error('Invalid length');\r\n  }\r\n  this.bufferBuilder.append(str);\r\n};\r\n\r\nPacker.prototype.pack_array = function (ary) {\r\n  var length = ary.length;\r\n  if (length <= 0x0f) {\r\n    this.pack_uint8(0x90 + length);\r\n  } else if (length <= 0xffff) {\r\n    this.bufferBuilder.append(0xdc);\r\n    this.pack_uint16(length);\r\n  } else if (length <= 0xffffffff) {\r\n    this.bufferBuilder.append(0xdd);\r\n    this.pack_uint32(length);\r\n  } else {\r\n    throw new Error('Invalid length');\r\n  }\r\n  for (var i = 0; i < length; i++) {\r\n    this.pack(ary[i]);\r\n  }\r\n};\r\n\r\nPacker.prototype.pack_integer = function (num) {\r\n  if (num >= -0x20 && num <= 0x7f) {\r\n    this.bufferBuilder.append(num & 0xff);\r\n  } else if (num >= 0x00 && num <= 0xff) {\r\n    this.bufferBuilder.append(0xcc);\r\n    this.pack_uint8(num);\r\n  } else if (num >= -0x80 && num <= 0x7f) {\r\n    this.bufferBuilder.append(0xd0);\r\n    this.pack_int8(num);\r\n  } else if (num >= 0x0000 && num <= 0xffff) {\r\n    this.bufferBuilder.append(0xcd);\r\n    this.pack_uint16(num);\r\n  } else if (num >= -0x8000 && num <= 0x7fff) {\r\n    this.bufferBuilder.append(0xd1);\r\n    this.pack_int16(num);\r\n  } else if (num >= 0x00000000 && num <= 0xffffffff) {\r\n    this.bufferBuilder.append(0xce);\r\n    this.pack_uint32(num);\r\n  } else if (num >= -0x80000000 && num <= 0x7fffffff) {\r\n    this.bufferBuilder.append(0xd2);\r\n    this.pack_int32(num);\r\n  } else if (num >= -0x8000000000000000 && num <= 0x7FFFFFFFFFFFFFFF) {\r\n    this.bufferBuilder.append(0xd3);\r\n    this.pack_int64(num);\r\n  } else if (num >= 0x0000000000000000 && num <= 0xFFFFFFFFFFFFFFFF) {\r\n    this.bufferBuilder.append(0xcf);\r\n    this.pack_uint64(num);\r\n  } else {\r\n    throw new Error('Invalid integer');\r\n  }\r\n};\r\n\r\nPacker.prototype.pack_double = function (num) {\r\n  var sign = 0;\r\n  if (num < 0) {\r\n    sign = 1;\r\n    num = -num;\r\n  }\r\n  var exp = Math.floor(Math.log(num) / Math.LN2);\r\n  var frac0 = num / Math.pow(2, exp) - 1;\r\n  var frac1 = Math.floor(frac0 * Math.pow(2, 52));\r\n  var b32 = Math.pow(2, 32);\r\n  var h32 = (sign << 31) | ((exp + 1023) << 20) |\r\n    (frac1 / b32) & 0x0fffff;\r\n  var l32 = frac1 % b32;\r\n  this.bufferBuilder.append(0xcb);\r\n  this.pack_int32(h32);\r\n  this.pack_int32(l32);\r\n};\r\n\r\nPacker.prototype.pack_object = function (obj) {\r\n  var keys = Object.keys(obj);\r\n  var length = keys.length;\r\n  if (length <= 0x0f) {\r\n    this.pack_uint8(0x80 + length);\r\n  } else if (length <= 0xffff) {\r\n    this.bufferBuilder.append(0xde);\r\n    this.pack_uint16(length);\r\n  } else if (length <= 0xffffffff) {\r\n    this.bufferBuilder.append(0xdf);\r\n    this.pack_uint32(length);\r\n  } else {\r\n    throw new Error('Invalid length');\r\n  }\r\n  for (var prop in obj) {\r\n    if (obj.hasOwnProperty(prop)) {\r\n      this.pack(prop);\r\n      this.pack(obj[prop]);\r\n    }\r\n  }\r\n};\r\n\r\nPacker.prototype.pack_uint8 = function (num) {\r\n  this.bufferBuilder.append(num);\r\n};\r\n\r\nPacker.prototype.pack_uint16 = function (num) {\r\n  this.bufferBuilder.append(num >> 8);\r\n  this.bufferBuilder.append(num & 0xff);\r\n};\r\n\r\nPacker.prototype.pack_uint32 = function (num) {\r\n  var n = num & 0xffffffff;\r\n  this.bufferBuilder.append((n & 0xff000000) >>> 24);\r\n  this.bufferBuilder.append((n & 0x00ff0000) >>> 16);\r\n  this.bufferBuilder.append((n & 0x0000ff00) >>> 8);\r\n  this.bufferBuilder.append((n & 0x000000ff));\r\n};\r\n\r\nPacker.prototype.pack_uint64 = function (num) {\r\n  var high = num / Math.pow(2, 32);\r\n  var low = num % Math.pow(2, 32);\r\n  this.bufferBuilder.append((high & 0xff000000) >>> 24);\r\n  this.bufferBuilder.append((high & 0x00ff0000) >>> 16);\r\n  this.bufferBuilder.append((high & 0x0000ff00) >>> 8);\r\n  this.bufferBuilder.append((high & 0x000000ff));\r\n  this.bufferBuilder.append((low & 0xff000000) >>> 24);\r\n  this.bufferBuilder.append((low & 0x00ff0000) >>> 16);\r\n  this.bufferBuilder.append((low & 0x0000ff00) >>> 8);\r\n  this.bufferBuilder.append((low & 0x000000ff));\r\n};\r\n\r\nPacker.prototype.pack_int8 = function (num) {\r\n  this.bufferBuilder.append(num & 0xff);\r\n};\r\n\r\nPacker.prototype.pack_int16 = function (num) {\r\n  this.bufferBuilder.append((num & 0xff00) >> 8);\r\n  this.bufferBuilder.append(num & 0xff);\r\n};\r\n\r\nPacker.prototype.pack_int32 = function (num) {\r\n  this.bufferBuilder.append((num >>> 24) & 0xff);\r\n  this.bufferBuilder.append((num & 0x00ff0000) >>> 16);\r\n  this.bufferBuilder.append((num & 0x0000ff00) >>> 8);\r\n  this.bufferBuilder.append((num & 0x000000ff));\r\n};\r\n\r\nPacker.prototype.pack_int64 = function (num) {\r\n  var high = Math.floor(num / Math.pow(2, 32));\r\n  var low = num % Math.pow(2, 32);\r\n  this.bufferBuilder.append((high & 0xff000000) >>> 24);\r\n  this.bufferBuilder.append((high & 0x00ff0000) >>> 16);\r\n  this.bufferBuilder.append((high & 0x0000ff00) >>> 8);\r\n  this.bufferBuilder.append((high & 0x000000ff));\r\n  this.bufferBuilder.append((low & 0xff000000) >>> 24);\r\n  this.bufferBuilder.append((low & 0x00ff0000) >>> 16);\r\n  this.bufferBuilder.append((low & 0x0000ff00) >>> 8);\r\n  this.bufferBuilder.append((low & 0x000000ff));\r\n};\r\n\r\nfunction _utf8Replace (m) {\r\n  var code = m.charCodeAt(0);\r\n\r\n  if (code <= 0x7ff) return '00';\r\n  if (code <= 0xffff) return '000';\r\n  if (code <= 0x1fffff) return '0000';\r\n  if (code <= 0x3ffffff) return '00000';\r\n  return '000000';\r\n}\r\n\r\nfunction utf8Length (str) {\r\n  if (str.length > 600) {\r\n    // Blob method faster for large strings\r\n    return (new Blob([str])).size;\r\n  } else {\r\n    return str.replace(/[^\\u0000-\\u007F]/g, _utf8Replace).length;\r\n  }\r\n}\r\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nlet logDisabled_ = true;\nlet deprecationWarnings_ = true;\n\n/**\n * Extract browser version out of the provided user agent string.\n *\n * @param {!string} uastring userAgent string.\n * @param {!string} expr Regular expression used as match criteria.\n * @param {!number} pos position in the version string to be returned.\n * @return {!number} browser version.\n */\nexport function extractVersion(uastring, expr, pos) {\n  const match = uastring.match(expr);\n  return match && match.length >= pos && parseInt(match[pos], 10);\n}\n\n// Wraps the peerconnection event eventNameToWrap in a function\n// which returns the modified event object (or false to prevent\n// the event).\nexport function wrapPeerConnectionEvent(window, eventNameToWrap, wrapper) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  const proto = window.RTCPeerConnection.prototype;\n  const nativeAddEventListener = proto.addEventListener;\n  proto.addEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap) {\n      return nativeAddEventListener.apply(this, arguments);\n    }\n    const wrappedCallback = (e) => {\n      const modifiedEvent = wrapper(e);\n      if (modifiedEvent) {\n        cb(modifiedEvent);\n      }\n    };\n    this._eventMap = this._eventMap || {};\n    this._eventMap[cb] = wrappedCallback;\n    return nativeAddEventListener.apply(this, [nativeEventName,\n      wrappedCallback]);\n  };\n\n  const nativeRemoveEventListener = proto.removeEventListener;\n  proto.removeEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap || !this._eventMap\n        || !this._eventMap[cb]) {\n      return nativeRemoveEventListener.apply(this, arguments);\n    }\n    const unwrappedCb = this._eventMap[cb];\n    delete this._eventMap[cb];\n    return nativeRemoveEventListener.apply(this, [nativeEventName,\n      unwrappedCb]);\n  };\n\n  Object.defineProperty(proto, 'on' + eventNameToWrap, {\n    get() {\n      return this['_on' + eventNameToWrap];\n    },\n    set(cb) {\n      if (this['_on' + eventNameToWrap]) {\n        this.removeEventListener(eventNameToWrap,\n            this['_on' + eventNameToWrap]);\n        delete this['_on' + eventNameToWrap];\n      }\n      if (cb) {\n        this.addEventListener(eventNameToWrap,\n            this['_on' + eventNameToWrap] = cb);\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n}\n\nexport function disableLog(bool) {\n  if (typeof bool !== 'boolean') {\n    return new Error('Argument type: ' + typeof bool +\n        '. Please use a boolean.');\n  }\n  logDisabled_ = bool;\n  return (bool) ? 'adapter.js logging disabled' :\n      'adapter.js logging enabled';\n}\n\n/**\n * Disable or enable deprecation warnings\n * @param {!boolean} bool set to true to disable warnings.\n */\nexport function disableWarnings(bool) {\n  if (typeof bool !== 'boolean') {\n    return new Error('Argument type: ' + typeof bool +\n        '. Please use a boolean.');\n  }\n  deprecationWarnings_ = !bool;\n  return 'adapter.js deprecation warnings ' + (bool ? 'disabled' : 'enabled');\n}\n\nexport function log() {\n  if (typeof window === 'object') {\n    if (logDisabled_) {\n      return;\n    }\n    if (typeof console !== 'undefined' && typeof console.log === 'function') {\n      console.log.apply(console, arguments);\n    }\n  }\n}\n\n/**\n * Shows a deprecation warning suggesting the modern and spec-compatible API.\n */\nexport function deprecated(oldMethod, newMethod) {\n  if (!deprecationWarnings_) {\n    return;\n  }\n  console.warn(oldMethod + ' is deprecated, please use ' + newMethod +\n      ' instead.');\n}\n\n/**\n * Browser detector.\n *\n * @return {object} result containing browser and version\n *     properties.\n */\nexport function detectBrowser(window) {\n  const {navigator} = window;\n\n  // Returned result object.\n  const result = {browser: null, version: null};\n\n  // Fail early if it's not a browser\n  if (typeof window === 'undefined' || !window.navigator) {\n    result.browser = 'Not a browser.';\n    return result;\n  }\n\n  if (navigator.mozGetUserMedia) { // Firefox.\n    result.browser = 'firefox';\n    result.version = extractVersion(navigator.userAgent,\n        /Firefox\\/(\\d+)\\./, 1);\n  } else if (navigator.webkitGetUserMedia ||\n      (window.isSecureContext === false && window.webkitRTCPeerConnection &&\n       !window.RTCIceGatherer)) {\n    // Chrome, Chromium, Webview, Opera.\n    // Version matches Chrome/WebRTC version.\n    // Chrome 74 removed webkitGetUserMedia on http as well so we need the\n    // more complicated fallback to webkitRTCPeerConnection.\n    result.browser = 'chrome';\n    result.version = extractVersion(navigator.userAgent,\n        /Chrom(e|ium)\\/(\\d+)\\./, 2);\n  } else if (navigator.mediaDevices &&\n      navigator.userAgent.match(/Edge\\/(\\d+).(\\d+)$/)) { // Edge.\n    result.browser = 'edge';\n    result.version = extractVersion(navigator.userAgent,\n        /Edge\\/(\\d+).(\\d+)$/, 2);\n  } else if (window.RTCPeerConnection &&\n      navigator.userAgent.match(/AppleWebKit\\/(\\d+)\\./)) { // Safari.\n    result.browser = 'safari';\n    result.version = extractVersion(navigator.userAgent,\n        /AppleWebKit\\/(\\d+)\\./, 1);\n    result.supportsUnifiedPlan = window.RTCRtpTransceiver &&\n        'currentDirection' in window.RTCRtpTransceiver.prototype;\n  } else { // Default fallthrough: not supported.\n    result.browser = 'Not a supported browser.';\n    return result;\n  }\n\n  return result;\n}\n\n/**\n * Checks if something is an object.\n *\n * @param {*} val The something you want to check.\n * @return true if val is an object, false otherwise.\n */\nfunction isObject(val) {\n  return Object.prototype.toString.call(val) === '[object Object]';\n}\n\n/**\n * Remove all empty objects and undefined values\n * from a nested object -- an enhanced and vanilla version\n * of Lodash's `compact`.\n */\nexport function compactObject(data) {\n  if (!isObject(data)) {\n    return data;\n  }\n\n  return Object.keys(data).reduce(function(accumulator, key) {\n    const isObj = isObject(data[key]);\n    const value = isObj ? compactObject(data[key]) : data[key];\n    const isEmptyObject = isObj && !Object.keys(value).length;\n    if (value === undefined || isEmptyObject) {\n      return accumulator;\n    }\n    return Object.assign(accumulator, {[key]: value});\n  }, {});\n}\n\n/* iterates the stats graph recursively. */\nexport function walkStats(stats, base, resultSet) {\n  if (!base || resultSet.has(base.id)) {\n    return;\n  }\n  resultSet.set(base.id, base);\n  Object.keys(base).forEach(name => {\n    if (name.endsWith('Id')) {\n      walkStats(stats, stats.get(base[name]), resultSet);\n    } else if (name.endsWith('Ids')) {\n      base[name].forEach(id => {\n        walkStats(stats, stats.get(id), resultSet);\n      });\n    }\n  });\n}\n\n/* filter getStats for a sender/receiver track. */\nexport function filterStats(result, track, outbound) {\n  const streamStatsType = outbound ? 'outbound-rtp' : 'inbound-rtp';\n  const filteredResult = new Map();\n  if (track === null) {\n    return filteredResult;\n  }\n  const trackStats = [];\n  result.forEach(value => {\n    if (value.type === 'track' &&\n        value.trackIdentifier === track.id) {\n      trackStats.push(value);\n    }\n  });\n  trackStats.forEach(trackStat => {\n    result.forEach(stats => {\n      if (stats.type === streamStatsType && stats.trackId === trackStat.id) {\n        walkStats(result, stats, filteredResult);\n      }\n    });\n  });\n  return filteredResult;\n}\n\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\nimport * as utils from '../utils.js';\nconst logging = utils.log;\n\nexport function shimGetUserMedia(window) {\n  const navigator = window && window.navigator;\n\n  if (!navigator.mediaDevices) {\n    return;\n  }\n\n  const browserDetails = utils.detectBrowser(window);\n\n  const constraintsToChrome_ = function(c) {\n    if (typeof c !== 'object' || c.mandatory || c.optional) {\n      return c;\n    }\n    const cc = {};\n    Object.keys(c).forEach(key => {\n      if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n        return;\n      }\n      const r = (typeof c[key] === 'object') ? c[key] : {ideal: c[key]};\n      if (r.exact !== undefined && typeof r.exact === 'number') {\n        r.min = r.max = r.exact;\n      }\n      const oldname_ = function(prefix, name) {\n        if (prefix) {\n          return prefix + name.charAt(0).toUpperCase() + name.slice(1);\n        }\n        return (name === 'deviceId') ? 'sourceId' : name;\n      };\n      if (r.ideal !== undefined) {\n        cc.optional = cc.optional || [];\n        let oc = {};\n        if (typeof r.ideal === 'number') {\n          oc[oldname_('min', key)] = r.ideal;\n          cc.optional.push(oc);\n          oc = {};\n          oc[oldname_('max', key)] = r.ideal;\n          cc.optional.push(oc);\n        } else {\n          oc[oldname_('', key)] = r.ideal;\n          cc.optional.push(oc);\n        }\n      }\n      if (r.exact !== undefined && typeof r.exact !== 'number') {\n        cc.mandatory = cc.mandatory || {};\n        cc.mandatory[oldname_('', key)] = r.exact;\n      } else {\n        ['min', 'max'].forEach(mix => {\n          if (r[mix] !== undefined) {\n            cc.mandatory = cc.mandatory || {};\n            cc.mandatory[oldname_(mix, key)] = r[mix];\n          }\n        });\n      }\n    });\n    if (c.advanced) {\n      cc.optional = (cc.optional || []).concat(c.advanced);\n    }\n    return cc;\n  };\n\n  const shimConstraints_ = function(constraints, func) {\n    if (browserDetails.version >= 61) {\n      return func(constraints);\n    }\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (constraints && typeof constraints.audio === 'object') {\n      const remap = function(obj, a, b) {\n        if (a in obj && !(b in obj)) {\n          obj[b] = obj[a];\n          delete obj[a];\n        }\n      };\n      constraints = JSON.parse(JSON.stringify(constraints));\n      remap(constraints.audio, 'autoGainControl', 'googAutoGainControl');\n      remap(constraints.audio, 'noiseSuppression', 'googNoiseSuppression');\n      constraints.audio = constraintsToChrome_(constraints.audio);\n    }\n    if (constraints && typeof constraints.video === 'object') {\n      // Shim facingMode for mobile & surface pro.\n      let face = constraints.video.facingMode;\n      face = face && ((typeof face === 'object') ? face : {ideal: face});\n      const getSupportedFacingModeLies = browserDetails.version < 66;\n\n      if ((face && (face.exact === 'user' || face.exact === 'environment' ||\n                    face.ideal === 'user' || face.ideal === 'environment')) &&\n          !(navigator.mediaDevices.getSupportedConstraints &&\n            navigator.mediaDevices.getSupportedConstraints().facingMode &&\n            !getSupportedFacingModeLies)) {\n        delete constraints.video.facingMode;\n        let matches;\n        if (face.exact === 'environment' || face.ideal === 'environment') {\n          matches = ['back', 'rear'];\n        } else if (face.exact === 'user' || face.ideal === 'user') {\n          matches = ['front'];\n        }\n        if (matches) {\n          // Look for matches in label, or use last cam for back (typical).\n          return navigator.mediaDevices.enumerateDevices()\n          .then(devices => {\n            devices = devices.filter(d => d.kind === 'videoinput');\n            let dev = devices.find(d => matches.some(match =>\n              d.label.toLowerCase().includes(match)));\n            if (!dev && devices.length && matches.includes('back')) {\n              dev = devices[devices.length - 1]; // more likely the back cam\n            }\n            if (dev) {\n              constraints.video.deviceId = face.exact ? {exact: dev.deviceId} :\n                                                        {ideal: dev.deviceId};\n            }\n            constraints.video = constraintsToChrome_(constraints.video);\n            logging('chrome: ' + JSON.stringify(constraints));\n            return func(constraints);\n          });\n        }\n      }\n      constraints.video = constraintsToChrome_(constraints.video);\n    }\n    logging('chrome: ' + JSON.stringify(constraints));\n    return func(constraints);\n  };\n\n  const shimError_ = function(e) {\n    if (browserDetails.version >= 64) {\n      return e;\n    }\n    return {\n      name: {\n        PermissionDeniedError: 'NotAllowedError',\n        PermissionDismissedError: 'NotAllowedError',\n        InvalidStateError: 'NotAllowedError',\n        DevicesNotFoundError: 'NotFoundError',\n        ConstraintNotSatisfiedError: 'OverconstrainedError',\n        TrackStartError: 'NotReadableError',\n        MediaDeviceFailedDueToShutdown: 'NotAllowedError',\n        MediaDeviceKillSwitchOn: 'NotAllowedError',\n        TabCaptureError: 'AbortError',\n        ScreenCaptureError: 'AbortError',\n        DeviceCaptureError: 'AbortError'\n      }[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraint || e.constraintName,\n      toString() {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  };\n\n  const getUserMedia_ = function(constraints, onSuccess, onError) {\n    shimConstraints_(constraints, c => {\n      navigator.webkitGetUserMedia(c, onSuccess, e => {\n        if (onError) {\n          onError(shimError_(e));\n        }\n      });\n    });\n  };\n  navigator.getUserMedia = getUserMedia_.bind(navigator);\n\n  // Even though Chrome 45 has navigator.mediaDevices and a getUserMedia\n  // function which returns a Promise, it does not accept spec-style\n  // constraints.\n  if (navigator.mediaDevices.getUserMedia) {\n    const origGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(cs) {\n      return shimConstraints_(cs, c => origGetUserMedia(c).then(stream => {\n        if (c.audio && !stream.getAudioTracks().length ||\n            c.video && !stream.getVideoTracks().length) {\n          stream.getTracks().forEach(track => {\n            track.stop();\n          });\n          throw new DOMException('', 'NotFoundError');\n        }\n        return stream;\n      }, e => Promise.reject(shimError_(e))));\n    };\n  }\n}\n","/*\n *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\nexport function shimGetDisplayMedia(window, getSourceId) {\n  if (window.navigator.mediaDevices &&\n    'getDisplayMedia' in window.navigator.mediaDevices) {\n    return;\n  }\n  if (!(window.navigator.mediaDevices)) {\n    return;\n  }\n  // getSourceId is a function that returns a promise resolving with\n  // the sourceId of the screen/window/tab to be shared.\n  if (typeof getSourceId !== 'function') {\n    console.error('shimGetDisplayMedia: getSourceId argument is not ' +\n        'a function');\n    return;\n  }\n  window.navigator.mediaDevices.getDisplayMedia =\n    function getDisplayMedia(constraints) {\n      return getSourceId(constraints)\n        .then(sourceId => {\n          const widthSpecified = constraints.video && constraints.video.width;\n          const heightSpecified = constraints.video &&\n            constraints.video.height;\n          const frameRateSpecified = constraints.video &&\n            constraints.video.frameRate;\n          constraints.video = {\n            mandatory: {\n              chromeMediaSource: 'desktop',\n              chromeMediaSourceId: sourceId,\n              maxFrameRate: frameRateSpecified || 3\n            }\n          };\n          if (widthSpecified) {\n            constraints.video.mandatory.maxWidth = widthSpecified;\n          }\n          if (heightSpecified) {\n            constraints.video.mandatory.maxHeight = heightSpecified;\n          }\n          return window.navigator.mediaDevices.getUserMedia(constraints);\n        });\n    };\n}\n","\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\nimport * as utils from '../utils.js';\n\nexport {shimGetUserMedia} from './getusermedia';\nexport {shimGetDisplayMedia} from './getdisplaymedia';\n\nexport function shimMediaStream(window) {\n  window.MediaStream = window.MediaStream || window.webkitMediaStream;\n}\n\nexport function shimOnTrack(window) {\n  if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n      window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n      get() {\n        return this._ontrack;\n      },\n      set(f) {\n        if (this._ontrack) {\n          this.removeEventListener('track', this._ontrack);\n        }\n        this.addEventListener('track', this._ontrack = f);\n      },\n      enumerable: true,\n      configurable: true\n    });\n    const origSetRemoteDescription =\n        window.RTCPeerConnection.prototype.setRemoteDescription;\n    window.RTCPeerConnection.prototype.setRemoteDescription =\n      function setRemoteDescription() {\n        if (!this._ontrackpoly) {\n          this._ontrackpoly = (e) => {\n            // onaddstream does not fire when a track is added to an existing\n            // stream. But stream.onaddtrack is implemented so we use that.\n            e.stream.addEventListener('addtrack', te => {\n              let receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = this.getReceivers()\n                  .find(r => r.track && r.track.id === te.track.id);\n              } else {\n                receiver = {track: te.track};\n              }\n\n              const event = new Event('track');\n              event.track = te.track;\n              event.receiver = receiver;\n              event.transceiver = {receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            });\n            e.stream.getTracks().forEach(track => {\n              let receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = this.getReceivers()\n                  .find(r => r.track && r.track.id === track.id);\n              } else {\n                receiver = {track};\n              }\n              const event = new Event('track');\n              event.track = track;\n              event.receiver = receiver;\n              event.transceiver = {receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            });\n          };\n          this.addEventListener('addstream', this._ontrackpoly);\n        }\n        return origSetRemoteDescription.apply(this, arguments);\n      };\n  } else {\n    // even if RTCRtpTransceiver is in window, it is only used and\n    // emitted in unified-plan. Unfortunately this means we need\n    // to unconditionally wrap the event.\n    utils.wrapPeerConnectionEvent(window, 'track', e => {\n      if (!e.transceiver) {\n        Object.defineProperty(e, 'transceiver',\n          {value: {receiver: e.receiver}});\n      }\n      return e;\n    });\n  }\n}\n\nexport function shimGetSendersWithDtmf(window) {\n  // Overrides addTrack/removeTrack, depends on shimAddTrackRemoveTrack.\n  if (typeof window === 'object' && window.RTCPeerConnection &&\n      !('getSenders' in window.RTCPeerConnection.prototype) &&\n      'createDTMFSender' in window.RTCPeerConnection.prototype) {\n    const shimSenderWithDtmf = function(pc, track) {\n      return {\n        track,\n        get dtmf() {\n          if (this._dtmf === undefined) {\n            if (track.kind === 'audio') {\n              this._dtmf = pc.createDTMFSender(track);\n            } else {\n              this._dtmf = null;\n            }\n          }\n          return this._dtmf;\n        },\n        _pc: pc\n      };\n    };\n\n    // augment addTrack when getSenders is not available.\n    if (!window.RTCPeerConnection.prototype.getSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n        this._senders = this._senders || [];\n        return this._senders.slice(); // return a copy of the internal state.\n      };\n      const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n      window.RTCPeerConnection.prototype.addTrack =\n        function addTrack(track, stream) {\n          let sender = origAddTrack.apply(this, arguments);\n          if (!sender) {\n            sender = shimSenderWithDtmf(this, track);\n            this._senders.push(sender);\n          }\n          return sender;\n        };\n\n      const origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n      window.RTCPeerConnection.prototype.removeTrack =\n        function removeTrack(sender) {\n          origRemoveTrack.apply(this, arguments);\n          const idx = this._senders.indexOf(sender);\n          if (idx !== -1) {\n            this._senders.splice(idx, 1);\n          }\n        };\n    }\n    const origAddStream = window.RTCPeerConnection.prototype.addStream;\n    window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n      this._senders = this._senders || [];\n      origAddStream.apply(this, [stream]);\n      stream.getTracks().forEach(track => {\n        this._senders.push(shimSenderWithDtmf(this, track));\n      });\n    };\n\n    const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n    window.RTCPeerConnection.prototype.removeStream =\n      function removeStream(stream) {\n        this._senders = this._senders || [];\n        origRemoveStream.apply(this, [stream]);\n\n        stream.getTracks().forEach(track => {\n          const sender = this._senders.find(s => s.track === track);\n          if (sender) { // remove sender\n            this._senders.splice(this._senders.indexOf(sender), 1);\n          }\n        });\n      };\n  } else if (typeof window === 'object' && window.RTCPeerConnection &&\n             'getSenders' in window.RTCPeerConnection.prototype &&\n             'createDTMFSender' in window.RTCPeerConnection.prototype &&\n             window.RTCRtpSender &&\n             !('dtmf' in window.RTCRtpSender.prototype)) {\n    const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n      const senders = origGetSenders.apply(this, []);\n      senders.forEach(sender => sender._pc = this);\n      return senders;\n    };\n\n    Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n      get() {\n        if (this._dtmf === undefined) {\n          if (this.track.kind === 'audio') {\n            this._dtmf = this._pc.createDTMFSender(this.track);\n          } else {\n            this._dtmf = null;\n          }\n        }\n        return this._dtmf;\n      }\n    });\n  }\n}\n\nexport function shimGetStats(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n\n  const origGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    const [selector, onSucc, onErr] = arguments;\n\n    // If selector is a function then we are in the old style stats so just\n    // pass back the original getStats format to avoid breaking old users.\n    if (arguments.length > 0 && typeof selector === 'function') {\n      return origGetStats.apply(this, arguments);\n    }\n\n    // When spec-style getStats is supported, return those when called with\n    // either no arguments or the selector argument is null.\n    if (origGetStats.length === 0 && (arguments.length === 0 ||\n        typeof selector !== 'function')) {\n      return origGetStats.apply(this, []);\n    }\n\n    const fixChromeStats_ = function(response) {\n      const standardReport = {};\n      const reports = response.result();\n      reports.forEach(report => {\n        const standardStats = {\n          id: report.id,\n          timestamp: report.timestamp,\n          type: {\n            localcandidate: 'local-candidate',\n            remotecandidate: 'remote-candidate'\n          }[report.type] || report.type\n        };\n        report.names().forEach(name => {\n          standardStats[name] = report.stat(name);\n        });\n        standardReport[standardStats.id] = standardStats;\n      });\n\n      return standardReport;\n    };\n\n    // shim getStats with maplike support\n    const makeMapStats = function(stats) {\n      return new Map(Object.keys(stats).map(key => [key, stats[key]]));\n    };\n\n    if (arguments.length >= 2) {\n      const successCallbackWrapper_ = function(response) {\n        onSucc(makeMapStats(fixChromeStats_(response)));\n      };\n\n      return origGetStats.apply(this, [successCallbackWrapper_,\n        selector]);\n    }\n\n    // promise-support\n    return new Promise((resolve, reject) => {\n      origGetStats.apply(this, [\n        function(response) {\n          resolve(makeMapStats(fixChromeStats_(response)));\n        }, reject]);\n    }).then(onSucc, onErr);\n  };\n}\n\nexport function shimSenderReceiverGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender && window.RTCRtpReceiver)) {\n    return;\n  }\n\n  // shim sender stats.\n  if (!('getStats' in window.RTCRtpSender.prototype)) {\n    const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n    if (origGetSenders) {\n      window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n        const senders = origGetSenders.apply(this, []);\n        senders.forEach(sender => sender._pc = this);\n        return senders;\n      };\n    }\n\n    const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n    if (origAddTrack) {\n      window.RTCPeerConnection.prototype.addTrack = function addTrack() {\n        const sender = origAddTrack.apply(this, arguments);\n        sender._pc = this;\n        return sender;\n      };\n    }\n    window.RTCRtpSender.prototype.getStats = function getStats() {\n      const sender = this;\n      return this._pc.getStats().then(result =>\n        /* Note: this will include stats of all senders that\n         *   send a track with the same id as sender.track as\n         *   it is not possible to identify the RTCRtpSender.\n         */\n        utils.filterStats(result, sender.track, true));\n    };\n  }\n\n  // shim receiver stats.\n  if (!('getStats' in window.RTCRtpReceiver.prototype)) {\n    const origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n    if (origGetReceivers) {\n      window.RTCPeerConnection.prototype.getReceivers =\n        function getReceivers() {\n          const receivers = origGetReceivers.apply(this, []);\n          receivers.forEach(receiver => receiver._pc = this);\n          return receivers;\n        };\n    }\n    utils.wrapPeerConnectionEvent(window, 'track', e => {\n      e.receiver._pc = e.srcElement;\n      return e;\n    });\n    window.RTCRtpReceiver.prototype.getStats = function getStats() {\n      const receiver = this;\n      return this._pc.getStats().then(result =>\n        utils.filterStats(result, receiver.track, false));\n    };\n  }\n\n  if (!('getStats' in window.RTCRtpSender.prototype &&\n      'getStats' in window.RTCRtpReceiver.prototype)) {\n    return;\n  }\n\n  // shim RTCPeerConnection.getStats(track).\n  const origGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    if (arguments.length > 0 &&\n        arguments[0] instanceof window.MediaStreamTrack) {\n      const track = arguments[0];\n      let sender;\n      let receiver;\n      let err;\n      this.getSenders().forEach(s => {\n        if (s.track === track) {\n          if (sender) {\n            err = true;\n          } else {\n            sender = s;\n          }\n        }\n      });\n      this.getReceivers().forEach(r => {\n        if (r.track === track) {\n          if (receiver) {\n            err = true;\n          } else {\n            receiver = r;\n          }\n        }\n        return r.track === track;\n      });\n      if (err || (sender && receiver)) {\n        return Promise.reject(new DOMException(\n          'There are more than one sender or receiver for the track.',\n          'InvalidAccessError'));\n      } else if (sender) {\n        return sender.getStats();\n      } else if (receiver) {\n        return receiver.getStats();\n      }\n      return Promise.reject(new DOMException(\n        'There is no sender or receiver for the track.',\n        'InvalidAccessError'));\n    }\n    return origGetStats.apply(this, arguments);\n  };\n}\n\nexport function shimAddTrackRemoveTrackWithNative(window) {\n  // shim addTrack/removeTrack with native variants in order to make\n  // the interactions with legacy getLocalStreams behave as in other browsers.\n  // Keeps a mapping stream.id => [stream, rtpsenders...]\n  window.RTCPeerConnection.prototype.getLocalStreams =\n    function getLocalStreams() {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      return Object.keys(this._shimmedLocalStreams)\n        .map(streamId => this._shimmedLocalStreams[streamId][0]);\n    };\n\n  const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n  window.RTCPeerConnection.prototype.addTrack =\n    function addTrack(track, stream) {\n      if (!stream) {\n        return origAddTrack.apply(this, arguments);\n      }\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n      const sender = origAddTrack.apply(this, arguments);\n      if (!this._shimmedLocalStreams[stream.id]) {\n        this._shimmedLocalStreams[stream.id] = [stream, sender];\n      } else if (this._shimmedLocalStreams[stream.id].indexOf(sender) === -1) {\n        this._shimmedLocalStreams[stream.id].push(sender);\n      }\n      return sender;\n    };\n\n  const origAddStream = window.RTCPeerConnection.prototype.addStream;\n  window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n    this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n\n    stream.getTracks().forEach(track => {\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n            'InvalidAccessError');\n      }\n    });\n    const existingSenders = this.getSenders();\n    origAddStream.apply(this, arguments);\n    const newSenders = this.getSenders()\n      .filter(newSender => existingSenders.indexOf(newSender) === -1);\n    this._shimmedLocalStreams[stream.id] = [stream].concat(newSenders);\n  };\n\n  const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      delete this._shimmedLocalStreams[stream.id];\n      return origRemoveStream.apply(this, arguments);\n    };\n\n  const origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n  window.RTCPeerConnection.prototype.removeTrack =\n    function removeTrack(sender) {\n      this._shimmedLocalStreams = this._shimmedLocalStreams || {};\n      if (sender) {\n        Object.keys(this._shimmedLocalStreams).forEach(streamId => {\n          const idx = this._shimmedLocalStreams[streamId].indexOf(sender);\n          if (idx !== -1) {\n            this._shimmedLocalStreams[streamId].splice(idx, 1);\n          }\n          if (this._shimmedLocalStreams[streamId].length === 1) {\n            delete this._shimmedLocalStreams[streamId];\n          }\n        });\n      }\n      return origRemoveTrack.apply(this, arguments);\n    };\n}\n\nexport function shimAddTrackRemoveTrack(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  const browserDetails = utils.detectBrowser(window);\n  // shim addTrack and removeTrack.\n  if (window.RTCPeerConnection.prototype.addTrack &&\n      browserDetails.version >= 65) {\n    return shimAddTrackRemoveTrackWithNative(window);\n  }\n\n  // also shim pc.getLocalStreams when addTrack is shimmed\n  // to return the original streams.\n  const origGetLocalStreams = window.RTCPeerConnection.prototype\n      .getLocalStreams;\n  window.RTCPeerConnection.prototype.getLocalStreams =\n    function getLocalStreams() {\n      const nativeStreams = origGetLocalStreams.apply(this);\n      this._reverseStreams = this._reverseStreams || {};\n      return nativeStreams.map(stream => this._reverseStreams[stream.id]);\n    };\n\n  const origAddStream = window.RTCPeerConnection.prototype.addStream;\n  window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n    this._streams = this._streams || {};\n    this._reverseStreams = this._reverseStreams || {};\n\n    stream.getTracks().forEach(track => {\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n            'InvalidAccessError');\n      }\n    });\n    // Add identity mapping for consistency with addTrack.\n    // Unless this is being used with a stream from addTrack.\n    if (!this._reverseStreams[stream.id]) {\n      const newStream = new window.MediaStream(stream.getTracks());\n      this._streams[stream.id] = newStream;\n      this._reverseStreams[newStream.id] = stream;\n      stream = newStream;\n    }\n    origAddStream.apply(this, [stream]);\n  };\n\n  const origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      this._streams = this._streams || {};\n      this._reverseStreams = this._reverseStreams || {};\n\n      origRemoveStream.apply(this, [(this._streams[stream.id] || stream)]);\n      delete this._reverseStreams[(this._streams[stream.id] ?\n          this._streams[stream.id].id : stream.id)];\n      delete this._streams[stream.id];\n    };\n\n  window.RTCPeerConnection.prototype.addTrack =\n    function addTrack(track, stream) {\n      if (this.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      const streams = [].slice.call(arguments, 1);\n      if (streams.length !== 1 ||\n          !streams[0].getTracks().find(t => t === track)) {\n        // this is not fully correct but all we can manage without\n        // [[associated MediaStreams]] internal slot.\n        throw new DOMException(\n          'The adapter.js addTrack polyfill only supports a single ' +\n          ' stream which is associated with the specified track.',\n          'NotSupportedError');\n      }\n\n      const alreadyExists = this.getSenders().find(s => s.track === track);\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n            'InvalidAccessError');\n      }\n\n      this._streams = this._streams || {};\n      this._reverseStreams = this._reverseStreams || {};\n      const oldStream = this._streams[stream.id];\n      if (oldStream) {\n        // this is using odd Chrome behaviour, use with caution:\n        // https://bugs.chromium.org/p/webrtc/issues/detail?id=7815\n        // Note: we rely on the high-level addTrack/dtmf shim to\n        // create the sender with a dtmf sender.\n        oldStream.addTrack(track);\n\n        // Trigger ONN async.\n        Promise.resolve().then(() => {\n          this.dispatchEvent(new Event('negotiationneeded'));\n        });\n      } else {\n        const newStream = new window.MediaStream([track]);\n        this._streams[stream.id] = newStream;\n        this._reverseStreams[newStream.id] = stream;\n        this.addStream(newStream);\n      }\n      return this.getSenders().find(s => s.track === track);\n    };\n\n  // replace the internal stream id with the external one and\n  // vice versa.\n  function replaceInternalStreamId(pc, description) {\n    let sdp = description.sdp;\n    Object.keys(pc._reverseStreams || []).forEach(internalId => {\n      const externalStream = pc._reverseStreams[internalId];\n      const internalStream = pc._streams[externalStream.id];\n      sdp = sdp.replace(new RegExp(internalStream.id, 'g'),\n          externalStream.id);\n    });\n    return new RTCSessionDescription({\n      type: description.type,\n      sdp\n    });\n  }\n  function replaceExternalStreamId(pc, description) {\n    let sdp = description.sdp;\n    Object.keys(pc._reverseStreams || []).forEach(internalId => {\n      const externalStream = pc._reverseStreams[internalId];\n      const internalStream = pc._streams[externalStream.id];\n      sdp = sdp.replace(new RegExp(externalStream.id, 'g'),\n          internalStream.id);\n    });\n    return new RTCSessionDescription({\n      type: description.type,\n      sdp\n    });\n  }\n  ['createOffer', 'createAnswer'].forEach(function(method) {\n    const nativeMethod = window.RTCPeerConnection.prototype[method];\n    const methodObj = {[method]() {\n      const args = arguments;\n      const isLegacyCall = arguments.length &&\n          typeof arguments[0] === 'function';\n      if (isLegacyCall) {\n        return nativeMethod.apply(this, [\n          (description) => {\n            const desc = replaceInternalStreamId(this, description);\n            args[0].apply(null, [desc]);\n          },\n          (err) => {\n            if (args[1]) {\n              args[1].apply(null, err);\n            }\n          }, arguments[2]\n        ]);\n      }\n      return nativeMethod.apply(this, arguments)\n      .then(description => replaceInternalStreamId(this, description));\n    }};\n    window.RTCPeerConnection.prototype[method] = methodObj[method];\n  });\n\n  const origSetLocalDescription =\n      window.RTCPeerConnection.prototype.setLocalDescription;\n  window.RTCPeerConnection.prototype.setLocalDescription =\n    function setLocalDescription() {\n      if (!arguments.length || !arguments[0].type) {\n        return origSetLocalDescription.apply(this, arguments);\n      }\n      arguments[0] = replaceExternalStreamId(this, arguments[0]);\n      return origSetLocalDescription.apply(this, arguments);\n    };\n\n  // TODO: mangle getStats: https://w3c.github.io/webrtc-stats/#dom-rtcmediastreamstats-streamidentifier\n\n  const origLocalDescription = Object.getOwnPropertyDescriptor(\n      window.RTCPeerConnection.prototype, 'localDescription');\n  Object.defineProperty(window.RTCPeerConnection.prototype,\n      'localDescription', {\n        get() {\n          const description = origLocalDescription.get.apply(this);\n          if (description.type === '') {\n            return description;\n          }\n          return replaceInternalStreamId(this, description);\n        }\n      });\n\n  window.RTCPeerConnection.prototype.removeTrack =\n    function removeTrack(sender) {\n      if (this.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      // We can not yet check for sender instanceof RTCRtpSender\n      // since we shim RTPSender. So we check if sender._pc is set.\n      if (!sender._pc) {\n        throw new DOMException('Argument 1 of RTCPeerConnection.removeTrack ' +\n            'does not implement interface RTCRtpSender.', 'TypeError');\n      }\n      const isLocal = sender._pc === this;\n      if (!isLocal) {\n        throw new DOMException('Sender was not created by this connection.',\n            'InvalidAccessError');\n      }\n\n      // Search for the native stream the senders track belongs to.\n      this._streams = this._streams || {};\n      let stream;\n      Object.keys(this._streams).forEach(streamid => {\n        const hasTrack = this._streams[streamid].getTracks()\n          .find(track => sender.track === track);\n        if (hasTrack) {\n          stream = this._streams[streamid];\n        }\n      });\n\n      if (stream) {\n        if (stream.getTracks().length === 1) {\n          // if this is the last track of the stream, remove the stream. This\n          // takes care of any shimmed _senders.\n          this.removeStream(this._reverseStreams[stream.id]);\n        } else {\n          // relying on the same odd chrome behaviour as above.\n          stream.removeTrack(sender.track);\n        }\n        this.dispatchEvent(new Event('negotiationneeded'));\n      }\n    };\n}\n\nexport function shimPeerConnection(window) {\n  const browserDetails = utils.detectBrowser(window);\n\n  if (!window.RTCPeerConnection && window.webkitRTCPeerConnection) {\n    // very basic support for old versions.\n    window.RTCPeerConnection = window.webkitRTCPeerConnection;\n  }\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n\n  // shim implicit creation of RTCSessionDescription/RTCIceCandidate\n  if (browserDetails.version < 53) {\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          const nativeMethod = window.RTCPeerConnection.prototype[method];\n          const methodObj = {[method]() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                window.RTCIceCandidate :\n                window.RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          }};\n          window.RTCPeerConnection.prototype[method] = methodObj[method];\n        });\n  }\n\n  // support for addIceCandidate(null or undefined)\n  const nativeAddIceCandidate =\n      window.RTCPeerConnection.prototype.addIceCandidate;\n  window.RTCPeerConnection.prototype.addIceCandidate =\n    function addIceCandidate() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      // Firefox 68+ emits and processes {candidate: \"\", ...}, ignore\n      // in older versions. Native support planned for Chrome M77.\n      if (browserDetails.version < 78 &&\n        arguments[0] && arguments[0].candidate === '') {\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n}\n\nexport function fixNegotiationNeeded(window) {\n  utils.wrapPeerConnectionEvent(window, 'negotiationneeded', e => {\n    const pc = e.target;\n    if (pc.signalingState !== 'stable') {\n      return;\n    }\n    return e;\n  });\n}\n","/*\n *  Copyright (c) 2018 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\n// Edge does not like\n// 1) stun: filtered after 14393 unless ?transport=udp is present\n// 2) turn: that does not have all of turn:host:port?transport=udp\n// 3) turn: with ipv6 addresses\n// 4) turn: occurring muliple times\nexport function filterIceServers(iceServers, edgeVersion) {\n  let hasTurn = false;\n  iceServers = JSON.parse(JSON.stringify(iceServers));\n  return iceServers.filter(server => {\n    if (server && (server.urls || server.url)) {\n      var urls = server.urls || server.url;\n      if (server.url && !server.urls) {\n        utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n      }\n      const isString = typeof urls === 'string';\n      if (isString) {\n        urls = [urls];\n      }\n      urls = urls.filter(url => {\n        // filter STUN unconditionally.\n        if (url.indexOf('stun:') === 0) {\n          return false;\n        }\n\n        const validTurn = url.startsWith('turn') &&\n            !url.startsWith('turn:[') &&\n            url.includes('transport=udp');\n        if (validTurn && !hasTurn) {\n          hasTurn = true;\n          return true;\n        }\n        return validTurn && !hasTurn;\n      });\n\n      delete server.url;\n      server.urls = isString ? urls[0] : urls;\n      return !!urls.length;\n    }\n  });\n}\n","/* eslint-env node */\n'use strict';\n\n// SDP helpers.\nvar SDPUtils = {};\n\n// Generate an alphanumeric identifier for cname or mids.\n// TODO: use UUIDs instead? https://gist.github.com/jed/982883\nSDPUtils.generateIdentifier = function() {\n  return Math.random().toString(36).substr(2, 10);\n};\n\n// The RTCP CNAME used by all peerconnections from the same JS.\nSDPUtils.localCName = SDPUtils.generateIdentifier();\n\n// Splits SDP into lines, dealing with both CRLF and LF.\nSDPUtils.splitLines = function(blob) {\n  return blob.trim().split('\\n').map(function(line) {\n    return line.trim();\n  });\n};\n// Splits SDP into sessionpart and mediasections. Ensures CRLF.\nSDPUtils.splitSections = function(blob) {\n  var parts = blob.split('\\nm=');\n  return parts.map(function(part, index) {\n    return (index > 0 ? 'm=' + part : part).trim() + '\\r\\n';\n  });\n};\n\n// returns the session description.\nSDPUtils.getDescription = function(blob) {\n  var sections = SDPUtils.splitSections(blob);\n  return sections && sections[0];\n};\n\n// returns the individual media sections.\nSDPUtils.getMediaSections = function(blob) {\n  var sections = SDPUtils.splitSections(blob);\n  sections.shift();\n  return sections;\n};\n\n// Returns lines that start with a certain prefix.\nSDPUtils.matchPrefix = function(blob, prefix) {\n  return SDPUtils.splitLines(blob).filter(function(line) {\n    return line.indexOf(prefix) === 0;\n  });\n};\n\n// Parses an ICE candidate line. Sample input:\n// candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8\n// rport 55996\"\nSDPUtils.parseCandidate = function(line) {\n  var parts;\n  // Parse both variants.\n  if (line.indexOf('a=candidate:') === 0) {\n    parts = line.substring(12).split(' ');\n  } else {\n    parts = line.substring(10).split(' ');\n  }\n\n  var candidate = {\n    foundation: parts[0],\n    component: parseInt(parts[1], 10),\n    protocol: parts[2].toLowerCase(),\n    priority: parseInt(parts[3], 10),\n    ip: parts[4],\n    address: parts[4], // address is an alias for ip.\n    port: parseInt(parts[5], 10),\n    // skip parts[6] == 'typ'\n    type: parts[7]\n  };\n\n  for (var i = 8; i < parts.length; i += 2) {\n    switch (parts[i]) {\n      case 'raddr':\n        candidate.relatedAddress = parts[i + 1];\n        break;\n      case 'rport':\n        candidate.relatedPort = parseInt(parts[i + 1], 10);\n        break;\n      case 'tcptype':\n        candidate.tcpType = parts[i + 1];\n        break;\n      case 'ufrag':\n        candidate.ufrag = parts[i + 1]; // for backward compability.\n        candidate.usernameFragment = parts[i + 1];\n        break;\n      default: // extension handling, in particular ufrag\n        candidate[parts[i]] = parts[i + 1];\n        break;\n    }\n  }\n  return candidate;\n};\n\n// Translates a candidate object into SDP candidate attribute.\nSDPUtils.writeCandidate = function(candidate) {\n  var sdp = [];\n  sdp.push(candidate.foundation);\n  sdp.push(candidate.component);\n  sdp.push(candidate.protocol.toUpperCase());\n  sdp.push(candidate.priority);\n  sdp.push(candidate.address || candidate.ip);\n  sdp.push(candidate.port);\n\n  var type = candidate.type;\n  sdp.push('typ');\n  sdp.push(type);\n  if (type !== 'host' && candidate.relatedAddress &&\n      candidate.relatedPort) {\n    sdp.push('raddr');\n    sdp.push(candidate.relatedAddress);\n    sdp.push('rport');\n    sdp.push(candidate.relatedPort);\n  }\n  if (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {\n    sdp.push('tcptype');\n    sdp.push(candidate.tcpType);\n  }\n  if (candidate.usernameFragment || candidate.ufrag) {\n    sdp.push('ufrag');\n    sdp.push(candidate.usernameFragment || candidate.ufrag);\n  }\n  return 'candidate:' + sdp.join(' ');\n};\n\n// Parses an ice-options line, returns an array of option tags.\n// a=ice-options:foo bar\nSDPUtils.parseIceOptions = function(line) {\n  return line.substr(14).split(' ');\n};\n\n// Parses an rtpmap line, returns RTCRtpCoddecParameters. Sample input:\n// a=rtpmap:111 opus/48000/2\nSDPUtils.parseRtpMap = function(line) {\n  var parts = line.substr(9).split(' ');\n  var parsed = {\n    payloadType: parseInt(parts.shift(), 10) // was: id\n  };\n\n  parts = parts[0].split('/');\n\n  parsed.name = parts[0];\n  parsed.clockRate = parseInt(parts[1], 10); // was: clockrate\n  parsed.channels = parts.length === 3 ? parseInt(parts[2], 10) : 1;\n  // legacy alias, got renamed back to channels in ORTC.\n  parsed.numChannels = parsed.channels;\n  return parsed;\n};\n\n// Generate an a=rtpmap line from RTCRtpCodecCapability or\n// RTCRtpCodecParameters.\nSDPUtils.writeRtpMap = function(codec) {\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  var channels = codec.channels || codec.numChannels || 1;\n  return 'a=rtpmap:' + pt + ' ' + codec.name + '/' + codec.clockRate +\n      (channels !== 1 ? '/' + channels : '') + '\\r\\n';\n};\n\n// Parses an a=extmap line (headerextension from RFC 5285). Sample input:\n// a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\n// a=extmap:2/sendonly urn:ietf:params:rtp-hdrext:toffset\nSDPUtils.parseExtmap = function(line) {\n  var parts = line.substr(9).split(' ');\n  return {\n    id: parseInt(parts[0], 10),\n    direction: parts[0].indexOf('/') > 0 ? parts[0].split('/')[1] : 'sendrecv',\n    uri: parts[1]\n  };\n};\n\n// Generates a=extmap line from RTCRtpHeaderExtensionParameters or\n// RTCRtpHeaderExtension.\nSDPUtils.writeExtmap = function(headerExtension) {\n  return 'a=extmap:' + (headerExtension.id || headerExtension.preferredId) +\n      (headerExtension.direction && headerExtension.direction !== 'sendrecv'\n        ? '/' + headerExtension.direction\n        : '') +\n      ' ' + headerExtension.uri + '\\r\\n';\n};\n\n// Parses an ftmp line, returns dictionary. Sample input:\n// a=fmtp:96 vbr=on;cng=on\n// Also deals with vbr=on; cng=on\nSDPUtils.parseFmtp = function(line) {\n  var parsed = {};\n  var kv;\n  var parts = line.substr(line.indexOf(' ') + 1).split(';');\n  for (var j = 0; j < parts.length; j++) {\n    kv = parts[j].trim().split('=');\n    parsed[kv[0].trim()] = kv[1];\n  }\n  return parsed;\n};\n\n// Generates an a=ftmp line from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeFmtp = function(codec) {\n  var line = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.parameters && Object.keys(codec.parameters).length) {\n    var params = [];\n    Object.keys(codec.parameters).forEach(function(param) {\n      if (codec.parameters[param]) {\n        params.push(param + '=' + codec.parameters[param]);\n      } else {\n        params.push(param);\n      }\n    });\n    line += 'a=fmtp:' + pt + ' ' + params.join(';') + '\\r\\n';\n  }\n  return line;\n};\n\n// Parses an rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:\n// a=rtcp-fb:98 nack rpsi\nSDPUtils.parseRtcpFb = function(line) {\n  var parts = line.substr(line.indexOf(' ') + 1).split(' ');\n  return {\n    type: parts.shift(),\n    parameter: parts.join(' ')\n  };\n};\n// Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeRtcpFb = function(codec) {\n  var lines = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.rtcpFeedback && codec.rtcpFeedback.length) {\n    // FIXME: special handling for trr-int?\n    codec.rtcpFeedback.forEach(function(fb) {\n      lines += 'a=rtcp-fb:' + pt + ' ' + fb.type +\n      (fb.parameter && fb.parameter.length ? ' ' + fb.parameter : '') +\n          '\\r\\n';\n    });\n  }\n  return lines;\n};\n\n// Parses an RFC 5576 ssrc media attribute. Sample input:\n// a=ssrc:3735928559 cname:something\nSDPUtils.parseSsrcMedia = function(line) {\n  var sp = line.indexOf(' ');\n  var parts = {\n    ssrc: parseInt(line.substr(7, sp - 7), 10)\n  };\n  var colon = line.indexOf(':', sp);\n  if (colon > -1) {\n    parts.attribute = line.substr(sp + 1, colon - sp - 1);\n    parts.value = line.substr(colon + 1);\n  } else {\n    parts.attribute = line.substr(sp + 1);\n  }\n  return parts;\n};\n\nSDPUtils.parseSsrcGroup = function(line) {\n  var parts = line.substr(13).split(' ');\n  return {\n    semantics: parts.shift(),\n    ssrcs: parts.map(function(ssrc) {\n      return parseInt(ssrc, 10);\n    })\n  };\n};\n\n// Extracts the MID (RFC 5888) from a media section.\n// returns the MID or undefined if no mid line was found.\nSDPUtils.getMid = function(mediaSection) {\n  var mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:')[0];\n  if (mid) {\n    return mid.substr(6);\n  }\n};\n\nSDPUtils.parseFingerprint = function(line) {\n  var parts = line.substr(14).split(' ');\n  return {\n    algorithm: parts[0].toLowerCase(), // algorithm is case-sensitive in Edge.\n    value: parts[1]\n  };\n};\n\n// Extracts DTLS parameters from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the fingerprint line as input. See also getIceParameters.\nSDPUtils.getDtlsParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n    'a=fingerprint:');\n  // Note: a=setup line is ignored since we use the 'auto' role.\n  // Note2: 'algorithm' is not case sensitive except in Edge.\n  return {\n    role: 'auto',\n    fingerprints: lines.map(SDPUtils.parseFingerprint)\n  };\n};\n\n// Serializes DTLS parameters to SDP.\nSDPUtils.writeDtlsParameters = function(params, setupType) {\n  var sdp = 'a=setup:' + setupType + '\\r\\n';\n  params.fingerprints.forEach(function(fp) {\n    sdp += 'a=fingerprint:' + fp.algorithm + ' ' + fp.value + '\\r\\n';\n  });\n  return sdp;\n};\n// Parses ICE information from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the ice-ufrag and ice-pwd lines as input.\nSDPUtils.getIceParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  // Search in session part, too.\n  lines = lines.concat(SDPUtils.splitLines(sessionpart));\n  var iceParameters = {\n    usernameFragment: lines.filter(function(line) {\n      return line.indexOf('a=ice-ufrag:') === 0;\n    })[0].substr(12),\n    password: lines.filter(function(line) {\n      return line.indexOf('a=ice-pwd:') === 0;\n    })[0].substr(10)\n  };\n  return iceParameters;\n};\n\n// Serializes ICE parameters to SDP.\nSDPUtils.writeIceParameters = function(params) {\n  return 'a=ice-ufrag:' + params.usernameFragment + '\\r\\n' +\n      'a=ice-pwd:' + params.password + '\\r\\n';\n};\n\n// Parses the SDP media section and returns RTCRtpParameters.\nSDPUtils.parseRtpParameters = function(mediaSection) {\n  var description = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: [],\n    rtcp: []\n  };\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  for (var i = 3; i < mline.length; i++) { // find all codecs from mline[3..]\n    var pt = mline[i];\n    var rtpmapline = SDPUtils.matchPrefix(\n      mediaSection, 'a=rtpmap:' + pt + ' ')[0];\n    if (rtpmapline) {\n      var codec = SDPUtils.parseRtpMap(rtpmapline);\n      var fmtps = SDPUtils.matchPrefix(\n        mediaSection, 'a=fmtp:' + pt + ' ');\n      // Only the first a=fmtp:<pt> is considered.\n      codec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};\n      codec.rtcpFeedback = SDPUtils.matchPrefix(\n        mediaSection, 'a=rtcp-fb:' + pt + ' ')\n        .map(SDPUtils.parseRtcpFb);\n      description.codecs.push(codec);\n      // parse FEC mechanisms from rtpmap lines.\n      switch (codec.name.toUpperCase()) {\n        case 'RED':\n        case 'ULPFEC':\n          description.fecMechanisms.push(codec.name.toUpperCase());\n          break;\n        default: // only RED and ULPFEC are recognized as FEC mechanisms.\n          break;\n      }\n    }\n  }\n  SDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach(function(line) {\n    description.headerExtensions.push(SDPUtils.parseExtmap(line));\n  });\n  // FIXME: parse rtcp.\n  return description;\n};\n\n// Generates parts of the SDP media section describing the capabilities /\n// parameters.\nSDPUtils.writeRtpDescription = function(kind, caps) {\n  var sdp = '';\n\n  // Build the mline.\n  sdp += 'm=' + kind + ' ';\n  sdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.\n  sdp += ' UDP/TLS/RTP/SAVPF ';\n  sdp += caps.codecs.map(function(codec) {\n    if (codec.preferredPayloadType !== undefined) {\n      return codec.preferredPayloadType;\n    }\n    return codec.payloadType;\n  }).join(' ') + '\\r\\n';\n\n  sdp += 'c=IN IP4 0.0.0.0\\r\\n';\n  sdp += 'a=rtcp:9 IN IP4 0.0.0.0\\r\\n';\n\n  // Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.\n  caps.codecs.forEach(function(codec) {\n    sdp += SDPUtils.writeRtpMap(codec);\n    sdp += SDPUtils.writeFmtp(codec);\n    sdp += SDPUtils.writeRtcpFb(codec);\n  });\n  var maxptime = 0;\n  caps.codecs.forEach(function(codec) {\n    if (codec.maxptime > maxptime) {\n      maxptime = codec.maxptime;\n    }\n  });\n  if (maxptime > 0) {\n    sdp += 'a=maxptime:' + maxptime + '\\r\\n';\n  }\n  sdp += 'a=rtcp-mux\\r\\n';\n\n  if (caps.headerExtensions) {\n    caps.headerExtensions.forEach(function(extension) {\n      sdp += SDPUtils.writeExtmap(extension);\n    });\n  }\n  // FIXME: write fecMechanisms.\n  return sdp;\n};\n\n// Parses the SDP media section and returns an array of\n// RTCRtpEncodingParameters.\nSDPUtils.parseRtpEncodingParameters = function(mediaSection) {\n  var encodingParameters = [];\n  var description = SDPUtils.parseRtpParameters(mediaSection);\n  var hasRed = description.fecMechanisms.indexOf('RED') !== -1;\n  var hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;\n\n  // filter a=ssrc:... cname:, ignore PlanB-msid\n  var ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(function(line) {\n      return SDPUtils.parseSsrcMedia(line);\n    })\n    .filter(function(parts) {\n      return parts.attribute === 'cname';\n    });\n  var primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;\n  var secondarySsrc;\n\n  var flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID')\n    .map(function(line) {\n      var parts = line.substr(17).split(' ');\n      return parts.map(function(part) {\n        return parseInt(part, 10);\n      });\n    });\n  if (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {\n    secondarySsrc = flows[0][1];\n  }\n\n  description.codecs.forEach(function(codec) {\n    if (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {\n      var encParam = {\n        ssrc: primarySsrc,\n        codecPayloadType: parseInt(codec.parameters.apt, 10)\n      };\n      if (primarySsrc && secondarySsrc) {\n        encParam.rtx = {ssrc: secondarySsrc};\n      }\n      encodingParameters.push(encParam);\n      if (hasRed) {\n        encParam = JSON.parse(JSON.stringify(encParam));\n        encParam.fec = {\n          ssrc: primarySsrc,\n          mechanism: hasUlpfec ? 'red+ulpfec' : 'red'\n        };\n        encodingParameters.push(encParam);\n      }\n    }\n  });\n  if (encodingParameters.length === 0 && primarySsrc) {\n    encodingParameters.push({\n      ssrc: primarySsrc\n    });\n  }\n\n  // we support both b=AS and b=TIAS but interpret AS as TIAS.\n  var bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');\n  if (bandwidth.length) {\n    if (bandwidth[0].indexOf('b=TIAS:') === 0) {\n      bandwidth = parseInt(bandwidth[0].substr(7), 10);\n    } else if (bandwidth[0].indexOf('b=AS:') === 0) {\n      // use formula from JSEP to convert b=AS to TIAS value.\n      bandwidth = parseInt(bandwidth[0].substr(5), 10) * 1000 * 0.95\n          - (50 * 40 * 8);\n    } else {\n      bandwidth = undefined;\n    }\n    encodingParameters.forEach(function(params) {\n      params.maxBitrate = bandwidth;\n    });\n  }\n  return encodingParameters;\n};\n\n// parses http://draft.ortc.org/#rtcrtcpparameters*\nSDPUtils.parseRtcpParameters = function(mediaSection) {\n  var rtcpParameters = {};\n\n  // Gets the first SSRC. Note tha with RTX there might be multiple\n  // SSRCs.\n  var remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(function(line) {\n      return SDPUtils.parseSsrcMedia(line);\n    })\n    .filter(function(obj) {\n      return obj.attribute === 'cname';\n    })[0];\n  if (remoteSsrc) {\n    rtcpParameters.cname = remoteSsrc.value;\n    rtcpParameters.ssrc = remoteSsrc.ssrc;\n  }\n\n  // Edge uses the compound attribute instead of reducedSize\n  // compound is !reducedSize\n  var rsize = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-rsize');\n  rtcpParameters.reducedSize = rsize.length > 0;\n  rtcpParameters.compound = rsize.length === 0;\n\n  // parses the rtcp-mux attrіbute.\n  // Note that Edge does not support unmuxed RTCP.\n  var mux = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-mux');\n  rtcpParameters.mux = mux.length > 0;\n\n  return rtcpParameters;\n};\n\n// parses either a=msid: or a=ssrc:... msid lines and returns\n// the id of the MediaStream and MediaStreamTrack.\nSDPUtils.parseMsid = function(mediaSection) {\n  var parts;\n  var spec = SDPUtils.matchPrefix(mediaSection, 'a=msid:');\n  if (spec.length === 1) {\n    parts = spec[0].substr(7).split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n  var planB = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n    .map(function(line) {\n      return SDPUtils.parseSsrcMedia(line);\n    })\n    .filter(function(msidParts) {\n      return msidParts.attribute === 'msid';\n    });\n  if (planB.length > 0) {\n    parts = planB[0].value.split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n};\n\n// SCTP\n// parses draft-ietf-mmusic-sctp-sdp-26 first and falls back\n// to draft-ietf-mmusic-sctp-sdp-05\nSDPUtils.parseSctpDescription = function(mediaSection) {\n  var mline = SDPUtils.parseMLine(mediaSection);\n  var maxSizeLine = SDPUtils.matchPrefix(mediaSection, 'a=max-message-size:');\n  var maxMessageSize;\n  if (maxSizeLine.length > 0) {\n    maxMessageSize = parseInt(maxSizeLine[0].substr(19), 10);\n  }\n  if (isNaN(maxMessageSize)) {\n    maxMessageSize = 65536;\n  }\n  var sctpPort = SDPUtils.matchPrefix(mediaSection, 'a=sctp-port:');\n  if (sctpPort.length > 0) {\n    return {\n      port: parseInt(sctpPort[0].substr(12), 10),\n      protocol: mline.fmt,\n      maxMessageSize: maxMessageSize\n    };\n  }\n  var sctpMapLines = SDPUtils.matchPrefix(mediaSection, 'a=sctpmap:');\n  if (sctpMapLines.length > 0) {\n    var parts = SDPUtils.matchPrefix(mediaSection, 'a=sctpmap:')[0]\n      .substr(10)\n      .split(' ');\n    return {\n      port: parseInt(parts[0], 10),\n      protocol: parts[1],\n      maxMessageSize: maxMessageSize\n    };\n  }\n};\n\n// SCTP\n// outputs the draft-ietf-mmusic-sctp-sdp-26 version that all browsers\n// support by now receiving in this format, unless we originally parsed\n// as the draft-ietf-mmusic-sctp-sdp-05 format (indicated by the m-line\n// protocol of DTLS/SCTP -- without UDP/ or TCP/)\nSDPUtils.writeSctpDescription = function(media, sctp) {\n  var output = [];\n  if (media.protocol !== 'DTLS/SCTP') {\n    output = [\n      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.protocol + '\\r\\n',\n      'c=IN IP4 0.0.0.0\\r\\n',\n      'a=sctp-port:' + sctp.port + '\\r\\n'\n    ];\n  } else {\n    output = [\n      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.port + '\\r\\n',\n      'c=IN IP4 0.0.0.0\\r\\n',\n      'a=sctpmap:' + sctp.port + ' ' + sctp.protocol + ' 65535\\r\\n'\n    ];\n  }\n  if (sctp.maxMessageSize !== undefined) {\n    output.push('a=max-message-size:' + sctp.maxMessageSize + '\\r\\n');\n  }\n  return output.join('');\n};\n\n// Generate a session ID for SDP.\n// https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-20#section-5.2.1\n// recommends using a cryptographically random +ve 64-bit value\n// but right now this should be acceptable and within the right range\nSDPUtils.generateSessionId = function() {\n  return Math.random().toString().substr(2, 21);\n};\n\n// Write boilder plate for start of SDP\n// sessId argument is optional - if not supplied it will\n// be generated randomly\n// sessVersion is optional and defaults to 2\n// sessUser is optional and defaults to 'thisisadapterortc'\nSDPUtils.writeSessionBoilerplate = function(sessId, sessVer, sessUser) {\n  var sessionId;\n  var version = sessVer !== undefined ? sessVer : 2;\n  if (sessId) {\n    sessionId = sessId;\n  } else {\n    sessionId = SDPUtils.generateSessionId();\n  }\n  var user = sessUser || 'thisisadapterortc';\n  // FIXME: sess-id should be an NTP timestamp.\n  return 'v=0\\r\\n' +\n      'o=' + user + ' ' + sessionId + ' ' + version +\n        ' IN IP4 127.0.0.1\\r\\n' +\n      's=-\\r\\n' +\n      't=0 0\\r\\n';\n};\n\nSDPUtils.writeMediaSection = function(transceiver, caps, type, stream) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n    transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n    transceiver.dtlsTransport.getLocalParameters(),\n    type === 'offer' ? 'actpass' : 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.direction) {\n    sdp += 'a=' + transceiver.direction + '\\r\\n';\n  } else if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    // spec.\n    var msid = 'msid:' + stream.id + ' ' +\n        transceiver.rtpSender.track.id + '\\r\\n';\n    sdp += 'a=' + msid;\n\n    // for Chrome.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n};\n\n// Gets the direction from the mediaSection or the sessionpart.\nSDPUtils.getDirection = function(mediaSection, sessionpart) {\n  // Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.\n  var lines = SDPUtils.splitLines(mediaSection);\n  for (var i = 0; i < lines.length; i++) {\n    switch (lines[i]) {\n      case 'a=sendrecv':\n      case 'a=sendonly':\n      case 'a=recvonly':\n      case 'a=inactive':\n        return lines[i].substr(2);\n      default:\n        // FIXME: What should happen here?\n    }\n  }\n  if (sessionpart) {\n    return SDPUtils.getDirection(sessionpart);\n  }\n  return 'sendrecv';\n};\n\nSDPUtils.getKind = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  return mline[0].substr(2);\n};\n\nSDPUtils.isRejected = function(mediaSection) {\n  return mediaSection.split(' ', 2)[1] === '0';\n};\n\nSDPUtils.parseMLine = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var parts = lines[0].substr(2).split(' ');\n  return {\n    kind: parts[0],\n    port: parseInt(parts[1], 10),\n    protocol: parts[2],\n    fmt: parts.slice(3).join(' ')\n  };\n};\n\nSDPUtils.parseOLine = function(mediaSection) {\n  var line = SDPUtils.matchPrefix(mediaSection, 'o=')[0];\n  var parts = line.substr(2).split(' ');\n  return {\n    username: parts[0],\n    sessionId: parts[1],\n    sessionVersion: parseInt(parts[2], 10),\n    netType: parts[3],\n    addressType: parts[4],\n    address: parts[5]\n  };\n};\n\n// a very naive interpretation of a valid SDP.\nSDPUtils.isValidSDP = function(blob) {\n  if (typeof blob !== 'string' || blob.length === 0) {\n    return false;\n  }\n  var lines = SDPUtils.splitLines(blob);\n  for (var i = 0; i < lines.length; i++) {\n    if (lines[i].length < 2 || lines[i].charAt(1) !== '=') {\n      return false;\n    }\n    // TODO: check the modifier a bit more.\n  }\n  return true;\n};\n\n// Expose public methods.\nif (typeof module === 'object') {\n  module.exports = SDPUtils;\n}\n","/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar SDPUtils = require('sdp');\n\nfunction fixStatsType(stat) {\n  return {\n    inboundrtp: 'inbound-rtp',\n    outboundrtp: 'outbound-rtp',\n    candidatepair: 'candidate-pair',\n    localcandidate: 'local-candidate',\n    remotecandidate: 'remote-candidate'\n  }[stat.type] || stat.type;\n}\n\nfunction writeMediaSection(transceiver, caps, type, stream, dtlsRole) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n      transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n      transceiver.dtlsTransport.getLocalParameters(),\n      type === 'offer' ? 'actpass' : dtlsRole || 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    var trackId = transceiver.rtpSender._initialTrackId ||\n        transceiver.rtpSender.track.id;\n    transceiver.rtpSender._initialTrackId = trackId;\n    // spec.\n    var msid = 'msid:' + (stream ? stream.id : '-') + ' ' +\n        trackId + '\\r\\n';\n    sdp += 'a=' + msid;\n    // for Chrome. Legacy should no longer be required.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n\n    // RTX\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n}\n\n// Edge does not like\n// 1) stun: filtered after 14393 unless ?transport=udp is present\n// 2) turn: that does not have all of turn:host:port?transport=udp\n// 3) turn: with ipv6 addresses\n// 4) turn: occurring muliple times\nfunction filterIceServers(iceServers, edgeVersion) {\n  var hasTurn = false;\n  iceServers = JSON.parse(JSON.stringify(iceServers));\n  return iceServers.filter(function(server) {\n    if (server && (server.urls || server.url)) {\n      var urls = server.urls || server.url;\n      if (server.url && !server.urls) {\n        console.warn('RTCIceServer.url is deprecated! Use urls instead.');\n      }\n      var isString = typeof urls === 'string';\n      if (isString) {\n        urls = [urls];\n      }\n      urls = urls.filter(function(url) {\n        var validTurn = url.indexOf('turn:') === 0 &&\n            url.indexOf('transport=udp') !== -1 &&\n            url.indexOf('turn:[') === -1 &&\n            !hasTurn;\n\n        if (validTurn) {\n          hasTurn = true;\n          return true;\n        }\n        return url.indexOf('stun:') === 0 && edgeVersion >= 14393 &&\n            url.indexOf('?transport=udp') === -1;\n      });\n\n      delete server.url;\n      server.urls = isString ? urls[0] : urls;\n      return !!urls.length;\n    }\n  });\n}\n\n// Determines the intersection of local and remote capabilities.\nfunction getCommonCapabilities(localCapabilities, remoteCapabilities) {\n  var commonCapabilities = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: []\n  };\n\n  var findCodecByPayloadType = function(pt, codecs) {\n    pt = parseInt(pt, 10);\n    for (var i = 0; i < codecs.length; i++) {\n      if (codecs[i].payloadType === pt ||\n          codecs[i].preferredPayloadType === pt) {\n        return codecs[i];\n      }\n    }\n  };\n\n  var rtxCapabilityMatches = function(lRtx, rRtx, lCodecs, rCodecs) {\n    var lCodec = findCodecByPayloadType(lRtx.parameters.apt, lCodecs);\n    var rCodec = findCodecByPayloadType(rRtx.parameters.apt, rCodecs);\n    return lCodec && rCodec &&\n        lCodec.name.toLowerCase() === rCodec.name.toLowerCase();\n  };\n\n  localCapabilities.codecs.forEach(function(lCodec) {\n    for (var i = 0; i < remoteCapabilities.codecs.length; i++) {\n      var rCodec = remoteCapabilities.codecs[i];\n      if (lCodec.name.toLowerCase() === rCodec.name.toLowerCase() &&\n          lCodec.clockRate === rCodec.clockRate) {\n        if (lCodec.name.toLowerCase() === 'rtx' &&\n            lCodec.parameters && rCodec.parameters.apt) {\n          // for RTX we need to find the local rtx that has a apt\n          // which points to the same local codec as the remote one.\n          if (!rtxCapabilityMatches(lCodec, rCodec,\n              localCapabilities.codecs, remoteCapabilities.codecs)) {\n            continue;\n          }\n        }\n        rCodec = JSON.parse(JSON.stringify(rCodec)); // deepcopy\n        // number of channels is the highest common number of channels\n        rCodec.numChannels = Math.min(lCodec.numChannels,\n            rCodec.numChannels);\n        // push rCodec so we reply with offerer payload type\n        commonCapabilities.codecs.push(rCodec);\n\n        // determine common feedback mechanisms\n        rCodec.rtcpFeedback = rCodec.rtcpFeedback.filter(function(fb) {\n          for (var j = 0; j < lCodec.rtcpFeedback.length; j++) {\n            if (lCodec.rtcpFeedback[j].type === fb.type &&\n                lCodec.rtcpFeedback[j].parameter === fb.parameter) {\n              return true;\n            }\n          }\n          return false;\n        });\n        // FIXME: also need to determine .parameters\n        //  see https://github.com/openpeer/ortc/issues/569\n        break;\n      }\n    }\n  });\n\n  localCapabilities.headerExtensions.forEach(function(lHeaderExtension) {\n    for (var i = 0; i < remoteCapabilities.headerExtensions.length;\n         i++) {\n      var rHeaderExtension = remoteCapabilities.headerExtensions[i];\n      if (lHeaderExtension.uri === rHeaderExtension.uri) {\n        commonCapabilities.headerExtensions.push(rHeaderExtension);\n        break;\n      }\n    }\n  });\n\n  // FIXME: fecMechanisms\n  return commonCapabilities;\n}\n\n// is action=setLocalDescription with type allowed in signalingState\nfunction isActionAllowedInSignalingState(action, type, signalingState) {\n  return {\n    offer: {\n      setLocalDescription: ['stable', 'have-local-offer'],\n      setRemoteDescription: ['stable', 'have-remote-offer']\n    },\n    answer: {\n      setLocalDescription: ['have-remote-offer', 'have-local-pranswer'],\n      setRemoteDescription: ['have-local-offer', 'have-remote-pranswer']\n    }\n  }[type][action].indexOf(signalingState) !== -1;\n}\n\nfunction maybeAddCandidate(iceTransport, candidate) {\n  // Edge's internal representation adds some fields therefore\n  // not all fieldѕ are taken into account.\n  var alreadyAdded = iceTransport.getRemoteCandidates()\n      .find(function(remoteCandidate) {\n        return candidate.foundation === remoteCandidate.foundation &&\n            candidate.ip === remoteCandidate.ip &&\n            candidate.port === remoteCandidate.port &&\n            candidate.priority === remoteCandidate.priority &&\n            candidate.protocol === remoteCandidate.protocol &&\n            candidate.type === remoteCandidate.type;\n      });\n  if (!alreadyAdded) {\n    iceTransport.addRemoteCandidate(candidate);\n  }\n  return !alreadyAdded;\n}\n\n\nfunction makeError(name, description) {\n  var e = new Error(description);\n  e.name = name;\n  // legacy error codes from https://heycam.github.io/webidl/#idl-DOMException-error-names\n  e.code = {\n    NotSupportedError: 9,\n    InvalidStateError: 11,\n    InvalidAccessError: 15,\n    TypeError: undefined,\n    OperationError: undefined\n  }[name];\n  return e;\n}\n\nmodule.exports = function(window, edgeVersion) {\n  // https://w3c.github.io/mediacapture-main/#mediastream\n  // Helper function to add the track to the stream and\n  // dispatch the event ourselves.\n  function addTrackToStreamAndFireEvent(track, stream) {\n    stream.addTrack(track);\n    stream.dispatchEvent(new window.MediaStreamTrackEvent('addtrack',\n        {track: track}));\n  }\n\n  function removeTrackFromStreamAndFireEvent(track, stream) {\n    stream.removeTrack(track);\n    stream.dispatchEvent(new window.MediaStreamTrackEvent('removetrack',\n        {track: track}));\n  }\n\n  function fireAddTrack(pc, track, receiver, streams) {\n    var trackEvent = new Event('track');\n    trackEvent.track = track;\n    trackEvent.receiver = receiver;\n    trackEvent.transceiver = {receiver: receiver};\n    trackEvent.streams = streams;\n    window.setTimeout(function() {\n      pc._dispatchEvent('track', trackEvent);\n    });\n  }\n\n  var RTCPeerConnection = function(config) {\n    var pc = this;\n\n    var _eventTarget = document.createDocumentFragment();\n    ['addEventListener', 'removeEventListener', 'dispatchEvent']\n        .forEach(function(method) {\n          pc[method] = _eventTarget[method].bind(_eventTarget);\n        });\n\n    this.canTrickleIceCandidates = null;\n\n    this.needNegotiation = false;\n\n    this.localStreams = [];\n    this.remoteStreams = [];\n\n    this._localDescription = null;\n    this._remoteDescription = null;\n\n    this.signalingState = 'stable';\n    this.iceConnectionState = 'new';\n    this.connectionState = 'new';\n    this.iceGatheringState = 'new';\n\n    config = JSON.parse(JSON.stringify(config || {}));\n\n    this.usingBundle = config.bundlePolicy === 'max-bundle';\n    if (config.rtcpMuxPolicy === 'negotiate') {\n      throw(makeError('NotSupportedError',\n          'rtcpMuxPolicy \\'negotiate\\' is not supported'));\n    } else if (!config.rtcpMuxPolicy) {\n      config.rtcpMuxPolicy = 'require';\n    }\n\n    switch (config.iceTransportPolicy) {\n      case 'all':\n      case 'relay':\n        break;\n      default:\n        config.iceTransportPolicy = 'all';\n        break;\n    }\n\n    switch (config.bundlePolicy) {\n      case 'balanced':\n      case 'max-compat':\n      case 'max-bundle':\n        break;\n      default:\n        config.bundlePolicy = 'balanced';\n        break;\n    }\n\n    config.iceServers = filterIceServers(config.iceServers || [], edgeVersion);\n\n    this._iceGatherers = [];\n    if (config.iceCandidatePoolSize) {\n      for (var i = config.iceCandidatePoolSize; i > 0; i--) {\n        this._iceGatherers.push(new window.RTCIceGatherer({\n          iceServers: config.iceServers,\n          gatherPolicy: config.iceTransportPolicy\n        }));\n      }\n    } else {\n      config.iceCandidatePoolSize = 0;\n    }\n\n    this._config = config;\n\n    // per-track iceGathers, iceTransports, dtlsTransports, rtpSenders, ...\n    // everything that is needed to describe a SDP m-line.\n    this.transceivers = [];\n\n    this._sdpSessionId = SDPUtils.generateSessionId();\n    this._sdpSessionVersion = 0;\n\n    this._dtlsRole = undefined; // role for a=setup to use in answers.\n\n    this._isClosed = false;\n  };\n\n  Object.defineProperty(RTCPeerConnection.prototype, 'localDescription', {\n    configurable: true,\n    get: function() {\n      return this._localDescription;\n    }\n  });\n  Object.defineProperty(RTCPeerConnection.prototype, 'remoteDescription', {\n    configurable: true,\n    get: function() {\n      return this._remoteDescription;\n    }\n  });\n\n  // set up event handlers on prototype\n  RTCPeerConnection.prototype.onicecandidate = null;\n  RTCPeerConnection.prototype.onaddstream = null;\n  RTCPeerConnection.prototype.ontrack = null;\n  RTCPeerConnection.prototype.onremovestream = null;\n  RTCPeerConnection.prototype.onsignalingstatechange = null;\n  RTCPeerConnection.prototype.oniceconnectionstatechange = null;\n  RTCPeerConnection.prototype.onconnectionstatechange = null;\n  RTCPeerConnection.prototype.onicegatheringstatechange = null;\n  RTCPeerConnection.prototype.onnegotiationneeded = null;\n  RTCPeerConnection.prototype.ondatachannel = null;\n\n  RTCPeerConnection.prototype._dispatchEvent = function(name, event) {\n    if (this._isClosed) {\n      return;\n    }\n    this.dispatchEvent(event);\n    if (typeof this['on' + name] === 'function') {\n      this['on' + name](event);\n    }\n  };\n\n  RTCPeerConnection.prototype._emitGatheringStateChange = function() {\n    var event = new Event('icegatheringstatechange');\n    this._dispatchEvent('icegatheringstatechange', event);\n  };\n\n  RTCPeerConnection.prototype.getConfiguration = function() {\n    return this._config;\n  };\n\n  RTCPeerConnection.prototype.getLocalStreams = function() {\n    return this.localStreams;\n  };\n\n  RTCPeerConnection.prototype.getRemoteStreams = function() {\n    return this.remoteStreams;\n  };\n\n  // internal helper to create a transceiver object.\n  // (which is not yet the same as the WebRTC 1.0 transceiver)\n  RTCPeerConnection.prototype._createTransceiver = function(kind, doNotAdd) {\n    var hasBundleTransport = this.transceivers.length > 0;\n    var transceiver = {\n      track: null,\n      iceGatherer: null,\n      iceTransport: null,\n      dtlsTransport: null,\n      localCapabilities: null,\n      remoteCapabilities: null,\n      rtpSender: null,\n      rtpReceiver: null,\n      kind: kind,\n      mid: null,\n      sendEncodingParameters: null,\n      recvEncodingParameters: null,\n      stream: null,\n      associatedRemoteMediaStreams: [],\n      wantReceive: true\n    };\n    if (this.usingBundle && hasBundleTransport) {\n      transceiver.iceTransport = this.transceivers[0].iceTransport;\n      transceiver.dtlsTransport = this.transceivers[0].dtlsTransport;\n    } else {\n      var transports = this._createIceAndDtlsTransports();\n      transceiver.iceTransport = transports.iceTransport;\n      transceiver.dtlsTransport = transports.dtlsTransport;\n    }\n    if (!doNotAdd) {\n      this.transceivers.push(transceiver);\n    }\n    return transceiver;\n  };\n\n  RTCPeerConnection.prototype.addTrack = function(track, stream) {\n    if (this._isClosed) {\n      throw makeError('InvalidStateError',\n          'Attempted to call addTrack on a closed peerconnection.');\n    }\n\n    var alreadyExists = this.transceivers.find(function(s) {\n      return s.track === track;\n    });\n\n    if (alreadyExists) {\n      throw makeError('InvalidAccessError', 'Track already exists.');\n    }\n\n    var transceiver;\n    for (var i = 0; i < this.transceivers.length; i++) {\n      if (!this.transceivers[i].track &&\n          this.transceivers[i].kind === track.kind) {\n        transceiver = this.transceivers[i];\n      }\n    }\n    if (!transceiver) {\n      transceiver = this._createTransceiver(track.kind);\n    }\n\n    this._maybeFireNegotiationNeeded();\n\n    if (this.localStreams.indexOf(stream) === -1) {\n      this.localStreams.push(stream);\n    }\n\n    transceiver.track = track;\n    transceiver.stream = stream;\n    transceiver.rtpSender = new window.RTCRtpSender(track,\n        transceiver.dtlsTransport);\n    return transceiver.rtpSender;\n  };\n\n  RTCPeerConnection.prototype.addStream = function(stream) {\n    var pc = this;\n    if (edgeVersion >= 15025) {\n      stream.getTracks().forEach(function(track) {\n        pc.addTrack(track, stream);\n      });\n    } else {\n      // Clone is necessary for local demos mostly, attaching directly\n      // to two different senders does not work (build 10547).\n      // Fixed in 15025 (or earlier)\n      var clonedStream = stream.clone();\n      stream.getTracks().forEach(function(track, idx) {\n        var clonedTrack = clonedStream.getTracks()[idx];\n        track.addEventListener('enabled', function(event) {\n          clonedTrack.enabled = event.enabled;\n        });\n      });\n      clonedStream.getTracks().forEach(function(track) {\n        pc.addTrack(track, clonedStream);\n      });\n    }\n  };\n\n  RTCPeerConnection.prototype.removeTrack = function(sender) {\n    if (this._isClosed) {\n      throw makeError('InvalidStateError',\n          'Attempted to call removeTrack on a closed peerconnection.');\n    }\n\n    if (!(sender instanceof window.RTCRtpSender)) {\n      throw new TypeError('Argument 1 of RTCPeerConnection.removeTrack ' +\n          'does not implement interface RTCRtpSender.');\n    }\n\n    var transceiver = this.transceivers.find(function(t) {\n      return t.rtpSender === sender;\n    });\n\n    if (!transceiver) {\n      throw makeError('InvalidAccessError',\n          'Sender was not created by this connection.');\n    }\n    var stream = transceiver.stream;\n\n    transceiver.rtpSender.stop();\n    transceiver.rtpSender = null;\n    transceiver.track = null;\n    transceiver.stream = null;\n\n    // remove the stream from the set of local streams\n    var localStreams = this.transceivers.map(function(t) {\n      return t.stream;\n    });\n    if (localStreams.indexOf(stream) === -1 &&\n        this.localStreams.indexOf(stream) > -1) {\n      this.localStreams.splice(this.localStreams.indexOf(stream), 1);\n    }\n\n    this._maybeFireNegotiationNeeded();\n  };\n\n  RTCPeerConnection.prototype.removeStream = function(stream) {\n    var pc = this;\n    stream.getTracks().forEach(function(track) {\n      var sender = pc.getSenders().find(function(s) {\n        return s.track === track;\n      });\n      if (sender) {\n        pc.removeTrack(sender);\n      }\n    });\n  };\n\n  RTCPeerConnection.prototype.getSenders = function() {\n    return this.transceivers.filter(function(transceiver) {\n      return !!transceiver.rtpSender;\n    })\n    .map(function(transceiver) {\n      return transceiver.rtpSender;\n    });\n  };\n\n  RTCPeerConnection.prototype.getReceivers = function() {\n    return this.transceivers.filter(function(transceiver) {\n      return !!transceiver.rtpReceiver;\n    })\n    .map(function(transceiver) {\n      return transceiver.rtpReceiver;\n    });\n  };\n\n\n  RTCPeerConnection.prototype._createIceGatherer = function(sdpMLineIndex,\n      usingBundle) {\n    var pc = this;\n    if (usingBundle && sdpMLineIndex > 0) {\n      return this.transceivers[0].iceGatherer;\n    } else if (this._iceGatherers.length) {\n      return this._iceGatherers.shift();\n    }\n    var iceGatherer = new window.RTCIceGatherer({\n      iceServers: this._config.iceServers,\n      gatherPolicy: this._config.iceTransportPolicy\n    });\n    Object.defineProperty(iceGatherer, 'state',\n        {value: 'new', writable: true}\n    );\n\n    this.transceivers[sdpMLineIndex].bufferedCandidateEvents = [];\n    this.transceivers[sdpMLineIndex].bufferCandidates = function(event) {\n      var end = !event.candidate || Object.keys(event.candidate).length === 0;\n      // polyfill since RTCIceGatherer.state is not implemented in\n      // Edge 10547 yet.\n      iceGatherer.state = end ? 'completed' : 'gathering';\n      if (pc.transceivers[sdpMLineIndex].bufferedCandidateEvents !== null) {\n        pc.transceivers[sdpMLineIndex].bufferedCandidateEvents.push(event);\n      }\n    };\n    iceGatherer.addEventListener('localcandidate',\n      this.transceivers[sdpMLineIndex].bufferCandidates);\n    return iceGatherer;\n  };\n\n  // start gathering from an RTCIceGatherer.\n  RTCPeerConnection.prototype._gather = function(mid, sdpMLineIndex) {\n    var pc = this;\n    var iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\n    if (iceGatherer.onlocalcandidate) {\n      return;\n    }\n    var bufferedCandidateEvents =\n      this.transceivers[sdpMLineIndex].bufferedCandidateEvents;\n    this.transceivers[sdpMLineIndex].bufferedCandidateEvents = null;\n    iceGatherer.removeEventListener('localcandidate',\n      this.transceivers[sdpMLineIndex].bufferCandidates);\n    iceGatherer.onlocalcandidate = function(evt) {\n      if (pc.usingBundle && sdpMLineIndex > 0) {\n        // if we know that we use bundle we can drop candidates with\n        // ѕdpMLineIndex > 0. If we don't do this then our state gets\n        // confused since we dispose the extra ice gatherer.\n        return;\n      }\n      var event = new Event('icecandidate');\n      event.candidate = {sdpMid: mid, sdpMLineIndex: sdpMLineIndex};\n\n      var cand = evt.candidate;\n      // Edge emits an empty object for RTCIceCandidateComplete‥\n      var end = !cand || Object.keys(cand).length === 0;\n      if (end) {\n        // polyfill since RTCIceGatherer.state is not implemented in\n        // Edge 10547 yet.\n        if (iceGatherer.state === 'new' || iceGatherer.state === 'gathering') {\n          iceGatherer.state = 'completed';\n        }\n      } else {\n        if (iceGatherer.state === 'new') {\n          iceGatherer.state = 'gathering';\n        }\n        // RTCIceCandidate doesn't have a component, needs to be added\n        cand.component = 1;\n        // also the usernameFragment. TODO: update SDP to take both variants.\n        cand.ufrag = iceGatherer.getLocalParameters().usernameFragment;\n\n        var serializedCandidate = SDPUtils.writeCandidate(cand);\n        event.candidate = Object.assign(event.candidate,\n            SDPUtils.parseCandidate(serializedCandidate));\n\n        event.candidate.candidate = serializedCandidate;\n        event.candidate.toJSON = function() {\n          return {\n            candidate: event.candidate.candidate,\n            sdpMid: event.candidate.sdpMid,\n            sdpMLineIndex: event.candidate.sdpMLineIndex,\n            usernameFragment: event.candidate.usernameFragment\n          };\n        };\n      }\n\n      // update local description.\n      var sections = SDPUtils.getMediaSections(pc._localDescription.sdp);\n      if (!end) {\n        sections[event.candidate.sdpMLineIndex] +=\n            'a=' + event.candidate.candidate + '\\r\\n';\n      } else {\n        sections[event.candidate.sdpMLineIndex] +=\n            'a=end-of-candidates\\r\\n';\n      }\n      pc._localDescription.sdp =\n          SDPUtils.getDescription(pc._localDescription.sdp) +\n          sections.join('');\n      var complete = pc.transceivers.every(function(transceiver) {\n        return transceiver.iceGatherer &&\n            transceiver.iceGatherer.state === 'completed';\n      });\n\n      if (pc.iceGatheringState !== 'gathering') {\n        pc.iceGatheringState = 'gathering';\n        pc._emitGatheringStateChange();\n      }\n\n      // Emit candidate. Also emit null candidate when all gatherers are\n      // complete.\n      if (!end) {\n        pc._dispatchEvent('icecandidate', event);\n      }\n      if (complete) {\n        pc._dispatchEvent('icecandidate', new Event('icecandidate'));\n        pc.iceGatheringState = 'complete';\n        pc._emitGatheringStateChange();\n      }\n    };\n\n    // emit already gathered candidates.\n    window.setTimeout(function() {\n      bufferedCandidateEvents.forEach(function(e) {\n        iceGatherer.onlocalcandidate(e);\n      });\n    }, 0);\n  };\n\n  // Create ICE transport and DTLS transport.\n  RTCPeerConnection.prototype._createIceAndDtlsTransports = function() {\n    var pc = this;\n    var iceTransport = new window.RTCIceTransport(null);\n    iceTransport.onicestatechange = function() {\n      pc._updateIceConnectionState();\n      pc._updateConnectionState();\n    };\n\n    var dtlsTransport = new window.RTCDtlsTransport(iceTransport);\n    dtlsTransport.ondtlsstatechange = function() {\n      pc._updateConnectionState();\n    };\n    dtlsTransport.onerror = function() {\n      // onerror does not set state to failed by itself.\n      Object.defineProperty(dtlsTransport, 'state',\n          {value: 'failed', writable: true});\n      pc._updateConnectionState();\n    };\n\n    return {\n      iceTransport: iceTransport,\n      dtlsTransport: dtlsTransport\n    };\n  };\n\n  // Destroy ICE gatherer, ICE transport and DTLS transport.\n  // Without triggering the callbacks.\n  RTCPeerConnection.prototype._disposeIceAndDtlsTransports = function(\n      sdpMLineIndex) {\n    var iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\n    if (iceGatherer) {\n      delete iceGatherer.onlocalcandidate;\n      delete this.transceivers[sdpMLineIndex].iceGatherer;\n    }\n    var iceTransport = this.transceivers[sdpMLineIndex].iceTransport;\n    if (iceTransport) {\n      delete iceTransport.onicestatechange;\n      delete this.transceivers[sdpMLineIndex].iceTransport;\n    }\n    var dtlsTransport = this.transceivers[sdpMLineIndex].dtlsTransport;\n    if (dtlsTransport) {\n      delete dtlsTransport.ondtlsstatechange;\n      delete dtlsTransport.onerror;\n      delete this.transceivers[sdpMLineIndex].dtlsTransport;\n    }\n  };\n\n  // Start the RTP Sender and Receiver for a transceiver.\n  RTCPeerConnection.prototype._transceive = function(transceiver,\n      send, recv) {\n    var params = getCommonCapabilities(transceiver.localCapabilities,\n        transceiver.remoteCapabilities);\n    if (send && transceiver.rtpSender) {\n      params.encodings = transceiver.sendEncodingParameters;\n      params.rtcp = {\n        cname: SDPUtils.localCName,\n        compound: transceiver.rtcpParameters.compound\n      };\n      if (transceiver.recvEncodingParameters.length) {\n        params.rtcp.ssrc = transceiver.recvEncodingParameters[0].ssrc;\n      }\n      transceiver.rtpSender.send(params);\n    }\n    if (recv && transceiver.rtpReceiver && params.codecs.length > 0) {\n      // remove RTX field in Edge 14942\n      if (transceiver.kind === 'video'\n          && transceiver.recvEncodingParameters\n          && edgeVersion < 15019) {\n        transceiver.recvEncodingParameters.forEach(function(p) {\n          delete p.rtx;\n        });\n      }\n      if (transceiver.recvEncodingParameters.length) {\n        params.encodings = transceiver.recvEncodingParameters;\n      } else {\n        params.encodings = [{}];\n      }\n      params.rtcp = {\n        compound: transceiver.rtcpParameters.compound\n      };\n      if (transceiver.rtcpParameters.cname) {\n        params.rtcp.cname = transceiver.rtcpParameters.cname;\n      }\n      if (transceiver.sendEncodingParameters.length) {\n        params.rtcp.ssrc = transceiver.sendEncodingParameters[0].ssrc;\n      }\n      transceiver.rtpReceiver.receive(params);\n    }\n  };\n\n  RTCPeerConnection.prototype.setLocalDescription = function(description) {\n    var pc = this;\n\n    // Note: pranswer is not supported.\n    if (['offer', 'answer'].indexOf(description.type) === -1) {\n      return Promise.reject(makeError('TypeError',\n          'Unsupported type \"' + description.type + '\"'));\n    }\n\n    if (!isActionAllowedInSignalingState('setLocalDescription',\n        description.type, pc.signalingState) || pc._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not set local ' + description.type +\n          ' in state ' + pc.signalingState));\n    }\n\n    var sections;\n    var sessionpart;\n    if (description.type === 'offer') {\n      // VERY limited support for SDP munging. Limited to:\n      // * changing the order of codecs\n      sections = SDPUtils.splitSections(description.sdp);\n      sessionpart = sections.shift();\n      sections.forEach(function(mediaSection, sdpMLineIndex) {\n        var caps = SDPUtils.parseRtpParameters(mediaSection);\n        pc.transceivers[sdpMLineIndex].localCapabilities = caps;\n      });\n\n      pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n        pc._gather(transceiver.mid, sdpMLineIndex);\n      });\n    } else if (description.type === 'answer') {\n      sections = SDPUtils.splitSections(pc._remoteDescription.sdp);\n      sessionpart = sections.shift();\n      var isIceLite = SDPUtils.matchPrefix(sessionpart,\n          'a=ice-lite').length > 0;\n      sections.forEach(function(mediaSection, sdpMLineIndex) {\n        var transceiver = pc.transceivers[sdpMLineIndex];\n        var iceGatherer = transceiver.iceGatherer;\n        var iceTransport = transceiver.iceTransport;\n        var dtlsTransport = transceiver.dtlsTransport;\n        var localCapabilities = transceiver.localCapabilities;\n        var remoteCapabilities = transceiver.remoteCapabilities;\n\n        // treat bundle-only as not-rejected.\n        var rejected = SDPUtils.isRejected(mediaSection) &&\n            SDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\n\n        if (!rejected && !transceiver.rejected) {\n          var remoteIceParameters = SDPUtils.getIceParameters(\n              mediaSection, sessionpart);\n          var remoteDtlsParameters = SDPUtils.getDtlsParameters(\n              mediaSection, sessionpart);\n          if (isIceLite) {\n            remoteDtlsParameters.role = 'server';\n          }\n\n          if (!pc.usingBundle || sdpMLineIndex === 0) {\n            pc._gather(transceiver.mid, sdpMLineIndex);\n            if (iceTransport.state === 'new') {\n              iceTransport.start(iceGatherer, remoteIceParameters,\n                  isIceLite ? 'controlling' : 'controlled');\n            }\n            if (dtlsTransport.state === 'new') {\n              dtlsTransport.start(remoteDtlsParameters);\n            }\n          }\n\n          // Calculate intersection of capabilities.\n          var params = getCommonCapabilities(localCapabilities,\n              remoteCapabilities);\n\n          // Start the RTCRtpSender. The RTCRtpReceiver for this\n          // transceiver has already been started in setRemoteDescription.\n          pc._transceive(transceiver,\n              params.codecs.length > 0,\n              false);\n        }\n      });\n    }\n\n    pc._localDescription = {\n      type: description.type,\n      sdp: description.sdp\n    };\n    if (description.type === 'offer') {\n      pc._updateSignalingState('have-local-offer');\n    } else {\n      pc._updateSignalingState('stable');\n    }\n\n    return Promise.resolve();\n  };\n\n  RTCPeerConnection.prototype.setRemoteDescription = function(description) {\n    var pc = this;\n\n    // Note: pranswer is not supported.\n    if (['offer', 'answer'].indexOf(description.type) === -1) {\n      return Promise.reject(makeError('TypeError',\n          'Unsupported type \"' + description.type + '\"'));\n    }\n\n    if (!isActionAllowedInSignalingState('setRemoteDescription',\n        description.type, pc.signalingState) || pc._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not set remote ' + description.type +\n          ' in state ' + pc.signalingState));\n    }\n\n    var streams = {};\n    pc.remoteStreams.forEach(function(stream) {\n      streams[stream.id] = stream;\n    });\n    var receiverList = [];\n    var sections = SDPUtils.splitSections(description.sdp);\n    var sessionpart = sections.shift();\n    var isIceLite = SDPUtils.matchPrefix(sessionpart,\n        'a=ice-lite').length > 0;\n    var usingBundle = SDPUtils.matchPrefix(sessionpart,\n        'a=group:BUNDLE ').length > 0;\n    pc.usingBundle = usingBundle;\n    var iceOptions = SDPUtils.matchPrefix(sessionpart,\n        'a=ice-options:')[0];\n    if (iceOptions) {\n      pc.canTrickleIceCandidates = iceOptions.substr(14).split(' ')\n          .indexOf('trickle') >= 0;\n    } else {\n      pc.canTrickleIceCandidates = false;\n    }\n\n    sections.forEach(function(mediaSection, sdpMLineIndex) {\n      var lines = SDPUtils.splitLines(mediaSection);\n      var kind = SDPUtils.getKind(mediaSection);\n      // treat bundle-only as not-rejected.\n      var rejected = SDPUtils.isRejected(mediaSection) &&\n          SDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;\n      var protocol = lines[0].substr(2).split(' ')[2];\n\n      var direction = SDPUtils.getDirection(mediaSection, sessionpart);\n      var remoteMsid = SDPUtils.parseMsid(mediaSection);\n\n      var mid = SDPUtils.getMid(mediaSection) || SDPUtils.generateIdentifier();\n\n      // Reject datachannels which are not implemented yet.\n      if (rejected || (kind === 'application' && (protocol === 'DTLS/SCTP' ||\n          protocol === 'UDP/DTLS/SCTP'))) {\n        // TODO: this is dangerous in the case where a non-rejected m-line\n        //     becomes rejected.\n        pc.transceivers[sdpMLineIndex] = {\n          mid: mid,\n          kind: kind,\n          protocol: protocol,\n          rejected: true\n        };\n        return;\n      }\n\n      if (!rejected && pc.transceivers[sdpMLineIndex] &&\n          pc.transceivers[sdpMLineIndex].rejected) {\n        // recycle a rejected transceiver.\n        pc.transceivers[sdpMLineIndex] = pc._createTransceiver(kind, true);\n      }\n\n      var transceiver;\n      var iceGatherer;\n      var iceTransport;\n      var dtlsTransport;\n      var rtpReceiver;\n      var sendEncodingParameters;\n      var recvEncodingParameters;\n      var localCapabilities;\n\n      var track;\n      // FIXME: ensure the mediaSection has rtcp-mux set.\n      var remoteCapabilities = SDPUtils.parseRtpParameters(mediaSection);\n      var remoteIceParameters;\n      var remoteDtlsParameters;\n      if (!rejected) {\n        remoteIceParameters = SDPUtils.getIceParameters(mediaSection,\n            sessionpart);\n        remoteDtlsParameters = SDPUtils.getDtlsParameters(mediaSection,\n            sessionpart);\n        remoteDtlsParameters.role = 'client';\n      }\n      recvEncodingParameters =\n          SDPUtils.parseRtpEncodingParameters(mediaSection);\n\n      var rtcpParameters = SDPUtils.parseRtcpParameters(mediaSection);\n\n      var isComplete = SDPUtils.matchPrefix(mediaSection,\n          'a=end-of-candidates', sessionpart).length > 0;\n      var cands = SDPUtils.matchPrefix(mediaSection, 'a=candidate:')\n          .map(function(cand) {\n            return SDPUtils.parseCandidate(cand);\n          })\n          .filter(function(cand) {\n            return cand.component === 1;\n          });\n\n      // Check if we can use BUNDLE and dispose transports.\n      if ((description.type === 'offer' || description.type === 'answer') &&\n          !rejected && usingBundle && sdpMLineIndex > 0 &&\n          pc.transceivers[sdpMLineIndex]) {\n        pc._disposeIceAndDtlsTransports(sdpMLineIndex);\n        pc.transceivers[sdpMLineIndex].iceGatherer =\n            pc.transceivers[0].iceGatherer;\n        pc.transceivers[sdpMLineIndex].iceTransport =\n            pc.transceivers[0].iceTransport;\n        pc.transceivers[sdpMLineIndex].dtlsTransport =\n            pc.transceivers[0].dtlsTransport;\n        if (pc.transceivers[sdpMLineIndex].rtpSender) {\n          pc.transceivers[sdpMLineIndex].rtpSender.setTransport(\n              pc.transceivers[0].dtlsTransport);\n        }\n        if (pc.transceivers[sdpMLineIndex].rtpReceiver) {\n          pc.transceivers[sdpMLineIndex].rtpReceiver.setTransport(\n              pc.transceivers[0].dtlsTransport);\n        }\n      }\n      if (description.type === 'offer' && !rejected) {\n        transceiver = pc.transceivers[sdpMLineIndex] ||\n            pc._createTransceiver(kind);\n        transceiver.mid = mid;\n\n        if (!transceiver.iceGatherer) {\n          transceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\n              usingBundle);\n        }\n\n        if (cands.length && transceiver.iceTransport.state === 'new') {\n          if (isComplete && (!usingBundle || sdpMLineIndex === 0)) {\n            transceiver.iceTransport.setRemoteCandidates(cands);\n          } else {\n            cands.forEach(function(candidate) {\n              maybeAddCandidate(transceiver.iceTransport, candidate);\n            });\n          }\n        }\n\n        localCapabilities = window.RTCRtpReceiver.getCapabilities(kind);\n\n        // filter RTX until additional stuff needed for RTX is implemented\n        // in adapter.js\n        if (edgeVersion < 15019) {\n          localCapabilities.codecs = localCapabilities.codecs.filter(\n              function(codec) {\n                return codec.name !== 'rtx';\n              });\n        }\n\n        sendEncodingParameters = transceiver.sendEncodingParameters || [{\n          ssrc: (2 * sdpMLineIndex + 2) * 1001\n        }];\n\n        // TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\n        var isNewTrack = false;\n        if (direction === 'sendrecv' || direction === 'sendonly') {\n          isNewTrack = !transceiver.rtpReceiver;\n          rtpReceiver = transceiver.rtpReceiver ||\n              new window.RTCRtpReceiver(transceiver.dtlsTransport, kind);\n\n          if (isNewTrack) {\n            var stream;\n            track = rtpReceiver.track;\n            // FIXME: does not work with Plan B.\n            if (remoteMsid && remoteMsid.stream === '-') {\n              // no-op. a stream id of '-' means: no associated stream.\n            } else if (remoteMsid) {\n              if (!streams[remoteMsid.stream]) {\n                streams[remoteMsid.stream] = new window.MediaStream();\n                Object.defineProperty(streams[remoteMsid.stream], 'id', {\n                  get: function() {\n                    return remoteMsid.stream;\n                  }\n                });\n              }\n              Object.defineProperty(track, 'id', {\n                get: function() {\n                  return remoteMsid.track;\n                }\n              });\n              stream = streams[remoteMsid.stream];\n            } else {\n              if (!streams.default) {\n                streams.default = new window.MediaStream();\n              }\n              stream = streams.default;\n            }\n            if (stream) {\n              addTrackToStreamAndFireEvent(track, stream);\n              transceiver.associatedRemoteMediaStreams.push(stream);\n            }\n            receiverList.push([track, rtpReceiver, stream]);\n          }\n        } else if (transceiver.rtpReceiver && transceiver.rtpReceiver.track) {\n          transceiver.associatedRemoteMediaStreams.forEach(function(s) {\n            var nativeTrack = s.getTracks().find(function(t) {\n              return t.id === transceiver.rtpReceiver.track.id;\n            });\n            if (nativeTrack) {\n              removeTrackFromStreamAndFireEvent(nativeTrack, s);\n            }\n          });\n          transceiver.associatedRemoteMediaStreams = [];\n        }\n\n        transceiver.localCapabilities = localCapabilities;\n        transceiver.remoteCapabilities = remoteCapabilities;\n        transceiver.rtpReceiver = rtpReceiver;\n        transceiver.rtcpParameters = rtcpParameters;\n        transceiver.sendEncodingParameters = sendEncodingParameters;\n        transceiver.recvEncodingParameters = recvEncodingParameters;\n\n        // Start the RTCRtpReceiver now. The RTPSender is started in\n        // setLocalDescription.\n        pc._transceive(pc.transceivers[sdpMLineIndex],\n            false,\n            isNewTrack);\n      } else if (description.type === 'answer' && !rejected) {\n        transceiver = pc.transceivers[sdpMLineIndex];\n        iceGatherer = transceiver.iceGatherer;\n        iceTransport = transceiver.iceTransport;\n        dtlsTransport = transceiver.dtlsTransport;\n        rtpReceiver = transceiver.rtpReceiver;\n        sendEncodingParameters = transceiver.sendEncodingParameters;\n        localCapabilities = transceiver.localCapabilities;\n\n        pc.transceivers[sdpMLineIndex].recvEncodingParameters =\n            recvEncodingParameters;\n        pc.transceivers[sdpMLineIndex].remoteCapabilities =\n            remoteCapabilities;\n        pc.transceivers[sdpMLineIndex].rtcpParameters = rtcpParameters;\n\n        if (cands.length && iceTransport.state === 'new') {\n          if ((isIceLite || isComplete) &&\n              (!usingBundle || sdpMLineIndex === 0)) {\n            iceTransport.setRemoteCandidates(cands);\n          } else {\n            cands.forEach(function(candidate) {\n              maybeAddCandidate(transceiver.iceTransport, candidate);\n            });\n          }\n        }\n\n        if (!usingBundle || sdpMLineIndex === 0) {\n          if (iceTransport.state === 'new') {\n            iceTransport.start(iceGatherer, remoteIceParameters,\n                'controlling');\n          }\n          if (dtlsTransport.state === 'new') {\n            dtlsTransport.start(remoteDtlsParameters);\n          }\n        }\n\n        // If the offer contained RTX but the answer did not,\n        // remove RTX from sendEncodingParameters.\n        var commonCapabilities = getCommonCapabilities(\n          transceiver.localCapabilities,\n          transceiver.remoteCapabilities);\n\n        var hasRtx = commonCapabilities.codecs.filter(function(c) {\n          return c.name.toLowerCase() === 'rtx';\n        }).length;\n        if (!hasRtx && transceiver.sendEncodingParameters[0].rtx) {\n          delete transceiver.sendEncodingParameters[0].rtx;\n        }\n\n        pc._transceive(transceiver,\n            direction === 'sendrecv' || direction === 'recvonly',\n            direction === 'sendrecv' || direction === 'sendonly');\n\n        // TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams\n        if (rtpReceiver &&\n            (direction === 'sendrecv' || direction === 'sendonly')) {\n          track = rtpReceiver.track;\n          if (remoteMsid) {\n            if (!streams[remoteMsid.stream]) {\n              streams[remoteMsid.stream] = new window.MediaStream();\n            }\n            addTrackToStreamAndFireEvent(track, streams[remoteMsid.stream]);\n            receiverList.push([track, rtpReceiver, streams[remoteMsid.stream]]);\n          } else {\n            if (!streams.default) {\n              streams.default = new window.MediaStream();\n            }\n            addTrackToStreamAndFireEvent(track, streams.default);\n            receiverList.push([track, rtpReceiver, streams.default]);\n          }\n        } else {\n          // FIXME: actually the receiver should be created later.\n          delete transceiver.rtpReceiver;\n        }\n      }\n    });\n\n    if (pc._dtlsRole === undefined) {\n      pc._dtlsRole = description.type === 'offer' ? 'active' : 'passive';\n    }\n\n    pc._remoteDescription = {\n      type: description.type,\n      sdp: description.sdp\n    };\n    if (description.type === 'offer') {\n      pc._updateSignalingState('have-remote-offer');\n    } else {\n      pc._updateSignalingState('stable');\n    }\n    Object.keys(streams).forEach(function(sid) {\n      var stream = streams[sid];\n      if (stream.getTracks().length) {\n        if (pc.remoteStreams.indexOf(stream) === -1) {\n          pc.remoteStreams.push(stream);\n          var event = new Event('addstream');\n          event.stream = stream;\n          window.setTimeout(function() {\n            pc._dispatchEvent('addstream', event);\n          });\n        }\n\n        receiverList.forEach(function(item) {\n          var track = item[0];\n          var receiver = item[1];\n          if (stream.id !== item[2].id) {\n            return;\n          }\n          fireAddTrack(pc, track, receiver, [stream]);\n        });\n      }\n    });\n    receiverList.forEach(function(item) {\n      if (item[2]) {\n        return;\n      }\n      fireAddTrack(pc, item[0], item[1], []);\n    });\n\n    // check whether addIceCandidate({}) was called within four seconds after\n    // setRemoteDescription.\n    window.setTimeout(function() {\n      if (!(pc && pc.transceivers)) {\n        return;\n      }\n      pc.transceivers.forEach(function(transceiver) {\n        if (transceiver.iceTransport &&\n            transceiver.iceTransport.state === 'new' &&\n            transceiver.iceTransport.getRemoteCandidates().length > 0) {\n          console.warn('Timeout for addRemoteCandidate. Consider sending ' +\n              'an end-of-candidates notification');\n          transceiver.iceTransport.addRemoteCandidate({});\n        }\n      });\n    }, 4000);\n\n    return Promise.resolve();\n  };\n\n  RTCPeerConnection.prototype.close = function() {\n    this.transceivers.forEach(function(transceiver) {\n      /* not yet\n      if (transceiver.iceGatherer) {\n        transceiver.iceGatherer.close();\n      }\n      */\n      if (transceiver.iceTransport) {\n        transceiver.iceTransport.stop();\n      }\n      if (transceiver.dtlsTransport) {\n        transceiver.dtlsTransport.stop();\n      }\n      if (transceiver.rtpSender) {\n        transceiver.rtpSender.stop();\n      }\n      if (transceiver.rtpReceiver) {\n        transceiver.rtpReceiver.stop();\n      }\n    });\n    // FIXME: clean up tracks, local streams, remote streams, etc\n    this._isClosed = true;\n    this._updateSignalingState('closed');\n  };\n\n  // Update the signaling state.\n  RTCPeerConnection.prototype._updateSignalingState = function(newState) {\n    this.signalingState = newState;\n    var event = new Event('signalingstatechange');\n    this._dispatchEvent('signalingstatechange', event);\n  };\n\n  // Determine whether to fire the negotiationneeded event.\n  RTCPeerConnection.prototype._maybeFireNegotiationNeeded = function() {\n    var pc = this;\n    if (this.signalingState !== 'stable' || this.needNegotiation === true) {\n      return;\n    }\n    this.needNegotiation = true;\n    window.setTimeout(function() {\n      if (pc.needNegotiation) {\n        pc.needNegotiation = false;\n        var event = new Event('negotiationneeded');\n        pc._dispatchEvent('negotiationneeded', event);\n      }\n    }, 0);\n  };\n\n  // Update the ice connection state.\n  RTCPeerConnection.prototype._updateIceConnectionState = function() {\n    var newState;\n    var states = {\n      'new': 0,\n      closed: 0,\n      checking: 0,\n      connected: 0,\n      completed: 0,\n      disconnected: 0,\n      failed: 0\n    };\n    this.transceivers.forEach(function(transceiver) {\n      if (transceiver.iceTransport && !transceiver.rejected) {\n        states[transceiver.iceTransport.state]++;\n      }\n    });\n\n    newState = 'new';\n    if (states.failed > 0) {\n      newState = 'failed';\n    } else if (states.checking > 0) {\n      newState = 'checking';\n    } else if (states.disconnected > 0) {\n      newState = 'disconnected';\n    } else if (states.new > 0) {\n      newState = 'new';\n    } else if (states.connected > 0) {\n      newState = 'connected';\n    } else if (states.completed > 0) {\n      newState = 'completed';\n    }\n\n    if (newState !== this.iceConnectionState) {\n      this.iceConnectionState = newState;\n      var event = new Event('iceconnectionstatechange');\n      this._dispatchEvent('iceconnectionstatechange', event);\n    }\n  };\n\n  // Update the connection state.\n  RTCPeerConnection.prototype._updateConnectionState = function() {\n    var newState;\n    var states = {\n      'new': 0,\n      closed: 0,\n      connecting: 0,\n      connected: 0,\n      completed: 0,\n      disconnected: 0,\n      failed: 0\n    };\n    this.transceivers.forEach(function(transceiver) {\n      if (transceiver.iceTransport && transceiver.dtlsTransport &&\n          !transceiver.rejected) {\n        states[transceiver.iceTransport.state]++;\n        states[transceiver.dtlsTransport.state]++;\n      }\n    });\n    // ICETransport.completed and connected are the same for this purpose.\n    states.connected += states.completed;\n\n    newState = 'new';\n    if (states.failed > 0) {\n      newState = 'failed';\n    } else if (states.connecting > 0) {\n      newState = 'connecting';\n    } else if (states.disconnected > 0) {\n      newState = 'disconnected';\n    } else if (states.new > 0) {\n      newState = 'new';\n    } else if (states.connected > 0) {\n      newState = 'connected';\n    }\n\n    if (newState !== this.connectionState) {\n      this.connectionState = newState;\n      var event = new Event('connectionstatechange');\n      this._dispatchEvent('connectionstatechange', event);\n    }\n  };\n\n  RTCPeerConnection.prototype.createOffer = function() {\n    var pc = this;\n\n    if (pc._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createOffer after close'));\n    }\n\n    var numAudioTracks = pc.transceivers.filter(function(t) {\n      return t.kind === 'audio';\n    }).length;\n    var numVideoTracks = pc.transceivers.filter(function(t) {\n      return t.kind === 'video';\n    }).length;\n\n    // Determine number of audio and video tracks we need to send/recv.\n    var offerOptions = arguments[0];\n    if (offerOptions) {\n      // Reject Chrome legacy constraints.\n      if (offerOptions.mandatory || offerOptions.optional) {\n        throw new TypeError(\n            'Legacy mandatory/optional constraints not supported.');\n      }\n      if (offerOptions.offerToReceiveAudio !== undefined) {\n        if (offerOptions.offerToReceiveAudio === true) {\n          numAudioTracks = 1;\n        } else if (offerOptions.offerToReceiveAudio === false) {\n          numAudioTracks = 0;\n        } else {\n          numAudioTracks = offerOptions.offerToReceiveAudio;\n        }\n      }\n      if (offerOptions.offerToReceiveVideo !== undefined) {\n        if (offerOptions.offerToReceiveVideo === true) {\n          numVideoTracks = 1;\n        } else if (offerOptions.offerToReceiveVideo === false) {\n          numVideoTracks = 0;\n        } else {\n          numVideoTracks = offerOptions.offerToReceiveVideo;\n        }\n      }\n    }\n\n    pc.transceivers.forEach(function(transceiver) {\n      if (transceiver.kind === 'audio') {\n        numAudioTracks--;\n        if (numAudioTracks < 0) {\n          transceiver.wantReceive = false;\n        }\n      } else if (transceiver.kind === 'video') {\n        numVideoTracks--;\n        if (numVideoTracks < 0) {\n          transceiver.wantReceive = false;\n        }\n      }\n    });\n\n    // Create M-lines for recvonly streams.\n    while (numAudioTracks > 0 || numVideoTracks > 0) {\n      if (numAudioTracks > 0) {\n        pc._createTransceiver('audio');\n        numAudioTracks--;\n      }\n      if (numVideoTracks > 0) {\n        pc._createTransceiver('video');\n        numVideoTracks--;\n      }\n    }\n\n    var sdp = SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,\n        pc._sdpSessionVersion++);\n    pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      // For each track, create an ice gatherer, ice transport,\n      // dtls transport, potentially rtpsender and rtpreceiver.\n      var track = transceiver.track;\n      var kind = transceiver.kind;\n      var mid = transceiver.mid || SDPUtils.generateIdentifier();\n      transceiver.mid = mid;\n\n      if (!transceiver.iceGatherer) {\n        transceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,\n            pc.usingBundle);\n      }\n\n      var localCapabilities = window.RTCRtpSender.getCapabilities(kind);\n      // filter RTX until additional stuff needed for RTX is implemented\n      // in adapter.js\n      if (edgeVersion < 15019) {\n        localCapabilities.codecs = localCapabilities.codecs.filter(\n            function(codec) {\n              return codec.name !== 'rtx';\n            });\n      }\n      localCapabilities.codecs.forEach(function(codec) {\n        // work around https://bugs.chromium.org/p/webrtc/issues/detail?id=6552\n        // by adding level-asymmetry-allowed=1\n        if (codec.name === 'H264' &&\n            codec.parameters['level-asymmetry-allowed'] === undefined) {\n          codec.parameters['level-asymmetry-allowed'] = '1';\n        }\n\n        // for subsequent offers, we might have to re-use the payload\n        // type of the last offer.\n        if (transceiver.remoteCapabilities &&\n            transceiver.remoteCapabilities.codecs) {\n          transceiver.remoteCapabilities.codecs.forEach(function(remoteCodec) {\n            if (codec.name.toLowerCase() === remoteCodec.name.toLowerCase() &&\n                codec.clockRate === remoteCodec.clockRate) {\n              codec.preferredPayloadType = remoteCodec.payloadType;\n            }\n          });\n        }\n      });\n      localCapabilities.headerExtensions.forEach(function(hdrExt) {\n        var remoteExtensions = transceiver.remoteCapabilities &&\n            transceiver.remoteCapabilities.headerExtensions || [];\n        remoteExtensions.forEach(function(rHdrExt) {\n          if (hdrExt.uri === rHdrExt.uri) {\n            hdrExt.id = rHdrExt.id;\n          }\n        });\n      });\n\n      // generate an ssrc now, to be used later in rtpSender.send\n      var sendEncodingParameters = transceiver.sendEncodingParameters || [{\n        ssrc: (2 * sdpMLineIndex + 1) * 1001\n      }];\n      if (track) {\n        // add RTX\n        if (edgeVersion >= 15019 && kind === 'video' &&\n            !sendEncodingParameters[0].rtx) {\n          sendEncodingParameters[0].rtx = {\n            ssrc: sendEncodingParameters[0].ssrc + 1\n          };\n        }\n      }\n\n      if (transceiver.wantReceive) {\n        transceiver.rtpReceiver = new window.RTCRtpReceiver(\n            transceiver.dtlsTransport, kind);\n      }\n\n      transceiver.localCapabilities = localCapabilities;\n      transceiver.sendEncodingParameters = sendEncodingParameters;\n    });\n\n    // always offer BUNDLE and dispose on return if not supported.\n    if (pc._config.bundlePolicy !== 'max-compat') {\n      sdp += 'a=group:BUNDLE ' + pc.transceivers.map(function(t) {\n        return t.mid;\n      }).join(' ') + '\\r\\n';\n    }\n    sdp += 'a=ice-options:trickle\\r\\n';\n\n    pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      sdp += writeMediaSection(transceiver, transceiver.localCapabilities,\n          'offer', transceiver.stream, pc._dtlsRole);\n      sdp += 'a=rtcp-rsize\\r\\n';\n\n      if (transceiver.iceGatherer && pc.iceGatheringState !== 'new' &&\n          (sdpMLineIndex === 0 || !pc.usingBundle)) {\n        transceiver.iceGatherer.getLocalCandidates().forEach(function(cand) {\n          cand.component = 1;\n          sdp += 'a=' + SDPUtils.writeCandidate(cand) + '\\r\\n';\n        });\n\n        if (transceiver.iceGatherer.state === 'completed') {\n          sdp += 'a=end-of-candidates\\r\\n';\n        }\n      }\n    });\n\n    var desc = new window.RTCSessionDescription({\n      type: 'offer',\n      sdp: sdp\n    });\n    return Promise.resolve(desc);\n  };\n\n  RTCPeerConnection.prototype.createAnswer = function() {\n    var pc = this;\n\n    if (pc._isClosed) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createAnswer after close'));\n    }\n\n    if (!(pc.signalingState === 'have-remote-offer' ||\n        pc.signalingState === 'have-local-pranswer')) {\n      return Promise.reject(makeError('InvalidStateError',\n          'Can not call createAnswer in signalingState ' + pc.signalingState));\n    }\n\n    var sdp = SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,\n        pc._sdpSessionVersion++);\n    if (pc.usingBundle) {\n      sdp += 'a=group:BUNDLE ' + pc.transceivers.map(function(t) {\n        return t.mid;\n      }).join(' ') + '\\r\\n';\n    }\n    sdp += 'a=ice-options:trickle\\r\\n';\n\n    var mediaSectionsInOffer = SDPUtils.getMediaSections(\n        pc._remoteDescription.sdp).length;\n    pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      if (sdpMLineIndex + 1 > mediaSectionsInOffer) {\n        return;\n      }\n      if (transceiver.rejected) {\n        if (transceiver.kind === 'application') {\n          if (transceiver.protocol === 'DTLS/SCTP') { // legacy fmt\n            sdp += 'm=application 0 DTLS/SCTP 5000\\r\\n';\n          } else {\n            sdp += 'm=application 0 ' + transceiver.protocol +\n                ' webrtc-datachannel\\r\\n';\n          }\n        } else if (transceiver.kind === 'audio') {\n          sdp += 'm=audio 0 UDP/TLS/RTP/SAVPF 0\\r\\n' +\n              'a=rtpmap:0 PCMU/8000\\r\\n';\n        } else if (transceiver.kind === 'video') {\n          sdp += 'm=video 0 UDP/TLS/RTP/SAVPF 120\\r\\n' +\n              'a=rtpmap:120 VP8/90000\\r\\n';\n        }\n        sdp += 'c=IN IP4 0.0.0.0\\r\\n' +\n            'a=inactive\\r\\n' +\n            'a=mid:' + transceiver.mid + '\\r\\n';\n        return;\n      }\n\n      // FIXME: look at direction.\n      if (transceiver.stream) {\n        var localTrack;\n        if (transceiver.kind === 'audio') {\n          localTrack = transceiver.stream.getAudioTracks()[0];\n        } else if (transceiver.kind === 'video') {\n          localTrack = transceiver.stream.getVideoTracks()[0];\n        }\n        if (localTrack) {\n          // add RTX\n          if (edgeVersion >= 15019 && transceiver.kind === 'video' &&\n              !transceiver.sendEncodingParameters[0].rtx) {\n            transceiver.sendEncodingParameters[0].rtx = {\n              ssrc: transceiver.sendEncodingParameters[0].ssrc + 1\n            };\n          }\n        }\n      }\n\n      // Calculate intersection of capabilities.\n      var commonCapabilities = getCommonCapabilities(\n          transceiver.localCapabilities,\n          transceiver.remoteCapabilities);\n\n      var hasRtx = commonCapabilities.codecs.filter(function(c) {\n        return c.name.toLowerCase() === 'rtx';\n      }).length;\n      if (!hasRtx && transceiver.sendEncodingParameters[0].rtx) {\n        delete transceiver.sendEncodingParameters[0].rtx;\n      }\n\n      sdp += writeMediaSection(transceiver, commonCapabilities,\n          'answer', transceiver.stream, pc._dtlsRole);\n      if (transceiver.rtcpParameters &&\n          transceiver.rtcpParameters.reducedSize) {\n        sdp += 'a=rtcp-rsize\\r\\n';\n      }\n    });\n\n    var desc = new window.RTCSessionDescription({\n      type: 'answer',\n      sdp: sdp\n    });\n    return Promise.resolve(desc);\n  };\n\n  RTCPeerConnection.prototype.addIceCandidate = function(candidate) {\n    var pc = this;\n    var sections;\n    if (candidate && !(candidate.sdpMLineIndex !== undefined ||\n        candidate.sdpMid)) {\n      return Promise.reject(new TypeError('sdpMLineIndex or sdpMid required'));\n    }\n\n    // TODO: needs to go into ops queue.\n    return new Promise(function(resolve, reject) {\n      if (!pc._remoteDescription) {\n        return reject(makeError('InvalidStateError',\n            'Can not add ICE candidate without a remote description'));\n      } else if (!candidate || candidate.candidate === '') {\n        for (var j = 0; j < pc.transceivers.length; j++) {\n          if (pc.transceivers[j].rejected) {\n            continue;\n          }\n          pc.transceivers[j].iceTransport.addRemoteCandidate({});\n          sections = SDPUtils.getMediaSections(pc._remoteDescription.sdp);\n          sections[j] += 'a=end-of-candidates\\r\\n';\n          pc._remoteDescription.sdp =\n              SDPUtils.getDescription(pc._remoteDescription.sdp) +\n              sections.join('');\n          if (pc.usingBundle) {\n            break;\n          }\n        }\n      } else {\n        var sdpMLineIndex = candidate.sdpMLineIndex;\n        if (candidate.sdpMid) {\n          for (var i = 0; i < pc.transceivers.length; i++) {\n            if (pc.transceivers[i].mid === candidate.sdpMid) {\n              sdpMLineIndex = i;\n              break;\n            }\n          }\n        }\n        var transceiver = pc.transceivers[sdpMLineIndex];\n        if (transceiver) {\n          if (transceiver.rejected) {\n            return resolve();\n          }\n          var cand = Object.keys(candidate.candidate).length > 0 ?\n              SDPUtils.parseCandidate(candidate.candidate) : {};\n          // Ignore Chrome's invalid candidates since Edge does not like them.\n          if (cand.protocol === 'tcp' && (cand.port === 0 || cand.port === 9)) {\n            return resolve();\n          }\n          // Ignore RTCP candidates, we assume RTCP-MUX.\n          if (cand.component && cand.component !== 1) {\n            return resolve();\n          }\n          // when using bundle, avoid adding candidates to the wrong\n          // ice transport. And avoid adding candidates added in the SDP.\n          if (sdpMLineIndex === 0 || (sdpMLineIndex > 0 &&\n              transceiver.iceTransport !== pc.transceivers[0].iceTransport)) {\n            if (!maybeAddCandidate(transceiver.iceTransport, cand)) {\n              return reject(makeError('OperationError',\n                  'Can not add ICE candidate'));\n            }\n          }\n\n          // update the remoteDescription.\n          var candidateString = candidate.candidate.trim();\n          if (candidateString.indexOf('a=') === 0) {\n            candidateString = candidateString.substr(2);\n          }\n          sections = SDPUtils.getMediaSections(pc._remoteDescription.sdp);\n          sections[sdpMLineIndex] += 'a=' +\n              (cand.type ? candidateString : 'end-of-candidates')\n              + '\\r\\n';\n          pc._remoteDescription.sdp =\n              SDPUtils.getDescription(pc._remoteDescription.sdp) +\n              sections.join('');\n        } else {\n          return reject(makeError('OperationError',\n              'Can not add ICE candidate'));\n        }\n      }\n      resolve();\n    });\n  };\n\n  RTCPeerConnection.prototype.getStats = function(selector) {\n    if (selector && selector instanceof window.MediaStreamTrack) {\n      var senderOrReceiver = null;\n      this.transceivers.forEach(function(transceiver) {\n        if (transceiver.rtpSender &&\n            transceiver.rtpSender.track === selector) {\n          senderOrReceiver = transceiver.rtpSender;\n        } else if (transceiver.rtpReceiver &&\n            transceiver.rtpReceiver.track === selector) {\n          senderOrReceiver = transceiver.rtpReceiver;\n        }\n      });\n      if (!senderOrReceiver) {\n        throw makeError('InvalidAccessError', 'Invalid selector.');\n      }\n      return senderOrReceiver.getStats();\n    }\n\n    var promises = [];\n    this.transceivers.forEach(function(transceiver) {\n      ['rtpSender', 'rtpReceiver', 'iceGatherer', 'iceTransport',\n          'dtlsTransport'].forEach(function(method) {\n            if (transceiver[method]) {\n              promises.push(transceiver[method].getStats());\n            }\n          });\n    });\n    return Promise.all(promises).then(function(allStats) {\n      var results = new Map();\n      allStats.forEach(function(stats) {\n        stats.forEach(function(stat) {\n          results.set(stat.id, stat);\n        });\n      });\n      return results;\n    });\n  };\n\n  // fix low-level stat names and return Map instead of object.\n  var ortcObjects = ['RTCRtpSender', 'RTCRtpReceiver', 'RTCIceGatherer',\n    'RTCIceTransport', 'RTCDtlsTransport'];\n  ortcObjects.forEach(function(ortcObjectName) {\n    var obj = window[ortcObjectName];\n    if (obj && obj.prototype && obj.prototype.getStats) {\n      var nativeGetstats = obj.prototype.getStats;\n      obj.prototype.getStats = function() {\n        return nativeGetstats.apply(this)\n        .then(function(nativeStats) {\n          var mapStats = new Map();\n          Object.keys(nativeStats).forEach(function(id) {\n            nativeStats[id].type = fixStatsType(nativeStats[id]);\n            mapStats.set(id, nativeStats[id]);\n          });\n          return mapStats;\n        });\n      };\n    }\n  });\n\n  // legacy callback shims. Should be moved to adapter.js some days.\n  var methods = ['createOffer', 'createAnswer'];\n  methods.forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[0] === 'function' ||\n          typeof args[1] === 'function') { // legacy\n        return nativeMethod.apply(this, [arguments[2]])\n        .then(function(description) {\n          if (typeof args[0] === 'function') {\n            args[0].apply(null, [description]);\n          }\n        }, function(error) {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null, [error]);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  methods = ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'];\n  methods.forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[1] === 'function' ||\n          typeof args[2] === 'function') { // legacy\n        return nativeMethod.apply(this, arguments)\n        .then(function() {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null);\n          }\n        }, function(error) {\n          if (typeof args[2] === 'function') {\n            args[2].apply(null, [error]);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  // getStats is special. It doesn't have a spec legacy method yet we support\n  // getStats(something, cb) without error callbacks.\n  ['getStats'].forEach(function(method) {\n    var nativeMethod = RTCPeerConnection.prototype[method];\n    RTCPeerConnection.prototype[method] = function() {\n      var args = arguments;\n      if (typeof args[1] === 'function') {\n        return nativeMethod.apply(this, arguments)\n        .then(function() {\n          if (typeof args[1] === 'function') {\n            args[1].apply(null);\n          }\n        });\n      }\n      return nativeMethod.apply(this, arguments);\n    };\n  });\n\n  return RTCPeerConnection;\n};\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nexport function shimGetUserMedia(window) {\n  const navigator = window && window.navigator;\n\n  const shimError_ = function(e) {\n    return {\n      name: {PermissionDeniedError: 'NotAllowedError'}[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraint,\n      toString() {\n        return this.name;\n      }\n    };\n  };\n\n  // getUserMedia error shim.\n  const origGetUserMedia = navigator.mediaDevices.getUserMedia.\n      bind(navigator.mediaDevices);\n  navigator.mediaDevices.getUserMedia = function(c) {\n    return origGetUserMedia(c).catch(e => Promise.reject(shimError_(e)));\n  };\n}\n","/*\n *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nexport function shimGetDisplayMedia(window) {\n  if (!('getDisplayMedia' in window.navigator)) {\n    return;\n  }\n  if (!(window.navigator.mediaDevices)) {\n    return;\n  }\n  if (window.navigator.mediaDevices &&\n    'getDisplayMedia' in window.navigator.mediaDevices) {\n    return;\n  }\n  window.navigator.mediaDevices.getDisplayMedia =\n    window.navigator.getDisplayMedia.bind(window.navigator);\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\nimport {filterIceServers} from './filtericeservers';\nimport shimRTCPeerConnection from 'rtcpeerconnection-shim';\n\nexport {shimGetUserMedia} from './getusermedia';\nexport {shimGetDisplayMedia} from './getdisplaymedia';\n\nexport function shimPeerConnection(window) {\n  const browserDetails = utils.detectBrowser(window);\n\n  if (window.RTCIceGatherer) {\n    if (!window.RTCIceCandidate) {\n      window.RTCIceCandidate = function RTCIceCandidate(args) {\n        return args;\n      };\n    }\n    if (!window.RTCSessionDescription) {\n      window.RTCSessionDescription = function RTCSessionDescription(args) {\n        return args;\n      };\n    }\n    // this adds an additional event listener to MediaStrackTrack that signals\n    // when a tracks enabled property was changed. Workaround for a bug in\n    // addStream, see below. No longer required in 15025+\n    if (browserDetails.version < 15025) {\n      const origMSTEnabled = Object.getOwnPropertyDescriptor(\n          window.MediaStreamTrack.prototype, 'enabled');\n      Object.defineProperty(window.MediaStreamTrack.prototype, 'enabled', {\n        set(value) {\n          origMSTEnabled.set.call(this, value);\n          const ev = new Event('enabled');\n          ev.enabled = value;\n          this.dispatchEvent(ev);\n        }\n      });\n    }\n  }\n\n  // ORTC defines the DTMF sender a bit different.\n  // https://github.com/w3c/ortc/issues/714\n  if (window.RTCRtpSender && !('dtmf' in window.RTCRtpSender.prototype)) {\n    Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n      get() {\n        if (this._dtmf === undefined) {\n          if (this.track.kind === 'audio') {\n            this._dtmf = new window.RTCDtmfSender(this);\n          } else if (this.track.kind === 'video') {\n            this._dtmf = null;\n          }\n        }\n        return this._dtmf;\n      }\n    });\n  }\n  // Edge currently only implements the RTCDtmfSender, not the\n  // RTCDTMFSender alias. See http://draft.ortc.org/#rtcdtmfsender2*\n  if (window.RTCDtmfSender && !window.RTCDTMFSender) {\n    window.RTCDTMFSender = window.RTCDtmfSender;\n  }\n\n  const RTCPeerConnectionShim = shimRTCPeerConnection(window,\n      browserDetails.version);\n  window.RTCPeerConnection = function RTCPeerConnection(config) {\n    if (config && config.iceServers) {\n      config.iceServers = filterIceServers(config.iceServers,\n        browserDetails.version);\n      utils.log('ICE servers after filtering:', config.iceServers);\n    }\n    return new RTCPeerConnectionShim(config);\n  };\n  window.RTCPeerConnection.prototype = RTCPeerConnectionShim.prototype;\n}\n\nexport function shimReplaceTrack(window) {\n  // ORTC has replaceTrack -- https://github.com/w3c/ortc/issues/614\n  if (window.RTCRtpSender &&\n      !('replaceTrack' in window.RTCRtpSender.prototype)) {\n    window.RTCRtpSender.prototype.replaceTrack =\n        window.RTCRtpSender.prototype.setTrack;\n  }\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\n\nexport function shimGetUserMedia(window) {\n  const browserDetails = utils.detectBrowser(window);\n  const navigator = window && window.navigator;\n  const MediaStreamTrack = window && window.MediaStreamTrack;\n\n  navigator.getUserMedia = function(constraints, onSuccess, onError) {\n    // Replace Firefox 44+'s deprecation warning with unprefixed version.\n    utils.deprecated('navigator.getUserMedia',\n        'navigator.mediaDevices.getUserMedia');\n    navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);\n  };\n\n  if (!(browserDetails.version > 55 &&\n      'autoGainControl' in navigator.mediaDevices.getSupportedConstraints())) {\n    const remap = function(obj, a, b) {\n      if (a in obj && !(b in obj)) {\n        obj[b] = obj[a];\n        delete obj[a];\n      }\n    };\n\n    const nativeGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      if (typeof c === 'object' && typeof c.audio === 'object') {\n        c = JSON.parse(JSON.stringify(c));\n        remap(c.audio, 'autoGainControl', 'mozAutoGainControl');\n        remap(c.audio, 'noiseSuppression', 'mozNoiseSuppression');\n      }\n      return nativeGetUserMedia(c);\n    };\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.getSettings) {\n      const nativeGetSettings = MediaStreamTrack.prototype.getSettings;\n      MediaStreamTrack.prototype.getSettings = function() {\n        const obj = nativeGetSettings.apply(this, arguments);\n        remap(obj, 'mozAutoGainControl', 'autoGainControl');\n        remap(obj, 'mozNoiseSuppression', 'noiseSuppression');\n        return obj;\n      };\n    }\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.applyConstraints) {\n      const nativeApplyConstraints =\n        MediaStreamTrack.prototype.applyConstraints;\n      MediaStreamTrack.prototype.applyConstraints = function(c) {\n        if (this.kind === 'audio' && typeof c === 'object') {\n          c = JSON.parse(JSON.stringify(c));\n          remap(c, 'autoGainControl', 'mozAutoGainControl');\n          remap(c, 'noiseSuppression', 'mozNoiseSuppression');\n        }\n        return nativeApplyConstraints.apply(this, [c]);\n      };\n    }\n  }\n}\n","/*\n *  Copyright (c) 2018 The adapter.js project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nexport function shimGetDisplayMedia(window, preferredMediaSource) {\n  if (window.navigator.mediaDevices &&\n    'getDisplayMedia' in window.navigator.mediaDevices) {\n    return;\n  }\n  if (!(window.navigator.mediaDevices)) {\n    return;\n  }\n  window.navigator.mediaDevices.getDisplayMedia =\n    function getDisplayMedia(constraints) {\n      if (!(constraints && constraints.video)) {\n        const err = new DOMException('getDisplayMedia without video ' +\n            'constraints is undefined');\n        err.name = 'NotFoundError';\n        // from https://heycam.github.io/webidl/#idl-DOMException-error-names\n        err.code = 8;\n        return Promise.reject(err);\n      }\n      if (constraints.video === true) {\n        constraints.video = {mediaSource: preferredMediaSource};\n      } else {\n        constraints.video.mediaSource = preferredMediaSource;\n      }\n      return window.navigator.mediaDevices.getUserMedia(constraints);\n    };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\nexport {shimGetUserMedia} from './getusermedia';\nexport {shimGetDisplayMedia} from './getdisplaymedia';\n\nexport function shimOnTrack(window) {\n  if (typeof window === 'object' && window.RTCTrackEvent &&\n      ('receiver' in window.RTCTrackEvent.prototype) &&\n      !('transceiver' in window.RTCTrackEvent.prototype)) {\n    Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n      get() {\n        return {receiver: this.receiver};\n      }\n    });\n  }\n}\n\nexport function shimPeerConnection(window) {\n  const browserDetails = utils.detectBrowser(window);\n\n  if (typeof window !== 'object' ||\n      !(window.RTCPeerConnection || window.mozRTCPeerConnection)) {\n    return; // probably media.peerconnection.enabled=false in about:config\n  }\n  if (!window.RTCPeerConnection && window.mozRTCPeerConnection) {\n    // very basic support for old versions.\n    window.RTCPeerConnection = window.mozRTCPeerConnection;\n  }\n\n  if (browserDetails.version < 53) {\n    // shim away need for obsolete RTCIceCandidate/RTCSessionDescription.\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          const nativeMethod = window.RTCPeerConnection.prototype[method];\n          const methodObj = {[method]() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                window.RTCIceCandidate :\n                window.RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          }};\n          window.RTCPeerConnection.prototype[method] = methodObj[method];\n        });\n  }\n\n  // support for addIceCandidate(null or undefined)\n  // as well as ignoring {sdpMid, candidate: \"\"}\n  if (browserDetails.version < 68) {\n    const nativeAddIceCandidate =\n        window.RTCPeerConnection.prototype.addIceCandidate;\n    window.RTCPeerConnection.prototype.addIceCandidate =\n    function addIceCandidate() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      // Firefox 68+ emits and processes {candidate: \"\", ...}, ignore\n      // in older versions.\n      if (arguments[0] && arguments[0].candidate === '') {\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n  }\n\n  const modernStatsTypes = {\n    inboundrtp: 'inbound-rtp',\n    outboundrtp: 'outbound-rtp',\n    candidatepair: 'candidate-pair',\n    localcandidate: 'local-candidate',\n    remotecandidate: 'remote-candidate'\n  };\n\n  const nativeGetStats = window.RTCPeerConnection.prototype.getStats;\n  window.RTCPeerConnection.prototype.getStats = function getStats() {\n    const [selector, onSucc, onErr] = arguments;\n    return nativeGetStats.apply(this, [selector || null])\n      .then(stats => {\n        if (browserDetails.version < 53 && !onSucc) {\n          // Shim only promise getStats with spec-hyphens in type names\n          // Leave callback version alone; misc old uses of forEach before Map\n          try {\n            stats.forEach(stat => {\n              stat.type = modernStatsTypes[stat.type] || stat.type;\n            });\n          } catch (e) {\n            if (e.name !== 'TypeError') {\n              throw e;\n            }\n            // Avoid TypeError: \"type\" is read-only, in old versions. 34-43ish\n            stats.forEach((stat, i) => {\n              stats.set(i, Object.assign({}, stat, {\n                type: modernStatsTypes[stat.type] || stat.type\n              }));\n            });\n          }\n        }\n        return stats;\n      })\n      .then(onSucc, onErr);\n  };\n}\n\nexport function shimSenderGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender)) {\n    return;\n  }\n  if (window.RTCRtpSender && 'getStats' in window.RTCRtpSender.prototype) {\n    return;\n  }\n  const origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n  if (origGetSenders) {\n    window.RTCPeerConnection.prototype.getSenders = function getSenders() {\n      const senders = origGetSenders.apply(this, []);\n      senders.forEach(sender => sender._pc = this);\n      return senders;\n    };\n  }\n\n  const origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n  if (origAddTrack) {\n    window.RTCPeerConnection.prototype.addTrack = function addTrack() {\n      const sender = origAddTrack.apply(this, arguments);\n      sender._pc = this;\n      return sender;\n    };\n  }\n  window.RTCRtpSender.prototype.getStats = function getStats() {\n    return this.track ? this._pc.getStats(this.track) :\n        Promise.resolve(new Map());\n  };\n}\n\nexport function shimReceiverGetStats(window) {\n  if (!(typeof window === 'object' && window.RTCPeerConnection &&\n      window.RTCRtpSender)) {\n    return;\n  }\n  if (window.RTCRtpSender && 'getStats' in window.RTCRtpReceiver.prototype) {\n    return;\n  }\n  const origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;\n  if (origGetReceivers) {\n    window.RTCPeerConnection.prototype.getReceivers = function getReceivers() {\n      const receivers = origGetReceivers.apply(this, []);\n      receivers.forEach(receiver => receiver._pc = this);\n      return receivers;\n    };\n  }\n  utils.wrapPeerConnectionEvent(window, 'track', e => {\n    e.receiver._pc = e.srcElement;\n    return e;\n  });\n  window.RTCRtpReceiver.prototype.getStats = function getStats() {\n    return this._pc.getStats(this.track);\n  };\n}\n\nexport function shimRemoveStream(window) {\n  if (!window.RTCPeerConnection ||\n      'removeStream' in window.RTCPeerConnection.prototype) {\n    return;\n  }\n  window.RTCPeerConnection.prototype.removeStream =\n    function removeStream(stream) {\n      utils.deprecated('removeStream', 'removeTrack');\n      this.getSenders().forEach(sender => {\n        if (sender.track && stream.getTracks().includes(sender.track)) {\n          this.removeTrack(sender);\n        }\n      });\n    };\n}\n\nexport function shimRTCDataChannel(window) {\n  // rename DataChannel to RTCDataChannel (native fix in FF60):\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1173851\n  if (window.DataChannel && !window.RTCDataChannel) {\n    window.RTCDataChannel = window.DataChannel;\n  }\n}\n\nexport function shimAddTransceiver(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origAddTransceiver = window.RTCPeerConnection.prototype.addTransceiver;\n  if (origAddTransceiver) {\n    window.RTCPeerConnection.prototype.addTransceiver =\n      function addTransceiver() {\n        this.setParametersPromises = [];\n        const initParameters = arguments[1];\n        const shouldPerformCheck = initParameters &&\n                                  'sendEncodings' in initParameters;\n        if (shouldPerformCheck) {\n          // If sendEncodings params are provided, validate grammar\n          initParameters.sendEncodings.forEach((encodingParam) => {\n            if ('rid' in encodingParam) {\n              const ridRegex = /^[a-z0-9]{0,16}$/i;\n              if (!ridRegex.test(encodingParam.rid)) {\n                throw new TypeError('Invalid RID value provided.');\n              }\n            }\n            if ('scaleResolutionDownBy' in encodingParam) {\n              if (!(parseFloat(encodingParam.scaleResolutionDownBy) >= 1.0)) {\n                throw new RangeError('scale_resolution_down_by must be >= 1.0');\n              }\n            }\n            if ('maxFramerate' in encodingParam) {\n              if (!(parseFloat(encodingParam.maxFramerate) >= 0)) {\n                throw new RangeError('max_framerate must be >= 0.0');\n              }\n            }\n          });\n        }\n        const transceiver = origAddTransceiver.apply(this, arguments);\n        if (shouldPerformCheck) {\n          // Check if the init options were applied. If not we do this in an\n          // asynchronous way and save the promise reference in a global object.\n          // This is an ugly hack, but at the same time is way more robust than\n          // checking the sender parameters before and after the createOffer\n          // Also note that after the createoffer we are not 100% sure that\n          // the params were asynchronously applied so we might miss the\n          // opportunity to recreate offer.\n          const {sender} = transceiver;\n          const params = sender.getParameters();\n          if (!('encodings' in params)) {\n            params.encodings = initParameters.sendEncodings;\n            this.setParametersPromises.push(\n              sender.setParameters(params)\n              .catch(() => {})\n            );\n          }\n        }\n        return transceiver;\n      };\n  }\n}\n\nexport function shimCreateOffer(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n  window.RTCPeerConnection.prototype.createOffer = function createOffer() {\n    if (this.setParametersPromises && this.setParametersPromises.length) {\n      return Promise.all(this.setParametersPromises)\n      .then(() => {\n        return origCreateOffer.apply(this, arguments);\n      })\n      .finally(() => {\n        this.setParametersPromises = [];\n      });\n    }\n    return origCreateOffer.apply(this, arguments);\n  };\n}\n\nexport function shimCreateAnswer(window) {\n  // https://github.com/webrtcHacks/adapter/issues/998#issuecomment-516921647\n  // Firefox ignores the init sendEncodings options passed to addTransceiver\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1396918\n  if (!(typeof window === 'object' && window.RTCPeerConnection)) {\n    return;\n  }\n  const origCreateAnswer = window.RTCPeerConnection.prototype.createAnswer;\n  window.RTCPeerConnection.prototype.createAnswer = function createAnswer() {\n    if (this.setParametersPromises && this.setParametersPromises.length) {\n      return Promise.all(this.setParametersPromises)\n      .then(() => {\n        return origCreateAnswer.apply(this, arguments);\n      })\n      .finally(() => {\n        this.setParametersPromises = [];\n      });\n    }\n    return origCreateAnswer.apply(this, arguments);\n  };\n}","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n'use strict';\nimport * as utils from '../utils';\n\nexport function shimLocalStreamsAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  if (!('getLocalStreams' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.getLocalStreams =\n      function getLocalStreams() {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        return this._localStreams;\n      };\n  }\n  if (!('addStream' in window.RTCPeerConnection.prototype)) {\n    const _addTrack = window.RTCPeerConnection.prototype.addTrack;\n    window.RTCPeerConnection.prototype.addStream = function addStream(stream) {\n      if (!this._localStreams) {\n        this._localStreams = [];\n      }\n      if (!this._localStreams.includes(stream)) {\n        this._localStreams.push(stream);\n      }\n      // Try to emulate Chrome's behaviour of adding in audio-video order.\n      // Safari orders by track id.\n      stream.getAudioTracks().forEach(track => _addTrack.call(this, track,\n        stream));\n      stream.getVideoTracks().forEach(track => _addTrack.call(this, track,\n        stream));\n    };\n\n    window.RTCPeerConnection.prototype.addTrack =\n      function addTrack(track) {\n        const stream = arguments[1];\n        if (stream) {\n          if (!this._localStreams) {\n            this._localStreams = [stream];\n          } else if (!this._localStreams.includes(stream)) {\n            this._localStreams.push(stream);\n          }\n        }\n        return _addTrack.apply(this, arguments);\n      };\n  }\n  if (!('removeStream' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.removeStream =\n      function removeStream(stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        const index = this._localStreams.indexOf(stream);\n        if (index === -1) {\n          return;\n        }\n        this._localStreams.splice(index, 1);\n        const tracks = stream.getTracks();\n        this.getSenders().forEach(sender => {\n          if (tracks.includes(sender.track)) {\n            this.removeTrack(sender);\n          }\n        });\n      };\n  }\n}\n\nexport function shimRemoteStreamsAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  if (!('getRemoteStreams' in window.RTCPeerConnection.prototype)) {\n    window.RTCPeerConnection.prototype.getRemoteStreams =\n      function getRemoteStreams() {\n        return this._remoteStreams ? this._remoteStreams : [];\n      };\n  }\n  if (!('onaddstream' in window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'onaddstream', {\n      get() {\n        return this._onaddstream;\n      },\n      set(f) {\n        if (this._onaddstream) {\n          this.removeEventListener('addstream', this._onaddstream);\n          this.removeEventListener('track', this._onaddstreampoly);\n        }\n        this.addEventListener('addstream', this._onaddstream = f);\n        this.addEventListener('track', this._onaddstreampoly = (e) => {\n          e.streams.forEach(stream => {\n            if (!this._remoteStreams) {\n              this._remoteStreams = [];\n            }\n            if (this._remoteStreams.includes(stream)) {\n              return;\n            }\n            this._remoteStreams.push(stream);\n            const event = new Event('addstream');\n            event.stream = stream;\n            this.dispatchEvent(event);\n          });\n        });\n      }\n    });\n    const origSetRemoteDescription =\n      window.RTCPeerConnection.prototype.setRemoteDescription;\n    window.RTCPeerConnection.prototype.setRemoteDescription =\n      function setRemoteDescription() {\n        const pc = this;\n        if (!this._onaddstreampoly) {\n          this.addEventListener('track', this._onaddstreampoly = function(e) {\n            e.streams.forEach(stream => {\n              if (!pc._remoteStreams) {\n                pc._remoteStreams = [];\n              }\n              if (pc._remoteStreams.indexOf(stream) >= 0) {\n                return;\n              }\n              pc._remoteStreams.push(stream);\n              const event = new Event('addstream');\n              event.stream = stream;\n              pc.dispatchEvent(event);\n            });\n          });\n        }\n        return origSetRemoteDescription.apply(pc, arguments);\n      };\n  }\n}\n\nexport function shimCallbacksAPI(window) {\n  if (typeof window !== 'object' || !window.RTCPeerConnection) {\n    return;\n  }\n  const prototype = window.RTCPeerConnection.prototype;\n  const origCreateOffer = prototype.createOffer;\n  const origCreateAnswer = prototype.createAnswer;\n  const setLocalDescription = prototype.setLocalDescription;\n  const setRemoteDescription = prototype.setRemoteDescription;\n  const addIceCandidate = prototype.addIceCandidate;\n\n  prototype.createOffer =\n    function createOffer(successCallback, failureCallback) {\n      const options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      const promise = origCreateOffer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n  prototype.createAnswer =\n    function createAnswer(successCallback, failureCallback) {\n      const options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      const promise = origCreateAnswer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n  let withCallback = function(description, successCallback, failureCallback) {\n    const promise = setLocalDescription.apply(this, [description]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.setLocalDescription = withCallback;\n\n  withCallback = function(description, successCallback, failureCallback) {\n    const promise = setRemoteDescription.apply(this, [description]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.setRemoteDescription = withCallback;\n\n  withCallback = function(candidate, successCallback, failureCallback) {\n    const promise = addIceCandidate.apply(this, [candidate]);\n    if (!failureCallback) {\n      return promise;\n    }\n    promise.then(successCallback, failureCallback);\n    return Promise.resolve();\n  };\n  prototype.addIceCandidate = withCallback;\n}\n\nexport function shimGetUserMedia(window) {\n  const navigator = window && window.navigator;\n\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    // shim not needed in Safari 12.1\n    const mediaDevices = navigator.mediaDevices;\n    const _getUserMedia = mediaDevices.getUserMedia.bind(mediaDevices);\n    navigator.mediaDevices.getUserMedia = (constraints) => {\n      return _getUserMedia(shimConstraints(constraints));\n    };\n  }\n\n  if (!navigator.getUserMedia && navigator.mediaDevices &&\n    navigator.mediaDevices.getUserMedia) {\n    navigator.getUserMedia = function getUserMedia(constraints, cb, errcb) {\n      navigator.mediaDevices.getUserMedia(constraints)\n      .then(cb, errcb);\n    }.bind(navigator);\n  }\n}\n\nexport function shimConstraints(constraints) {\n  if (constraints && constraints.video !== undefined) {\n    return Object.assign({},\n      constraints,\n      {video: utils.compactObject(constraints.video)}\n    );\n  }\n\n  return constraints;\n}\n\nexport function shimRTCIceServerUrls(window) {\n  // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n  const OrigPeerConnection = window.RTCPeerConnection;\n  window.RTCPeerConnection =\n    function RTCPeerConnection(pcConfig, pcConstraints) {\n      if (pcConfig && pcConfig.iceServers) {\n        const newIceServers = [];\n        for (let i = 0; i < pcConfig.iceServers.length; i++) {\n          let server = pcConfig.iceServers[i];\n          if (!server.hasOwnProperty('urls') &&\n              server.hasOwnProperty('url')) {\n            utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n            server = JSON.parse(JSON.stringify(server));\n            server.urls = server.url;\n            delete server.url;\n            newIceServers.push(server);\n          } else {\n            newIceServers.push(pcConfig.iceServers[i]);\n          }\n        }\n        pcConfig.iceServers = newIceServers;\n      }\n      return new OrigPeerConnection(pcConfig, pcConstraints);\n    };\n  window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\n  // wrap static methods. Currently just generateCertificate.\n  if ('generateCertificate' in window.RTCPeerConnection) {\n    Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n      get() {\n        return OrigPeerConnection.generateCertificate;\n      }\n    });\n  }\n}\n\nexport function shimTrackEventTransceiver(window) {\n  // Add event.transceiver member over deprecated event.receiver\n  if (typeof window === 'object' && window.RTCTrackEvent &&\n      'receiver' in window.RTCTrackEvent.prototype &&\n      !('transceiver' in window.RTCTrackEvent.prototype)) {\n    Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n      get() {\n        return {receiver: this.receiver};\n      }\n    });\n  }\n}\n\nexport function shimCreateOfferLegacy(window) {\n  const origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n  window.RTCPeerConnection.prototype.createOffer =\n    function createOffer(offerOptions) {\n      if (offerOptions) {\n        if (typeof offerOptions.offerToReceiveAudio !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveAudio =\n            !!offerOptions.offerToReceiveAudio;\n        }\n        const audioTransceiver = this.getTransceivers().find(transceiver =>\n          transceiver.receiver.track.kind === 'audio');\n        if (offerOptions.offerToReceiveAudio === false && audioTransceiver) {\n          if (audioTransceiver.direction === 'sendrecv') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('sendonly');\n            } else {\n              audioTransceiver.direction = 'sendonly';\n            }\n          } else if (audioTransceiver.direction === 'recvonly') {\n            if (audioTransceiver.setDirection) {\n              audioTransceiver.setDirection('inactive');\n            } else {\n              audioTransceiver.direction = 'inactive';\n            }\n          }\n        } else if (offerOptions.offerToReceiveAudio === true &&\n            !audioTransceiver) {\n          this.addTransceiver('audio');\n        }\n\n        if (typeof offerOptions.offerToReceiveVideo !== 'undefined') {\n          // support bit values\n          offerOptions.offerToReceiveVideo =\n            !!offerOptions.offerToReceiveVideo;\n        }\n        const videoTransceiver = this.getTransceivers().find(transceiver =>\n          transceiver.receiver.track.kind === 'video');\n        if (offerOptions.offerToReceiveVideo === false && videoTransceiver) {\n          if (videoTransceiver.direction === 'sendrecv') {\n            if (videoTransceiver.setDirection) {\n              videoTransceiver.setDirection('sendonly');\n            } else {\n              videoTransceiver.direction = 'sendonly';\n            }\n          } else if (videoTransceiver.direction === 'recvonly') {\n            if (videoTransceiver.setDirection) {\n              videoTransceiver.setDirection('inactive');\n            } else {\n              videoTransceiver.direction = 'inactive';\n            }\n          }\n        } else if (offerOptions.offerToReceiveVideo === true &&\n            !videoTransceiver) {\n          this.addTransceiver('video');\n        }\n      }\n      return origCreateOffer.apply(this, arguments);\n    };\n}\n","/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport SDPUtils from 'sdp';\nimport * as utils from './utils';\n\nexport function shimRTCIceCandidate(window) {\n  // foundation is arbitrarily chosen as an indicator for full support for\n  // https://w3c.github.io/webrtc-pc/#rtcicecandidate-interface\n  if (!window.RTCIceCandidate || (window.RTCIceCandidate && 'foundation' in\n      window.RTCIceCandidate.prototype)) {\n    return;\n  }\n\n  const NativeRTCIceCandidate = window.RTCIceCandidate;\n  window.RTCIceCandidate = function RTCIceCandidate(args) {\n    // Remove the a= which shouldn't be part of the candidate string.\n    if (typeof args === 'object' && args.candidate &&\n        args.candidate.indexOf('a=') === 0) {\n      args = JSON.parse(JSON.stringify(args));\n      args.candidate = args.candidate.substr(2);\n    }\n\n    if (args.candidate && args.candidate.length) {\n      // Augment the native candidate with the parsed fields.\n      const nativeCandidate = new NativeRTCIceCandidate(args);\n      const parsedCandidate = SDPUtils.parseCandidate(args.candidate);\n      const augmentedCandidate = Object.assign(nativeCandidate,\n          parsedCandidate);\n\n      // Add a serializer that does not serialize the extra attributes.\n      augmentedCandidate.toJSON = function toJSON() {\n        return {\n          candidate: augmentedCandidate.candidate,\n          sdpMid: augmentedCandidate.sdpMid,\n          sdpMLineIndex: augmentedCandidate.sdpMLineIndex,\n          usernameFragment: augmentedCandidate.usernameFragment,\n        };\n      };\n      return augmentedCandidate;\n    }\n    return new NativeRTCIceCandidate(args);\n  };\n  window.RTCIceCandidate.prototype = NativeRTCIceCandidate.prototype;\n\n  // Hook up the augmented candidate in onicecandidate and\n  // addEventListener('icecandidate', ...)\n  utils.wrapPeerConnectionEvent(window, 'icecandidate', e => {\n    if (e.candidate) {\n      Object.defineProperty(e, 'candidate', {\n        value: new window.RTCIceCandidate(e.candidate),\n        writable: 'false'\n      });\n    }\n    return e;\n  });\n}\n\nexport function shimMaxMessageSize(window) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  const browserDetails = utils.detectBrowser(window);\n\n  if (!('sctp' in window.RTCPeerConnection.prototype)) {\n    Object.defineProperty(window.RTCPeerConnection.prototype, 'sctp', {\n      get() {\n        return typeof this._sctp === 'undefined' ? null : this._sctp;\n      }\n    });\n  }\n\n  const sctpInDescription = function(description) {\n    if (!description || !description.sdp) {\n      return false;\n    }\n    const sections = SDPUtils.splitSections(description.sdp);\n    sections.shift();\n    return sections.some(mediaSection => {\n      const mLine = SDPUtils.parseMLine(mediaSection);\n      return mLine && mLine.kind === 'application'\n          && mLine.protocol.indexOf('SCTP') !== -1;\n    });\n  };\n\n  const getRemoteFirefoxVersion = function(description) {\n    // TODO: Is there a better solution for detecting Firefox?\n    const match = description.sdp.match(/mozilla...THIS_IS_SDPARTA-(\\d+)/);\n    if (match === null || match.length < 2) {\n      return -1;\n    }\n    const version = parseInt(match[1], 10);\n    // Test for NaN (yes, this is ugly)\n    return version !== version ? -1 : version;\n  };\n\n  const getCanSendMaxMessageSize = function(remoteIsFirefox) {\n    // Every implementation we know can send at least 64 KiB.\n    // Note: Although Chrome is technically able to send up to 256 KiB, the\n    //       data does not reach the other peer reliably.\n    //       See: https://bugs.chromium.org/p/webrtc/issues/detail?id=8419\n    let canSendMaxMessageSize = 65536;\n    if (browserDetails.browser === 'firefox') {\n      if (browserDetails.version < 57) {\n        if (remoteIsFirefox === -1) {\n          // FF < 57 will send in 16 KiB chunks using the deprecated PPID\n          // fragmentation.\n          canSendMaxMessageSize = 16384;\n        } else {\n          // However, other FF (and RAWRTC) can reassemble PPID-fragmented\n          // messages. Thus, supporting ~2 GiB when sending.\n          canSendMaxMessageSize = 2147483637;\n        }\n      } else if (browserDetails.version < 60) {\n        // Currently, all FF >= 57 will reset the remote maximum message size\n        // to the default value when a data channel is created at a later\n        // stage. :(\n        // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\n        canSendMaxMessageSize =\n          browserDetails.version === 57 ? 65535 : 65536;\n      } else {\n        // FF >= 60 supports sending ~2 GiB\n        canSendMaxMessageSize = 2147483637;\n      }\n    }\n    return canSendMaxMessageSize;\n  };\n\n  const getMaxMessageSize = function(description, remoteIsFirefox) {\n    // Note: 65536 bytes is the default value from the SDP spec. Also,\n    //       every implementation we know supports receiving 65536 bytes.\n    let maxMessageSize = 65536;\n\n    // FF 57 has a slightly incorrect default remote max message size, so\n    // we need to adjust it here to avoid a failure when sending.\n    // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1425697\n    if (browserDetails.browser === 'firefox'\n         && browserDetails.version === 57) {\n      maxMessageSize = 65535;\n    }\n\n    const match = SDPUtils.matchPrefix(description.sdp,\n      'a=max-message-size:');\n    if (match.length > 0) {\n      maxMessageSize = parseInt(match[0].substr(19), 10);\n    } else if (browserDetails.browser === 'firefox' &&\n                remoteIsFirefox !== -1) {\n      // If the maximum message size is not present in the remote SDP and\n      // both local and remote are Firefox, the remote peer can receive\n      // ~2 GiB.\n      maxMessageSize = 2147483637;\n    }\n    return maxMessageSize;\n  };\n\n  const origSetRemoteDescription =\n      window.RTCPeerConnection.prototype.setRemoteDescription;\n  window.RTCPeerConnection.prototype.setRemoteDescription =\n    function setRemoteDescription() {\n      this._sctp = null;\n      // Chrome decided to not expose .sctp in plan-b mode.\n      // As usual, adapter.js has to do an 'ugly worakaround'\n      // to cover up the mess.\n      if (browserDetails.browser === 'chrome' && browserDetails.version >= 76) {\n        const {sdpSemantics} = this.getConfiguration();\n        if (sdpSemantics === 'plan-b') {\n          Object.defineProperty(this, 'sctp', {\n            get() {\n              return typeof this._sctp === 'undefined' ? null : this._sctp;\n            },\n            enumerable: true,\n            configurable: true,\n          });\n        }\n      }\n\n      if (sctpInDescription(arguments[0])) {\n        // Check if the remote is FF.\n        const isFirefox = getRemoteFirefoxVersion(arguments[0]);\n\n        // Get the maximum message size the local peer is capable of sending\n        const canSendMMS = getCanSendMaxMessageSize(isFirefox);\n\n        // Get the maximum message size of the remote peer.\n        const remoteMMS = getMaxMessageSize(arguments[0], isFirefox);\n\n        // Determine final maximum message size\n        let maxMessageSize;\n        if (canSendMMS === 0 && remoteMMS === 0) {\n          maxMessageSize = Number.POSITIVE_INFINITY;\n        } else if (canSendMMS === 0 || remoteMMS === 0) {\n          maxMessageSize = Math.max(canSendMMS, remoteMMS);\n        } else {\n          maxMessageSize = Math.min(canSendMMS, remoteMMS);\n        }\n\n        // Create a dummy RTCSctpTransport object and the 'maxMessageSize'\n        // attribute.\n        const sctp = {};\n        Object.defineProperty(sctp, 'maxMessageSize', {\n          get() {\n            return maxMessageSize;\n          }\n        });\n        this._sctp = sctp;\n      }\n\n      return origSetRemoteDescription.apply(this, arguments);\n    };\n}\n\nexport function shimSendThrowTypeError(window) {\n  if (!(window.RTCPeerConnection &&\n      'createDataChannel' in window.RTCPeerConnection.prototype)) {\n    return;\n  }\n\n  // Note: Although Firefox >= 57 has a native implementation, the maximum\n  //       message size can be reset for all data channels at a later stage.\n  //       See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831\n\n  function wrapDcSend(dc, pc) {\n    const origDataChannelSend = dc.send;\n    dc.send = function send() {\n      const data = arguments[0];\n      const length = data.length || data.size || data.byteLength;\n      if (dc.readyState === 'open' &&\n          pc.sctp && length > pc.sctp.maxMessageSize) {\n        throw new TypeError('Message too large (can send a maximum of ' +\n          pc.sctp.maxMessageSize + ' bytes)');\n      }\n      return origDataChannelSend.apply(dc, arguments);\n    };\n  }\n  const origCreateDataChannel =\n    window.RTCPeerConnection.prototype.createDataChannel;\n  window.RTCPeerConnection.prototype.createDataChannel =\n    function createDataChannel() {\n      const dataChannel = origCreateDataChannel.apply(this, arguments);\n      wrapDcSend(dataChannel, this);\n      return dataChannel;\n    };\n  utils.wrapPeerConnectionEvent(window, 'datachannel', e => {\n    wrapDcSend(e.channel, e.target);\n    return e;\n  });\n}\n\n\n/* shims RTCConnectionState by pretending it is the same as iceConnectionState.\n * See https://bugs.chromium.org/p/webrtc/issues/detail?id=6145#c12\n * for why this is a valid hack in Chrome. In Firefox it is slightly incorrect\n * since DTLS failures would be hidden. See\n * https://bugzilla.mozilla.org/show_bug.cgi?id=1265827\n * for the Firefox tracking bug.\n */\nexport function shimConnectionState(window) {\n  if (!window.RTCPeerConnection ||\n      'connectionState' in window.RTCPeerConnection.prototype) {\n    return;\n  }\n  const proto = window.RTCPeerConnection.prototype;\n  Object.defineProperty(proto, 'connectionState', {\n    get() {\n      return {\n        completed: 'connected',\n        checking: 'connecting'\n      }[this.iceConnectionState] || this.iceConnectionState;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(proto, 'onconnectionstatechange', {\n    get() {\n      return this._onconnectionstatechange || null;\n    },\n    set(cb) {\n      if (this._onconnectionstatechange) {\n        this.removeEventListener('connectionstatechange',\n            this._onconnectionstatechange);\n        delete this._onconnectionstatechange;\n      }\n      if (cb) {\n        this.addEventListener('connectionstatechange',\n            this._onconnectionstatechange = cb);\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  ['setLocalDescription', 'setRemoteDescription'].forEach((method) => {\n    const origMethod = proto[method];\n    proto[method] = function() {\n      if (!this._connectionstatechangepoly) {\n        this._connectionstatechangepoly = e => {\n          const pc = e.target;\n          if (pc._lastConnectionState !== pc.connectionState) {\n            pc._lastConnectionState = pc.connectionState;\n            const newEvent = new Event('connectionstatechange', e);\n            pc.dispatchEvent(newEvent);\n          }\n          return e;\n        };\n        this.addEventListener('iceconnectionstatechange',\n          this._connectionstatechangepoly);\n      }\n      return origMethod.apply(this, arguments);\n    };\n  });\n}\n\nexport function removeAllowExtmapMixed(window) {\n  /* remove a=extmap-allow-mixed for Chrome < M71 */\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  const browserDetails = utils.detectBrowser(window);\n  if (browserDetails.browser === 'chrome' && browserDetails.version >= 71) {\n    return;\n  }\n  const nativeSRD = window.RTCPeerConnection.prototype.setRemoteDescription;\n  window.RTCPeerConnection.prototype.setRemoteDescription =\n  function setRemoteDescription(desc) {\n    if (desc && desc.sdp && desc.sdp.indexOf('\\na=extmap-allow-mixed') !== -1) {\n      desc.sdp = desc.sdp.split('\\n').filter((line) => {\n        return line.trim() !== 'a=extmap-allow-mixed';\n      }).join('\\n');\n    }\n    return nativeSRD.apply(this, arguments);\n  };\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\nimport * as utils from './utils';\n\n  // Browser shims.\nimport * as chromeShim from './chrome/chrome_shim';\nimport * as edgeShim from './edge/edge_shim';\nimport * as firefoxShim from './firefox/firefox_shim';\nimport * as safariShim from './safari/safari_shim';\nimport * as commonShim from './common_shim';\n\n// Shimming starts here.\nexport function adapterFactory({window} = {}, options = {\n  shimChrome: true,\n  shimFirefox: true,\n  shimEdge: true,\n  shimSafari: true,\n}) {\n  // Utils.\n  const logging = utils.log;\n  const browserDetails = utils.detectBrowser(window);\n\n  const adapter = {\n    browserDetails,\n    commonShim,\n    extractVersion: utils.extractVersion,\n    disableLog: utils.disableLog,\n    disableWarnings: utils.disableWarnings\n  };\n\n  // Shim browser if found.\n  switch (browserDetails.browser) {\n    case 'chrome':\n      if (!chromeShim || !chromeShim.shimPeerConnection ||\n          !options.shimChrome) {\n        logging('Chrome shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming chrome.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = chromeShim;\n\n      chromeShim.shimGetUserMedia(window);\n      chromeShim.shimMediaStream(window);\n      chromeShim.shimPeerConnection(window);\n      chromeShim.shimOnTrack(window);\n      chromeShim.shimAddTrackRemoveTrack(window);\n      chromeShim.shimGetSendersWithDtmf(window);\n      chromeShim.shimGetStats(window);\n      chromeShim.shimSenderReceiverGetStats(window);\n      chromeShim.fixNegotiationNeeded(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      commonShim.shimConnectionState(window);\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      commonShim.removeAllowExtmapMixed(window);\n      break;\n    case 'firefox':\n      if (!firefoxShim || !firefoxShim.shimPeerConnection ||\n          !options.shimFirefox) {\n        logging('Firefox shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming firefox.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = firefoxShim;\n\n      firefoxShim.shimGetUserMedia(window);\n      firefoxShim.shimPeerConnection(window);\n      firefoxShim.shimOnTrack(window);\n      firefoxShim.shimRemoveStream(window);\n      firefoxShim.shimSenderGetStats(window);\n      firefoxShim.shimReceiverGetStats(window);\n      firefoxShim.shimRTCDataChannel(window);\n      firefoxShim.shimAddTransceiver(window);\n      firefoxShim.shimCreateOffer(window);\n      firefoxShim.shimCreateAnswer(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      commonShim.shimConnectionState(window);\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      break;\n    case 'edge':\n      if (!edgeShim || !edgeShim.shimPeerConnection || !options.shimEdge) {\n        logging('MS edge shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming edge.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = edgeShim;\n\n      edgeShim.shimGetUserMedia(window);\n      edgeShim.shimGetDisplayMedia(window);\n      edgeShim.shimPeerConnection(window);\n      edgeShim.shimReplaceTrack(window);\n\n      // the edge shim implements the full RTCIceCandidate object.\n\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      break;\n    case 'safari':\n      if (!safariShim || !options.shimSafari) {\n        logging('Safari shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming safari.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = safariShim;\n\n      safariShim.shimRTCIceServerUrls(window);\n      safariShim.shimCreateOfferLegacy(window);\n      safariShim.shimCallbacksAPI(window);\n      safariShim.shimLocalStreamsAPI(window);\n      safariShim.shimRemoteStreamsAPI(window);\n      safariShim.shimTrackEventTransceiver(window);\n      safariShim.shimGetUserMedia(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      commonShim.shimMaxMessageSize(window);\n      commonShim.shimSendThrowTypeError(window);\n      commonShim.removeAllowExtmapMixed(window);\n      break;\n    default:\n      logging('Unsupported browser!');\n      break;\n  }\n\n  return adapter;\n}\n","/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n\n'use strict';\n\nimport {adapterFactory} from './adapter_factory.js';\n\nconst adapter = adapterFactory({window});\nexport default adapter;\n","import webRTCAdapter from \"webrtc-adapter\";\n\nexport { webRTCAdapter };\n","import { webRTCAdapter } from './adapter';\n\nexport const Supports = new class {\n  readonly isIOS = ['iPad', 'iPhone', 'iPod'].includes(navigator.platform);\n  readonly supportedBrowsers = ['firefox', 'chrome', 'safari'];\n\n  readonly minFirefoxVersion = 59;\n  readonly minChromeVersion = 72;\n  readonly minSafariVersion = 605;\n\n  isWebRTCSupported(): boolean {\n    return typeof RTCPeerConnection !== 'undefined';\n  };\n\n  isBrowserSupported(): boolean {\n    const browser = this.getBrowser();\n    const version = this.getVersion();\n\n    const validBrowser = this.supportedBrowsers.includes(browser);\n\n    if (!validBrowser) return false;\n\n    if (browser === 'chrome') return version >= this.minChromeVersion;\n    if (browser === 'firefox') return version >= this.minFirefoxVersion;\n    if (browser === 'safari') return !this.isIOS && version >= this.minSafariVersion;\n\n    return false;\n  }\n\n  getBrowser(): string {\n    return webRTCAdapter.browserDetails.browser;\n  }\n\n  getVersion(): number {\n    return webRTCAdapter.browserDetails.version || 0;\n  }\n\n  isUnifiedPlanSupported(): boolean {\n    const browser = this.getBrowser();\n    const version = webRTCAdapter.browserDetails.version || 0;\n\n    if (browser === 'chrome' && version < 72) return false;\n    if (browser === 'firefox' && version >= 59) return true;\n    if (!window.RTCRtpTransceiver || !('currentDirection' in RTCRtpTransceiver.prototype)) return false;\n\n    let tempPc: RTCPeerConnection;\n    let supported = false;\n\n    try {\n      tempPc = new RTCPeerConnection();\n      tempPc.addTransceiver('audio');\n      supported = true;\n    } catch (e) { }\n    finally {\n      if (tempPc) {\n        tempPc.close();\n      }\n    }\n\n    return supported;\n  }\n\n  toString(): string {\n    return `Supports: \n    browser:${this.getBrowser()} \n    version:${this.getVersion()} \n    isIOS:${this.isIOS} \n    isWebRTCSupported:${this.isWebRTCSupported()} \n    isBrowserSupported:${this.isBrowserSupported()} \n    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`;\n  }\n}","import * as BinaryPack from \"peerjs-js-binarypack\";\nimport { Supports } from './supports';\nimport { UtilSupportsObj } from '..';\n\nconst DEFAULT_CONFIG = {\n  iceServers: [\n    { urls: \"stun:stun.l.google.com:19302\" },\n    { urls: \"turn:0.peerjs.com:3478\", username: \"peerjs\", credential: \"peerjsp\" }\n  ],\n  sdpSemantics: \"unified-plan\"\n};\n\nexport const util = new class {\n  noop(): void { }\n\n  readonly CLOUD_HOST = \"0.peerjs.com\";\n  readonly CLOUD_PORT = 443;\n\n  // Browsers that need chunking:\n  readonly chunkedBrowsers = { Chrome: 1, chrome: 1 };\n  readonly chunkedMTU = 16300; // The original 60000 bytes setting does not work when sending data from Firefox to Chrome, which is \"cut off\" after 16384 bytes and delivered individually.\n\n  // Returns browser-agnostic default config\n  readonly defaultConfig = DEFAULT_CONFIG;\n\n  readonly browser = Supports.getBrowser();\n  readonly browserVersion = Supports.getVersion();\n\n  // Lists which features are supported\n  readonly supports = (function () {\n    const supported: UtilSupportsObj = {\n      browser: Supports.isBrowserSupported(),\n      webRTC: Supports.isWebRTCSupported(),\n      audioVideo: false,\n      data: false,\n      binaryBlob: false,\n      reliable: false,\n    };\n\n    if (!supported.webRTC) return supported;\n\n    let pc: RTCPeerConnection;\n\n    try {\n      pc = new RTCPeerConnection(DEFAULT_CONFIG);\n\n      supported.audioVideo = true;\n\n      let dc: RTCDataChannel;\n\n      try {\n        dc = pc.createDataChannel(\"_PEERJSTEST\", { ordered: true });\n        supported.data = true;\n        supported.reliable = !!dc.ordered;\n\n        // Binary test\n        try {\n          dc.binaryType = \"blob\";\n          supported.binaryBlob = !Supports.isIOS;\n        } catch (e) {\n        }\n      } catch (e) {\n      } finally {\n        if (dc) {\n          dc.close();\n        }\n      }\n    } catch (e) {\n    } finally {\n      if (pc) {\n        pc.close();\n      }\n    }\n\n    return supported;\n  })();\n\n  // Ensure alphanumeric ids\n  validateId(id: string): boolean {\n    // Allow empty ids\n    return !id || /^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(id);\n  }\n\n  pack = BinaryPack.pack;\n  unpack = BinaryPack.unpack;\n\n  // Binary stuff\n\n  private _dataCount: number = 1;\n\n  chunk(blob: Blob): { __peerData: number, n: number, total: number, data: Blob }[] {\n    const chunks = [];\n    const size = blob.size;\n    const total = Math.ceil(size / util.chunkedMTU);\n\n    let index = 0;\n    let start = 0;\n\n    while (start < size) {\n      const end = Math.min(size, start + util.chunkedMTU);\n      const b = blob.slice(start, end);\n\n      const chunk = {\n        __peerData: this._dataCount,\n        n: index,\n        data: b,\n        total,\n      };\n\n      chunks.push(chunk);\n\n      start = end;\n      index++;\n    }\n\n    this._dataCount++;\n\n    return chunks;\n  }\n\n  blobToArrayBuffer(blob: Blob, cb: (arg: ArrayBuffer | null) => void): FileReader {\n    const fr = new FileReader();\n\n    fr.onload = function (evt) {\n      if (evt.target) {\n        cb(evt.target.result as ArrayBuffer);\n      }\n    };\n\n    fr.readAsArrayBuffer(blob);\n\n    return fr;\n  }\n\n  binaryStringToArrayBuffer(binary: string): ArrayBuffer | SharedArrayBuffer {\n    const byteArray = new Uint8Array(binary.length);\n\n    for (let i = 0; i < binary.length; i++) {\n      byteArray[i] = binary.charCodeAt(i) & 0xff;\n    }\n\n    return byteArray.buffer;\n  }\n\n  randomToken(): string {\n    return Math.random()\n      .toString(36)\n      .substr(2);\n  }\n\n  isSecure(): boolean {\n    return location.protocol === \"https:\";\n  }\n}\n","'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","const LOG_PREFIX = 'PeerJS: ';\n\n/*\nPrints log messages depending on the debug level passed in. Defaults to 0.\n0  Prints no logs.\n1  Prints only errors.\n2  Prints errors and warnings.\n3  Prints all logs.\n*/\nexport enum LogLevel {\n    Disabled,\n    Errors,\n    Warnings,\n    All\n}\n\nclass Logger {\n    private _logLevel = LogLevel.Disabled;\n\n    get logLevel(): LogLevel { return this._logLevel; }\n\n    set logLevel(logLevel: LogLevel) { this._logLevel = logLevel; }\n\n    log(...args: any[]) {\n        if (this._logLevel >= LogLevel.All) {\n            this._print(LogLevel.All, ...args);\n        }\n    }\n\n    warn(...args: any[]) {\n        if (this._logLevel >= LogLevel.Warnings) {\n            this._print(LogLevel.Warnings, ...args);\n        }\n    }\n\n    error(...args: any[]) {\n        if (this._logLevel >= LogLevel.Errors) {\n            this._print(LogLevel.Errors, ...args);\n        }\n    }\n\n    setLogFunction(fn: (logLevel: LogLevel, ..._: any[]) => void): void {\n        this._print = fn;\n    }\n\n    private _print(logLevel: LogLevel, ...rest: any[]): void {\n        const copy = [LOG_PREFIX, ...rest];\n\n        for (let i in copy) {\n            if (copy[i] instanceof Error) {\n                copy[i] = \"(\" + copy[i].name + \") \" + copy[i].message;\n\n            }\n        }\n\n        if (logLevel >= LogLevel.All) {\n            console.log(...copy);\n        } else if (logLevel >= LogLevel.Warnings) {\n            console.warn(\"WARNING\", ...copy);\n        } else if (logLevel >= LogLevel.Errors) {\n            console.error(\"ERROR\", ...copy);\n        }\n    }\n}\n\nexport default new Logger();","export enum ConnectionEventType {\n  Open = \"open\",\n  Stream = \"stream\",\n  Data = \"data\",\n  Close = \"close\",\n  Error = \"error\",\n  IceStateChanged = \"iceStateChanged\"\n}\n\nexport enum ConnectionType {\n  Data = \"data\",\n  Media = \"media\"\n}\n\nexport enum PeerEventType {\n  Open = \"open\",\n  Close = \"close\",\n  Connection = \"connection\",\n  Call = \"call\",\n  Disconnected = \"disconnected\",\n  Error = \"error\"\n}\n\nexport enum PeerErrorType {\n  BrowserIncompatible = \"browser-incompatible\",\n  Disconnected = \"disconnected\",\n  InvalidID = \"invalid-id\",\n  InvalidKey = \"invalid-key\",\n  Network = \"network\",\n  PeerUnavailable = \"peer-unavailable\",\n  SslUnavailable = \"ssl-unavailable\",\n  ServerError = \"server-error\",\n  SocketError = \"socket-error\",\n  SocketClosed = \"socket-closed\",\n  UnavailableID = \"unavailable-id\",\n  WebRTC = \"webrtc\"\n}\n\nexport enum SerializationType {\n  Binary = \"binary\",\n  BinaryUTF8 = \"binary-utf8\",\n  JSON = \"json\"\n}\n\nexport enum SocketEventType {\n  Message = \"message\",\n  Disconnected = \"disconnected\",\n  Error = \"error\",\n  Close = \"close\"\n}\n\nexport enum ServerMessageType {\n  Heartbeat = \"HEARTBEAT\",\n  Candidate = \"CANDIDATE\",\n  Offer = \"OFFER\",\n  Answer = \"ANSWER\",\n  Open = \"OPEN\", // The connection to the server is open.\n  Error = \"ERROR\", // Server error.\n  IdTaken = \"ID-TAKEN\", // The selected ID is taken.\n  InvalidKey = \"INVALID-KEY\", // The given API key cannot be found.\n  Leave = \"LEAVE\", // Another peer has closed its connection to this peer.\n  Expire = \"EXPIRE\" // The offer sent to a peer has expired without response.\n\n}","import { EventEmitter } from \"eventemitter3\";\nimport logger from \"./logger\";\nimport { SocketEventType, ServerMessageType } from \"./enums\";\n\n/**\n * An abstraction on top of WebSockets to provide fastest\n * possible connection for peers.\n */\nexport class Socket extends EventEmitter {\n  private _disconnected: boolean = true;\n  private _id?: string;\n  private _messagesQueue: Array<object> = [];\n  private _socket?: WebSocket;\n  private _wsPingTimer?: any;\n  private readonly _baseUrl: string;\n\n  constructor(\n    secure: any,\n    host: string,\n    port: number,\n    path: string,\n    key: string,\n    private readonly pingInterval: number = 5000,\n  ) {\n    super();\n\n    const wsProtocol = secure ? \"wss://\" : \"ws://\";\n\n    this._baseUrl = wsProtocol + host + \":\" + port + path + \"peerjs?key=\" + key;\n  }\n\n  start(id: string, token: string): void {\n    this._id = id;\n\n    const wsUrl = `${this._baseUrl}&id=${id}&token=${token}`;\n\n    if (!!this._socket || !this._disconnected) {\n      return;\n    }\n\n    this._socket = new WebSocket(wsUrl);\n    this._disconnected = false;\n\n    this._socket.onmessage = (event) => {\n      let data;\n\n      try {\n        data = JSON.parse(event.data);\n        logger.log(\"Server message received:\", data);\n      } catch (e) {\n        logger.log(\"Invalid server message\", event.data);\n        return;\n      }\n\n      this.emit(SocketEventType.Message, data);\n    };\n\n    this._socket.onclose = (event) => {\n      if (this._disconnected) {\n        return;\n      }\n\n      logger.log(\"Socket closed.\", event);\n\n      this._cleanup();\n      this._disconnected = true;\n\n      this.emit(SocketEventType.Disconnected);\n    };\n\n    // Take care of the queue of connections if necessary and make sure Peer knows\n    // socket is open.\n    this._socket.onopen = () => {\n      if (this._disconnected) {\n        return;\n      }\n\n      this._sendQueuedMessages();\n\n      logger.log(\"Socket open\");\n\n      this._scheduleHeartbeat();\n    };\n  }\n\n  private _scheduleHeartbeat(): void {\n    this._wsPingTimer = setTimeout(() => {\n      this._sendHeartbeat();\n    }, this.pingInterval);\n  }\n\n  private _sendHeartbeat(): void {\n    if (!this._wsOpen()) {\n      logger.log(`Cannot send heartbeat, because socket closed`);\n      return;\n    }\n\n    const message = JSON.stringify({ type: ServerMessageType.Heartbeat });\n\n    this._socket!.send(message);\n\n    this._scheduleHeartbeat();\n  }\n\n  /** Is the websocket currently open? */\n  private _wsOpen(): boolean {\n    return !!this._socket && this._socket.readyState === 1;\n  }\n\n  /** Send queued messages. */\n  private _sendQueuedMessages(): void {\n    //Create copy of queue and clear it,\n    //because send method push the message back to queue if smth will go wrong\n    const copiedQueue = [...this._messagesQueue];\n    this._messagesQueue = [];\n\n    for (const message of copiedQueue) {\n      this.send(message);\n    }\n  }\n\n  /** Exposed send for DC & Peer. */\n  send(data: any): void {\n    if (this._disconnected) {\n      return;\n    }\n\n    // If we didn't get an ID yet, we can't yet send anything so we should queue\n    // up these messages.\n    if (!this._id) {\n      this._messagesQueue.push(data);\n      return;\n    }\n\n    if (!data.type) {\n      this.emit(SocketEventType.Error, \"Invalid message\");\n      return;\n    }\n\n    if (!this._wsOpen()) {\n      return;\n    }\n\n    const message = JSON.stringify(data);\n\n    this._socket!.send(message);\n  }\n\n  close(): void {\n    if (this._disconnected) {\n      return;\n    }\n\n    this._cleanup();\n\n    this._disconnected = true;\n  }\n\n  private _cleanup(): void {\n    if (!!this._socket) {\n      this._socket.onopen = this._socket.onmessage = this._socket.onclose = null;\n      this._socket.close();\n      this._socket = undefined;\n    }\n\n    clearTimeout(this._wsPingTimer!);\n  }\n}\n","import { util } from \"./util\";\nimport logger from \"./logger\";\nimport { MediaConnection } from \"./mediaconnection\";\nimport { DataConnection } from \"./dataconnection\";\nimport { ConnectionType, PeerErrorType, ConnectionEventType, ServerMessageType } from \"./enums\";\nimport { BaseConnection } from \"./baseconnection\";\n\n/**\n * Manages all negotiations between Peers.\n */\nexport class Negotiator {\n  constructor(readonly connection: BaseConnection) { }\n\n  /** Returns a PeerConnection object set up correctly (for data, media). */\n  startConnection(options: any) {\n    const peerConnection = this._startPeerConnection();\n\n    // Set the connection's PC.\n    this.connection.peerConnection = peerConnection;\n\n    if (this.connection.type === ConnectionType.Media && options._stream) {\n      this._addTracksToConnection(options._stream, peerConnection);\n    }\n\n    // What do we need to do now?\n    if (options.originator) {\n      if (this.connection.type === ConnectionType.Data) {\n        const dataConnection = <DataConnection>this.connection;\n\n        const config: RTCDataChannelInit = { ordered: !!options.reliable };\n\n        const dataChannel = peerConnection.createDataChannel(\n          dataConnection.label,\n          config\n        );\n        dataConnection.initialize(dataChannel);\n      }\n\n      this._makeOffer();\n    } else {\n      this.handleSDP(\"OFFER\", options.sdp);\n    }\n  }\n\n  /** Start a PC. */\n  private _startPeerConnection(): RTCPeerConnection {\n    logger.log(\"Creating RTCPeerConnection.\");\n\n    const peerConnection = new RTCPeerConnection(this.connection.provider.options.config);\n\n    this._setupListeners(peerConnection);\n\n    return peerConnection;\n  }\n\n  /** Set up various WebRTC listeners. */\n  private _setupListeners(\n    peerConnection: RTCPeerConnection\n  ) {\n    const peerId = this.connection.peer;\n    const connectionId = this.connection.connectionId;\n    const connectionType = this.connection.type;\n    const provider = this.connection.provider;\n\n    // ICE CANDIDATES.\n    logger.log(\"Listening for ICE candidates.\");\n\n    peerConnection.onicecandidate = (evt) => {\n      if (!evt.candidate || !evt.candidate.candidate) return;\n\n      logger.log(`Received ICE candidates for ${peerId}:`, evt.candidate);\n\n      provider.socket.send({\n        type: ServerMessageType.Candidate,\n        payload: {\n          candidate: evt.candidate,\n          type: connectionType,\n          connectionId: connectionId\n        },\n        dst: peerId\n      });\n    };\n\n    peerConnection.oniceconnectionstatechange = () => {\n      switch (peerConnection.iceConnectionState) {\n        case \"failed\":\n          logger.log(\n            \"iceConnectionState is failed, closing connections to \" +\n            peerId\n          );\n          this.connection.emit(\n            ConnectionEventType.Error,\n            new Error(\"Negotiation of connection to \" + peerId + \" failed.\")\n          );\n          this.connection.close();\n          break;\n        case \"closed\":\n          logger.log(\n            \"iceConnectionState is closed, closing connections to \" +\n            peerId\n          );\n          this.connection.emit(\n            ConnectionEventType.Error,\n            new Error(\"Connection to \" + peerId + \" closed.\")\n          );\n          this.connection.close();\n          break;\n        case \"disconnected\":\n          logger.log(\n            \"iceConnectionState changed to disconnected on the connection with \" +\n            peerId\n          );\n          break;\n        case \"completed\":\n          peerConnection.onicecandidate = util.noop;\n          break;\n      }\n\n      this.connection.emit(ConnectionEventType.IceStateChanged, peerConnection.iceConnectionState);\n    };\n\n    // DATACONNECTION.\n    logger.log(\"Listening for data channel\");\n    // Fired between offer and answer, so options should already be saved\n    // in the options hash.\n    peerConnection.ondatachannel = (evt) => {\n      logger.log(\"Received data channel\");\n\n      const dataChannel = evt.channel;\n      const connection = <DataConnection>(\n        provider.getConnection(peerId, connectionId)\n      );\n\n      connection.initialize(dataChannel);\n    };\n\n    // MEDIACONNECTION.\n    logger.log(\"Listening for remote stream\");\n\n    peerConnection.ontrack = (evt) => {\n      logger.log(\"Received remote stream\");\n\n      const stream = evt.streams[0];\n      const connection = provider.getConnection(peerId, connectionId);\n\n      if (connection.type === ConnectionType.Media) {\n        const mediaConnection = <MediaConnection>connection;\n\n        this._addStreamToMediaConnection(stream, mediaConnection);\n      }\n    };\n  }\n\n  cleanup(): void {\n    logger.log(\"Cleaning up PeerConnection to \" + this.connection.peer);\n\n    const peerConnection = this.connection.peerConnection;\n\n    if (!peerConnection) {\n      return;\n    }\n\n    this.connection.peerConnection = null;\n\n    //unsubscribe from all PeerConnection's events\n    peerConnection.onicecandidate = peerConnection.oniceconnectionstatechange = peerConnection.ondatachannel = peerConnection.ontrack = () => { };\n\n    const peerConnectionNotClosed = peerConnection.signalingState !== \"closed\";\n    let dataChannelNotClosed = false;\n\n    if (this.connection.type === ConnectionType.Data) {\n      const dataConnection = <DataConnection>this.connection;\n      const dataChannel = dataConnection.dataChannel;\n\n      if (dataChannel) {\n        dataChannelNotClosed = !!dataChannel.readyState && dataChannel.readyState !== \"closed\";\n      }\n    }\n\n    if (peerConnectionNotClosed || dataChannelNotClosed) {\n      peerConnection.close();\n    }\n  }\n\n  private async _makeOffer(): Promise<void> {\n    const peerConnection = this.connection.peerConnection;\n    const provider = this.connection.provider;\n\n    try {\n      const offer = await peerConnection.createOffer(\n        this.connection.options.constraints\n      );\n\n      logger.log(\"Created offer.\");\n\n      if (this.connection.options.sdpTransform && typeof this.connection.options.sdpTransform === 'function') {\n        offer.sdp = this.connection.options.sdpTransform(offer.sdp) || offer.sdp;\n      }\n\n      try {\n        await peerConnection.setLocalDescription(offer);\n\n        logger.log(\"Set localDescription:\", offer, `for:${this.connection.peer}`);\n\n        let payload: any = {\n          sdp: offer,\n          type: this.connection.type,\n          connectionId: this.connection.connectionId,\n          metadata: this.connection.metadata,\n          browser: util.browser\n        };\n\n        if (this.connection.type === ConnectionType.Data) {\n          const dataConnection = <DataConnection>this.connection;\n\n          payload = {\n            ...payload,\n            label: dataConnection.label,\n            reliable: dataConnection.reliable,\n            serialization: dataConnection.serialization\n          };\n        }\n\n        provider.socket.send({\n          type: ServerMessageType.Offer,\n          payload,\n          dst: this.connection.peer\n        });\n      } catch (err) {\n        // TODO: investigate why _makeOffer is being called from the answer\n        if (\n          err !=\n          \"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer\"\n        ) {\n          provider.emitError(PeerErrorType.WebRTC, err);\n          logger.log(\"Failed to setLocalDescription, \", err);\n        }\n      }\n    } catch (err_1) {\n      provider.emitError(PeerErrorType.WebRTC, err_1);\n      logger.log(\"Failed to createOffer, \", err_1);\n    }\n  }\n\n  private async _makeAnswer(): Promise<void> {\n    const peerConnection = this.connection.peerConnection;\n    const provider = this.connection.provider;\n\n    try {\n      const answer = await peerConnection.createAnswer();\n      logger.log(\"Created answer.\");\n\n      if (this.connection.options.sdpTransform && typeof this.connection.options.sdpTransform === 'function') {\n        answer.sdp = this.connection.options.sdpTransform(answer.sdp) || answer.sdp;\n      }\n\n      try {\n        await peerConnection.setLocalDescription(answer);\n\n        logger.log(`Set localDescription:`, answer, `for:${this.connection.peer}`);\n\n        provider.socket.send({\n          type: ServerMessageType.Answer,\n          payload: {\n            sdp: answer,\n            type: this.connection.type,\n            connectionId: this.connection.connectionId,\n            browser: util.browser\n          },\n          dst: this.connection.peer\n        });\n      } catch (err) {\n        provider.emitError(PeerErrorType.WebRTC, err);\n        logger.log(\"Failed to setLocalDescription, \", err);\n      }\n    } catch (err_1) {\n      provider.emitError(PeerErrorType.WebRTC, err_1);\n      logger.log(\"Failed to create answer, \", err_1);\n    }\n  }\n\n  /** Handle an SDP. */\n  async handleSDP(\n    type: string,\n    sdp: any\n  ): Promise<void> {\n    sdp = new RTCSessionDescription(sdp);\n    const peerConnection = this.connection.peerConnection;\n    const provider = this.connection.provider;\n\n    logger.log(\"Setting remote description\", sdp);\n\n    const self = this;\n\n    try {\n      await peerConnection.setRemoteDescription(sdp);\n      logger.log(`Set remoteDescription:${type} for:${this.connection.peer}`);\n      if (type === \"OFFER\") {\n        await self._makeAnswer();\n      }\n    } catch (err) {\n      provider.emitError(PeerErrorType.WebRTC, err);\n      logger.log(\"Failed to setRemoteDescription, \", err);\n    }\n  }\n\n  /** Handle a candidate. */\n  async handleCandidate(ice: any): Promise<void> {\n    logger.log(`handleCandidate:`, ice);\n\n    const candidate = ice.candidate;\n    const sdpMLineIndex = ice.sdpMLineIndex;\n    const sdpMid = ice.sdpMid;\n    const peerConnection = this.connection.peerConnection;\n    const provider = this.connection.provider;\n\n    try {\n      await peerConnection.addIceCandidate(\n        new RTCIceCandidate({\n          sdpMid: sdpMid,\n          sdpMLineIndex: sdpMLineIndex,\n          candidate: candidate\n        })\n      );\n      logger.log(`Added ICE candidate for:${this.connection.peer}`);\n    } catch (err) {\n      provider.emitError(PeerErrorType.WebRTC, err);\n      logger.log(\"Failed to handleCandidate, \", err);\n    }\n  }\n\n  private _addTracksToConnection(\n    stream: MediaStream,\n    peerConnection: RTCPeerConnection\n  ): void {\n    logger.log(`add tracks from stream ${stream.id} to peer connection`);\n\n    if (!peerConnection.addTrack) {\n      return logger.error(\n        `Your browser does't support RTCPeerConnection#addTrack. Ignored.`\n      );\n    }\n\n    stream.getTracks().forEach(track => {\n      peerConnection.addTrack(track, stream);\n    });\n  }\n\n  private _addStreamToMediaConnection(\n    stream: MediaStream,\n    mediaConnection: MediaConnection\n  ): void {\n    logger.log(\n      `add stream ${stream.id} to media connection ${\n      mediaConnection.connectionId\n      }`\n    );\n\n    mediaConnection.addStream(stream);\n  }\n}\n","import { EventEmitter } from \"eventemitter3\";\nimport { Peer } from \"./peer\";\nimport { ServerMessage } from \"./servermessage\";\nimport { ConnectionType } from \"./enums\";\n\nexport abstract class BaseConnection extends EventEmitter {\n  protected _open = false;\n\n  readonly metadata: any;\n  connectionId: string;\n\n  peerConnection: RTCPeerConnection;\n\n  abstract get type(): ConnectionType;\n\n  get open() {\n    return this._open;\n  }\n\n  constructor(\n    readonly peer: string,\n    public provider: Peer,\n    readonly options: any\n  ) {\n    super();\n\n    this.metadata = options.metadata;\n  }\n\n  abstract close(): void;\n\n  abstract handleMessage(message: ServerMessage): void;\n}\n","import { util } from \"./util\";\nimport logger from \"./logger\";\nimport { Negotiator } from \"./negotiator\";\nimport { ConnectionType, ConnectionEventType, ServerMessageType } from \"./enums\";\nimport { Peer } from \"./peer\";\nimport { BaseConnection } from \"./baseconnection\";\nimport { ServerMessage } from \"./servermessage\";\nimport { AnswerOption } from \"..\";\n\n/**\n * Wraps the streaming interface between two Peers.\n */\nexport class MediaConnection extends BaseConnection {\n  private static readonly ID_PREFIX = \"mc_\";\n\n  private _negotiator: Negotiator;\n  private _localStream: MediaStream;\n  private _remoteStream: MediaStream;\n\n  get type() {\n    return ConnectionType.Media;\n  }\n\n  get localStream(): MediaStream { return this._localStream; }\n  get remoteStream(): MediaStream { return this._remoteStream; }\n\n  constructor(peerId: string, provider: Peer, options: any) {\n    super(peerId, provider, options);\n\n    this._localStream = this.options._stream;\n    this.connectionId =\n      this.options.connectionId ||\n      MediaConnection.ID_PREFIX + util.randomToken();\n\n    this._negotiator = new Negotiator(this);\n\n    if (this._localStream) {\n      this._negotiator.startConnection({\n        _stream: this._localStream,\n        originator: true\n      });\n    }\n  }\n\n  addStream(remoteStream) {\n    logger.log(\"Receiving stream\", remoteStream);\n\n    this._remoteStream = remoteStream;\n    super.emit(ConnectionEventType.Stream, remoteStream); // Should we call this `open`?\n  }\n\n  handleMessage(message: ServerMessage): void {\n    const type = message.type;\n    const payload = message.payload;\n\n    switch (message.type) {\n      case ServerMessageType.Answer:\n        // Forward to negotiator\n        this._negotiator.handleSDP(type, payload.sdp);\n        this._open = true;\n        break;\n      case ServerMessageType.Candidate:\n        this._negotiator.handleCandidate(payload.candidate);\n        break;\n      default:\n        logger.warn(`Unrecognized message type:${type} from peer:${this.peer}`);\n        break;\n    }\n  }\n\n  answer(stream: MediaStream, options: AnswerOption = {}): void {\n    if (this._localStream) {\n      logger.warn(\n        \"Local stream already exists on this MediaConnection. Are you answering a call twice?\"\n      );\n      return;\n    }\n\n    this._localStream = stream;\n\n    if (options && options.sdpTransform) {\n      this.options.sdpTransform = options.sdpTransform;\n    }\n\n    this._negotiator.startConnection({ ...this.options._payload, _stream: stream });\n    // Retrieve lost messages stored because PeerConnection not set up.\n    const messages = this.provider._getMessages(this.connectionId);\n\n    for (let message of messages) {\n      this.handleMessage(message);\n    }\n\n    this._open = true;\n  }\n\n  /**\n   * Exposed functionality for users.\n   */\n\n  /** Allows user to close connection. */\n  close(): void {\n    if (this._negotiator) {\n      this._negotiator.cleanup();\n      this._negotiator = null;\n    }\n\n    this._localStream = null;\n    this._remoteStream = null;\n\n    if (this.provider) {\n      this.provider._removeConnection(this);\n\n      this.provider = null;\n    }\n\n    if (this.options && this.options._stream) {\n      this.options._stream = null;\n    }\n\n    if (!this.open) {\n      return;\n    }\n\n    this._open = false;\n\n    super.emit(ConnectionEventType.Close);\n  }\n}\n","import { EventEmitter } from \"eventemitter3\";\nimport logger from \"./logger\";\n\nexport class EncodingQueue extends EventEmitter {\n  readonly fileReader: FileReader = new FileReader();\n\n  private _queue: Blob[] = [];\n  private _processing: boolean = false;\n\n  constructor() {\n    super();\n\n    this.fileReader.onload = (evt) => {\n      this._processing = false;\n\n      if (evt.target) {\n        this.emit('done', evt.target.result as ArrayBuffer);\n      }\n\n      this.doNextTask();\n    };\n\n    this.fileReader.onerror = (evt) => {\n      logger.error(`EncodingQueue error:`, evt);\n      this._processing = false;\n      this.destroy();\n      this.emit('error', evt);\n    }\n  }\n\n  get queue(): Blob[] {\n    return this._queue;\n  }\n\n  get size(): number {\n    return this.queue.length;\n  }\n\n  get processing(): boolean {\n    return this._processing;\n  }\n\n  enque(blob: Blob): void {\n    this.queue.push(blob);\n\n    if (this.processing) return;\n\n    this.doNextTask();\n  }\n\n  destroy(): void {\n    this.fileReader.abort();\n    this._queue = [];\n  }\n\n  private doNextTask(): void {\n    if (this.size === 0) return;\n    if (this.processing) return;\n\n    this._processing = true;\n\n    this.fileReader.readAsArrayBuffer(this.queue.shift());\n  }\n}","import { util } from \"./util\";\nimport logger from \"./logger\";\nimport { Negotiator } from \"./negotiator\";\nimport {\n  ConnectionType,\n  ConnectionEventType,\n  SerializationType,\n  ServerMessageType\n} from \"./enums\";\nimport { Peer } from \"./peer\";\nimport { BaseConnection } from \"./baseconnection\";\nimport { ServerMessage } from \"./servermessage\";\nimport { EncodingQueue } from './encodingQueue';\nimport { DataConnection as IDataConnection } from '../index';\n\n/**\n * Wraps a DataChannel between two Peers.\n */\nexport class DataConnection extends BaseConnection implements IDataConnection {\n  private static readonly ID_PREFIX = \"dc_\";\n  private static readonly MAX_BUFFERED_AMOUNT = 8 * 1024 * 1024;\n\n  private _negotiator: Negotiator;\n  readonly label: string;\n  readonly serialization: SerializationType;\n  readonly reliable: boolean;\n  stringify: (data: any) => string = JSON.stringify;\n  parse: (data: string) => any = JSON.parse;\n\n  get type() {\n    return ConnectionType.Data;\n  }\n\n  private _buffer: any[] = [];\n  private _bufferSize = 0;\n  private _buffering = false;\n  private _chunkedData: {\n    [id: number]: {\n      data: Blob[],\n      count: number,\n      total: number\n    }\n  } = {};\n\n  private _dc: RTCDataChannel;\n  private _encodingQueue = new EncodingQueue();\n\n  get dataChannel(): RTCDataChannel {\n    return this._dc;\n  }\n\n  get bufferSize(): number { return this._bufferSize; }\n\n  constructor(peerId: string, provider: Peer, options: any) {\n    super(peerId, provider, options);\n\n    this.connectionId =\n      this.options.connectionId || DataConnection.ID_PREFIX + util.randomToken();\n\n    this.label = this.options.label || this.connectionId;\n    this.serialization = this.options.serialization || SerializationType.Binary;\n    this.reliable = !!this.options.reliable;\n\n    this._encodingQueue.on('done', (ab: ArrayBuffer) => {\n      this._bufferedSend(ab);\n    });\n\n    this._encodingQueue.on('error', () => {\n      logger.error(`DC#${this.connectionId}: Error occured in encoding from blob to arraybuffer, close DC`);\n      this.close();\n    });\n\n    this._negotiator = new Negotiator(this);\n\n    this._negotiator.startConnection(\n      this.options._payload || {\n        originator: true\n      }\n    );\n  }\n\n  /** Called by the Negotiator when the DataChannel is ready. */\n  initialize(dc: RTCDataChannel): void {\n    this._dc = dc;\n    this._configureDataChannel();\n  }\n\n  private _configureDataChannel(): void {\n    if (!util.supports.binaryBlob || util.supports.reliable) {\n      this.dataChannel.binaryType = \"arraybuffer\";\n    }\n\n    this.dataChannel.onopen = () => {\n      logger.log(`DC#${this.connectionId} dc connection success`);\n      this._open = true;\n      this.emit(ConnectionEventType.Open);\n    };\n\n    this.dataChannel.onmessage = (e) => {\n      logger.log(`DC#${this.connectionId} dc onmessage:`, e.data);\n      this._handleDataMessage(e);\n    };\n\n    this.dataChannel.onclose = () => {\n      logger.log(`DC#${this.connectionId} dc closed for:`, this.peer);\n      this.close();\n    };\n  }\n\n  // Handles a DataChannel message.\n  private _handleDataMessage({ data }: { data: Blob | ArrayBuffer | string }): void {\n    const datatype = data.constructor;\n\n    const isBinarySerialization = this.serialization === SerializationType.Binary ||\n      this.serialization === SerializationType.BinaryUTF8;\n\n    let deserializedData: any = data;\n\n    if (isBinarySerialization) {\n      if (datatype === Blob) {\n        // Datatype should never be blob\n        util.blobToArrayBuffer(data as Blob, (ab) => {\n          const unpackedData = util.unpack(ab);\n          this.emit(ConnectionEventType.Data, unpackedData);\n        });\n        return;\n      } else if (datatype === ArrayBuffer) {\n        deserializedData = util.unpack(data as ArrayBuffer);\n      } else if (datatype === String) {\n        // String fallback for binary data for browsers that don't support binary yet\n        const ab = util.binaryStringToArrayBuffer(data as string);\n        deserializedData = util.unpack(ab);\n      }\n    } else if (this.serialization === SerializationType.JSON) {\n      deserializedData = this.parse(data as string);\n    }\n\n    // Check if we've chunked--if so, piece things back together.\n    // We're guaranteed that this isn't 0.\n    if (deserializedData.__peerData) {\n      this._handleChunk(deserializedData);\n      return;\n    }\n\n    super.emit(ConnectionEventType.Data, deserializedData);\n  }\n\n  private _handleChunk(data: { __peerData: number, n: number, total: number, data: Blob }): void {\n    const id = data.__peerData;\n    const chunkInfo = this._chunkedData[id] || {\n      data: [],\n      count: 0,\n      total: data.total\n    };\n\n    chunkInfo.data[data.n] = data.data;\n    chunkInfo.count++;\n    this._chunkedData[id] = chunkInfo;\n\n    if (chunkInfo.total === chunkInfo.count) {\n      // Clean up before making the recursive call to `_handleDataMessage`.\n      delete this._chunkedData[id];\n\n      // We've received all the chunks--time to construct the complete data.\n      const data = new Blob(chunkInfo.data);\n      this._handleDataMessage({ data });\n    }\n  }\n\n  /**\n   * Exposed functionality for users.\n   */\n\n  /** Allows user to close connection. */\n  close(): void {\n    this._buffer = [];\n    this._bufferSize = 0;\n    this._chunkedData = {};\n\n    if (this._negotiator) {\n      this._negotiator.cleanup();\n      this._negotiator = null;\n    }\n\n    if (this.provider) {\n      this.provider._removeConnection(this);\n\n      this.provider = null;\n    }\n\n    if (this.dataChannel) {\n      this.dataChannel.onopen = null;\n      this.dataChannel.onmessage = null;\n      this.dataChannel.onclose = null;\n      this._dc = null;\n    }\n\n    if (this._encodingQueue) {\n      this._encodingQueue.destroy();\n      this._encodingQueue.removeAllListeners();\n      this._encodingQueue = null;\n    }\n\n    if (!this.open) {\n      return;\n    }\n\n    this._open = false;\n\n    super.emit(ConnectionEventType.Close);\n  }\n\n  /** Allows user to send data. */\n  send(data: any, chunked?: boolean): void {\n    if (!this.open) {\n      super.emit(\n        ConnectionEventType.Error,\n        new Error(\n          \"Connection is not open. You should listen for the `open` event before sending messages.\"\n        )\n      );\n      return;\n    }\n\n    if (this.serialization === SerializationType.JSON) {\n      this._bufferedSend(this.stringify(data));\n    } else if (\n      this.serialization === SerializationType.Binary ||\n      this.serialization === SerializationType.BinaryUTF8\n    ) {\n      const blob = util.pack(data);\n\n      if (!chunked && blob.size > util.chunkedMTU) {\n        this._sendChunks(blob);\n        return;\n      }\n\n      if (!util.supports.binaryBlob) {\n        // We only do this if we really need to (e.g. blobs are not supported),\n        // because this conversion is costly.\n        this._encodingQueue.enque(blob);\n      } else {\n        this._bufferedSend(blob);\n      }\n    } else {\n      this._bufferedSend(data);\n    }\n  }\n\n  private _bufferedSend(msg: any): void {\n    if (this._buffering || !this._trySend(msg)) {\n      this._buffer.push(msg);\n      this._bufferSize = this._buffer.length;\n    }\n  }\n\n  // Returns true if the send succeeds.\n  private _trySend(msg: any): boolean {\n    if (!this.open) {\n      return false;\n    }\n\n    if (this.dataChannel.bufferedAmount > DataConnection.MAX_BUFFERED_AMOUNT) {\n      this._buffering = true;\n      setTimeout(() => {\n        this._buffering = false;\n        this._tryBuffer();\n      }, 50);\n\n      return false;\n    }\n\n    try {\n      this.dataChannel.send(msg);\n    } catch (e) {\n      logger.error(`DC#:${this.connectionId} Error when sending:`, e);\n      this._buffering = true;\n\n      this.close();\n\n      return false;\n    }\n\n    return true;\n  }\n\n  // Try to send the first message in the buffer.\n  private _tryBuffer(): void {\n    if (!this.open) {\n      return;\n    }\n\n    if (this._buffer.length === 0) {\n      return;\n    }\n\n    const msg = this._buffer[0];\n\n    if (this._trySend(msg)) {\n      this._buffer.shift();\n      this._bufferSize = this._buffer.length;\n      this._tryBuffer();\n    }\n  }\n\n  private _sendChunks(blob: Blob): void {\n    const blobs = util.chunk(blob);\n    logger.log(`DC#${this.connectionId} Try to send ${blobs.length} chunks...`);\n\n    for (let blob of blobs) {\n      this.send(blob, true);\n    }\n  }\n\n  handleMessage(message: ServerMessage): void {\n    const payload = message.payload;\n\n    switch (message.type) {\n      case ServerMessageType.Answer:\n        this._negotiator.handleSDP(message.type, payload.sdp);\n        break;\n      case ServerMessageType.Candidate:\n        this._negotiator.handleCandidate(payload.candidate);\n        break;\n      default:\n        logger.warn(\n          \"Unrecognized message type:\",\n          message.type,\n          \"from peer:\",\n          this.peer\n        );\n        break;\n    }\n  }\n}\n","import { util } from \"./util\";\nimport logger from \"./logger\";\n\nexport class API {\n  constructor(private readonly _options: any) { }\n\n  private _buildUrl(method: string): string {\n    const protocol = this._options.secure ? \"https://\" : \"http://\";\n    let url =\n      protocol +\n      this._options.host +\n      \":\" +\n      this._options.port +\n      this._options.path +\n      this._options.key +\n      \"/\" +\n      method;\n    const queryString = \"?ts=\" + new Date().getTime() + \"\" + Math.random();\n    url += queryString;\n\n    return url;\n  }\n\n  /** Get a unique ID from the server via XHR and initialize with it. */\n  async retrieveId(): Promise<string> {\n    const url = this._buildUrl(\"id\");\n\n    try {\n      const response = await fetch(url);\n\n      if (response.status !== 200) {\n        throw new Error(`Error. Status:${response.status}`);\n      }\n\n      return response.text();\n    } catch (error) {\n      logger.error(\"Error retrieving ID\", error);\n\n      let pathError = \"\";\n\n      if (\n        this._options.path === \"/\" &&\n        this._options.host !== util.CLOUD_HOST\n      ) {\n        pathError =\n          \" If you passed in a `path` to your self-hosted PeerServer, \" +\n          \"you'll also need to pass in that same path when creating a new \" +\n          \"Peer.\";\n      }\n\n      throw new Error(\"Could not get an ID from the server.\" + pathError);\n    }\n  }\n\n  /** @deprecated */\n  async listAllPeers(): Promise<any[]> {\n    const url = this._buildUrl(\"peers\");\n\n    try {\n      const response = await fetch(url);\n\n      if (response.status !== 200) {\n        if (response.status === 401) {\n          let helpfulError = \"\";\n\n          if (this._options.host === util.CLOUD_HOST) {\n            helpfulError =\n              \"It looks like you're using the cloud server. You can email \" +\n              \"team@peerjs.com to enable peer listing for your API key.\";\n          } else {\n            helpfulError =\n              \"You need to enable `allow_discovery` on your self-hosted \" +\n              \"PeerServer to use this feature.\";\n          }\n\n          throw new Error(\"It doesn't look like you have permission to list peers IDs. \" +\n            helpfulError);\n        }\n\n        throw new Error(`Error. Status:${response.status}`);\n      }\n\n      return response.json();\n    } catch (error) {\n      logger.error(\"Error retrieving list peers\", error);\n\n      throw new Error(\"Could not get list peers from the server.\" + error);\n    }\n  }\n}\n","import { EventEmitter } from \"eventemitter3\";\nimport { util } from \"./util\";\nimport logger, { LogLevel } from \"./logger\";\nimport { Socket } from \"./socket\";\nimport { MediaConnection } from \"./mediaconnection\";\nimport { DataConnection } from \"./dataconnection\";\nimport {\n  ConnectionType,\n  PeerErrorType,\n  PeerEventType,\n  SocketEventType,\n  ServerMessageType\n} from \"./enums\";\nimport { BaseConnection } from \"./baseconnection\";\nimport { ServerMessage } from \"./servermessage\";\nimport { API } from \"./api\";\nimport { PeerConnectOption, PeerJSOption } from \"..\";\n\nclass PeerOptions implements PeerJSOption {\n  debug?: LogLevel; // 1: Errors, 2: Warnings, 3: All logs\n  host?: string;\n  port?: number;\n  path?: string;\n  key?: string;\n  token?: string;\n  config?: any;\n  secure?: boolean;\n  pingInterval?: number;\n  logFunction?: (logLevel: LogLevel, ...rest: any[]) => void;\n}\n\n/**\n * A peer who can initiate connections with other peers.\n */\nexport class Peer extends EventEmitter {\n  private static readonly DEFAULT_KEY = \"peerjs\";\n\n  private readonly _options: PeerOptions;\n  private readonly _api: API;\n  private readonly _socket: Socket;\n\n  private _id: string | null = null;\n  private _lastServerId: string | null = null;\n\n  // States.\n  private _destroyed = false; // Connections have been killed\n  private _disconnected = false; // Connection to PeerServer killed but P2P connections still active\n  private _open = false; // Sockets and such are not yet open.\n  private readonly _connections: Map<string, BaseConnection[]> = new Map(); // All connections for this peer.\n  private readonly _lostMessages: Map<string, ServerMessage[]> = new Map(); // src => [list of messages]\n\n  get id() {\n    return this._id;\n  }\n\n  get options() {\n    return this._options;\n  }\n\n  get open() {\n    return this._open;\n  }\n\n  get socket() {\n    return this._socket;\n  }\n\n  /**\n   * @deprecated \n   * Return type will change from Object to Map<string,[]> \n   */\n  get connections(): Object {\n    const plainConnections = Object.create(null);\n\n    for (let [k, v] of this._connections) {\n      plainConnections[k] = v;\n    }\n\n    return plainConnections;\n  }\n\n  get destroyed() {\n    return this._destroyed;\n  }\n  get disconnected() {\n    return this._disconnected;\n  }\n\n  constructor(id?: string | PeerOptions, options?: PeerOptions) {\n    super();\n\n    let userId: string | undefined;\n\n    // Deal with overloading\n    if (id && id.constructor == Object) {\n      options = id as PeerOptions;\n    } else if (id) {\n      userId = id.toString();\n    }\n\n    // Configurize options\n    options = {\n      debug: 0, // 1: Errors, 2: Warnings, 3: All logs\n      host: util.CLOUD_HOST,\n      port: util.CLOUD_PORT,\n      path: \"/\",\n      key: Peer.DEFAULT_KEY,\n      token: util.randomToken(),\n      config: util.defaultConfig,\n      ...options\n    };\n    this._options = options;\n\n    // Detect relative URL host.\n    if (this._options.host === \"/\") {\n      this._options.host = window.location.hostname;\n    }\n\n    // Set path correctly.\n    if (this._options.path) {\n      if (this._options.path[0] !== \"/\") {\n        this._options.path = \"/\" + this._options.path;\n      }\n      if (this._options.path[this._options.path.length - 1] !== \"/\") {\n        this._options.path += \"/\";\n      }\n    }\n\n    // Set whether we use SSL to same as current host\n    if (this._options.secure === undefined && this._options.host !== util.CLOUD_HOST) {\n      this._options.secure = util.isSecure();\n    } else if (this._options.host == util.CLOUD_HOST) {\n      this._options.secure = true;\n    }\n    // Set a custom log function if present\n    if (this._options.logFunction) {\n      logger.setLogFunction(this._options.logFunction);\n    }\n\n    logger.logLevel = this._options.debug || 0;\n\n    this._api = new API(options);\n    this._socket = this._createServerConnection();\n\n    // Sanity checks\n    // Ensure WebRTC supported\n    if (!util.supports.audioVideo && !util.supports.data) {\n      this._delayedAbort(\n        PeerErrorType.BrowserIncompatible,\n        \"The current browser does not support WebRTC\"\n      );\n      return;\n    }\n\n    // Ensure alphanumeric id\n    if (!!userId && !util.validateId(userId)) {\n      this._delayedAbort(PeerErrorType.InvalidID, `ID \"${userId}\" is invalid`);\n      return;\n    }\n\n    if (userId) {\n      this._initialize(userId);\n    } else {\n      this._api.retrieveId()\n        .then(id => this._initialize(id))\n        .catch(error => this._abort(PeerErrorType.ServerError, error));\n    }\n  }\n\n  private _createServerConnection(): Socket {\n    const socket = new Socket(\n      this._options.secure,\n      this._options.host!,\n      this._options.port!,\n      this._options.path!,\n      this._options.key!,\n      this._options.pingInterval\n    );\n\n    socket.on(SocketEventType.Message, (data: ServerMessage) => {\n      this._handleMessage(data);\n    });\n\n    socket.on(SocketEventType.Error, (error: string) => {\n      this._abort(PeerErrorType.SocketError, error);\n    });\n\n    socket.on(SocketEventType.Disconnected, () => {\n      if (this.disconnected) {\n        return;\n      }\n\n      this.emitError(PeerErrorType.Network, \"Lost connection to server.\");\n      this.disconnect();\n    });\n\n    socket.on(SocketEventType.Close, () => {\n      if (this.disconnected) {\n        return;\n      }\n\n      this._abort(PeerErrorType.SocketClosed, \"Underlying socket is already closed.\");\n    });\n\n    return socket;\n  }\n\n  /** Initialize a connection with the server. */\n  private _initialize(id: string): void {\n    this._id = id;\n    this.socket.start(id, this._options.token!);\n  }\n\n  /** Handles messages from the server. */\n  private _handleMessage(message: ServerMessage): void {\n    const type = message.type;\n    const payload = message.payload;\n    const peerId = message.src;\n\n    switch (type) {\n      case ServerMessageType.Open: // The connection to the server is open.\n        this._lastServerId = this.id;\n        this._open = true;\n        this.emit(PeerEventType.Open, this.id);\n        break;\n      case ServerMessageType.Error: // Server error.\n        this._abort(PeerErrorType.ServerError, payload.msg);\n        break;\n      case ServerMessageType.IdTaken: // The selected ID is taken.\n        this._abort(PeerErrorType.UnavailableID, `ID \"${this.id}\" is taken`);\n        break;\n      case ServerMessageType.InvalidKey: // The given API key cannot be found.\n        this._abort(PeerErrorType.InvalidKey, `API KEY \"${this._options.key}\" is invalid`);\n        break;\n      case ServerMessageType.Leave: // Another peer has closed its connection to this peer.\n        logger.log(`Received leave message from ${peerId}`);\n        this._cleanupPeer(peerId);\n        this._connections.delete(peerId);\n        break;\n      case ServerMessageType.Expire: // The offer sent to a peer has expired without response.\n        this.emitError(PeerErrorType.PeerUnavailable, `Could not connect to peer ${peerId}`);\n        break;\n      case ServerMessageType.Offer: {\n        // we should consider switching this to CALL/CONNECT, but this is the least breaking option.\n        const connectionId = payload.connectionId;\n        let connection = this.getConnection(peerId, connectionId);\n\n        if (connection) {\n          connection.close();\n          logger.warn(`Offer received for existing Connection ID:${connectionId}`);\n        }\n\n        // Create a new connection.\n        if (payload.type === ConnectionType.Media) {\n          connection = new MediaConnection(peerId, this, {\n            connectionId: connectionId,\n            _payload: payload,\n            metadata: payload.metadata\n          });\n          this._addConnection(peerId, connection);\n          this.emit(PeerEventType.Call, connection);\n        } else if (payload.type === ConnectionType.Data) {\n          connection = new DataConnection(peerId, this, {\n            connectionId: connectionId,\n            _payload: payload,\n            metadata: payload.metadata,\n            label: payload.label,\n            serialization: payload.serialization,\n            reliable: payload.reliable\n          });\n          this._addConnection(peerId, connection);\n          this.emit(PeerEventType.Connection, connection);\n        } else {\n          logger.warn(`Received malformed connection type:${payload.type}`);\n          return;\n        }\n\n        // Find messages.\n        const messages = this._getMessages(connectionId);\n        for (let message of messages) {\n          connection.handleMessage(message);\n        }\n\n        break;\n      }\n      default: {\n        if (!payload) {\n          logger.warn(`You received a malformed message from ${peerId} of type ${type}`);\n          return;\n        }\n\n        const connectionId = payload.connectionId;\n        const connection = this.getConnection(peerId, connectionId);\n\n        if (connection && connection.peerConnection) {\n          // Pass it on.\n          connection.handleMessage(message);\n        } else if (connectionId) {\n          // Store for possible later use\n          this._storeMessage(connectionId, message);\n        } else {\n          logger.warn(\"You received an unrecognized message:\", message);\n        }\n        break;\n      }\n    }\n  }\n\n  /** Stores messages without a set up connection, to be claimed later. */\n  private _storeMessage(connectionId: string, message: ServerMessage): void {\n    if (!this._lostMessages.has(connectionId)) {\n      this._lostMessages.set(connectionId, []);\n    }\n\n    this._lostMessages.get(connectionId).push(message);\n  }\n\n  /** Retrieve messages from lost message store */\n  //TODO Change it to private\n  public _getMessages(connectionId: string): ServerMessage[] {\n    const messages = this._lostMessages.get(connectionId);\n\n    if (messages) {\n      this._lostMessages.delete(connectionId);\n      return messages;\n    }\n\n    return [];\n  }\n\n  /**\n   * Returns a DataConnection to the specified peer. See documentation for a\n   * complete list of options.\n   */\n  connect(peer: string, options: PeerConnectOption = {}): DataConnection {\n    if (this.disconnected) {\n      logger.warn(\n        \"You cannot connect to a new Peer because you called \" +\n        \".disconnect() on this Peer and ended your connection with the \" +\n        \"server. You can create a new Peer to reconnect, or call reconnect \" +\n        \"on this peer if you believe its ID to still be available.\"\n      );\n      this.emitError(\n        PeerErrorType.Disconnected,\n        \"Cannot connect to new Peer after disconnecting from server.\"\n      );\n      return;\n    }\n\n    const dataConnection = new DataConnection(peer, this, options);\n    this._addConnection(peer, dataConnection);\n    return dataConnection;\n  }\n\n  /**\n   * Returns a MediaConnection to the specified peer. See documentation for a\n   * complete list of options.\n   */\n  call(peer: string, stream: MediaStream, options: any = {}): MediaConnection {\n    if (this.disconnected) {\n      logger.warn(\n        \"You cannot connect to a new Peer because you called \" +\n        \".disconnect() on this Peer and ended your connection with the \" +\n        \"server. You can create a new Peer to reconnect.\"\n      );\n      this.emitError(\n        PeerErrorType.Disconnected,\n        \"Cannot connect to new Peer after disconnecting from server.\"\n      );\n      return;\n    }\n\n    if (!stream) {\n      logger.error(\n        \"To call a peer, you must provide a stream from your browser's `getUserMedia`.\"\n      );\n      return;\n    }\n\n    options._stream = stream;\n\n    const mediaConnection = new MediaConnection(peer, this, options);\n    this._addConnection(peer, mediaConnection);\n    return mediaConnection;\n  }\n\n  /** Add a data/media connection to this peer. */\n  private _addConnection(peerId: string, connection: BaseConnection): void {\n    logger.log(`add connection ${connection.type}:${connection.connectionId} to peerId:${peerId}`);\n\n    if (!this._connections.has(peerId)) {\n      this._connections.set(peerId, []);\n    }\n    this._connections.get(peerId).push(connection);\n  }\n\n  //TODO should be private\n  _removeConnection(connection: BaseConnection): void {\n    const connections = this._connections.get(connection.peer);\n\n    if (connections) {\n      const index = connections.indexOf(connection);\n\n      if (index !== -1) {\n        connections.splice(index, 1);\n      }\n    }\n\n    //remove from lost messages\n    this._lostMessages.delete(connection.connectionId);\n  }\n\n  /** Retrieve a data/media connection for this peer. */\n  getConnection(peerId: string, connectionId: string): null | BaseConnection {\n    const connections = this._connections.get(peerId);\n    if (!connections) {\n      return null;\n    }\n\n    for (let connection of connections) {\n      if (connection.connectionId === connectionId) {\n        return connection;\n      }\n    }\n\n    return null;\n  }\n\n  private _delayedAbort(type: PeerErrorType, message: string | Error): void {\n    setTimeout(() => {\n      this._abort(type, message);\n    }, 0);\n  }\n\n  /**\n   * Emits an error message and destroys the Peer.\n   * The Peer is not destroyed if it's in a disconnected state, in which case\n   * it retains its disconnected state and its existing connections.\n   */\n  private _abort(type: PeerErrorType, message: string | Error): void {\n    logger.error(\"Aborting!\");\n\n    this.emitError(type, message);\n\n    if (!this._lastServerId) {\n      this.destroy();\n    } else {\n      this.disconnect();\n    }\n  }\n\n  /** Emits a typed error message. */\n  emitError(type: PeerErrorType, err: string | Error): void {\n    logger.error(\"Error:\", err);\n\n    let error: Error & { type?: PeerErrorType };\n\n    if (typeof err === \"string\") {\n      error = new Error(err);\n    } else {\n      error = err as Error;\n    }\n\n    error.type = type;\n\n    this.emit(PeerEventType.Error, error);\n  }\n\n  /**\n   * Destroys the Peer: closes all active connections as well as the connection\n   *  to the server.\n   * Warning: The peer can no longer create or accept connections after being\n   *  destroyed.\n   */\n  destroy(): void {\n    if (this.destroyed) {\n      return;\n    }\n\n    logger.log(`Destroy peer with ID:${this.id}`);\n\n    this.disconnect();\n    this._cleanup();\n\n    this._destroyed = true;\n\n    this.emit(PeerEventType.Close);\n  }\n\n  /** Disconnects every connection on this peer. */\n  private _cleanup(): void {\n    for (let peerId of this._connections.keys()) {\n      this._cleanupPeer(peerId);\n      this._connections.delete(peerId);\n    }\n\n    this.socket.removeAllListeners();\n  }\n\n  /** Closes all connections to this peer. */\n  private _cleanupPeer(peerId: string): void {\n    const connections = this._connections.get(peerId);\n\n    if (!connections) return;\n\n    for (let connection of connections) {\n      connection.close();\n    }\n  }\n\n  /**\n   * Disconnects the Peer's connection to the PeerServer. Does not close any\n   *  active connections.\n   * Warning: The peer can no longer create or accept connections after being\n   *  disconnected. It also cannot reconnect to the server.\n   */\n  disconnect(): void {\n    if (this.disconnected) {\n      return;\n    }\n\n    const currentId = this.id;\n\n    logger.log(`Disconnect peer with ID:${currentId}`);\n\n    this._disconnected = true;\n    this._open = false;\n\n    this.socket.close();\n\n    this._lastServerId = currentId;\n    this._id = null;\n\n    this.emit(PeerEventType.Disconnected, currentId);\n  }\n\n  /** Attempts to reconnect with the same ID. */\n  reconnect(): void {\n    if (this.disconnected && !this.destroyed) {\n      logger.log(`Attempting reconnection to server with ID ${this._lastServerId}`);\n      this._disconnected = false;\n      this._initialize(this._lastServerId!);\n    } else if (this.destroyed) {\n      throw new Error(\"This peer cannot reconnect to the server. It has already been destroyed.\");\n    } else if (!this.disconnected && !this.open) {\n      // Do nothing. We're still connecting the first time.\n      logger.error(\"In a hurry? We're still trying to make the initial connection!\");\n    } else {\n      throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`);\n    }\n  }\n\n  /**\n   * Get a list of available peer IDs. If you're running your own server, you'll\n   * want to set allow_discovery: true in the PeerServer options. If you're using\n   * the cloud server, email team@peerjs.com to get the functionality enabled for\n   * your key.\n   */\n  listAllPeers(cb = (_: any[]) => { }): void {\n    this._api.listAllPeers()\n      .then(peers => cb(peers))\n      .catch(error => this._abort(PeerErrorType.ServerError, error));\n  }\n}\n","import { Chessground } from \"chessground\";\n\nimport Peer from \"peerjs\";\n\nlet path = location.pathname.substr(1);\nif (path) {\n  console.log(\"!!!\", path);\n  const peer = new Peer(null, {\n    debug: 2,\n  });\n  const conn = peer.connect(path);\n  conn.on(\"open\", () => {\n    conn.send(\"hi!\");\n    console.log(\"sent hi\");\n  });\n} else {\n  const peer = new Peer(null, {\n    debug: 2,\n  });\n  peer.on(\"open\", function (id) {\n    console.log(\"My peer ID is: \" + id);\n    // location.replace(id);\n  });\n  peer.on(\"connection\", (conn) => {\n    console.log(\"123 connected\");\n    conn.on(\"data\", (data) => {\n      // Will print 'hi!'\n      console.log(data);\n    });\n    conn.on(\"open\", () => {\n      conn.send(\"hello!\");\n    });\n    peer.on(\"disconnected\", function () {\n      console.log(\"Connection lost. Please reconnect\");\n    });\n    peer.on(\"close\", function () {\n      console.log(\"Connection destroyed\");\n    });\n    peer.on(\"error\", function (err) {\n      console.log(err);\n    });\n  });\n}\n\nconst config = { fen: \"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR\" };\nconst board = document.getElementById(\"board\");\nconst ground = Chessground(board, config);\n"]}